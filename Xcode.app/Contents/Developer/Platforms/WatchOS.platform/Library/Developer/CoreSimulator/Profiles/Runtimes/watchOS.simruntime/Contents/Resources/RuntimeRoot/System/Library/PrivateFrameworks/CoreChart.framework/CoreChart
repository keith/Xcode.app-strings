@(#)PROGRAM:CoreChart  PROJECT:CoreChart-1
v8@?0
com.apple.CoreChart
renderer
strokeOffset
items
size
cornerRadius
width
angle
height
opacity
zindex
strokeMiterLimit
fillOpacity
strokeOpacity
strokeWidth
radius
theta
fontSize
interpolate
orient
path
strokeCap
strokeJoin
shape
baseline
fontStyle
font
fontWeight
align
clip
text
length
defined
bounds
fill
stroke
strokeDash
_caLayer
_caDirty
com.apple.CoreChart-Transaction
bold
-cc-internal-
sans-serif
Helvetica
serif
Times
monospace
Courier
system-ui
-apple-system
-apple-system-rounded
-apple-system-monospaced
-apple-system-serif
traitCollection
italic
oblique
right
center
largeTitle
title1
title2
title3
headline
subheadline
body
callout
footnote
caption1
caption2
normal
-cc-internal-%@-%@
default
%@-%llu-%ld
fontFamily
fontName
pointSize
ascender
descender
leading
xHeight
capHeight
lineHeight
small-caps
bolder
lighter
%@-%@
%lf$$%@$$%@$$%@$$%@$$%@
__chartViewDataRowID
Unknown argument type given to console.log
var console = {};
console
warn
error
v24@?0@"JSContext"8@"JSValue"16
line
column
stack
square
round
bevel
cornerRadiusTopLeft
cornerRadiusTopRight
cornerRadiusBottomLeft
cornerRadiusBottomRight
stops
color
offset
gradient
radial
alphabetic
middle
bottom
line-top
line-bottom
left
nativeNumberFormat
nativeDateComponentsFormat
nativeDateFormat
nativeTextMetrics
nativeFontMetrics
number
format
positiveFormat
negativeFormat
numberStyle
decimal
percent
scientific
spellOut
ordinal
currency
currencyAccounting
currencyISOCode
currencyPlural 
formatterBehavior
10_4
multiplier
@"JSValue"8@?0
year
yearForWeekOfYear
quarter
month
weekOfYear
weekOfMonth
weekday
weekdayOrdinal
hour
minute
second
nanosecond
calendar
timeZone
date-components
unitsStyle
full
short
brief
abbreviated
positional
includesApproximationPhrase
includesTimeRemainingPhrase
allowedUnits
allowsFractionalUnits
collapsesLargestUnit
maximumUnitCount
zeroFormattingBehavior
none
dropLeading
dropMiddle
dropTrailing
dropAll
medium
long
date
dateStyle
timeStyle
dateFormat
localizedFormatFromTemplate
fontVariant
You must either override enterMark, and updateMark
You must either override enterMultiMark, and updateMultiMark
You must override pathForMark
vega
pathRender
pathParse
context
parentNode
recursiveSetSize
__tmp_propertyAccess
typeof __tmp_propertyAccess
function
bind
__LogProxy_wrapped
linear
linear-closed
cardinal
basis
basis-open
monotone
vertical
step
step-after
step-before
window
HTMLElement
document
@"JSValue"20@?0@"JSValue"8i16
setTimeout
setInterval
v16@?0@"JSValue"8
clearTimeout
clearInterval
expressionFunction
CCVegaWorkerDispatchQueueID
scaleX
scaleY
horizontal
tension
interactive
marktype
name
role
allocator<T>::allocate(size_t n) 'n' exceeds maximum supported size
__tmp_instance
__tmp_handler
new Proxy(__tmp_instance, __tmp_handler);
__tmp_proxy
Object.defineProperty(__tmp_proxy, '__LogProxy_wrapped', {  enumerable: true,  value: __tmp_instance,});
startAngle
endAngle
padAngle
innerRadius
outerRadius
aspect
CCChartViewZoomFactor
CCChartViewBaseConfig
CCChartViewDelegate
CCChartViewRendererType
CCChartViewCATransactionFromBackgroundThread
CCBaseConfigApple
CCBaseConfigVega
CCRendererTypeCoreGraphics
CCRendererTypeCoreAnimation
mousemove
mousedown
mouseup
source_0
v24@?0@"NSString"8@"JSValue"16
Cannot set accessibilityElements on chart view.
prepareSpecDict
spec
config
baseConfig
mode
vega-lite
precompileSpec
json
result
compileError
message
v16@?0@?<v@?>8
vega-lite.js
vega.js
cc-bootstrap.js
VEGA_VERSION
VEGA_LITE_VERSION
5.13.0
4.14.1
script://
rect
symbol
rule
area
group
image
callFunction
blend
multiply
screen
overlay
darken
lighten
color-dodge
color-burn
hard-light
soft-light
difference
exclusion
saturation
luminosity
source-over
aria
description
ariaRoleDescription
12px system-ui
butt
miter
canvas
rgb(
rgba(
cross
diamond
arrow
wedge
triangle
triangle-up
triangle-down
triangle-right
triangle-left
circle
undefined
URL loading not supported
prepareSpecDictForRuntime
createViewRenderer
CCVegaCARenderer
CADelegate
CCVegaCanvasRenderer
devicePixelRatio
setScaleZoomFactor
finalize
@"NSObject"24@?0@"JSValue"8@"NSString"16
setupSignalHandler
textStyle
string
identifier
firstWeekday
languageCode
countryCode
currencySymbol
groupingSeparator
decimalSeparator
usesMetricSystem
quotationBeginDelimiter
quotationEndDelimiter
alternateQuotationBeginDelimiter
alternateQuotationEndDelimiter
characterDirection
leftToRight
rightToLeft
topToBottom
bottomToTop
unknown
locale
macOS
tvOS
watchOS
macCatalyst
simulator
version
majorVersion
minorVersion
patchVersion
safeSetSignal
mainScreenWidth
mainScreenHeight
contentScaleFactor
touchDataflow
vegaView
resize
getWidth
getHeight
runAsync
then
catch
getContext
rerender
redraw
B16@?0@"<CCChartDataRow>"8
safeGetSignal
safeAddSignalListener
safeRemoveSignalListener
saveState
loadState
data:image/png;base64,
data:image/jpeg;base64,
isEventConsumed
v32@?0@"<CCChartDataRow>"8Q16^B24
changeset
insert
remove
change
aliceblue
antiquewhite
aqua
aquamarine
azure
beige
bisque
black
blanchedalmond
blue
blueviolet
brown
burlywood
cadetblue
chartreuse
chocolate
coral
cornflowerblue
cornsilk
crimson
cyan
darkblue
darkcyan
darkgoldenrod
darkgray
darkgreen
darkgrey
darkkhaki
darkmagenta
darkolivegreen
darkorange
darkorchid
darkred
darksalmon
darkseagreen
darkslateblue
darkslategray
darkslategrey
darkturquoise
darkviolet
deeppink
deepskyblue
dimgray
dimgrey
dodgerblue
firebrick
floralwhite
forestgreen
fuchsia
gainsboro
ghostwhite
gold
goldenrod
gray
green
greenyellow
grey
honeydew
hotpink
indianred
indigo
ivory
khaki
lavender
lavenderblush
lawngreen
lemonchiffon
lightblue
lightcoral
lightcyan
lightgoldenrodyellow
lightgray
lightgreen
lightgrey
lightpink
lightsalmon
lightseagreen
lightskyblue
lightslategray
lightslategrey
lightsteelblue
lightyellow
lime
limegreen
linen
magenta
maroon
mediumaquamarine
mediumblue
mediumorchid
mediumpurple
mediumseagreen
mediumslateblue
mediumspringgreen
mediumturquoise
mediumvioletred
midnightblue
mintcream
mistyrose
moccasin
navajowhite
navy
oldlace
olive
olivedrab
orange
orangered
orchid
palegoldenrod
palegreen
paleturquoise
palevioletred
papayawhip
peachpuff
peru
pink
plum
powderblue
purple
rebeccapurple
rosybrown
royalblue
saddlebrown
salmon
sandybrown
seagreen
seashell
sienna
silver
skyblue
slateblue
slategray
slategrey
snow
springgreen
steelblue
teal
thistle
tomato
turquoise
violet
wheat
white
whitesmoke
yellow
yellowgreen
CCVegaTransaction:begin
CCVegaTransaction:commit
CCVegaJSFont: font style '%s' doesn't exist
chartViewDataRowID(%p): address for self is larger than 2^53-1, taking the lowest 53 bits as row ID
JS console log: %s
JS console warning: %s
JS console error: %s
Unhandled exception: %s
In context: %s
Line %s, column %s
Stacktrace: %s
unexpected text baseline property: %s
unexpected text align property: %s
Getting property "%s" on LogProxy wrapped object %s
Get for missing property "%s" on LogProxy wrapped object %s
Setting property "%s" on LogProxy wrapped object %s to value "%s"
Set for missing property "%s" on LogProxy wrapped object %s to value %s
curve interpolate type %s is not implemented in the CoreAnimation renderer
CCVegaWorker: expression function '%s' called without a worker client.
CCVegaWorker(%p):dealloc
CCVegaWorkerClient: expression function '%s' is not registered for use with this client.
CCChartView(%p):dealloc
CCChartView(%p):initialize
CCChartView(%p): setupWithSpec called multiple times. This will result in unexpected behavior
render CGImage: (%.2lfx%.2lf, scale factor = %.2lf)
CCChartView(%p):lazilyInitializeRenderer
CCChartView(%p):reinitializeRenderer
CCChartView::renderToImageWithType the specified image type is not supported
Vega: %s, Vega-Lite: %s
CCVegaCARenderer(%p):updateCALayers, skipped because there is no root layer
CCVegaCARenderer(%p):updateCALayers, dirtyAll = %d
CCVegaCARenderer(%p): mark type '%s' not implemented
CCVegaCARenderer(%p):invalidateCaches
CCVegaCARenderer(%p):dealloc
CCVegaRenderer(%p):init
CCVegaRenderer(%p):displayWithCommitter
CCVegaRenderer(%p):displayWithCommitter updateCALayers
CCVegaRenderer(%p):displayWithCommitter rendererDidUpdate
CCVegaRenderer(%p):dealloc
CCVegaRenderer(%p):isActive cannot be set to false once it's true
CCVegaRenderer(%p):updateNativeView
CCVegaRenderer(%p):runAsync: use runAsyncWithCallback instead
CCVegaRenderer(%p):runAsyncWithCallback: we should have a valid callback
CCVegaRenderer(%p):runAsyncWithCallback
Unexpected error in runAsync
CCVegaRenderer(%p):setSize: %.2lf %.2lf, was %.2lf %.2lf
CCVegaRenderer(%p):updateScaleZoomFactor scaleFactor = %.2lf zoomFactor = %.2lf
Encountered extra properties on canvas: %s
Encountered extra properties on canvas context: %s
CoreGraphics renderer doesn't support exporting as PDF
CCVegaRenderer(%p):rerenderEntireChart
CCVegaRenderer(%p):changeDataset: %s
CCVegaRenderer(%p):processEvent %s %lf %lf
CCVegaRenderer(%p):setSignal: %s
zPLR
zPLR
zPLR
zPLR
zPLR
zPLR
zPLR
zPLR
zPLR
CCVegaRuleMarkDef
CCVegaLogger
CCVegaGroupMarkDef
CCVegaMarkItem
CCVegaMarkItemInterface
CCWeakLayerReference
CCVegaTransaction
CCVegaTransactionCommitter
CCVegaTransactionMainThreadOperation
CCVegaSignalListener
CCVegaJSFont
CCVegaCGFontProperties
CCVegaJSFontCache
CCChartDataRow
NSObject
CCChartDataRowBinding
CCVegaJSConsole
CCVegaScenegraphUtils
CCVegaRectMarkDef
CCVegaTextMarkDef
CCVegaExpressionFunctions
CCTextLayerLineData
CCTextLayer
CCVegaMarkDef
CCVegaMarkDefInterface
JSExport
CCVegaSingleItemShapeMarkDef
CCVegaMultiItemShapeMarkDef
CCVegaSymbolMarkDef
CCVegaSVGRenderer
CCVegaCSSStyleDeclaration
CCVegaCSSStyleDeclarationInterface
CCVegaHTMLElement
CCVegaHTMLElementInterface
CCVegaLogProxyHandler
CCVegaLogProxyHandling
CCVegaCurves
CCVegaWorker
CCVegaWorkerClient
CCVegaPathMarkDef
CCTransaction
CCVegaAreaMarkDef
CCVegaMark
CCVegaMarkInterface
CCVegaAccessibilityHelper
CCAccessibilityElement
CCVegaAccessibilityGroupStackElement
CCVegaLogProxy
CCVegaArcMarkDef
CCVegaImageMarkDef
CCChartView
CCChartViewSetupOptions
CCAsyncQueueBlockOperation
CCAsyncOperation
CCAsyncQueue
CCVegaShapeMarkDef
CCVegaScripts
CCTestUtils
CCVegaCARenderer
CCVegaCARendererDelegateInterface
CCVegaCARendererWrapper
CCVegaCARendererJSExport
CCVegaCGLinearGradient
CCVegaCGGradientInterface
CCVegaCGImage
CCVegaCGImageInterface
CCVegaCGTextMetrics
CCVegaCGTextMetricsInterface
CCVegaCGContext
CCVegaCGContextInterface
CCVegaCGCanvas
CCVegaCGCanvasInterface
CCVegaJSColor
CCVegaColorOrGradient
CCVegaColorOrGradientInterface
CCVegaSymbolPath
CCVegaJSDocument
CCVegaJSDocumentInterface
CCViewRendererDelegate
CCViewRendererDelegateInterface
CCVegaRenderer
CCAsyncQueueDelegate
CCVegaWorkerClientDelegate
CCVegaEventAsyncOperation
CCVegaDataUpdateAsyncOperation
CCVegaSignalUpdateAsyncOperation
CCVegaRendererOptions
CCVegaJSMouseEvent
CCVegaJSMouseEventInterface
CCVegaJSColorMap
CCVegaLineMarkDef
getDouble:defaultValue:
newPathForMark:
accessibilityFrameForMark:layer:
_instance
newPathForRectangleMark:offset:
sublayers
objectAtIndex:
setSublayerTransform:
delegate
updateShapeLayer:withMark:delegate:
fillColor
strokeColor
newGroupPath:
setPath:
clip
mask
layer
setTransform:
setMask:
arrayWithObjects:count:
setSublayers:
updateLayer:withMark:
caLayer
bounds
enterMark:
updateMark:
init
setMark:
objectForKeyedSubscript:
isArray
isUndefined
toDouble
isNull
toString
toBool
toUInt32
initWithCapacity:
valueAtIndex:
addObject:
toObject
isBoolean
isObject
initWithJSValue:
toArray
toObjectOfClass:
initWithLayer:
setObject:forKeyedSubscript:
context
valueWithBool:inContext:
valueForProperty:
mark
getInstance
newPathFromJSFunction:item:
newPathByCallingShapeFunction
getString:defaultValue:
getObject:defaultValue:
getBoolean:defaultValue:
defined
getText
itemAtIndex:
isEqual:
cornerRadius
shape
orient
size
baseline
radius
theta
fontStyle
fontSize
fontWeight
font
align
width
angle
height
opacity
fill
fillOpacity
stroke
strokeOpacity
strokeWidth
strokeCap
strokeDash
strokeJoin
interpolate
strokeMiterLimit
path
zindex
itemCount
setCaLayer:
isDirty
setIsDirty:
Td,R
T@"NSString",R
T@"NSObject<CCVegaColorOrGradientInterface>",R
T@"NSArray",R
TB,R
TQ,R,N
T@"CALayer",&,N
TB,N
.cxx_destruct
_items
T@"JSValue",&,Vmark
setLayer:
_layer
T@"CALayer",W,N,V_layer
weakObjectsHashTable
allObjects
removeAllObjects
_commitTransactionForRenderers:
count
initWithRenderers:
commit
singleton
begin
scheduleDisplay:
_status
_scheduledRenderers
_dispatchQueue
countByEnumeratingWithState:objects:count:
displayWithCommitter:
waitForBlockReady
setDisableActions:
runBlock
flush
newMainThreadOperation
setNeedsCATransaction
_renderers
_mainThreadOperations
_needsCATransaction
provideBlock:
cancel
_semaphore
_block
setCallback:
initWithCallback:
callback
T@"JSValue",&,Vcallback
componentsSeparatedByString:
whitespaceCharacterSet
stringByTrimmingCharactersInSet:
characterSetWithCharactersInString:
isEqualToString:
parseCSSFontFamilyList:
hasPrefix:
cacheedFontForInternalName:
numericWeightFromFontWeight:
systemFontOfSize:weight:
systemFontOfSize:
fontDescriptor
fontDescriptorWithDesign:
fontWithDescriptor:size:
_fontAdjustedForContentSizeCategoryCompatibleWithTraitCollection:
fontWithSize:
fontWithName:size:
numberWithFloat:
setValue:forKey:
numberWithUnsignedInt:
dictionaryWithObjects:forKeys:count:
initWithDictionary:
initWithCSSFontString:
hasSuffix:
length
substringToIndex:
doubleValue
fontFamily
fontVariant
initWithFontFamily:fontSize:fontWeight:fontStyle:fontVariant:options:
dealloc
nativeTextStyleFromTextStyle:
UTF8String
preferredFontForTextStyle:compatibleWithTraitCollection:
preferredFontForTextStyle:
stringWithTextStyleOptions:
stringWithFormat:
cacheFont:forInternalName:
fontMetricsForFont:fontNameOverride:lineHeightOverride:
preferredContentSizeCategory
accessibilityTraits
legibilityWeight
lineHeight
defaultLineHeightForNativeFont:
cssFontWeightFromNumericWeight:
familyName
fontName
pointSize
numberWithDouble:
ascender
descender
leading
xHeight
capHeight
fontMetricsForTextStyle:options:
measureText:
extendedMeasureText:
drawText:x:y:align:color:drawingMode:inContext:
initWithCSSFontString:options:
CTFont
fontMetrics
defaultLineHeight
_font
setFontFamily:
setFontSize:
setFontVariant:
setFontWeight:
setFontStyle:
setLineHeight:
componentsSeparatedByCharactersInSet:
objectAtIndexedSubscript:
subarrayWithRange:
componentsJoinedByString:
stringByAppendingString:
T@"NSString",&,N,VfontFamily
T@"NSString",&,N,VfontSize
T@"NSString",&,N,VfontStyle
T@"NSString",&,N,VfontWeight
T@"NSString",&,N,VfontVariant
T@"NSString",&,N,VlineHeight
sharedCache
objectForKey:
setObject:forKey:
null
fontWithCSSFontString:options:
fontWithFontFamily:fontSize:fontWeight:fontStyle:fontVariant:options:
cleanUp
_cache
_styleCache
_internalNameCache
allKeys
numberWithUnsignedLong:
columnsInChartView
chartViewDataValueForColumn:
chartViewDataRowID
class
self
performSelector:
performSelector:withObject:
performSelector:withObject:withObject:
isProxy
isKindOfClass:
isMemberOfClass:
conformsToProtocol:
respondsToSelector:
retain
release
autorelease
retainCount
zone
hash
superclass
description
debugDescription
TQ,R
T#,R
T@"NSString",R,C
initWithArray:
objectEnumerator
initWithChartDataRow:
keyEnumerator
_dataRow
currentArguments
appendString:
evaluateScript:
arguments
setExceptionHandler:
attachToJavaScriptContext:
isGradient
gradient
createOrUpdateLayer:path:gradient:mode:lineWidth:delegate:
updateShapeLayerFill:withMark:delegate:
setFillColor:
updateShapeLayerStroke:withMark:delegate:
insertSublayer:atIndex:
insertSublayer:above:
setOpacity:
isColor
color
newColorFromCSSString:alpha:
setStrokeColor:
setLineWidth:
setLineCap:
setLineJoin:
setMiterLimit:
setLineDashPattern:
applyGradient:toLayer:delegate:
createOrUpdateGradientLayer:existingLayer:delegate:
setFrame:
arrayWithCapacity:
newColorFromCSSString:
setColors:
setLocations:
setStartPoint:
setEndPoint:
setType:
createOrUpdateLayer:path:withMark:delegate:
arrayWithObject:
fontOptions
setFont:
setStrokeWidth:
setBaseline:
setAlign:
anchorPoint:
_currentCombinedCTM
setCombinedCTMHint:
setTextPosition:
setTextAngle:
setLines:
pixelRatio
setContentsScale:
updateTextContents
updateTextLayer:withMark:
frame
autoupdatingCurrentLocale
autoupdatingCurrentCalendar
nativeNumberFormat
registerExpressionFunction:withName:
nativeDateComponentsFormat
nativeDateFormat
nativeTextMetrics
nativeFontMetrics
dataWithJSONObject:options:error:
initWithData:encoding:
currentContext
valueWithObject:inContext:
valueWithUndefinedInContext:
keyForKind:options:
locale
setLocale:
setPositiveFormat:
setNegativeFormat:
setNumberStyle:
setFormatterBehavior:
setMultiplier:
makeReturnValue:
toNumber
isString
toDictionary
numberFormatterFromOptions:
stringFromNumber:
calendar
setCalendar:
setUnitsStyle:
boolValue
setIncludesApproximationPhrase:
setIncludesTimeRemainingPhrase:
calendarUnitFromString:
setAllowedUnits:
setAllowsFractionalUnits:
setCollapsesLargestUnit:
integerValue
setMaximumUnitCount:
setZeroFormattingBehavior:
dateComponentsFormatterFromOptions:
stringFromTimeInterval:
timeZone
setTimeZone:
dateFormatterStyleFromString:
setDateStyle:
setTimeStyle:
setDateFormat:
setLocalizedDateFormatFromTemplate:
toDate
dateFormatterFromOptions:
stringFromDate:
isNumber
fontFromJSFontDesc:options:
functionNames
setFontOptions:
registerFunctionsToClient:
_locale
_calendar
_fontOptions
T@"NSLocale",&
T@"NSCalendar",&
T@"NSDictionary",&
line
setLine:
setBounds:
baselineOffset
setBaselineOffset:
xOffset
setXOffset:
T@,&,N,Vline
T{CGRect={CGPoint=dd}{CGSize=dd}},N,Vbounds
Td,N,VbaselineOffset
Td,N,VxOffset
dictionary
setAnchorPoint:
setNeedsDisplay
display
drawInContext:
renderInContext:
position
lines
textPosition
textAngle
combinedCTMHint
_lineContents
_align
_baseline
_lines
_lineHeight
_strokeColor
_fillColor
_strokeWidth
_textAngle
_textPosition
_combinedCTMHint
T@,&,N,V_font
T@,&,N,V_fillColor
T@,&,N,V_strokeColor
Td,N,V_strokeWidth
T@"NSArray",&,N,V_lines
Td,N,V_lineHeight
T{CGAffineTransform=dddddd},N,V_combinedCTMHint
Ti,N,V_align
Ti,N,V_baseline
T{CGPoint=dd},N,V_textPosition
Td,N,V_textAngle
setDelegate:
raise:format:
initWithDelegate:
isMultiItemMark
enterMultiMark:
updateMultiMark:
T@"CCVegaCARenderer",W,Vdelegate
transformForMark:
drawMark:withLayer:
setShouldRasterize:
setRasterizationScale:
setCgCanvas:
cgCanvas
setWidth:
setHeight:
callWithArguments:
invokeMethod:withArguments:
newPathFromParsedPath:size:rendererContext:
parseString:rendererContext:
T@"CCVegaCGContext",&,VcgCanvas
setCursor:
cursor
T@"NSString",&,N
T@"NSString",&,N,Vcursor
initWithTagName:
setStyle:
setChildNodes:
setEvents:
setTagName:
setParentNode:
setClientWidth:
setClientHeight:
childNodes
value
recursiveSetSize:
managedValueWithValue:
removeObject:
clientWidth
clientHeight
valueWithSize:inContext:
insertObject:atIndex:
events
valueForKey:
managedValueWithValue:andOwner:
getBoundingClientRect
removeWithChild:
appendWithChild:
prependWithChild:
setAttributeWithName:value:
addEventListenerWithType:listener:
removeEventListenerWithType:listener:
style
tagName
parentNode
removeWithChild:__JS_EXPORT_AS__removeChild:
appendWithChild:__JS_EXPORT_AS__appendChild:
prependWithChild:__JS_EXPORT_AS__prepend:
setAttributeWithName:value:__JS_EXPORT_AS__setAttribute:
addEventListenerWithType:listener:__JS_EXPORT_AS__addEventListener:
removeEventListenerWithType:listener:__JS_EXPORT_AS__removeEventListener:
T@"CCVegaCSSStyleDeclaration",&,N
T@"NSMutableArray",&,N
T@"NSMutableDictionary",&,N
T@"NSObject<CCVegaHTMLElementInterface>",&,N
Td,N
T@"CCVegaCSSStyleDeclaration",&,N,Vstyle
T@"NSMutableArray",&,N,VchildNodes
T@"NSString",&,N,VtagName
T@"NSMutableDictionary",&,N,Vevents
T@"NSObject<CCVegaHTMLElementInterface>",&,N,VparentNode
Td,N,VclientWidth
Td,N,VclientHeight
wrap:
hasProperty:
getPropertyOnObject:named:
setPropertyOnObject:named:toValue:
getPropertyOnObject:named:__JS_EXPORT_AS__get:
setPropertyOnObject:named:toValue:__JS_EXPORT_AS__set:
newPathForLineWithPoints:count:interpolate:orient:tension:
newPathForAreaWithPoints:count:interpolate:orient:tension:
setVirtualMachine:
virtualMachine
initWithVirtualMachine:
setContext:
setupContext
globalObject
setupTimerFunctions
setupConsole
setDocument:
document
evaluateBootstrapScriptsInContext:
registerProxyExpressionFunction:
evaluateVegaLiteScriptInContext:
currentClient
evaluateExpressionFunction:
nextTimerIndex
dispatchQueue
clientEnter
clientDidExecuteTimerCallback
clientExit
numberWithInteger:
valueWithInt32:inContext:
removeObjectForKey:
cleanUpWithCallback:
setOnDealloc:
sharedWorker
initWithQueue:
requireVegaLite
requireVegaParser
waitForWorker
setCurrentClient:
dispatchQueueID
onDealloc
_currentTimerIndex
_timers
_vegaLiteLoaded
_vegaParserLoaded
_dispatchQueueID
_onDealloc
T@"JSVirtualMachine",&,VvirtualMachine
T@"JSContext",&,Vcontext
T@"CCVegaJSDocument",&,N,Vdocument
T@"CCVegaWorkerClient",W,VcurrentClient
T@?,C,V_onDealloc
TQ,R,V_dispatchQueueID
setWorker:
setIsValid:
worker
workerContextEnter
workerContextExit
workerDidExecuteTimerCallback
initWithWorker:delegate:
runBlockAsync:
runBlockSync:
isValid
_expressionFunctions
T@"CCVegaWorker",&,Vworker
T@"NSObject<CCVegaWorkerClientDelegate>",W,Vdelegate
TB,VisValid
_cachedPathDef
_cachedPath
interactive
marktype
name
role
TB,R,N
T@"NSString",R,N
Td,R,N
firstObject
removeObjectAtIndex:
container
initWithAccessibilityContainer:
addElementWithLabel:roleDescription:frame:
newAccessibilityElementWithFrame:
setLabel:
setRoleDescription:
initWithElements:
translateX:Y:
markAriaHidden
saveState
restoreState
enterGroupWithLabel:roleDescription:frame:
exitGroup
getElements
setContainer:
.cxx_construct
_stateStack
_currentState
_elementCache
_rootAccessibilityElements
_children
_groupStack
T@,W,Vcontainer
label
setAccessibilityFrameInContainerSpace:
accessibilityFrameInContainerSpace
isAccessibilityElement
accessibilityLabel
roleDescription
T{CGRect={CGPoint=dd}{CGSize=dd}}
T@"NSString",&,Vlabel
T@"NSString",&,VroleDescription
groupElement
setGroupElement:
previousChildren
setPreviousChildren:
T@"CCAccessibilityElement",&,VgroupElement
T@"NSMutableArray",&,VpreviousChildren
wrap:withHandler:
wrapObject:
tryUnwrap:
unwrap:
setPosition:
newImageFromURL:
setContents:
setContentsGravity:
initWithCoder:
initialize
initWithFrame:
initWithSpec:config:
initWithSpec:config:options:
setSpec:
setConfig:
setZoomFactor:
setRendererType:
setBaseConfig:
setCATransactionFromBackgroundThread:
defaultCenter
removeObserver:
refreshLocaleAndCalendar
addObserver:selector:name:object:
spec
rendererType
baseConfig
config
expressionFunctions
lazilyInitializeRenderer
setupWithSpec:options:
JSONStringFromDictionary:
renderer
setLocale:calendar:shouldRefresh:
reinitializeRenderer
scaleFactor
contentScaleFactor
zoomFactor
setScaleFactor:
setSize:
setIsActive:
currentBitmap
currentBitmapScaleFactor
traitCollectionDidChange:
traitCollection
userInterfaceStyle
traitCollectionWithUserInterfaceStyle:
traitCollectionWithTraitsFromCollections:
rerender
render
setTraitCollection:
refreshNativeSignals
rerenderEntireChart
setRenderer:
setCaUpdateFromBackground:
configForBaseConfigType:
initWithSpec:config:options:workerClient:
saveStateWithNamedDatasets:
loadState:
chartView:stringWithContentsOfURL:encoding:error:
chartViewLoadDataFromURL:error:
loadChartDataFromURL:error:
changeConstraints
accessibilityDataSeriesElement
chartView:colorNamed:
chartViewColorNamed:
colorNamed:
rangeOfString:
dynamicColorNamed:
chartView:localizedStringNamed:
chartViewLocalizedStringNamed:
localizedStringNamed:
mainBundle
localizedStringForKey:value:table:
chartView:imageWithContentsOfURL:error:
URLWithString:
chartViewImageNamed:
imageNamed:
touchesForView:
locationInView:
initWithLocation:movement:
triggerMouseEvent:type:setConsumed:
eventToMouseEvent:
triggerEventWithType:event:waitForEventHandling:
isConsumed
triggerMouseEvent:type:
view
contentSize
dataUsingEncoding:
JSONObjectWithData:options:error:
dictionaryFromJSONString:
setSpecDictionary:
setConfigDictionary:
setDefaultDataset:
setNamedDataset:rows:
changeDefaultDatasetByInserting:removingIDs:
changeNamedDataset:inserting:removingIDs:
setContentScaleFactor:
constant
setConstant:
widthAnchor
constraintEqualToConstant:
setPriority:
addConstraint:
removeConstraint:
heightAnchor
renderToCGImage
newDataWithPDFImage
_initWithCGPDFPage:
initWithCGImage:
numberWithBool:
isDate
getSignalWithName:
unwrapJSValue:
setSignalWithName:toValue:
addListener:toSignalWithName:
removeListener:fromSignalWithName:
accessibilityElements
setAccessibilityElements:
setIsAccessibilityElement:
setAccessibilityDataSeriesElement:
stringForScriptData:length:
errorWithDomain:code:userInfo:
compileSpec:config:baseConfig:expressionFunctionNames:error:
getBenchmarkRecords
preloadFrameworkAssets
compileSpecDictionary:configDictionary:baseConfig:expressionFunctionNames:error:
initWithSpec:
setupWithSpec:
setupWithSpecDictionary:
setupWithSpecDictionary:options:
CATransactionFromBackgroundThread
drawRect:
rendererDidUpdate
touchesBegan:withEvent:
touchesEnded:withEvent:
touchesMoved:withEvent:
touchesCancelled:withEvent:
gestureRecognizerShouldBegin:
specDictionary
configDictionary
setSpec:config:
setSpec:config:baseConfig:
setSpec:config:baseConfig:rendererType:
setSpecDictionary:configDictionary:
setSpecDictionary:configDictionary:baseConfig:
setSpecDictionary:configDictionary:baseConfig:rendererType:
data
setData:
translatesChartSizeIntoConstraints
setTranslatesChartSizeIntoConstraints:
CGImage
renderToImageWithType:
registerLocalExpressionFunction:withName:
setAccessibilityDataSeriesElements:
accessibilityDataSeriesElements
accessibilityContainerType
_worker
_workerClient
_renderer
_baseConfigType
_rendererType
_config
_configDictionary
_spec
_specDictionary
_zoomFactor
_legacyData
_knownNamedDatasets
_preventGestures
_caUpdateFromBackground
_didCustomizeLocale
_didCustomizeCalendar
_rendererWidth
_rendererHeight
_translatesChartSizeIntoConstraints
_widthConstraint
_heightConstraint
_accessibilityDataSeriesElement
T@"NSString",&
T@"NSArray",&,N
T@"NSLocale",&,N
T@"NSCalendar",&,N
T^{CGImage=},R
TQ,N
T@"NSObject<CCChartViewDelegate>",W,Vdelegate
T@"NSArray",&
T@"UIAccessibilityElement",&,V_accessibilityDataSeriesElement
setExpressionFunctions:
T@"NSString",&,Vconfig
T@"NSString",&,VrendererType
T@"NSString",&,VbaseConfig
T@"NSDictionary",&,VexpressionFunctions
performOperationWithCallback:
initWithBlock:
enqueueOperation:
startProcessOperations
processOperations
simplifyQueue:
enqueueOperationWithBlock:
waitForPendingOperations
initWithWorkerClient:
waitForOperation:
keepAliveUntilCurrentOperationIsComplete
_nextActionID
_queue
_isProcessing
_delegate
T@"NSObject<CCAsyncQueueDelegate>",W,N,V_delegate
loadScriptWithName:source:inVirtualMachine:
evaluateJSScript:
dataWithBytes:length:
scriptOfType:withSource:andSourceURL:andBytecodeCache:inVirtualMachine:error:
evaluateScriptWithName:source:inContext:
vegaJS
vegaliteJS
compareImage:withImage:
setRootLayer:
setPixelRatio:
initWithValue:
setScenegraphRoot:
scenegraphRoot
updateCALayers:dirtyAll:
rootLayer
addSublayer:
backgroundColor
setBackgroundColor:
drawMark:parentGroup:into:dirtyAll:
callFromJSFunction:
superlayer
sublayerTransform
transform
marks
compositingFilterForItem:
setCompositingFilter:
replaceSublayer:with:
applyClip:onLayer:
drawMark:parentGroup:item:into:dirtyAll:
copy
containsObject:
removeFromSuperlayer
initWithRenderer:context:rootLayer:updateFromBackground:
containerSize
setContainerSize:
dirty
dirtyAll
render:
updateCALayers
resizeWidth:height:originX:originY:
invalidateCaches
_updateFromBackground
_marks
_rootLayer
_contentLayer
_initialized
_width
_height
_containerSize
_originX
_originY
_dirty
_dirtyAll
_pendingUpdate
_pendingUpdateDirtyAll
_imageCache
_accessibilityHelper
_currentTranslate
T@"JSContext",W,Vcontext
T@"CALayer",W
T{CGSize=dd},VcontainerSize
T@"NSArray",&,VaccessibilityElements
T@"JSManagedValue",&,VscenegraphRoot
T{CGAffineTransform=dddddd},R
T@"NSString",&,VbackgroundColor
Td,VpixelRatio
Td,VzoomFactor
resizeWidth:height:originX:originY:__JS_EXPORT_AS__resize:
render:__JS_EXPORT_AS__render:
initWithRenderer:
T@"CCVegaCARenderer",W,V_renderer
initWithX0:y0:x1:y1:
addColorStopWithOffset:color:
newColorFromString:
addColorStopWithOffset:color:__JS_EXPORT_AS__addColorStop:
initWithDictionary:context:
fillWithContext:
_colorStops
_context
Td,N,Vwidth
resizeBitmapContext
textWithString:x:y:drawingMode:
flipYAxisWithHeight:
rectWithX:y:width:height:
lineDashOffset
save
restore
arcWithX:y:radius:startAngle:endAngle:anticlockwise:
beginPath
bezierCurveToCP1x:cp1y:cp2x:cp2y:x:y:
quadraticCurveToCP1x:cp1y:x:y:
clearRectWithX:y:w:h:
closePath
createLinearGradientWithX0:y0:x1:y1:
fillTextWithString:x:y:
fillRectWithX:y:width:height:
lineToX:y:
moveToX:y:
strokeTextWithString:x:y:
setLineDashWithSegments:
rotateWithAngle:
setTransformWithA:b:c:d:e:f:
translateWithX:y:
isPointInPathWithX:y:
fillStyle
setFillStyle:
globalAlpha
setGlobalAlpha:
lineCap
lineJoin
lineWidth
miterLimit
strokeStyle
setStrokeStyle:
textAlign
setTextAlign:
setLineDashOffset:
globalCompositeOperation
setGlobalCompositeOperation:
arcWithX:y:radius:startAngle:endAngle:anticlockwise:__JS_EXPORT_AS__arc:
bezierCurveToCP1x:cp1y:cp2x:cp2y:x:y:__JS_EXPORT_AS__bezierCurveTo:
quadraticCurveToCP1x:cp1y:x:y:__JS_EXPORT_AS__quadraticCurveTo:
clearRectWithX:y:w:h:__JS_EXPORT_AS__clearRect:
createLinearGradientWithX0:y0:x1:y1:__JS_EXPORT_AS__createLinearGradient:
fillTextWithString:x:y:__JS_EXPORT_AS__fillText:
fillRectWithX:y:width:height:__JS_EXPORT_AS__fillRect:
lineToX:y:__JS_EXPORT_AS__lineTo:
moveToX:y:__JS_EXPORT_AS__moveTo:
rectWithX:y:width:height:__JS_EXPORT_AS__rect:
strokeTextWithString:x:y:__JS_EXPORT_AS__strokeText:
setLineDashWithSegments:__JS_EXPORT_AS__setLineDash:
rotateWithAngle:__JS_EXPORT_AS__rotate:
setTransformWithA:b:c:d:e:f:__JS_EXPORT_AS__setTransform:
translateWithX:y:__JS_EXPORT_AS__translate:
isPointInPathWithX:y:__JS_EXPORT_AS__isPointInPath:
T@"JSValue",&
invalidateBitmapContext
_fillStyle
_globalAlpha
_lineCap
_lineJoin
_lineWidth
_miterLimit
_strokeStyle
_textAlign
_currentTransform
_lineDashOffset
_globalCompositeOperation
_bitmapContext
_internalFont
T@"CCVegaRenderer",W,N,Vrenderer
T^{CGContext=},R
Td,N,VpixelRatio
getContext:
T@"CCVegaCGContext",&,N,Vcontext
newColorTransparent
characterAtIndex:
newColorFromR:G:B:A:
substringWithRange:
scannerWithString:
scanInt:
scanDouble:
unsignedIntValue
newColorBlack
newColorWhite
setColor:
setGradient:
T@"NSString",&,Vcolor
T@"NSDictionary",&,Vgradient
newCrossPathWithSize:
newDiamondPathWithSize:
newSquarePathWithSize:
newArrowPathWithSize:
newWedgePathWithSize:
newTrianglePathWithSize:
newTriangleUpPathWithSize:
newTriangleDownPathWithSize:
newTriangleRightPathWithSize:
newTriangleLeftPathWithSize:
newStrokePathWithSize:
newCirclePathWithSize:
newPathForBuiltin:withSize:
newPathForCustomSVGShape:withSize:withContext:
setBody:
createElementWithString:
body
createElementWithString:__JS_EXPORT_AS__createElement:
T@"CCVegaHTMLElement",&,N
T@"CCVegaHTMLElement",&,N,Vbody
setVegaRenderer:
vegaRenderer
workerClient
updateNativeView
loadURL:options:withCallback:
loadURL:options:withCallback:__JS_EXPORT_AS__loadURL:
initWithVegaRenderer:
T@"CCVegaRenderer",W,VvegaRenderer
setViewDelegate:
setWorkerClient:
setAsyncQueue:
asyncQueue
caUpdateFromBackground
setCARenderer:
CARenderer
viewDelegate
setupSignalHandlers
setupScreenSignal
runAsyncWithCallback:
_doUpdateInMainThread
vegaContext
shrinkFootprintWhenIdle
scheduleDisplay
calendarIdentifier
firstWeekday
numberWithUnsignedInteger:
localeIdentifier
languageCode
countryCode
currencySymbol
groupingSeparator
decimalSeparator
usesMetricSystem
quotationBeginDelimiter
quotationEndDelimiter
alternateQuotationBeginDelimiter
alternateQuotationEndDelimiter
characterDirectionForLanguage:
processInfo
operatingSystemVersionString
operatingSystemVersion
mainScreen
refreshNativeSignalsRerunDataflow:
type
removeObjectsInRange:
updateInMainThreadIfNeeded
setCurrentCGImage:
clearPendingDataUpdates
updateScaleFactor:zoomFactor:
currentCGImage
enqueueRunAsync
setEvent:
changeNamedDataset:inserting:removingWithCallback:
setNamedDataset:
setRowsToInsert:
setCallbackForRowsToRemove:
setName:
setValue:
substringFromIndex:
getWhite:alpha:
colorWithAlphaComponent:
CGColor
dataWithContentsOfURL:
initWithData:
specIsValid
isActive
runAsync
addPendingDataUpdate:
hasPendingDataUpdate:
_builtinExpressionFunctions
_currentCGImage
_currentCGImageScaleFactor
_needsUpdateFromMainThread
_pendingDataUpdates
_internalScaleFactor
_internalZoomFactor
_caLayer
_data
_isActive
_scaleFactor
_traitCollection
T@"NSString",&,N,Vspec
T@"NSString",&,N,Vconfig
T@"CCVegaHTMLElement",&,N,Vcontainer
T@"JSValue",&,N,Vrenderer
T@"CCVegaCARenderer",&,VCARenderer
T@"CCViewRendererDelegate",&,VviewDelegate
T@"CCAsyncQueue",&,N,VasyncQueue
T^{CGImage=},VcurrentCGImage
T@"CCVegaWorkerClient",&,VworkerClient
TI,VrendererType
T@"CALayer",&
T@"NSObject<CCVegaRendererDelegate>",W,Vdelegate
T@"UITraitCollection",&
event
setPropagationStopped:
clientX
clientY
propagationStopped
setIsConsumed:
_type
_event
T@"CCVegaRenderer",W,N,V_renderer
T@"NSString",&,N,V_type
T@"CCVegaJSMouseEvent",&,N,V_event
rowsToInsert
enumerateObjectsUsingBlock:
callbackForRowsToRemove
namedDataset
doDataUpdate:
_namedDataset
_rowsToInsert
_callbackForRowsToRemove
T@"NSString",&,V_namedDataset
T@"NSArray",&,V_rowsToInsert
T@?,C,V_callbackForRowsToRemove
_name
_value
T@"NSString",&,N,V_name
T@,&,N,V_value
Td,VscaleFactor
T{CGSize=dd},Vsize
T@"NSLocale",&,Vlocale
T@"NSCalendar",&,Vcalendar
T@"UITraitCollection",&,VtraitCollection
TI,Vrenderer
T@"CALayer",&,VcaLayer
TB,VcaUpdateFromBackground
setDefaultPrevented:
setClientX:
setClientY:
setMovementX:
setMovementY:
preventDefault
stopPropagation
movementX
movementY
defaultPrevented
Td,N,VclientX
Td,N,VclientY
Td,N,VmovementX
Td,N,VmovementY
TB,N,VpropagationStopped
TB,N,VdefaultPrevented
TB,N,VisConsumed
^{CGPath=}24@0:8@16
{CGRect={CGPoint=dd}{CGSize=dd}}32@0:8@16@24
@16@0:8
v32@0:8@16@24
@24@0:8@16
^{CGPath=}16@0:8
d32@0:8@16d24
@32@0:8@16@24
B28@0:8@16B24
{CGRect={CGPoint=dd}{CGSize=dd}}16@0:8
B16@0:8
@24@0:8Q16
B24@0:8@16
d16@0:8
Q16@0:8
v24@0:8@16
v20@0:8B16
d32@0:8@"NSString"16d24
@"NSString"32@0:8@"NSString"16@"NSString"24
@"NSObject"32@0:8@"NSString"16@"NSObject"24
B28@0:8@"NSString"16B24
@"NSObject"16@0:8
@"CCVegaMark"24@0:8Q16
B24@0:8@"NSObject<CCVegaMarkItemInterface>"16
@"NSString"16@0:8
@"NSObject<CCVegaColorOrGradientInterface>"16@0:8
@"NSArray"16@0:8
@"CALayer"16@0:8
v24@0:8@"CALayer"16
v16@0:8
@"JSValue"
@"CALayer"
@"NSHashTable"
@"NSObject<OS_dispatch_queue>"
@"NSMutableArray"
v24@0:8@?16
@"NSObject<OS_dispatch_semaphore>"
d24@0:8@16
@24@0:8d16
@40@0:8^{__CTFont=}16@24d32
@64@0:8@16d24@32@40@48@56
{?={CGSize=dd}}24@0:8@16
{?={CGSize=dd}{CGSize=dd}ddd}24@0:8@16
v68@0:8@16d24d32@40^{CGColor=}48i56^{CGContext=}60
^{__CTFont=}16@0:8
^{__CTFont=}
@"NSString"
v32@0:8^{__CTFont=}16@24
^{__CTFont=}24@0:8@16
@"NSMutableDictionary"
#16@0:8
@24@0:8:16
@32@0:8:16@24
@40@0:8:16@24@32
B24@0:8#16
B24@0:8:16
Vv16@0:8
^{_NSZone=}16@0:8
B24@0:8@"Protocol"16
@24@0:8@"NSString"16
@"NSNumber"16@0:8
@"<CCChartDataRow>"
@48@0:8@16^{CGPath=}24@32@40
v40@0:8@16@24@32
^{CGPath=}32@0:8@16d24
@40@0:8@16@24@32
@60@0:8@16^{CGPath=}24@32i40d44@52
{CGPoint=dd}24@0:8@16
@?16@0:8
Q24@0:8@16
@"NSLocale"
@"NSCalendar"
@"NSDictionary"
v48@0:8{CGRect={CGPoint=dd}{CGSize=dd}}16
v24@0:8d16
{CGRect="origin"{CGPoint="x"d"y"d}"size"{CGSize="width"d"height"d}}
v24@0:8^{CGContext=}16
i16@0:8
v20@0:8i16
{CGPoint=dd}16@0:8
v32@0:8{CGPoint=dd}16
{CGAffineTransform=dddddd}16@0:8
v64@0:8{CGAffineTransform=dddddd}16
@"NSArray"
{CGPoint="x"d"y"d}
{CGAffineTransform="a"d"b"d"c"d"d"d"tx"d"ty"d}
@"CCVegaCARenderer"
{CATransform3D=dddddddddddddddd}24@0:8@16
^{CGPath=}40@0:8@16d24@32
^{CGPath=}32@0:8@16@24
@"CCVegaCGContext"
v24@0:8@"NSString"16
v32@0:8{CGSize=dd}16
@"NSDictionary"16@0:8
@"NSObject<CCVegaHTMLElementInterface>"24@0:8@"JSValue"16
v32@0:8@"NSString"16@"NSString"24
v32@0:8@"NSString"16@"JSValue"24
@"CCVegaCSSStyleDeclaration"16@0:8
v24@0:8@"CCVegaCSSStyleDeclaration"16
@"NSMutableArray"16@0:8
v24@0:8@"NSMutableArray"16
@"NSMutableDictionary"16@0:8
v24@0:8@"NSMutableDictionary"16
@"NSObject<CCVegaHTMLElementInterface>"16@0:8
v24@0:8@"NSObject<CCVegaHTMLElementInterface>"16
@"NSObject<CCVegaHTMLElementInterface>"32@0:8@"JSValue"16@24
v40@0:8@"NSString"16@"NSString"24@32
v40@0:8@"NSString"16@"JSValue"24@32
@"CCVegaCSSStyleDeclaration"
@"NSObject<CCVegaHTMLElementInterface>"
B40@0:8@16@24@32
B48@0:8@16@24@32@40
@"JSValue"32@0:8@"JSValue"16@"NSString"24
B40@0:8@"JSValue"16@"NSString"24@"JSValue"32
@"JSValue"40@0:8@"JSValue"16@"NSString"24@32
B48@0:8@"JSValue"16@"NSString"24@"JSValue"32@40
^{CGPath=}56@0:8^{?=ddB}16Q24@32@40d48
^{CGPath=}56@0:8^{?=ddddB}16Q24@32@40d48
v32@0:8@?16@24
@"JSContext"
@"JSVirtualMachine"
@"CCVegaJSDocument"
@"CCVegaWorkerClient"
@"CCVegaWorker"
@"NSObject<CCVegaWorkerClientDelegate>"
^{CGPath=}
@"CCVegaMarkItem"24@0:8Q16
B24@0:8@"NSObject<CCVegaMarkInterface>"16
@48@0:8{CGRect={CGPoint=dd}{CGSize=dd}}16
v32@0:8d16d24
v64@0:8@16@24{CGRect={CGPoint=dd}{CGSize=dd}}32
{stack<CCVegaAccessibilityHelperState, std::deque<CCVegaAccessibilityHelperState>>="c"{deque<CCVegaAccessibilityHelperState, std::allocator<CCVegaAccessibilityHelperState>>="__map_"{__split_buffer<CCVegaAccessibilityHelperState *, std::allocator<CCVegaAccessibilityHelperState *>>="__first_"^^{?}"__begin_"^^{?}"__end_"^^{?}"__end_cap_"{__compressed_pair<CCVegaAccessibilityHelperState **, std::allocator<CCVegaAccessibilityHelperState *>>="__value_"^^{?}}}"__start_"Q"__size_"{__compressed_pair<unsigned long, std::allocator<CCVegaAccessibilityHelperState>>="__value_"Q}}}
{?="origin"{CGPoint="x"d"y"d}"ariaHidden"B}
@"CCAccessibilityElement"
@56@0:8@16@24@32@40^@48
@32@0:8@16^@24
v36@0:8@16@24B32
v48@0:8@16@24@32@40
v24@0:8Q16
^{CGImage=}16@0:8
@32@0:8@?16@24
q16@0:8
@"CCVegaRenderer"
@"NSMutableSet"
@"NSLayoutConstraint"
@"NSObject<CCChartViewDelegate>"
@"UIAccessibilityElement"
v24@0:8@?<v@?>16
@24@0:8@?16
Q24@0:8@?16
@"NSObject<CCAsyncQueueDelegate>"
@32@0:8*16Q24
{?=dddii}32@0:8^{CGImage=}16^{CGImage=}24
@44@0:8@16@24@32B40
{CGSize=dd}16@0:8
v28@0:8@16B24
v48@0:8d16d24d32d40
v44@0:8@16@24@32B40
@52@0:8@16@24@32@40B48
^{CGColor=}24@0:8@16
^{CGColor=}32@0:8@16d24
^{CGImage=}24@0:8@16
{CGSize="width"d"height"d}
@"CCVegaAccessibilityHelper"
@"JSManagedValue"
v56@0:8d16d24d32d40@48
v24@0:8@"JSValue"16
v32@0:8@"JSValue"16@24
v32@0:8d16@24
v40@0:8d16@24@32
v32@0:8d16@"NSString"24
v40@0:8d16@"NSString"24@32
@48@0:8d16d24d32d40
{CGAffineTransform=dddddd}24@0:8d16
v60@0:8d16d24d32d40d48B56
v64@0:8d16d24d32d40d48d56
v40@0:8@16d24d32
B32@0:8d16d24
v68@0:8d16d24d32d40d48B56@60
v72@0:8d16d24d32d40d48d56@64
@56@0:8d16d24d32d40@48
v48@0:8@16d24d32@40
v40@0:8d16d24@32
B40@0:8d16d24@32
@"JSValue"24@0:8@"NSString"16
@"JSValue"48@0:8d16d24d32d40
v40@0:8@"NSString"16d24d32
v24@0:8@"NSArray"16
@"JSValue"16@0:8
@"JSValue"56@0:8d16d24d32d40@48
v48@0:8@"NSString"16d24d32@40
v32@0:8@"NSArray"16@24
^{CGContext=}16@0:8
v44@0:8@16d24d32i40
^{CGContext=}
@"CCVegaJSFont"
@"CCVegaCGContext"24@0:8@"NSString"16
^{CGColor=}48@0:8d16d24d32d40
^{CGColor=}16@0:8
v24@0:8@"NSDictionary"16
^{CGPath=}24@0:8d16
@"CCVegaHTMLElement"24@0:8@"NSString"16
@"CCVegaHTMLElement"16@0:8
v24@0:8@"CCVegaHTMLElement"16
@"CCVegaHTMLElement"32@0:8@"NSString"16@24
@"CCVegaHTMLElement"
v40@0:8@"NSString"16@"JSValue"24@"JSValue"32
v48@0:8@"NSString"16@"JSValue"24@"JSValue"32@40
@48@0:8@16@24@32@40
v24@0:8^{CGImage=}16
v40@0:8@16@24@?32
I16@0:8
v20@0:8I16
@"CCVegaExpressionFunctions"
^{CGImage=}
@"UITraitCollection"
@"CCViewRendererDelegate"
@"CCAsyncQueue"
@"NSObject<CCVegaRendererDelegate>"
@"CCVegaJSMouseEvent"
@48@0:8{CGPoint=dd}16{CGPoint=dd}32
  "aria": false,
  "customFormatTypes": true,
  "padding": 12,
  "signals": [
    {"name": "os", "value": {}},
    {"name": "color", "value": {}},
    {
      "name": "chartColor",
      "update": "os.macOS ? {\"mark\":color.controlAccentColor,\"background\":color.controlBackgroundColor,\"gridOuter\":color.quaternaryLabelColor,\"gridInner\":color.quaternaryLabelColor,\"gridDivider\":color.quaternaryLabelColor,\"groupTitle\":color.labelColor,\"axisLabel\":color.secondaryLabelColor,\"groupSubtitle\":color.secondaryLabelColor,\"axisTitle\":color.secondaryLabelColor,\"textMark\":color.labelColor} : os.watchOS ? {\"background\":\"black\",\"gridOuter\":\"rgb(64,64,64)\",\"gridInner\":\"rgb(64,64,64)\",\"gridDivider\":\"rgb(64,64,64)\",\"axisLabel\":\"rgb(128,128,128)\",\"axisTitle\":\"rgb(128,128,128)\",\"mark\":\"rgb(32,148,250)\",\"groupTitle\":\"rgb(128,128,128)\",\"groupSubtitle\":\"rgb(128,128,128)\",\"textMark\":\"rgb(128,128,128)\"} : {\"background\":color.systemBackgroundColor,\"gridOuter\":color.systemGray2Color,\"gridInner\":color.systemGray3Color,\"gridDivider\":color.systemGrayColor,\"axisLabel\":color.secondaryLabelColor,\"axisTitle\":color.secondaryLabelColor,\"mark\":color.systemBlueColor,\"groupTitle\":color.labelColor,\"groupSubtitle\":color.secondaryLabelColor,\"textMark\":color.labelColor}"
    },
    {"name": "textStyle", "value": {}},
    {"name": "calendar", "value": {}},
    {"name": "locale", "value": {}},
    {"name": "gridWidth", "update": "os.macOS ? 1 : os.watchOS ? 1 : 0.5"},
    {
      "name": "guideLabelStyle",
      "update": "os.macOS ? textStyle.subheadline : os.watchOS ? textStyle.caption2 : textStyle.caption2"
    },
    {
      "name": "guideTitleStyle",
      "update": "os.macOS ? textStyle.subheadline : os.watchOS ? textStyle.caption1 : textStyle.caption1"
    },
    {
      "name": "titleStyle",
      "update": "os.macOS ? textStyle.headline : os.watchOS ? textStyle.headline : textStyle.headline"
    },
    {
      "name": "subtitleStyle",
      "update": "os.macOS ? textStyle.subheadline : os.watchOS ? textStyle.subheadline : textStyle.subheadline"
    },
    {
      "name": "textMarkStyle",
      "update": "os.macOS ? textStyle.caption2 : os.watchOS ? textStyle.caption2 : textStyle.caption2"
    }
  ],
  "background": {"signal": "chartColor.background"},
  "view": {
    "stroke": {"signal": "chartColor.gridOuter"},
    "strokeWidth": {"signal": "gridWidth"},
    "step": 20
  },
  "mark": {"color": {"signal": "chartColor.mark"}},
  "area": {"opacity": 0.4},
  "bar": {"cornerRadiusEnd": 2},
  "circle": {"size": 50},
  "line": {"strokeCap": "round"},
  "point": {"size": 50},
  "square": {"size": 50},
  "text": {
    "color": {"signal": "chartColor.textMark"},
    "dir": {
      "signal": "locale.characterDirection === \"rightToLeft\" ? \"rtl\" : \"ltr\""
    },
    "font": {"signal": "textMarkStyle.fontName"},
    "fontSize": {"signal": "textMarkStyle.pointSize"},
    "lineHeight": {"signal": "textMarkStyle.lineHeight"}
  },
  "style": {
    "guide-title": {
      "dir": {
        "signal": "locale.characterDirection === \"rightToLeft\" ? \"rtl\" : \"ltr\""
      },
      "fill": {"signal": "chartColor.axisTitle"},
      "font": {"signal": "guideTitleStyle.fontName"},
      "fontSize": {"signal": "guideTitleStyle.pointSize"},
      "lineHeight": {"signal": "guideTitleStyle.lineHeight"}
    },
    "guide-label": {
      "dir": {
        "signal": "locale.characterDirection === \"rightToLeft\" ? \"rtl\" : \"ltr\""
      },
      "fill": {"signal": "chartColor.axisLabel"},
      "fontWeight": 400,
      "fontSize": {"signal": "guideLabelStyle.pointSize"},
      "font": {"signal": "guideLabelStyle.fontName"},
      "lineHeight": {"signal": "guideLabelStyle.lineHeight"}
    },
    "group-title": {
      "dir": {
        "signal": "locale.characterDirection === \"rightToLeft\" ? \"rtl\" : \"ltr\""
      },
      "fill": {"signal": "chartColor.groupTitle"},
      "font": {"signal": "titleStyle.fontName"},
      "fontSize": {"signal": "titleStyle.pointSize"},
      "lineHeight": {"signal": "titleStyle.lineHeight"}
    },
    "group-subtitle": {
      "dir": {
        "signal": "locale.characterDirection === \"rightToLeft\" ? \"rtl\" : \"ltr\""
      },
      "fill": {"signal": "chartColor.groupSubtitle"},
      "font": {"signal": "subtitleStyle.fontName"},
      "fontSize": {"signal": "subtitleStyle.pointSize"},
      "lineHeight": {"signal": "subtitleStyle.lineHeight"}
    },
    "lineMarker": {"fill": "white", "stroke": {"signal": "chartColor.mark"}},
    "crosshair": {"stroke": "#666", "strokeDash": [2, 2]},
    "axis": {
      "domain": false,
      "domainColor": {"signal": "chartColor.gridOuter"},
      "domainWidth": {"signal": "gridWidth"},
      "gridColor": {"signal": "chartColor.gridInner"},
      "gridWidth": {"signal": "gridWidth"},
      "labelPadding": 4,
      "labelSeparation": 4,
      "ticks": false,
      "tickColor": {"signal": "chartColor.gridInner"},
      "tickRound": false,
      "translate": {"signal": "gridWidth/2"},
      "tickWidth": {"signal": "gridWidth"},
      "titlePadding": 8
    },
    "axis-right": {
      "orient": {
        "signal": "(locale.characterDirection === \"rightToLeft\" ? 'left' : 'right')"
      }
    },
    "axis-left": {
      "orient": {
        "signal": "(locale.characterDirection === \"rightToLeft\" ? 'right' : 'left')"
      }
    },
    "axis-temporal": {"gridDash": [2, 2], "tickDash": [2, 2]},
    "axis-x-horizontal": {
      "labelAngle": 0,
      "labelBaseline": "line-top",
      "labelPadding": 2
    },
    "axis-x-interval": {
      "ticks": true,
      "tickSize": {"signal": "guideLabelStyle.lineHeight + 2"},
      "labelAlign": {
        "signal": "((locale.characterDirection === \"rightToLeft\" && locale.languageCode !== \"he\")) ? 'right' : 'left'"
      },
      "labelPadding": {"signal": "-guideLabelStyle.lineHeight"},
      "labelOffset": {
        "signal": "((locale.characterDirection === \"rightToLeft\" && locale.languageCode !== \"he\") ? -1 : 1) * 4"
      },
      "labelExpr": "datum.index === 1 ? \"\" : datum.label"
    },
    "axis-year": {
      "gridDash": {
        "condition": {
          "test": {"timeUnit": "month", "field": "value", "equal": 0},
          "value": []
        },
        "value": [2, 2]
      },
      "tickDash": {
        "condition": {
          "test": {"timeUnit": "month", "field": "value", "equal": 0},
          "value": []
        },
        "value": [2, 2]
      },
      "gridColor": {
        "condition": {
          "test": {"timeUnit": "month", "field": "value", "equal": 0},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickColor": {
        "condition": {
          "test": {"timeUnit": "month", "field": "value", "equal": 0},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickCount": 4
    },
    "axis-month": {
      "gridDash": {
        "condition": {
          "test": {"timeUnit": "date", "field": "value", "equal": 1},
          "value": []
        },
        "value": [2, 2]
      },
      "tickDash": {
        "condition": {
          "test": {"timeUnit": "date", "field": "value", "equal": 1},
          "value": []
        },
        "value": [2, 2]
      },
      "gridColor": {
        "condition": {
          "test": {"timeUnit": "date", "field": "value", "equal": 1},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickColor": {
        "condition": {
          "test": {"timeUnit": "date", "field": "value", "equal": 1},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      }
    },
    "axis-week": {
      "gridDash": {
        "condition": {
          "test": "day(datum.value)===calendar.firstWeekday-1",
          "value": []
        },
        "value": [2, 2]
      },
      "tickDash": {
        "condition": {
          "test": "day(datum.value)===calendar.firstWeekday-1",
          "value": []
        },
        "value": [2, 2]
      },
      "gridColor": {
        "condition": {
          "test": "day(datum.value)===calendar.firstWeekday-1",
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickColor": {
        "condition": {
          "test": "day(datum.value)===calendar.firstWeekday-1",
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickCount": 7
    },
    "axis-day": {
      "gridDash": {
        "condition": {
          "test": {"timeUnit": "hours", "field": "value", "equal": 0},
          "value": []
        },
        "value": [2, 2]
      },
      "tickDash": {
        "condition": {
          "test": {"timeUnit": "hours", "field": "value", "equal": 0},
          "value": []
        },
        "value": [2, 2]
      },
      "gridColor": {
        "condition": {
          "test": {"timeUnit": "hours", "field": "value", "equal": 0},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickColor": {
        "condition": {
          "test": {"timeUnit": "hours", "field": "value", "equal": 0},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickCount": 4
    },
    "axis-hour": {
      "gridDash": {
        "condition": {
          "test": {"timeUnit": "minutes", "field": "value", "equal": 0},
          "value": []
        },
        "value": [2, 2]
      },
      "tickDash": {
        "condition": {
          "test": {"timeUnit": "minutes", "field": "value", "equal": 0},
          "value": []
        },
        "value": [2, 2]
      },
      "gridColor": {
        "condition": {
          "test": {"timeUnit": "minutes", "field": "value", "equal": 0},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickColor": {
        "condition": {
          "test": {"timeUnit": "minutes", "field": "value", "equal": 0},
          "signal": "chartColor.gridDivider"
        },
        "signal": "chartColor.gridInner"
      },
      "tickCount": 4
    }
  },
  "axis": {"style": "axis"},
  "axisY": {"style": "axis-left"},
  "axisXQuantitative": {"style": "axis-x-horizontal"},
  "axisTemporal": {"style": "axis-temporal"},
  "axisXTemporal": {"style": ["axis-x-horizontal", "axis-x-interval"]},
  "scale": {
    "bandPaddingInner": 0.2,
    "xReverse": {
      "signal": "(locale.characterDirection === \"rightToLeft\" && locale.languageCode !== \"he\")"
    }
  },
  "legend": {
    "offset": 24,
    "symbolBaseFillColor": {"signal": "chartColor.axisTitle"}
  },
  "title": {"offset": 16},
  "range": {
    "category": [
      "#308BEF",
      "#4DC960",
      "#FF9500",
      "#EF5C53",
      "#A34FCD",
      "#00A39B",
      "#98685E",
      "#EEDB41"
    ],
    "heatmap": {"scheme": "yellowgreenblue"},
    "ordinal": {"scheme": "yellowgreenblue"},
    "ramp": {"scheme": "yellowgreenblue"}
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).vega={})}(this,(function(t){"use strict";function e(t,e,n){return t.fields=e||[],t.fname=n,t}function n(t){return null==t?null:t.fname}function r(t){return null==t?null:t.fields}function i(t){return 1===t.length?a(t[0]):o(t)}const a=t=>function(e){return e[t]},o=t=>{const e=t.length;return function(n){for(let r=0;r<e;++r)n=n[t[r]];return n}};function u(t){throw Error(t)}function s(t){var e,n,r,i=[],a=null,o=0,s=t.length,l="";function c(){i.push(l+t.substring(e,n)),l="",e=n+1}for(t+="",e=n=0;n<s;++n)if("\\"===(r=t[n]))l+=t.substring(e,n),l+=t.substring(++n,++n),e=n;else if(r===a)c(),a=null,o=-1;else{if(a)continue;e===o&&'"'===r||e===o&&"'"===r?(e=n+1,a=r):"."!==r||o?"["===r?(n>e&&c(),o=e=n+1):"]"===r&&(o||u("Access path missing open bracket: "+t),o>0&&c(),o=0,e=n+1):n>e?c():e=n+1}return o&&u("Access path missing closing bracket: "+t),a&&u("Access path missing closing quote: "+t),n>e&&(n++,c()),i}function l(t,n,r){const a=s(t);return t=1===a.length?a[0]:t,e((r&&r.get||i)(a),[t],n||t)}var c=[],f=l("id"),h=e((function(t){return t}),c,"identity"),d=e((function(){return 0}),c,"zero"),p=e((function(){return 1}),c,"one"),g=e((function(){return!0}),c,"true"),m=e((function(){return!1}),c,"false");function v(t,e,n){var r=[e].concat([].slice.call(n));console[t].apply(console,r)}function y(t,e){var n=t||0;return{level:function(t){return arguments.length?(n=+t,this):n},error:function(){return n>=1&&v(e||"error","ERROR",arguments),this},warn:function(){return n>=2&&v(e||"warn","WARN",arguments),this},info:function(){return n>=3&&v(e||"log","INFO",arguments),this},debug:function(){return n>=4&&v(e||"log","DEBUG",arguments),this}}}var _=Array.isArray;function x(t){return t===Object(t)}const b=t=>"__proto__"!==t;function w(...t){return t.reduce((t,e)=>{for(var n in e)if("signals"===n)t.signals=A(t.signals,e.signals);else{var r="legend"===n?{layout:1}:"style"===n||null;k(t,n,e[n],r)}return t},{})}function k(t,e,n,r){var i,a;if(b(e))if(x(n)&&!_(n))for(i in a=x(t[e])?t[e]:t[e]={},n)r&&(!0===r||r[i])?k(a,i,n[i]):b(i)&&(a[i]=n[i]);else t[e]=n}function A(t,e){if(null==t)return e;const n={},r=[];function i(t){n[t.name]||(n[t.name]=1,r.push(t))}return e.forEach(i),t.forEach(i),r}function M(t){return t[t.length-1]}function E(t){return null==t||""===t?null:+t}function D(t){return function(e){return t*Math.exp(e)}}function C(t){return function(e){return Math.log(t*e)}}function F(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function S(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function B(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function T(t,e,n,r){var i=n(t[0]),a=n(M(t)),o=(a-i)*e;return[r(i-o),r(a-o)]}function z(t,e){return T(t,e,E,h)}function N(t,e){var n=Math.sign(t[0]);return T(t,e,C(n),D(n))}function O(t,e,n){return T(t,e,B(n),B(1/n))}function R(t,e,n){return T(t,e,F(n),S(n))}function q(t,e,n,r,i){var a=r(t[0]),o=r(M(t)),u=null!=e?r(e):(a+o)/2;return[i(u+(a-u)*n),i(u+(o-u)*n)]}function U(t,e,n){return q(t,e,n,E,h)}function L(t,e,n){var r=Math.sign(t[0]);return q(t,e,n,C(r),D(r))}function $(t,e,n,r){return q(t,e,n,B(r),B(1/r))}function P(t,e,n,r){return q(t,e,n,F(r),S(r))}function j(t){return 1+~~(new Date(t).getMonth()/3)}function I(t){return 1+~~(new Date(t).getUTCMonth()/3)}function W(t){return null!=t?_(t)?t:[t]:[]}function H(t,e,n){var r,i=t[0],a=t[1];return a<i&&(r=a,a=i,i=r),(r=a-i)>=n-e?[e,n]:[i=Math.min(Math.max(i,e),n-r),i+r]}function Y(t){return"function"==typeof t}function V(t,n,i){i=i||{},n=W(n)||[];const a=[],o=[],u={},s=i.comparator||X;return W(t).forEach((t,e)=>{null!=t&&(a.push("descending"===n[e]?-1:1),o.push(t=Y(t)?t:l(t,null,i)),(r(t)||[]).forEach(t=>u[t]=1))}),0===o.length?null:e(s(o,a),Object.keys(u))}const G=(t,e)=>(t<e||null==t)&&null!=e?-1:(t>e||null==e)&&null!=t?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e==e?-1:e!=e&&t==t?1:0),X=(t,e)=>1===t.length?J(t[0],e[0]):Z(t,e,t.length),J=(t,e)=>function(n,r){return G(t(n),t(r))*e},Z=(t,e,n)=>(e.push(0),function(r,i){let a,o=0,u=-1;for(;0===o&&++u<n;)a=t[u],o=G(a(r),a(i));return o*e[u]});function Q(t){return Y(t)?t:function(){return t}}function K(t,e){var n,r;function i(){e(r),n=r=null}return function(e){r=e,n&&clearTimeout(n),n=setTimeout(i,t)}}function tt(t){for(var e,n,r=1,i=arguments.length;r<i;++r)for(n in e=arguments[r])t[n]=e[n];return t}function et(t,e){var n,r,i,a,o=0;if(t&&(n=t.length))if(null==e){for(r=t[o];o<n&&(null==r||r!=r);r=t[++o]);for(i=a=r;o<n;++o)null!=(r=t[o])&&(r<i&&(i=r),r>a&&(a=r))}else{for(r=e(t[o]);o<n&&(null==r||r!=r);r=e(t[++o]));for(i=a=r;o<n;++o)null!=(r=e(t[o]))&&(r<i&&(i=r),r>a&&(a=r))}return[i,a]}function nt(t,e){var n,r,i,a,o,u=-1,s=t.length;if(null==e){for(;++u<s;)if(null!=(r=t[u])&&r>=r){n=i=r;break}if(u===s)return[-1,-1];for(a=o=u;++u<s;)null!=(r=t[u])&&(n>r&&(n=r,a=u),i<r&&(i=r,o=u))}else{for(;++u<s;)if(null!=(r=e(t[u],u,t))&&r>=r){n=i=r;break}if(u===s)return[-1,-1];for(a=o=u;++u<s;)null!=(r=e(t[u],u,t))&&(n>r&&(n=r,a=u),i<r&&(i=r,o=u))}return[a,o]}const rt=Object.prototype.hasOwnProperty;function it(t,e){return rt.call(t,e)}var at={};function ot(t){var e,n,r={};function i(t){return it(r,t)&&r[t]!==at}return e={size:0,empty:0,object:r,has:i,get:t=>i(t)?r[t]:void 0,set(t,n){return i(t)||(++e.size,r[t]===at&&--e.empty),r[t]=n,this},delete(t){return i(t)&&(--e.size,++e.empty,r[t]=at),this},clear(){e.size=e.empty=0,e.object=r={}},test(t){return arguments.length?(n=t,e):n},clean(){var t,i,a={},o=0;for(t in r)(i=r[t])===at||n&&n(i)||(a[t]=i,++o);e.size=o,e.empty=0,e.object=r=a}},t&&Object.keys(t).forEach((function(n){e.set(n,t[n])})),e}function ut(t,e,n,r,i,a){if(!n&&0!==n)return a;var o,u,s=t[0],l=M(t),c=+n;return l<s&&(o=s,s=l,l=o),(o=Math.abs(e-s))<(u=Math.abs(l-e))&&o<=c?r:u<=c?i:a}function st(t,e){var n=t.prototype=Object.create(e.prototype);return n.constructor=t,n}function lt(t,e,n,r){var i,a=e[0],o=e[e.length-1];return a>o&&(i=a,a=o,o=i),r=void 0===r||r,((n=void 0===n||n)?a<=t:a<t)&&(r?t<=o:t<o)}function ct(t){return"boolean"==typeof t}function ft(t){return"[object Date]"===Object.prototype.toString.call(t)}function ht(t){return"number"==typeof t}function dt(t){return"[object RegExp]"===Object.prototype.toString.call(t)}function pt(t){return"string"==typeof t}function gt(t,n,r){t&&(t=n?W(t).map(t=>t.replace(/\\(.)/g,"$1")):W(t));const a=t&&t.length,o=r&&r.get||i,u=t=>o(n?[t]:s(t));let l;if(a)if(1===a){const e=u(t[0]);l=function(t){return""+e(t)}}else{const e=t.map(u);l=function(t){let n=""+e[0](t),r=0;for(;++r<a;)n+="|"+e[r](t);return n}}else l=function(){return""};return e(l,t,"key")}function mt(t,e){const n=t[0],r=M(t),i=+e;return i?1===i?r:n+i*(r-n):n}function vt(t){let e,n,r;t=+t||1e4;const i=()=>{e={},n={},r=0},a=(i,a)=>(++r>t&&(n=e,e={},r=1),e[i]=a);return i(),{clear:i,has:t=>it(e,t)||it(n,t),get:t=>it(e,t)?e[t]:it(n,t)?a(t,n[t]):void 0,set:(t,n)=>it(e,t)?e[t]=n:a(t,n)}}function yt(t,e,n,r){var i=e.length,a=n.length;if(!a)return e;if(!i)return n;for(var o=r||new e.constructor(i+a),u=0,s=0,l=0;u<i&&s<a;++l)o[l]=t(e[u],n[s])>0?n[s++]:e[u++];for(;u<i;++u,++l)o[l]=e[u];for(;s<a;++s,++l)o[l]=n[s];return o}function _t(t,e){for(var n="";--e>=0;)n+=t;return n}function xt(t,e,n,r){var i=n||" ",a=t+"",o=e-a.length;return o<=0?a:"left"===r?_t(i,o)+a:"center"===r?_t(i,~~(o/2))+a+_t(i,Math.ceil(o/2)):a+_t(i,o)}function bt(t){return t&&M(t)-t[0]||0}function wt(t){return _(t)?"["+t.map(wt)+"]":x(t)||pt(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function kt(t){return null==t||""===t?null:!(!t||"false"===t||"0"===t)&&!!t}function At(t){return ht(t)||ft(t)?t:Date.parse(t)}function Mt(t,e){return e=e||At,null==t||""===t?null:e(t)}function Et(t){return null==t||""===t?null:t+""}function Dt(t){for(var e={},n=0,r=t.length;n<r;++n)e[t[n]]=!0;return e}function Ct(t,e,n,r){var i=null!=r?r:"
",a=t+"",o=a.length,u=Math.max(0,e-i.length);return o<=e?a:"left"===n?i+a.slice(o-u):"center"===n?a.slice(0,Math.ceil(u/2))+i+a.slice(o-~~(u/2)):a.slice(0,u)+i}function Ft(t,e,n){if(t)if(e)for(var r,i=0,a=t.length;i<a;++i)(r=e(t[i]))&&n(r,i,t);else t.forEach(n)}function St(t){var e=t||h,n=[],r={};return n.add=function(t){var i=e(t);return r[i]||(r[i]=1,n.push(t)),n},n.remove=function(t){var i,a=e(t);return r[a]&&(r[a]=0,(i=n.indexOf(t))>=0&&n.splice(i,1)),n},n}async function Bt(t,e){try{await e(t)}catch(e){t.error(e)}}var Tt=Symbol("vega_id"),zt=1;function Nt(t){return!(!t||!Ot(t))}function Ot(t){return t[Tt]}function Rt(t,e){return t[Tt]=e,t}function qt(t){var e=t===Object(t)?t:{data:t};return Ot(e)?e:Rt(e,zt++)}function Ut(t){return Lt(t,qt({}))}function Lt(t,e){for(var n in t)e[n]=t[n];return e}function $t(t,e){return Rt(e,Ot(t))}function Pt(t,e){return t?e?(n,r)=>t(n,r)||Ot(e(n))-Ot(e(r)):(e,n)=>t(e,n)||Ot(e)-Ot(n):null}function jt(t){return t&&t.constructor===It}function It(){var t=[],e=[],n=[],r=[],i=[],a=null,o=!1;return{constructor:It,insert:function(e){for(var n=W(e),r=0,i=n.length;r<i;++r)t.push(n[r]);return this},remove:function(t){for(var n=Y(t)?r:e,i=W(t),a=0,o=i.length;a<o;++a)n.push(i[a]);return this},modify:function(t,e,r){var a={field:e,value:Q(r)};return Y(t)?(a.filter=t,i.push(a)):(a.tuple=t,n.push(a)),this},encode:function(t,e){return Y(t)?i.push({filter:t,field:e}):n.push({tuple:t,field:e}),this},clean:function(t){return a=t,this},reflow:function(){return o=!0,this},pulse:function(u,s){var l,c,f,h,d,p,g={},m={};for(l=0,c=s.length;l<c;++l)g[Ot(s[l])]=1;for(l=0,c=e.length;l<c;++l)g[Ot(d=e[l])]=-1;for(l=0,c=r.length;l<c;++l)h=r[l],s.forEach((function(t){h(t)&&(g[Ot(t)]=-1)}));for(l=0,c=t.length;l<c;++l)p=Ot(d=t[l]),g[p]?g[p]=1:u.add.push(qt(t[l]));for(l=0,c=s.length;l<c;++l)d=s[l],g[Ot(d)]<0&&u.rem.push(d);function v(t,e,n){n?t[e]=n(t):u.encode=e,o||(m[Ot(t)]=t)}for(l=0,c=n.length;l<c;++l)d=(f=n[l]).tuple,h=f.field,(p=g[Ot(d)])>0&&(v(d,h,f.value),u.modifies(h));for(l=0,c=i.length;l<c;++l)f=i[l],h=f.filter,s.forEach((function(t){h(t)&&g[Ot(t)]>0&&v(t,f.field,f.value)})),u.modifies(f.field);if(o)u.mod=e.length||r.length?s.filter((function(t){return g[Ot(t)]>0})):s.slice();else for(p in m)u.mod.push(m[p]);return(a||null==a&&(e.length||r.length))&&u.clean(!0),u}}}var Wt="_:mod:_";function Ht(){Object.defineProperty(this,Wt,{writable:!0,value:{}})}var Yt=Ht.prototype;Yt.set=function(t,e,n,r){var i=this,a=i[t],o=i[Wt];return null!=e&&e>=0?(a[e]!==n||r)&&(a[e]=n,o[e+":"+t]=-1,o[t]=-1):(a!==n||r)&&(i[t]=n,o[t]=_(n)?1+n.length:-1),i},Yt.modified=function(t,e){var n,r=this[Wt];if(!arguments.length){for(n in r)if(r[n])return!0;return!1}if(_(t)){for(n=0;n<t.length;++n)if(r[t[n]])return!0;return!1}return null!=e&&e>=0?e+1<r[t]||!!r[e+":"+t]:!!r[t]},Yt.clear=function(){return this[Wt]={},this};var Vt=0,Gt=new Ht;function Xt(t,e,n,r){this.id=++Vt,this.value=t,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,e&&(this._update=e),n&&this.parameters(n,r)}var Jt=Xt.prototype;function Zt(t){return function(e){var n=this.flags;return 0===arguments.length?!!(n&t):(this.flags=e?n|t:n&~t,this)}}Jt.targets=function(){return this._targets||(this._targets=St(f))},Jt.set=function(t){return this.value!==t?(this.value=t,1):0},Jt.skip=Zt(1),Jt.modified=Zt(2),Jt.parameters=function(t,e,n){e=!1!==e;var r,i,a,o,s=this,l=s._argval=s._argval||new Ht,c=s._argops=s._argops||[],f=[];function h(t,n,r){r instanceof Xt?(r!==s&&(e&&r.targets().add(s),f.push(r)),c.push({op:r,name:t,index:n})):l.set(t,n,r)}for(r in t)if(i=t[r],"pulse"===r)W(i).forEach((function(t){t instanceof Xt?t!==s&&(t.targets().add(s),f.push(t)):u("Pulse parameters must be operator instances.")})),s.source=i;else if(_(i))for(l.set(r,-1,Array(a=i.length)),o=0;o<a;++o)h(r,o,i[o]);else h(r,-1,i);return this.marshall().clear(),n&&(c.initonly=!0),f},Jt.marshall=function(t){var e,n,r,i,a,o=this._argval||Gt,u=this._argops;if(u){for(n=0,r=u.length;n<r;++n)a=(i=(e=u[n]).op).modified()&&i.stamp===t,o.set(e.name,e.index,i.value,a);if(u.initonly){for(n=0;n<r;++n)(e=u[n]).op.targets().remove(this);this._argops=null,this._update=null}}return o},Jt.detach=function(){var t,e,n,r=this._argops;if(r)for(t=0,e=r.length;t<e;++t)(n=r[t].op)._targets&&n._targets.remove(this)},Jt.evaluate=function(t){var e=this._update;if(e){var n=this.marshall(t.stamp),r=e.call(this,n,t);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return t.StopPropagation}},Jt.run=function(t){return t.stamp<this.stamp?t.StopPropagation:(this.skip()?(this.skip(!1),e=0):e=this.evaluate(t),this.pulse=e||t);var e};var Qt=0;function Kt(t,e,n){this.id=++Qt,this.value=null,n&&(this.receive=n),t&&(this._filter=t),e&&(this._apply=e)}function te(t,e,n){return new Kt(t,e,n)}var ee=Kt.prototype;ee._filter=g,ee._apply=h,ee.targets=function(){return this._targets||(this._targets=St(f))},ee.consume=function(t){return arguments.length?(this._consume=!!t,this):!!this._consume},ee.receive=function(t){if(this._filter(t)){for(var e=this.value=this._apply(t),n=this._targets,r=n?n.length:0,i=0;i<r;++i)n[i].receive(e);this._consume&&(t.preventDefault(),t.stopPropagation())}},ee.filter=function(t){var e=te(t);return this.targets().add(e),e},ee.apply=function(t){var e=te(null,t);return this.targets().add(e),e},ee.merge=function(){var t=te();this.targets().add(t);for(var e=0,n=arguments.length;e<n;++e)arguments[e].targets().add(t);return t},ee.throttle=function(t){var e=-1;return this.filter((function(){var n=Date.now();return n-e>t?(e=n,1):0}))},ee.debounce=function(t){var e=te();return this.targets().add(te(null,null,K(t,(function(t){var n=t.dataflow;e.receive(t),n&&n.run&&n.run()})))),e},ee.between=function(t,e){var n=!1;return t.targets().add(te(null,null,(function(){n=!0}))),e.targets().add(te(null,null,(function(){n=!1}))),this.filter((function(){return n}))};const ne=/^([A-Za-z]+:)?\/\//,re=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,ie=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g;async function ae(t,e){const n=await this.sanitize(t,e),r=n.href;return n.localFile?this.file(r):this.http(r,e)}async function oe(t,e){e=tt({},this.options,e);const n=this.fileAccess,r={href:null};let i,a,o;const s=re.test(t.replace(ie,""));null!=t&&"string"==typeof t&&s||u("Sanitize failure, invalid URI: "+wt(t));const l=ne.test(t);return(o=e.baseURL)&&!l&&(t.startsWith("/")||"/"===o[o.length-1]||(t="/"+t),t=o+t),a=(i=t.startsWith("file://"))||"file"===e.mode||"http"!==e.mode&&!l&&n,i?t=t.slice("file://".length):t.startsWith("//")&&("file"===e.defaultProtocol?(t=t.slice(2),a=!0):t=(e.defaultProtocol||"http")+":"+t),Object.defineProperty(r,"localFile",{value:!!a}),r.href=t,e.target&&(r.target=e.target+""),e.rel&&(r.rel=e.rel+""),"image"===e.context&&e.crossOrigin&&(r.crossOrigin=e.crossOrigin+""),r}function ue(t){return t?function(e){return new Promise((function(n,r){t.readFile(e,(function(t,e){t?r(t):n(e)}))}))}:se}async function se(){u("No file system access.")}function le(t){return t?async function(e,n){const r=tt({},this.options.http,n),i=n&&n.response,a=await t(e,r);return a.ok?Y(a[i])?a[i]():a.text():u(a.status+""+a.statusText)}:ce}async function ce(){u("No HTTP fetch method available.")}var fe={boolean:kt,integer:E,number:E,date:Mt,string:Et,unknown:h},he=[function(t){return"true"===t||"false"===t||!0===t||!1===t},function(t){return me(t)&&Number.isInteger(+t)},me,function(t){return!Number.isNaN(Date.parse(t))}],de=["boolean","integer","number","date"];function pe(t,e){if(!t||!t.length)return"unknown";const n=t.length,r=he.length,i=he.map((t,e)=>e+1);for(let o,u,s=0,l=0;s<n;++s)for(u=e?t[s][e]:t[s],o=0;o<r;++o)if(i[o]&&(null!=(a=u)&&a==a)&&!he[o](u)&&(i[o]=0,++l,l===he.length))return"string";var a;return de[i.reduce((t,e)=>0===t?e:t,0)-1]}function ge(t,e){return e.reduce((function(e,n){return e[n]=pe(t,n),e}),{})}function me(t){return!(Number.isNaN(+t)||t instanceof Date)}var ve={},ye={};function _e(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function xe(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var r in t)r in e||n.push(e[r]=r)})),n}function be(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function we(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":function(t){return t<0?"-"+be(-t,6):t>9999?"+"+be(t,6):be(t,4)}(t.getUTCFullYear())+"-"+be(t.getUTCMonth()+1,2)+"-"+be(t.getUTCDate(),2)+(i?"T"+be(e,2)+":"+be(n,2)+":"+be(r,2)+"."+be(i,3)+"Z":r?"T"+be(e,2)+":"+be(n,2)+":"+be(r,2)+"Z":n||e?"T"+be(e,2)+":"+be(n,2)+"Z":"")}function ke(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function r(t,e){var r,i=[],a=t.length,o=0,u=0,s=a<=0,l=!1;function c(){if(s)return ye;if(l)return l=!1,ve;var e,r,i=o;if(34===t.charCodeAt(i)){for(;o++<a&&34!==t.charCodeAt(o)||34===t.charCodeAt(++o););return(e=o)>=a?s=!0:10===(r=t.charCodeAt(o++))?l=!0:13===r&&(l=!0,10===t.charCodeAt(o)&&++o),t.slice(i+1,e-1).replace(/""/g,'"')}for(;o<a;){if(10===(r=t.charCodeAt(e=o++)))l=!0;else if(13===r)l=!0,10===t.charCodeAt(o)&&++o;else if(r!==n)continue;return t.slice(i,e)}return s=!0,t.slice(i,a)}for(10===t.charCodeAt(a-1)&&--a,13===t.charCodeAt(a-1)&&--a;(r=c())!==ye;){for(var f=[];r!==ve&&r!==ye;)f.push(r),r=c();e&&null==(f=e(f,u++))||i.push(f)}return i}function i(e,n){return e.map((function(e){return n.map((function(t){return o(e[t])})).join(t)}))}function a(e){return e.map(o).join(t)}function o(t){return null==t?"":t instanceof Date?we(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,i,a=r(t,(function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=_e(t);return function(r,i){return e(n(r),i,t)}}(t,e):_e(t)}));return a.columns=i||[],a},parseRows:r,format:function(e,n){return null==n&&(n=xe(e)),[n.map(o).join(t)].concat(i(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=xe(t)),i(t,e).join("\n")},formatRows:function(t){return t.map(a).join("\n")},formatRow:a,formatValue:o}}function Ae(t){const e=function(e,n){const r={delimiter:t};return Me(e,n?tt(n,r):r)};return e.responseType="text",e}function Me(t,e){return e.header&&(t=e.header.map(wt).join(e.delimiter)+"\n"+t),ke(e.delimiter).parse(t+"")}function Ee(t,e){const n=e&&e.property?l(e.property):h;return!x(t)||(r=t,"function"==typeof Buffer&&Y(Buffer.isBuffer)&&Buffer.isBuffer(r))?n(JSON.parse(t)):function(t,e){return e&&e.copy?JSON.parse(JSON.stringify(t)):t}(n(t));var r}function De(t){return t}function Ce(t,e){return"string"==typeof e&&(e=t.objects[e]),"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return Fe(t,e)}))}:Fe(t,e)}function Fe(t,e){var n=e.id,r=e.bbox,i=null==e.properties?{}:e.properties,a=Se(t,e);return null==n&&null==r?{type:"Feature",properties:i,geometry:a}:null==r?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function Se(t,e){var n=function(t){if(null==t)return De;var e,n,r=t.scale[0],i=t.scale[1],a=t.translate[0],o=t.translate[1];return function(t,u){u||(e=n=0);var s=2,l=t.length,c=new Array(l);for(c[0]=(e+=t[0])*r+a,c[1]=(n+=t[1])*i+o;s<l;)c[s]=t[s],++s;return c}}(t.transform),r=t.arcs;function i(t,e){e.length&&e.pop();for(var i=r[t<0?~t:t],a=0,o=i.length;a<o;++a)e.push(n(i[a],a));t<0&&function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}(e,o)}function a(t){return n(t)}function o(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0]),e}function u(t){for(var e=o(t);e.length<4;)e.push(e[0]);return e}function s(t){return t.map(u)}return function t(e){var n,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(t)};case"Point":n=a(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(a);break;case"LineString":n=o(e.arcs);break;case"MultiLineString":n=e.arcs.map(o);break;case"Polygon":n=s(e.arcs);break;case"MultiPolygon":n=e.arcs.map(s);break;default:return null}return{type:r,coordinates:n}}(e)}function Be(t,e){var n={},r={},i={},a=[],o=-1;function u(t,e){for(var r in t){var i=t[r];delete e[i.start],delete i.start,delete i.end,i.forEach((function(t){n[t<0?~t:t]=1})),a.push(i)}}return e.forEach((function(n,r){var i,a=t.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(i=e[++o],e[o]=n,e[r]=i)})),e.forEach((function(e){var n,a,o=function(e){var n,r=t.arcs[e<0?~e:e],i=r[0];t.transform?(n=[0,0],r.forEach((function(t){n[0]+=t[0],n[1]+=t[1]}))):n=r[r.length-1];return e<0?[n,i]:[i,n]}(e),u=o[0],s=o[1];if(n=i[u])if(delete i[n.end],n.push(e),n.end=s,a=r[s]){delete r[a.start];var l=a===n?n:n.concat(a);r[l.start=n.start]=i[l.end=a.end]=l}else r[n.start]=i[n.end]=n;else if(n=r[s])if(delete r[n.start],n.unshift(e),n.start=u,a=i[u]){delete i[a.end];var c=a===n?n:a.concat(n);r[c.start=a.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[e]).start=u]=i[n.end=s]=n})),u(i,r),u(r,i),e.forEach((function(t){n[t<0?~t:t]||a.push([t])})),a}function Te(t){return Se(t,ze.apply(this,arguments))}function ze(t,e,n){var r,i,a;if(arguments.length>1)r=Ne(t,e,n);else for(i=0,r=new Array(a=t.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:Be(t,r)}}function Ne(t,e,n){var r,i=[],a=[];function o(t){var e=t<0?~t:t;(a[e]||(a[e]=[])).push({i:t,g:r})}function u(t){t.forEach(o)}function s(t){t.forEach(u)}return function t(e){switch(r=e,e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"LineString":u(e.arcs);break;case"MultiLineString":case"Polygon":s(e.arcs);break;case"MultiPolygon":!function(t){t.forEach(s)}(e.arcs)}}(e),a.forEach(null==n?function(t){i.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&i.push(t[0].i)}),i}Me.responseType="text",Ee.responseType="json";const Oe={interior:(t,e)=>t!==e,exterior:(t,e)=>t===e};function Re(t,e){let n,r,i,a;return t=Ee(t,e),e&&e.feature?(n=Ce,i=e.feature):e&&e.mesh?(n=Te,i=e.mesh,a=Oe[e.filter]):u("Missing TopoJSON feature or mesh parameter."),r=(r=t.objects[i])?n(t,r,a):u("Invalid TopoJSON object: "+i),r&&r.features||[r]}Re.responseType="json";const qe={dsv:Me,csv:Ae(","),tsv:Ae("\t"),json:Ee,topojson:Re};function Ue(t,e){return arguments.length>1?(qe[t]=e,this):it(qe,t)?qe[t]:null}function Le(t){const e=Ue(t);return e&&e.responseType||"text"}function $e(t){const e={};return n=>e[n]||(e[n]=t(n))}function Pe(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function je(t){var e;return 1===t.length&&(e=t,t=function(t,n){return Pe(e(t),n)}),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var a=r+i>>>1;t(e[a],n)<0?r=a+1:i=a}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var a=r+i>>>1;t(e[a],n)>0?i=a:r=a+1}return r}}}var Ie=je(Pe),We=Ie.right,He=Ie.left;function Ye(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),a=new Array(i);++r<i;)a[r]=t+r*n;return a}var Ve=Math.sqrt(50),Ge=Math.sqrt(10),Xe=Math.sqrt(2);function Je(t,e,n){var r,i,a,o,u=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(o=Ze(t,e,n))||!isFinite(o))return[];if(o>0)for(t=Math.ceil(t/o),e=Math.floor(e/o),a=new Array(i=Math.ceil(e-t+1));++u<i;)a[u]=(t+u)*o;else for(t=Math.floor(t*o),e=Math.ceil(e*o),a=new Array(i=Math.ceil(t-e+1));++u<i;)a[u]=(t-u)/o;return r&&a.reverse(),a}function Ze(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=Ve?10:a>=Ge?5:a>=Xe?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=Ve?10:a>=Ge?5:a>=Xe?2:1)}function Qe(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=Ve?i*=10:a>=Ge?i*=5:a>=Xe&&(i*=2),e<t?-i:i}function Ke(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function tn(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function en(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function nn(t){return null===t?NaN:+t}function rn(t,e,n){if(r=(t=Float64Array.from(function*(t,e){if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let r of t)null!=(r=e(r,++n,t))&&(r=+r)>=r&&(yield r)}}(t,n))).length){if((e=+e)<=0||r<2)return tn(t);if(e>=1)return Ke(t);var r,i=(r-1)*e,a=Math.floor(i),o=Ke(function t(e,n,r=0,i=e.length-1,a=Pe){for(;i>r;){if(i-r>600){const o=i-r+1,u=n-r+1,s=Math.log(o),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(o-l)/o)*(u-o/2<0?-1:1);t(e,n,Math.max(r,Math.floor(n-u*l/o+c)),Math.min(i,Math.floor(n+(o-u)*l/o+c)),a)}const o=e[n];let u=r,s=i;for(en(e,r,n),a(e[i],o)>0&&en(e,r,i);u<s;){for(en(e,u,s),++u,--s;a(e[u],o)<0;)++u;for(;a(e[s],o)>0;)--s}0===a(e[r],o)?en(e,r,s):(++s,en(e,s,i)),s<=n&&(r=s+1),n<=s&&(i=s-1)}return e}(t,a).subarray(0,a+1));return o+(tn(t.subarray(a+1))-o)*(i-a)}}function an(t,e){return rn(t,.5,e)}function on(t,e){let n=0;if(void 0===e)for(let e of t)(e=+e)&&(n+=e);else{let r=-1;for(let i of t)(i=+e(i,++r,t))&&(n+=i)}return n}function un(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function sn(t){return(t=un(Math.abs(t)))?t[1]:NaN}var ln,cn=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function fn(t){if(!(e=cn.exec(t)))throw new Error("invalid format: "+t);var e;return new hn({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function hn(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function dn(t,e){var n=un(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}fn.prototype=hn.prototype,hn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var pn={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return dn(100*t,e)},r:dn,s:function(t,e){var n=un(t,e);if(!n)return t+"";var r=n[0],i=n[1],a=i-(ln=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+un(t,Math.max(0,e+a-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function gn(t){return t}var mn,vn,yn,_n=Array.prototype.map,xn=["y","z","a","f","p","n","
","m","","k","M","G","T","P","E","Z","Y"];function bn(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?gn:(e=_n.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,a=[],o=0,u=e[0],s=0;i>0&&u>0&&(s+u+1>r&&(u=Math.max(1,r-s)),a.push(t.substring(i-=u,i+u)),!((s+=u+1)>r));)u=e[o=(o+1)%e.length];return a.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",a=void 0===t.currency?"":t.currency[1]+"",o=void 0===t.decimal?".":t.decimal+"",u=void 0===t.numerals?gn:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(_n.call(t.numerals,String)),s=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"-":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function f(t){var e=(t=fn(t)).fill,n=t.align,f=t.sign,h=t.symbol,d=t.zero,p=t.width,g=t.comma,m=t.precision,v=t.trim,y=t.type;"n"===y?(g=!0,y="g"):pn[y]||(void 0===m&&(m=12),v=!0,y="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var _="$"===h?i:"#"===h&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===h?a:/[%p]/.test(y)?s:"",b=pn[y],w=/[defgprs%]/.test(y);function k(t){var i,a,s,h=_,k=x;if("c"===y)k=b(t)+k,t="";else{var A=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:b(Math.abs(t),m),v&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),A&&0==+t&&"+"!==f&&(A=!1),h=(A?"("===f?f:l:"-"===f||"("===f?"":f)+h,k=("s"===y?xn[8+ln/3]:"")+k+(A&&"("===f?")":""),w)for(i=-1,a=t.length;++i<a;)if(48>(s=t.charCodeAt(i))||s>57){k=(46===s?o+t.slice(i+1):t.slice(i))+k,t=t.slice(0,i);break}}g&&!d&&(t=r(t,1/0));var M=h.length+t.length+k.length,E=M<p?new Array(p-M+1).join(e):"";switch(g&&d&&(t=r(E+t,E.length?p-k.length:1/0),E=""),n){case"<":t=h+t+k+E;break;case"=":t=h+E+t+k;break;case"^":t=E.slice(0,M=E.length>>1)+h+t+k+E.slice(M);break;default:t=E+h+t+k}return u(t)}return m=void 0===m?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),k.toString=function(){return t+""},k}return{format:f,formatPrefix:function(t,e){var n=f(((t=fn(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(sn(e)/3))),i=Math.pow(10,-r),a=xn[8+r/3];return function(t){return n(i*t)+a}}}}function wn(t){return Math.max(0,-sn(Math.abs(t)))}function kn(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(sn(e)/3)))-sn(Math.abs(t)))}function An(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,sn(e)-sn(t))+1}function Mn(t){const e=$e(t.format),n=t.formatPrefix;return{format:e,formatPrefix:n,formatFloat(t){var n,r,i=fn(t||",");if(null==i.precision){switch(i.precision=12,i.type){case"%":i.precision-=2;break;case"e":i.precision-=1}return n=e(i),r=e(".1f")(1)[1],t=>{var e,i,a=n(t),o=a.indexOf(r);if(o<0)return a;for(i=(e=function(t,e){var n,r=t.lastIndexOf("e");if(r>0)return r;for(r=t.length;--r>e;)if((n=t.charCodeAt(r))>=48&&n<=57)return r+1}(a,o))<a.length?a.slice(e):"";--e>o;)if("0"!==a[e]){++e;break}return a.slice(0,e)+i}}return e(i)},formatSpan(t,r,i,a){a=fn(null==a?",f":a);const o=Qe(t,r,i),u=Math.max(Math.abs(t),Math.abs(r));let s;if(null==a.precision)switch(a.type){case"s":return isNaN(s=kn(o,u))||(a.precision=s),n(a,u);case"":case"e":case"g":case"p":case"r":isNaN(s=An(o,u))||(a.precision=s-("e"===a.type));break;case"f":case"%":isNaN(s=wn(o))||(a.precision=s-2*("%"===a.type))}return e(a)}}}let En;function Dn(){return En=Mn({format:vn,formatPrefix:yn})}function Cn(t){return Mn(bn(t))}function Fn(t){return arguments.length?En=Cn(t):En}!function(t){mn=bn(t),vn=mn.format,yn=mn.formatPrefix}({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),Dn();const Sn="year",Bn="quarter",Tn="month",zn="week",Nn="date",On="day",Rn="hours",qn="minutes",Un="seconds",Ln=[Sn,Bn,Tn,zn,Nn,On,"dayofyear",Rn,qn,Un,"milliseconds"],$n=Ln.reduce((t,e,n)=>(t[e]=1+n,t),{});function Pn(t){const e=W(t).slice(),n={};e.length||u("Missing time unit."),e.forEach(t=>{it($n,t)?n[t]=1:u(`Invalid time unit: ${t}.`)});return(n[zn]||n.day?1:0)+(n[Bn]||n[Tn]||n[Nn]?1:0)+(n.dayofyear?1:0)>1&&u("Incompatible time units: "+t),e.sort((t,e)=>$n[t]-$n[e]),e}const jn={[Sn]:"%Y ",[Bn]:"Q%q ",[Tn]:"%b ",[Nn]:"%d ",[zn]:"W%U ",[On]:"%a ",dayofyear:"%j ",[Rn]:"%H:00",[qn]:"00:%M",[Un]:":%S",milliseconds:".%L","year-month":"%Y-%m ","year-month-date":"%Y-%m-%d ",["hours-"+qn]:"%H:%M"};function In(t,e){const n=tt({},jn,e),r=Pn(t),i=r.length;let a,o,u="",s=0;for(s=0;s<i;)for(a=r.length;a>s;--a)if(o=r.slice(s,a).join("-"),null!=n[o]){u+=n[o],s=a;break}return u.trim()}var Wn=new Date,Hn=new Date;function Yn(t,e,n,r){function i(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return i.floor=function(e){return t(e=new Date(+e)),e},i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,a){var o,u=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r&&a>0))return u;do{u.push(o=new Date(+n)),e(n,a),t(n)}while(o<n&&n<r);return u},i.filter=function(n){return Yn((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,r){if(t>=t)if(r<0)for(;++r<=0;)for(;e(t,-1),!n(t););else for(;--r>=0;)for(;e(t,1),!n(t););}))},n&&(i.count=function(e,r){return Wn.setTime(+e),Hn.setTime(+r),t(Wn),t(Hn),Math.floor(n(Wn,Hn))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t==0}:function(e){return i.count(0,e)%t==0}):i:null}),i}var Vn=Yn((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));Vn.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?Yn((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):Vn:null};var Gn=Yn((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+1e3*e)}),(function(t,e){return(e-t)/1e3}),(function(t){return t.getUTCSeconds()})),Xn=Yn((function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds())}),(function(t,e){t.setTime(+t+6e4*e)}),(function(t,e){return(e-t)/6e4}),(function(t){return t.getMinutes()})),Jn=Yn((function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds()-6e4*t.getMinutes())}),(function(t,e){t.setTime(+t+36e5*e)}),(function(t,e){return(e-t)/36e5}),(function(t){return t.getHours()})),Zn=Yn((function(t){t.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+e)}),(function(t,e){return(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5}),(function(t){return t.getDate()-1}));function Qn(t){return Yn((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/6048e5}))}var Kn=Qn(0),tr=Qn(1),er=(Qn(2),Qn(3),Qn(4)),nr=(Qn(5),Qn(6),Yn((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()}))),rr=Yn((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));rr.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Yn((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};var ir=Yn((function(t){t.setUTCSeconds(0,0)}),(function(t,e){t.setTime(+t+6e4*e)}),(function(t,e){return(e-t)/6e4}),(function(t){return t.getUTCMinutes()})),ar=Yn((function(t){t.setUTCMinutes(0,0,0)}),(function(t,e){t.setTime(+t+36e5*e)}),(function(t,e){return(e-t)/36e5}),(function(t){return t.getUTCHours()})),or=Yn((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/864e5}),(function(t){return t.getUTCDate()-1}));function ur(t){return Yn((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/6048e5}))}var sr=ur(0),lr=ur(1),cr=(ur(2),ur(3),ur(4)),fr=(ur(5),ur(6),Yn((function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCMonth(t.getUTCMonth()+e)}),(function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())}),(function(t){return t.getUTCMonth()}))),hr=Yn((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));hr.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Yn((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};const dr=new Date;function pr(t){return dr.setFullYear(t),dr.setMonth(0),dr.setDate(1),dr.setHours(0,0,0,0),dr}function gr(t){return vr(new Date(t))}function mr(t){return yr(new Date(t))}function vr(t){return Zn.count(pr(t.getFullYear())-1,t)}function yr(t){return Kn.count(pr(t.getFullYear())-1,t)}function _r(t){return pr(t).getDay()}function xr(t,e,n,r,i,a,o){if(0<=t&&t<100){var u=new Date(-1,e,n,r,i,a,o);return u.setFullYear(t),u}return new Date(t,e,n,r,i,a,o)}function br(t){return kr(new Date(t))}function wr(t){return Ar(new Date(t))}function kr(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return or.count(e-1,t)}function Ar(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return sr.count(e-1,t)}function Mr(t){return dr.setTime(Date.UTC(t,0,1)),dr.getUTCDay()}function Er(t,e,n,r,i,a,o){if(0<=t&&t<100){var u=new Date(Date.UTC(-1,e,n,r,i,a,o));return u.setUTCFullYear(n.y),u}return new Date(Date.UTC(t,e,n,r,i,a,o))}function Dr(t,e,n,r,i){const a=e||1,o=M(t),u=(t,e,i)=>function(t,e,n,r){const i=n<=1?t:r?(e,i)=>r+n*Math.floor((t(e,i)-r)/n):(e,r)=>n*Math.floor(t(e,r)/n);return e?(t,n)=>e(i(t,n),n):i}(n[i=i||t],r[i],t===o&&a,e),s=new Date,l=Dt(t),c=l[Sn]?u(Sn):Q(2012),f=l[Tn]?u(Tn):l[Bn]?u(Bn):d,h=l[zn]&&l.day?u(On,1,zn+On):l[zn]?u(zn,1):l.day?u(On,1):l[Nn]?u(Nn,1):l.dayofyear?u("dayofyear",1):p,g=l[Rn]?u(Rn):d,m=l[qn]?u(qn):d,v=l[Un]?u(Un):d,y=l.milliseconds?u("milliseconds"):d;return function(t){s.setTime(+t);const e=c(s);return i(e,f(s),h(s,e),g(s),m(s),v(s),y(s))}}function Cr(t,e,n){return e+7*t-(n+6)%7}const Fr={[Sn]:t=>t.getFullYear(),[Bn]:t=>Math.floor(t.getMonth()/3),[Tn]:t=>t.getMonth(),[Nn]:t=>t.getDate(),[Rn]:t=>t.getHours(),[qn]:t=>t.getMinutes(),[Un]:t=>t.getSeconds(),milliseconds:t=>t.getMilliseconds(),dayofyear:t=>vr(t),[zn]:t=>yr(t),[zn+On]:(t,e)=>Cr(yr(t),t.getDay(),_r(e)),[On]:(t,e)=>Cr(1,t.getDay(),_r(e))},Sr={[Bn]:t=>3*t,[zn]:(t,e)=>Cr(t,0,_r(e))};function Br(t,e){return Dr(t,e||1,Fr,Sr,xr)}const Tr={[Sn]:t=>t.getUTCFullYear(),[Bn]:t=>Math.floor(t.getUTCMonth()/3),[Tn]:t=>t.getUTCMonth(),[Nn]:t=>t.getUTCDate(),[Rn]:t=>t.getUTCHours(),[qn]:t=>t.getUTCMinutes(),[Un]:t=>t.getUTCSeconds(),milliseconds:t=>t.getUTCMilliseconds(),dayofyear:t=>kr(t),[zn]:t=>Ar(t),[On]:(t,e)=>Cr(1,t.getUTCDay(),Mr(e)),[zn+On]:(t,e)=>Cr(Ar(t),t.getUTCDay(),Mr(e))},zr={[Bn]:t=>3*t,[zn]:(t,e)=>Cr(t,0,Mr(e))};function Nr(t,e){return Dr(t,e||1,Tr,zr,Er)}const Or={[Sn]:rr,[Bn]:nr.every(3),[Tn]:nr,[zn]:Kn,[Nn]:Zn,[On]:Zn,dayofyear:Zn,[Rn]:Jn,[qn]:Xn,[Un]:Gn,milliseconds:Vn},Rr={[Sn]:hr,[Bn]:fr.every(3),[Tn]:fr,[zn]:sr,[Nn]:or,[On]:or,dayofyear:or,[Rn]:ar,[qn]:ir,[Un]:Gn,milliseconds:Vn};function qr(t){return Or[t]}function Ur(t){return Rr[t]}function Lr(t,e,n){return t?t.offset(e,n):void 0}function $r(t,e,n){return Lr(qr(t),e,n)}function Pr(t,e,n){return Lr(Ur(t),e,n)}function jr(t,e,n,r){return t?t.range(e,n,r):void 0}function Ir(t,e,n,r){return jr(qr(t),e,n,r)}function Wr(t,e,n,r){return jr(Ur(t),e,n,r)}const Hr=[Sn,Tn,Nn,Rn,qn,Un,"milliseconds"],Yr=Hr.slice(0,-1),Vr=Yr.slice(0,-1),Gr=Vr.slice(0,-1),Xr=Gr.slice(0,-1),Jr=[Sn,Tn],Zr=[Sn],Qr=[[Yr,1,1e3],[Yr,5,5e3],[Yr,15,15e3],[Yr,30,3e4],[Vr,1,6e4],[Vr,5,3e5],[Vr,15,9e5],[Vr,30,18e5],[Gr,1,36e5],[Gr,3,108e5],[Gr,6,216e5],[Gr,12,432e5],[Xr,1,864e5],[[Sn,zn],1,6048e5],[Jr,1,2592e6],[Jr,3,7776e6],[Zr,1,31536e6]];function Kr(t){const e=t.extent,n=t.maxbins||40,r=Math.abs(bt(e))/n;let i,a,o=je(t=>t[2]).right(Qr,r);return o===Qr.length?(i=Zr,a=Qe(e[0]/31536e6,e[1]/31536e6,n)):o?(o=Qr[r/Qr[o-1][2]<Qr[o][2]/r?o-1:o],i=o[0],a=o[1]):(i=Hr,a=Math.max(Qe(e[0],e[1],n),1)),{units:i,step:a}}function ti(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function ei(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function ni(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function ri(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,a=t.days,o=t.shortDays,u=t.months,s=t.shortMonths,l=gi(i),c=mi(i),f=gi(a),h=mi(a),d=gi(o),p=mi(o),g=gi(u),m=mi(u),v=gi(s),y=mi(s),_={a:function(t){return o[t.getDay()]},A:function(t){return a[t.getDay()]},b:function(t){return s[t.getMonth()]},B:function(t){return u[t.getMonth()]},c:null,d:qi,e:qi,f:ji,H:Ui,I:Li,j:$i,L:Pi,m:Ii,M:Wi,p:function(t){return i[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:ya,s:_a,S:Hi,u:Yi,U:Vi,V:Gi,w:Xi,W:Ji,x:null,X:null,y:Zi,Y:Qi,Z:Ki,"%":va},x={a:function(t){return o[t.getUTCDay()]},A:function(t){return a[t.getUTCDay()]},b:function(t){return s[t.getUTCMonth()]},B:function(t){return u[t.getUTCMonth()]},c:null,d:ta,e:ta,f:aa,H:ea,I:na,j:ra,L:ia,m:oa,M:ua,p:function(t){return i[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:ya,s:_a,S:sa,u:la,U:ca,V:fa,w:ha,W:da,x:null,X:null,y:pa,Y:ga,Z:ma,"%":va},b={a:function(t,e,n){var r=d.exec(e.slice(n));return r?(t.w=p[r[0].toLowerCase()],n+r[0].length):-1},A:function(t,e,n){var r=f.exec(e.slice(n));return r?(t.w=h[r[0].toLowerCase()],n+r[0].length):-1},b:function(t,e,n){var r=v.exec(e.slice(n));return r?(t.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(t,e,n){var r=g.exec(e.slice(n));return r?(t.m=m[r[0].toLowerCase()],n+r[0].length):-1},c:function(t,n,r){return A(t,e,n,r)},d:Di,e:Di,f:zi,H:Fi,I:Fi,j:Ci,L:Ti,m:Ei,M:Si,p:function(t,e,n){var r=l.exec(e.slice(n));return r?(t.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:Mi,Q:Oi,s:Ri,S:Bi,u:yi,U:_i,V:xi,w:vi,W:bi,x:function(t,e,r){return A(t,n,e,r)},X:function(t,e,n){return A(t,r,e,n)},y:ki,Y:wi,Z:Ai,"%":Ni};function w(t,e){return function(n){var r,i,a,o=[],u=-1,s=0,l=t.length;for(n instanceof Date||(n=new Date(+n));++u<l;)37===t.charCodeAt(u)&&(o.push(t.slice(s,u)),null!=(i=li[r=t.charAt(++u)])?r=t.charAt(++u):i="e"===r?" ":"0",(a=e[r])&&(r=a(n,i)),o.push(r),s=u+1);return o.push(t.slice(s,u)),o.join("")}}function k(t,e){return function(n){var r,i,a=ni(1900,void 0,1);if(A(a,t,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(e&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=ei(ni(a.y,0,1))).getUTCDay(),r=i>4||0===i?lr.ceil(r):lr(r),r=or.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=ti(ni(a.y,0,1))).getDay(),r=i>4||0===i?tr.ceil(r):tr(r),r=Zn.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?ei(ni(a.y,0,1)).getUTCDay():ti(ni(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,ei(a)):ti(a)}}function A(t,e,n,r){for(var i,a,o=0,u=e.length,s=n.length;o<u;){if(r>=s)return-1;if(37===(i=e.charCodeAt(o++))){if(i=e.charAt(o++),!(a=b[i in li?e.charAt(o++):i])||(r=a(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=w(n,_),_.X=w(r,_),_.c=w(e,_),x.x=w(n,x),x.X=w(r,x),x.c=w(e,x),{format:function(t){var e=w(t+="",_);return e.toString=function(){return t},e},parse:function(t){var e=k(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=w(t+="",x);return e.toString=function(){return t},e},utcParse:function(t){var e=k(t+="",!0);return e.toString=function(){return t},e}}}var ii,ai,oi,ui,si,li={"-":"",_:" ",0:"0"},ci=/^\s*\d+/,fi=/^%/,hi=/[\\^$*+?|[\]().{}]/g;function di(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(e)+i:i)}function pi(t){return t.replace(hi,"\\$&")}function gi(t){return new RegExp("^(?:"+t.map(pi).join("|")+")","i")}function mi(t){for(var e={},n=-1,r=t.length;++n<r;)e[t[n].toLowerCase()]=n;return e}function vi(t,e,n){var r=ci.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function yi(t,e,n){var r=ci.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function _i(t,e,n){var r=ci.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function xi(t,e,n){var r=ci.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function bi(t,e,n){var r=ci.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function wi(t,e,n){var r=ci.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function ki(t,e,n){var r=ci.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Ai(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Mi(t,e,n){var r=ci.exec(e.slice(n,n+1));return r?(t.q=3*r[0]-3,n+r[0].length):-1}function Ei(t,e,n){var r=ci.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function Di(t,e,n){var r=ci.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function Ci(t,e,n){var r=ci.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function Fi(t,e,n){var r=ci.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function Si(t,e,n){var r=ci.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function Bi(t,e,n){var r=ci.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function Ti(t,e,n){var r=ci.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function zi(t,e,n){var r=ci.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Ni(t,e,n){var r=fi.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function Oi(t,e,n){var r=ci.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function Ri(t,e,n){var r=ci.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function qi(t,e){return di(t.getDate(),e,2)}function Ui(t,e){return di(t.getHours(),e,2)}function Li(t,e){return di(t.getHours()%12||12,e,2)}function $i(t,e){return di(1+Zn.count(rr(t),t),e,3)}function Pi(t,e){return di(t.getMilliseconds(),e,3)}function ji(t,e){return Pi(t,e)+"000"}function Ii(t,e){return di(t.getMonth()+1,e,2)}function Wi(t,e){return di(t.getMinutes(),e,2)}function Hi(t,e){return di(t.getSeconds(),e,2)}function Yi(t){var e=t.getDay();return 0===e?7:e}function Vi(t,e){return di(Kn.count(rr(t)-1,t),e,2)}function Gi(t,e){var n=t.getDay();return t=n>=4||0===n?er(t):er.ceil(t),di(er.count(rr(t),t)+(4===rr(t).getDay()),e,2)}function Xi(t){return t.getDay()}function Ji(t,e){return di(tr.count(rr(t)-1,t),e,2)}function Zi(t,e){return di(t.getFullYear()%100,e,2)}function Qi(t,e){return di(t.getFullYear()%1e4,e,4)}function Ki(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+di(e/60|0,"0",2)+di(e%60,"0",2)}function ta(t,e){return di(t.getUTCDate(),e,2)}function ea(t,e){return di(t.getUTCHours(),e,2)}function na(t,e){return di(t.getUTCHours()%12||12,e,2)}function ra(t,e){return di(1+or.count(hr(t),t),e,3)}function ia(t,e){return di(t.getUTCMilliseconds(),e,3)}function aa(t,e){return ia(t,e)+"000"}function oa(t,e){return di(t.getUTCMonth()+1,e,2)}function ua(t,e){return di(t.getUTCMinutes(),e,2)}function sa(t,e){return di(t.getUTCSeconds(),e,2)}function la(t){var e=t.getUTCDay();return 0===e?7:e}function ca(t,e){return di(sr.count(hr(t)-1,t),e,2)}function fa(t,e){var n=t.getUTCDay();return t=n>=4||0===n?cr(t):cr.ceil(t),di(cr.count(hr(t),t)+(4===hr(t).getUTCDay()),e,2)}function ha(t){return t.getUTCDay()}function da(t,e){return di(lr.count(hr(t)-1,t),e,2)}function pa(t,e){return di(t.getUTCFullYear()%100,e,2)}function ga(t,e){return di(t.getUTCFullYear()%1e4,e,4)}function ma(){return"+0000"}function va(){return"%"}function ya(t){return+t}function _a(t){return Math.floor(+t/1e3)}function xa(t,e,n){x(n=n||{})||u("Invalid time multi-format specifier: "+n);const r=e(Un),i=e(qn),a=e(Rn),o=e(Nn),s=e(zn),l=e(Tn),c=e(Bn),f=e(Sn),h=t(n.milliseconds||".%L"),d=t(n[Un]||":%S"),p=t(n[qn]||"%I:%M"),g=t(n[Rn]||"%I %p"),m=t(n[Nn]||n.day||"%a %d"),v=t(n[zn]||"%b %d"),y=t(n[Tn]||"%B"),_=t(n[Bn]||"%B"),b=t(n[Sn]||"%Y");return t=>(r(t)<t?h:i(t)<t?d:a(t)<t?p:o(t)<t?g:l(t)<t?s(t)<t?m:v:f(t)<t?c(t)<t?y:_:b)(t)}function ba(t){const e=$e(t.format),n=$e(t.utcFormat);return{timeFormat:t=>pt(t)?e(t):xa(e,qr,t),utcFormat:t=>pt(t)?n(t):xa(n,Ur,t),timeParse:$e(t.parse),utcParse:$e(t.utcParse)}}let wa;function ka(){return wa=ba({format:ai,parse:oi,utcFormat:ui,utcParse:si})}function Aa(t){return ba(ri(t))}function Ma(t){return arguments.length?wa=Aa(t):wa}!function(t){ii=ri(t),ai=ii.format,oi=ii.parse,ui=ii.utcFormat,si=ii.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),ka();const Ea=(t,e)=>tt({},t,e);function Da(t,e){const n=t?Cn(t):Fn(),r=e?Aa(e):Ma();return Ea(n,r)}function Ca(t,e){const n=arguments.length;return n&&2!==n&&u("defaultLocale expects either zero or two arguments."),n?Ea(Fn(t),Ma(e)):Ea(Fn(),Ma())}function Fa(t,e,n,r){const i=Ue((e=e||{}).type||"json");return i||u("Unknown data format type: "+e.type),t=i(t,e),e.parse&&function(t,e,n,r){if(!t.length)return;const i=Ma();n=n||i.timeParse,r=r||i.utcParse;var a,o,u,s,l,c,f,h=t.columns||Object.keys(t[0]);"auto"===e&&(e=ge(t,h));for(h=Object.keys(e),a=h.map((function(t){var i,a,o=e[t];if(o&&(o.startsWith("date:")||o.startsWith("utc:"))){("'"===(a=(i=o.split(/:(.+)?/,2))[1])[0]&&"'"===a[a.length-1]||'"'===a[0]&&'"'===a[a.length-1])&&(a=a.slice(1,-1));return("utc"===i[0]?r:n)(a)}if(!fe[o])throw Error("Illegal format pattern: "+t+":"+o);return fe[o]})),s=0,c=t.length,f=h.length;s<c;++s)for(o=t[s],l=0;l<f;++l)u=h[l],o[u]=a[l](o[u])}(t,e.parse,n,r),it(t,"columns")&&delete t.columns,t}var Sa=function(t,e){return function(n){return{options:n||{},sanitize:oe,load:ae,fileAccess:!!e,file:ue(e),http:le(t)}}}("undefined"!=typeof fetch&&fetch,null);var Ba={skip:!0};function Ta(t,e,n,r,i,a){var o,u,s=tt({},a,Ba);Y(n)||(n=Q(n)),void 0===r?o=e=>t.touch(n(e)):Y(r)?(u=new Xt(null,r,i,!1),o=e=>{u.evaluate(e);const r=n(e),i=u.value;jt(i)?t.pulse(r,i,a):t.update(r,i,s)}):o=e=>t.update(n(e),r,s),e.apply(o)}function za(t,e,n,r,i,a){if(void 0===r)e.targets().add(n);else{const o=a||{},u=new Xt(null,function(t,e){return e=Y(e)?e:Q(e),t?function(n,r){const i=e(n,r);return t.skip()||(t.skip(i!==this.value).value=i),i}:e}(n,r),i,!1);u.modified(o.force),u.rank=e.rank,e.targets().add(u),n&&(u.skip(!0),u.value=n.value,u.targets().add(n),t.connect(n,[u]))}}const Na={};function Oa(t,e,n){this.dataflow=t,this.stamp=null==e?-1:e,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}const Ra=Oa.prototype;function qa(t,e){return t?(n,r)=>t(n,r)&&e(n,r):e}function Ua(t,e){var n=[];return Ft(t,e,t=>n.push(t)),n}function La(t,e){var n={};return t.visit(e,(function(t){n[Ot(t)]=1})),t=>n[Ot(t)]?null:t}function $a(t,e,n,r){var i,a,o,u,s,l=this,c=0;for(this.dataflow=t,this.stamp=e,this.fields=null,this.encode=r||null,this.pulses=n,o=0,u=n.length;o<u;++o)if((i=n[o]).stamp===e){if(i.fields)for(s in a=l.fields||(l.fields={}),i.fields)a[s]=1;i.changed(l.ADD)&&(c|=l.ADD),i.changed(l.REM)&&(c|=l.REM),i.changed(l.MOD)&&(c|=l.MOD)}this.changes=c}Ra.StopPropagation=Na,Ra.ADD=1,Ra.REM=2,Ra.MOD=4,Ra.ADD_REM=3,Ra.ADD_MOD=5,Ra.ALL=7,Ra.REFLOW=8,Ra.SOURCE=16,Ra.NO_SOURCE=32,Ra.NO_FIELDS=64,Ra.fork=function(t){return new Oa(this.dataflow).init(this,t)},Ra.clone=function(){const t=this.fork(7);return t.add=t.add.slice(),t.rem=t.rem.slice(),t.mod=t.mod.slice(),t.source&&(t.source=t.source.slice()),t.materialize(23)},Ra.addAll=function(){let t=this;return t.source&&t.source.length!==t.add.length?(t=new Oa(this.dataflow).init(this),t.add=t.source,t):t},Ra.init=function(t,e){const n=this;return n.stamp=t.stamp,n.encode=t.encode,!t.fields||64&e||(n.fields=t.fields),1&e?(n.addF=t.addF,n.add=t.add):(n.addF=null,n.add=[]),2&e?(n.remF=t.remF,n.rem=t.rem):(n.remF=null,n.rem=[]),4&e?(n.modF=t.modF,n.mod=t.mod):(n.modF=null,n.mod=[]),32&e?(n.srcF=null,n.source=null):(n.srcF=t.srcF,n.source=t.source,t.cleans&&(n.cleans=t.cleans)),n},Ra.runAfter=function(t){this.dataflow.runAfter(t)},Ra.changed=function(t){var e=t||7;return 1&e&&this.add.length||2&e&&this.rem.length||4&e&&this.mod.length},Ra.reflow=function(t){if(t)return this.fork(7).reflow();var e=this.add.length,n=this.source&&this.source.length;return n&&n!==e&&(this.mod=this.source,e&&this.filter(4,La(this,1))),this},Ra.clean=function(t){return arguments.length?(this.cleans=!!t,this):this.cleans},Ra.modifies=function(t){var e=this.fields||(this.fields={});return _(t)?t.forEach(t=>e[t]=!0):e[t]=!0,this},Ra.modified=function(t,e){var n=this.fields;return!(!e&&!this.mod.length||!n)&&(arguments.length?_(t)?t.some(t=>n[t]):n[t]:!!n)},Ra.filter=function(t,e){var n=this;return 1&t&&(n.addF=qa(n.addF,e)),2&t&&(n.remF=qa(n.remF,e)),4&t&&(n.modF=qa(n.modF,e)),16&t&&(n.srcF=qa(n.srcF,e)),n},Ra.materialize=function(t){var e=this;return 1&(t=t||7)&&e.addF&&(e.add=Ua(e.add,e.addF),e.addF=null),2&t&&e.remF&&(e.rem=Ua(e.rem,e.remF),e.remF=null),4&t&&e.modF&&(e.mod=Ua(e.mod,e.modF),e.modF=null),16&t&&e.srcF&&(e.source=e.source.filter(e.srcF),e.srcF=null),e},Ra.visit=function(t,e){var n,r,i=this,a=e;return 16&t?(Ft(i.source,i.srcF,a),i):(1&t&&Ft(i.add,i.addF,a),2&t&&Ft(i.rem,i.remF,a),4&t&&Ft(i.mod,i.modF,a),8&t&&(n=i.source)&&((r=i.add.length+i.mod.length)===n.length||Ft(n,r?La(i,5):i.srcF,a)),i)};var Pa=st($a,Oa);function ja(t){return t.error("Dataflow already running. Use runAsync() to chain invocations."),t}Pa.fork=function(t){var e=new Oa(this.dataflow).init(this,t&this.NO_FIELDS);return void 0!==t&&(t&e.ADD&&this.visit(e.ADD,(function(t){return e.add.push(t)})),t&e.REM&&this.visit(e.REM,(function(t){return e.rem.push(t)})),t&e.MOD&&this.visit(e.MOD,(function(t){return e.mod.push(t)}))),e},Pa.changed=function(t){return this.changes&t},Pa.modified=function(t){var e=this,n=e.fields;return n&&e.changes&e.MOD?_(t)?t.some((function(t){return n[t]})):n[t]:0},Pa.filter=function(){u("MultiPulse does not support filtering.")},Pa.materialize=function(){u("MultiPulse does not support materialization.")},Pa.visit=function(t,e){var n=this,r=n.pulses,i=r.length,a=0;if(t&n.SOURCE)for(;a<i;++a)r[a].visit(t,e);else for(;a<i;++a)r[a].stamp===n.stamp&&r[a].visit(t,e);return n};var Ia={skip:!1,force:!1};function Wa(t){var e=[];return{clear:()=>e=[],size:()=>e.length,peek:()=>e[0],push:n=>(e.push(n),Ha(e,0,e.length-1,t)),pop:()=>{var n,r=e.pop();return e.length?(n=e[0],e[0]=r,function(t,e,n){var r,i=e,a=t.length,o=t[e],u=1+(e<<1);for(;u<a;)(r=u+1)<a&&n(t[u],t[r])>=0&&(u=r),t[e]=t[u],u=1+((e=u)<<1);t[e]=o,Ha(t,i,e,n)}(e,0,t)):n=r,n}}}function Ha(t,e,n,r){var i,a,o;for(i=t[n];n>e&&r(i,a=t[o=n-1>>1])<0;)t[n]=a,n=o;return t[n]=i}function Ya(){this.logger(y()),this.logLevel(1),this._clock=0,this._rank=0,this._locale=Ca();try{this._loader=Sa()}catch(t){}this._touched=St(f),this._input={},this._pulse=null,this._heap=Wa((t,e)=>t.qrank-e.qrank),this._postrun=[]}var Va=Ya.prototype;function Ga(t){return function(){return this._log[t].apply(this,arguments)}}function Xa(t,e){Xt.call(this,t,null,e)}Va.stamp=function(){return this._clock},Va.loader=function(t){return arguments.length?(this._loader=t,this):this._loader},Va.locale=function(t){return arguments.length?(this._locale=t,this):this._locale},Va.cleanThreshold=1e4,Va.add=function(t,e,n,r){var i,a=1;return t instanceof Xt?i=t:t&&t.prototype instanceof Xt?i=new t:Y(t)?i=new Xt(null,t):(a=0,i=new Xt(t,e)),this.rank(i),a&&(r=n,n=e),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},Va.connect=function(t,e){var n,r,i=t.rank;for(n=0,r=e.length;n<r;++n)if(i<e[n].rank)return void this.rerank(t)},Va.rank=function(t){t.rank=++this._rank},Va.rerank=function(t){for(var e,n,r,i=[t];i.length;)if(this.rank(e=i.pop()),n=e._targets)for(r=n.length;--r>=0;)i.push(e=n[r]),e===t&&u("Cycle detected in dataflow graph.")},Va.pulse=function(t,e,n){this.touch(t,n||Ia);var r=new Oa(this,this._clock+(this._pulse?0:1)),i=t.pulse&&t.pulse.source||[];return r.target=t,this._input[t.id]=e.pulse(r,i),this},Va.touch=function(t,e){var n=e||Ia;return this._pulse?this._enqueue(t):this._touched.add(t),n.skip&&t.skip(!0),this},Va.update=function(t,e,n){var r=n||Ia;return(t.set(e)||r.force)&&this.touch(t,r),this},Va.changeset=It,Va.ingest=function(t,e,n){return e=this.parse(e,n),this.pulse(t,this.changeset().insert(e))},Va.parse=function(t,e){const n=this.locale();return Fa(t,e,n.timeParse,n.utcParse)},Va.preload=async function(t,e,n){const r=this,i=r._pending||function(t){var e,n=new Promise((function(t){e=t}));return n.requests=0,n.done=function(){0==--n.requests&&(t._pending=null,e(t))},t._pending=n}(r);i.requests+=1;const a=await r.request(e,n);return r.pulse(t,r.changeset().remove(g).insert(a.data||[])),i.done(),a},Va.request=async function(t,e){const n=this;let r,i=0;try{r=await n.loader().load(t,{context:"dataflow",response:Le(e&&e.type)});try{r=n.parse(r,e)}catch(e){i=-2,n.warn("Data ingestion failed",t,e)}}catch(e){i=-1,n.warn("Loading failed",t,e)}return{data:r,status:i}},Va.events=function(t,e,n,r){for(var i,a=this,o=te(n,r),u=function(t){t.dataflow=a;try{o.receive(t)}catch(t){a.error(t)}finally{a.run()}},s=0,l=(i="string"==typeof t&&"undefined"!=typeof document?document.querySelectorAll(t):W(t)).length;s<l;++s)i[s].addEventListener(e,u);return o},Va.on=function(t,e,n,r,i){return(t instanceof Xt?za:Ta)(this,t,e,n,r,i),this},Va.evaluate=async function(t,e,n){const r=this,i=[];if(r._pulse)return ja(r);if(r._pending&&await r._pending,e&&await Bt(r,e),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const a=++r._clock;r._pulse=new Oa(r,a,t),r._touched.forEach(t=>r._enqueue(t,!0)),r._touched=St(f);let o,u,s,l=0;try{for(;r._heap.size()>0;)o=r._heap.pop(),o.rank===o.qrank?(u=o.run(r._getPulse(o,t)),u.then?u=await u:u.async&&(i.push(u.async),u=Na),u!==Na&&o._targets&&o._targets.forEach(t=>r._enqueue(t)),++l):r._enqueue(o,!0)}catch(t){r._heap.clear(),s=t}if(r._input={},r._pulse=null,r.debug(`Pulse ${a}: ${l} operators`),s&&(r._postrun=[],r.error(s)),r._postrun.length){const t=r._postrun.sort((t,e)=>e.priority-t.priority);r._postrun=[];for(let e=0;e<t.length;++e)await Bt(r,t[e].callback)}return n&&await Bt(r,n),i.length&&Promise.all(i).then(t=>r.runAsync(null,()=>{t.forEach(t=>{try{t(r)}catch(t){r.error(t)}})})),r},Va.run=function(t,e,n){return this._pulse?ja(this):(this.evaluate(t,e,n),this)},Va.runAsync=async function(t,e,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(t,e,n)).then(r,r),this._running},Va.runAfter=function(t,e,n){if(this._pulse||e)this._postrun.push({priority:n||0,callback:t});else try{t(this)}catch(t){this.error(t)}},Va._enqueue=function(t,e){var n=t.stamp<this._clock;n&&(t.stamp=this._clock),(n||e)&&(t.qrank=t.rank,this._heap.push(t))},Va._getPulse=function(t,e){var n=t.source,r=this._clock;return n&&_(n)?new $a(this,r,n.map(t=>t.pulse),e):this._input[t.id]||function(t,e){if(e&&e.stamp===t.stamp)return e;t=t.fork(),e&&e!==Na&&(t.source=e.source);return t}(this._pulse,n&&n.pulse)},Va.logger=function(t){return arguments.length?(this._log=t,this):this._log},Va.error=Ga("error"),Va.warn=Ga("warn"),Va.info=Ga("info"),Va.debug=Ga("debug"),Va.logLevel=Ga("level");var Ja=st(Xa,Xt);Ja.run=function(t){return t.stamp<this.stamp?t.StopPropagation:(this.skip()?this.skip(!1):e=this.evaluate(t),(e=e||t).then?e=e.then(t=>this.pulse=t):e!==t.StopPropagation&&(this.pulse=e),e);var e},Ja.evaluate=function(t){var e=this.marshall(t.stamp),n=this.transform(e,t);return e.clear(),n},Ja.transform=function(){};var Za={};function Qa(t){var e=Ka(t);return e&&e.Definition||null}function Ka(t){return t=t&&t.toLowerCase(),it(Za,t)?Za[t]:null}function to(t){return t&&t.length?1===t.length?t[0]:(e=t,function(t){for(var n=e.length,r=1,i=String(e[0](t));r<n;++r)i+="|"+e[r](t);return i}):function(){return""};var e}function eo(t,e,n){return n||t+(e?"_"+e:"")}const no=()=>{},ro={init:no,add:no,rem:no,idx:0},io={values:{init:t=>t.cell.store=!0,value:t=>t.cell.data.values(),idx:-1},count:{value:t=>t.cell.num},__count__:{value:t=>t.missing+t.valid},missing:{value:t=>t.missing},valid:{value:t=>t.valid},sum:{init:t=>t.sum=0,value:t=>t.sum,add:(t,e)=>t.sum+=+e,rem:(t,e)=>t.sum-=e},product:{init:t=>t.product=1,value:t=>t.valid?t.product:void 0,add:(t,e)=>t.product*=e,rem:(t,e)=>t.product/=e},mean:{init:t=>t.mean=0,value:t=>t.valid?t.mean:void 0,add:(t,e)=>(t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid),rem:(t,e)=>(t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean)},average:{value:t=>t.valid?t.mean:void 0,req:["mean"],idx:1},variance:{init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):void 0,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean),req:["mean"],idx:1},variancep:{value:t=>t.valid>1?t.dev/t.valid:void 0,req:["variance"],idx:2},stdev:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):void 0,req:["variance"],idx:2},stderr:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid*(t.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:t=>t.cell.data.distinct(t.get),req:["values"],idx:3},ci0:{value:t=>t.cell.data.ci0(t.get),req:["values"],idx:3},ci1:{value:t=>t.cell.data.ci1(t.get),req:["values"],idx:3},median:{value:t=>t.cell.data.q2(t.get),req:["values"],idx:3},q1:{value:t=>t.cell.data.q1(t.get),req:["values"],idx:3},q3:{value:t=>t.cell.data.q3(t.get),req:["values"],idx:3},min:{init:t=>t.min=void 0,value:t=>t.min=Number.isNaN(t.min)?t.cell.data.min(t.get):t.min,add:(t,e)=>{(e<t.min||void 0===t.min)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)},req:["values"],idx:4},max:{init:t=>t.max=void 0,value:t=>t.max=Number.isNaN(t.max)?t.cell.data.max(t.get):t.max,add:(t,e)=>{(e>t.max||void 0===t.max)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)},req:["values"],idx:4},argmin:{init:t=>t.argmin=void 0,value:t=>t.argmin||t.cell.data.argmin(t.get),add:(t,e,n)=>{e<t.min&&(t.argmin=n)},rem:(t,e)=>{e<=t.min&&(t.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:t=>t.argmax=void 0,value:t=>t.argmax||t.cell.data.argmax(t.get),add:(t,e,n)=>{e>t.max&&(t.argmax=n)},rem:(t,e)=>{e>=t.max&&(t.argmax=void 0)},req:["max","values"],idx:3}},ao=Object.keys(io);function oo(t,e){return io[t](e)}function uo(t,e){return t.idx-e.idx}function so(){this.valid=0,this.missing=0,this._ops.forEach(t=>t.init(this))}function lo(t,e){null!=t&&""!==t?t==t&&(++this.valid,this._ops.forEach(n=>n.add(this,t,e))):++this.missing}function co(t,e){null!=t&&""!==t?t==t&&(--this.valid,this._ops.forEach(n=>n.rem(this,t,e))):--this.missing}function fo(t){return this._out.forEach(e=>t[e.out]=e.value(this)),t}function ho(t,e){var n=e||h,r=function(t){const e={};t.forEach(t=>e[t.name]=t);const n=t=>{t.req&&t.req.forEach(t=>{e[t]||n(e[t]=io[t]())})};return t.forEach(n),Object.values(e).sort(uo)}(t),i=t.slice().sort(uo);function a(t){this._ops=r,this._out=i,this.cell=t,this.init()}return a.prototype.init=so,a.prototype.add=lo,a.prototype.rem=co,a.prototype.set=fo,a.prototype.get=n,a.fields=t.map(t=>t.out),a}function*po(t,e){if(null==e)for(let e of t)null!=e&&""!==e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let r of t)r=e(r,++n,t),null!=r&&""!==r&&(r=+r)>=r&&(yield r)}}function go(t,e,n){var r=Float64Array.from(po(t,n));return r.sort(Pe),e.map(t=>function(t,e,n=nn){if(r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,a=Math.floor(i),o=+n(t[a],a,t);return o+(+n(t[a+1],a+1,t)-o)*(i-a)}}(r,t))}function mo(t,e){return go(t,[.25,.5,.75],e)}function vo(t,e){var n=t.length,r=function(t,e){const n=function(t,e){let n,r=0,i=0,a=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(n=e-i,i+=n/++r,a+=n*(e-i));else{let o=-1;for(let u of t)null!=(u=e(u,++o,t))&&(u=+u)>=u&&(n=u-i,i+=n/++r,a+=n*(u-i))}if(r>1)return a/(r-1)}(t,e);return n?Math.sqrt(n):n}(t,e),i=mo(t,e),a=(i[2]-i[0])/1.34;return 1.06*(r=Math.min(r,a)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function yo(t){var e,n,r,i,a,o,u,s,l=t.maxbins||20,c=t.base||10,f=Math.log(c),h=t.divide||[5,2],d=t.extent[0],p=t.extent[1],g=t.span||p-d||Math.abs(d)||1;if(t.step)e=t.step;else if(t.steps){for(a=g/l,o=0,u=t.steps.length;o<u&&t.steps[o]<a;++o);e=t.steps[Math.max(0,o-1)]}else{for(n=Math.ceil(Math.log(l)/f),r=t.minstep||0,e=Math.max(r,Math.pow(c,Math.round(Math.log(g)/f)-n));Math.ceil(g/e)>l;)e*=c;for(o=0,u=h.length;o<u;++o)(a=e/h[o])>=r&&g/a<=l&&(e=a)}return i=(a=Math.log(e))>=0?0:1+~~(-a/f),s=Math.pow(c,-i-1),(t.nice||void 0===t.nice)&&(d=d<(a=Math.floor(d/e+s)*e)?a-e:a,p=Math.ceil(p/e)*e),{start:d,stop:p===d?d+e:p,step:e}}function _o(e,n,r,i){if(!e.length)return[void 0,void 0];var a,o,u,s,l=Float64Array.from(po(e,i)),c=l.length,f=n;for(u=0,s=Array(f);u<f;++u){for(a=0,o=0;o<c;++o)a+=l[~~(t.random()*c)];s[u]=a/c}return s.sort(Pe),[rn(s,r/2),rn(s,1-r/2)]}function xo(t,e,n,r){r=r||(t=>t);let i,a=0,o=1,u=t.length,s=new Float64Array(u),l=r(t[0]),c=l,f=l+e;for(;o<u;++o){if(i=r(t[o]),i>=f){for(c=(l+c)/2;a<o;++a)s[a]=c;f=i+e,l=i}c=i}for(c=(l+c)/2;a<o;++a)s[a]=c;return n?function(t,e){let n,r,i=t.length,a=0,o=1;for(;t[a]===t[o];)++o;for(;o<i;){for(n=o+1;t[o]===t[n];)++n;if(t[o]-t[o-1]<e){for(r=o+(a+n-o-o>>1);r<o;)t[r++]=t[o];for(;r>o;)t[r--]=t[a]}a=o,o=n}return t}(s,e+e/4):s}ao.forEach(t=>{io[t]=function(t,e){return n=>tt({name:t,out:n||t},ro,e)}(t,io[t])}),t.random=Math.random;const bo=Math.sqrt(2*Math.PI),wo=Math.SQRT2;let ko=NaN;function Ao(e,n){e=e||0,n=null==n?1:n;let r,i,a=0,o=0;if(ko==ko)a=ko,ko=NaN;else{do{a=2*t.random()-1,o=2*t.random()-1,r=a*a+o*o}while(0===r||r>1);i=Math.sqrt(-2*Math.log(r)/r),a*=i,ko=o*i}return e+a*n}function Mo(t,e,n){const r=(t-(e||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*bo)}function Eo(t,e,n){let r,i=(t-(e=e||0))/(n=null==n?1:n),a=Math.abs(i);if(a>37)r=0;else{let t,e=Math.exp(-a*a/2);a<7.07106781186547?(t=.0352624965998911*a+.700383064443688,t=t*a+6.37396220353165,t=t*a+33.912866078383,t=t*a+112.079291497871,t=t*a+221.213596169931,t=t*a+220.206867912376,r=e*t,t=.0883883476483184*a+1.75566716318264,t=t*a+16.064177579207,t=t*a+86.7807322029461,t=t*a+296.564248779674,t=t*a+637.333633378831,t=t*a+793.826512519948,t=t*a+440.413735824752,r/=t):(t=a+.65,t=a+4/t,t=a+3/t,t=a+2/t,t=a+1/t,r=e/t/2.506628274631)}return i>0?1-r:r}function Do(t,e,n){return t<0||t>1?NaN:(e||0)+(null==n?1:n)*wo*function(t){let e,n=-Math.log((1-t)*(1+t));n<6.25?(n-=3.125,e=-364441206401782e-35,e=e*n-16850591381820166e-35,e=128584807152564e-32+e*n,e=11157877678025181e-33+e*n,e=e*n-1333171662854621e-31,e=20972767875968562e-33+e*n,e=6637638134358324e-30+e*n,e=e*n-4054566272975207e-29,e=e*n-8151934197605472e-29,e=26335093153082323e-28+e*n,e=e*n-12975133253453532e-27,e=e*n-5415412054294628e-26,e=1.0512122733215323e-9+e*n,e=e*n-4.112633980346984e-9,e=e*n-2.9070369957882005e-8,e=4.2347877827932404e-7+e*n,e=e*n-13654692000834679e-22,e=e*n-13882523362786469e-21,e=.00018673420803405714+e*n,e=e*n-.000740702534166267,e=e*n-.006033670871430149,e=.24015818242558962+e*n,e=1.6536545626831027+e*n):n<16?(n=Math.sqrt(n)-3.25,e=2.2137376921775787e-9,e=9.075656193888539e-8+e*n,e=e*n-2.7517406297064545e-7,e=1.8239629214389228e-8+e*n,e=15027403968909828e-22+e*n,e=e*n-4013867526981546e-21,e=29234449089955446e-22+e*n,e=12475304481671779e-21+e*n,e=e*n-47318229009055734e-21,e=6828485145957318e-20+e*n,e=24031110387097894e-21+e*n,e=e*n-.0003550375203628475,e=.0009532893797373805+e*n,e=e*n-.0016882755560235047,e=.002491442096107851+e*n,e=e*n-.003751208507569241,e=.005370914553590064+e*n,e=1.0052589676941592+e*n,e=3.0838856104922208+e*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,e=-27109920616438573e-27,e=e*n-2.555641816996525e-10,e=1.5076572693500548e-9+e*n,e=e*n-3.789465440126737e-9,e=7.61570120807834e-9+e*n,e=e*n-1.496002662714924e-8,e=2.914795345090108e-8+e*n,e=e*n-6.771199775845234e-8,e=2.2900482228026655e-7+e*n,e=e*n-9.9298272942317e-7,e=4526062597223154e-21+e*n,e=e*n-1968177810553167e-20,e=7599527703001776e-20+e*n,e=e*n-.00021503011930044477,e=e*n-.00013871931833623122,e=1.0103004648645344+e*n,e=4.849906401408584+e*n):e=1/0;return e*t}(2*t-1)}function Co(t,e){var n,r,i={mean:function(t){return arguments.length?(n=t||0,i):n},stdev:function(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>Ao(n,r),pdf:t=>Mo(t,n,r),cdf:t=>Eo(t,n,r),icdf:t=>Do(t,n,r)};return i.mean(t).stdev(e)}function Fo(e,n){var r=Co(),i={},a=0;return i.data=function(t){return arguments.length?(e=t,a=t?t.length:0,i.bandwidth(n)):e},i.bandwidth=function(t){return arguments.length?(!(n=t)&&e&&(n=vo(e)),i):n},i.sample=function(){return e[~~(t.random()*a)]+n*r.sample()},i.pdf=function(t){for(var i=0,o=0;o<a;++o)i+=r.pdf((t-e[o])/n);return i/n/a},i.cdf=function(t){for(var i=0,o=0;o<a;++o)i+=r.cdf((t-e[o])/n);return i/a},i.icdf=function(){throw Error("KDE icdf not supported.")},i.data(e)}function So(t,e){return t=t||0,e=null==e?1:e,Math.exp(t+Ao()*e)}function Bo(t,e,n){if(t<=0)return 0;e=e||0,n=null==n?1:n;const r=(Math.log(t)-e)/n;return Math.exp(-.5*r*r)/(n*bo*t)}function To(t,e,n){return Eo(Math.log(t),e,n)}function zo(t,e,n){return Math.exp(Do(t,e,n))}function No(t,e){var n,r,i={mean:function(t){return arguments.length?(n=t||0,i):n},stdev:function(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>So(n,r),pdf:t=>Bo(t,n,r),cdf:t=>To(t,n,r),icdf:t=>zo(t,n,r)};return i.mean(t).stdev(e)}function Oo(e,n){var r,i={},a=0;function o(t){var e,n=[],r=0;for(e=0;e<a;++e)r+=n[e]=null==t[e]?1:+t[e];for(e=0;e<a;++e)n[e]/=r;return n}return i.weights=function(t){return arguments.length?(r=o(n=t||[]),i):n},i.distributions=function(t){return arguments.length?(t?(a=t.length,e=t):(a=0,e=[]),i.weights(n)):e},i.sample=function(){for(var n=t.random(),i=e[a-1],o=r[0],u=0;u<a-1;o+=r[++u])if(n<o){i=e[u];break}return i.sample()},i.pdf=function(t){for(var n=0,i=0;i<a;++i)n+=r[i]*e[i].pdf(t);return n},i.cdf=function(t){for(var n=0,i=0;i<a;++i)n+=r[i]*e[i].cdf(t);return n},i.icdf=function(){throw Error("Mixture icdf not supported.")},i.distributions(e).weights(n)}function Ro(e,n){return null==n&&(n=null==e?1:e,e=0),e+(n-e)*t.random()}function qo(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=e&&t<=n?1/(n-e):0}function Uo(t,e,n){return null==n&&(n=null==e?1:e,e=0),t<e?0:t>n?1:(t-e)/(n-e)}function Lo(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=0&&t<=1?e+t*(n-e):NaN}function $o(t,e){var n,r,i={min:function(t){return arguments.length?(n=t||0,i):n},max:function(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>Ro(n,r),pdf:t=>qo(t,n,r),cdf:t=>Uo(t,n,r),icdf:t=>Lo(t,n,r)};return null==e&&(e=null==t?1:t,t=0),i.min(t).max(e)}function Po(t,e,n,r){const i=r-t*t,a=Math.abs(i)<1e-24?0:(n-t*e)/i;return[e-a*t,a]}function jo(t,e,n,r){t=t.filter(t=>{let r=e(t),i=n(t);return null!=r&&(r=+r)>=r&&null!=i&&(i=+i)>=i}),r&&t.sort((t,n)=>e(t)-e(n));const i=t.length,a=new Float64Array(i),o=new Float64Array(i);let u,s,l,c=0,f=0,h=0;for(l of t)a[c]=u=+e(l),o[c]=s=+n(l),++c,f+=(u-f)/c,h+=(s-h)/c;for(c=0;c<i;++c)a[c]-=f,o[c]-=h;return[a,o,f,h]}function Io(t,e,n,r){let i,a,o=-1;for(let u of t)i=e(u),a=n(u),null!=i&&(i=+i)>=i&&null!=a&&(a=+a)>=a&&r(i,a,++o)}function Wo(t,e,n,r,i){let a=0,o=0;return Io(t,e,n,(t,e)=>{const n=e-i(t),u=e-r;a+=n*n,o+=u*u}),1-a/o}function Ho(t,e,n){let r=0,i=0,a=0,o=0,u=0;Io(t,e,n,(t,e)=>{++u,r+=(t-r)/u,i+=(e-i)/u,a+=(t*e-a)/u,o+=(t*t-o)/u});const s=Po(r,i,a,o),l=t=>s[0]+s[1]*t;return{coef:s,predict:l,rSquared:Wo(t,e,n,i,l)}}function Yo(t,e,n){let r=0,i=0,a=0,o=0,u=0;Io(t,e,n,(t,e)=>{++u,t=Math.log(t),r+=(t-r)/u,i+=(e-i)/u,a+=(t*e-a)/u,o+=(t*t-o)/u});const s=Po(r,i,a,o),l=t=>s[0]+s[1]*Math.log(t);return{coef:s,predict:l,rSquared:Wo(t,e,n,i,l)}}function Vo(t,e,n){const[r,i,a,o]=jo(t,e,n);let u,s,l,c=0,f=0,h=0,d=0,p=0;Io(t,e,n,(t,e)=>{u=r[p++],s=Math.log(e),l=u*e,c+=(e*s-c)/p,f+=(l-f)/p,h+=(l*s-h)/p,d+=(u*l-d)/p});const[g,m]=Po(f/o,c/o,h/o,d/o),v=t=>Math.exp(g+m*(t-a));return{coef:[Math.exp(g-m*a),m],predict:v,rSquared:Wo(t,e,n,o,v)}}function Go(t,e,n){let r=0,i=0,a=0,o=0,u=0,s=0;Io(t,e,n,(t,e)=>{const n=Math.log(t),l=Math.log(e);++s,r+=(n-r)/s,i+=(l-i)/s,a+=(n*l-a)/s,o+=(n*n-o)/s,u+=(e-u)/s});const l=Po(r,i,a,o),c=t=>l[0]*Math.pow(t,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:Wo(t,e,n,u,c)}}function Xo(t,e,n){const[r,i,a,o]=jo(t,e,n),u=r.length;let s,l,c,f,h=0,d=0,p=0,g=0,m=0;for(s=0;s<u;)l=r[s],c=i[s++],f=l*l,h+=(f-h)/s,d+=(f*l-d)/s,p+=(f*f-p)/s,g+=(l*c-g)/s,m+=(f*c-m)/s;const v=p-h*h,y=h*v-d*d,_=(m*h-g*d)/y,x=(g*v-m*d)/y,b=-_*h,w=t=>_*(t-=a)*t+x*t+b+o;return{coef:[b-x*a+_*a*a+o,x-2*_*a,_],predict:w,rSquared:Wo(t,e,n,o,w)}}function Jo(t,e,n,r){if(1===r)return Ho(t,e,n);if(2===r)return Xo(t,e,n);const[i,a,o,u]=jo(t,e,n),s=i.length,l=[],c=[],f=r+1;let h,d,p,g,m;for(h=0;h<f;++h){for(p=0,g=0;p<s;++p)g+=Math.pow(i[p],h)*a[p];for(l.push(g),m=new Float64Array(f),d=0;d<f;++d){for(p=0,g=0;p<s;++p)g+=Math.pow(i[p],h+d);m[d]=g}c.push(m)}c.push(l);const v=function(t){const e=t.length-1,n=[];let r,i,a,o,u;for(r=0;r<e;++r){for(o=r,i=r+1;i<e;++i)Math.abs(t[r][i])>Math.abs(t[r][o])&&(o=i);for(a=r;a<e+1;++a)u=t[a][r],t[a][r]=t[a][o],t[a][o]=u;for(i=r+1;i<e;++i)for(a=e;a>=r;a--)t[a][i]-=t[a][r]*t[r][i]/t[r][r]}for(i=e-1;i>=0;--i){for(u=0,a=i+1;a<e;++a)u+=t[a][i]*n[a];n[i]=(t[e][i]-u)/t[i][i]}return n}(c),y=t=>{t-=o;let e=u+v[0]+v[1]*t+v[2]*t*t;for(h=3;h<f;++h)e+=v[h]*Math.pow(t,h);return e};return{coef:Zo(f,v,-o,u),predict:y,rSquared:Wo(t,e,n,u,y)}}function Zo(t,e,n,r){const i=Array(t);let a,o,u,s;for(a=0;a<t;++a)i[a]=0;for(a=t-1;a>=0;--a)for(u=e[a],s=1,i[a]+=u,o=1;o<=a;++o)s*=(a+1-o)/o,i[a-o]+=u*Math.pow(n,o)*s;return i[0]+=r,i}function Qo(t,e,n,r){const[i,a,o,u]=jo(t,e,n,!0),s=i.length,l=Math.max(2,~~(r*s)),c=new Float64Array(s),f=new Float64Array(s),h=new Float64Array(s).fill(1);for(let t=-1;++t<=2;){const e=[0,l-1];for(let t=0;t<s;++t){const n=i[t],r=e[0],o=e[1],u=n-i[r]>i[o]-n?r:o;let s=0,l=0,d=0,p=0,g=0,m=1/Math.abs(i[u]-n||1);for(let t=r;t<=o;++t){const e=i[t],r=a[t],o=Ko(Math.abs(n-e)*m)*h[t],u=e*o;s+=o,l+=u,d+=r*o,p+=r*u,g+=e*u}const[v,y]=Po(l/s,d/s,p/s,g/s);c[t]=v+y*n,f[t]=Math.abs(a[t]-c[t]),tu(i,t+1,e)}if(2===t)break;const n=an(f);if(Math.abs(n)<1e-12)break;for(let t,e,r=0;r<s;++r)t=f[r]/(6*n),h[r]=t>=1?1e-12:(e=1-t*t)*e}return function(t,e,n,r){const i=t.length,a=[];let o,u=0,s=0,l=[];for(;u<i;++u)o=t[u]+n,l[0]===o?l[1]+=(e[u]-l[1])/++s:(s=0,l[1]+=r,l=[o,e[u]],a.push(l));return l[1]+=r,a}(i,c,o,u)}function Ko(t){return(t=1-t*t*t)*t*t}function tu(t,e,n){let r=t[e],i=n[0],a=n[1]+1;if(!(a>=t.length))for(;e>i&&t[a]-r<=r-t[i];)n[0]=++i,n[1]=a,++a}const eu=.1*Math.PI/180;function nu(t,e,n,r){n=n||25,r=Math.max(n,r||200);const i=e=>[e,t(e)],a=e[0],o=e[1],u=o-a,s=u/r,l=[i(a)],c=[];if(n===r){for(let t=1;t<r;++t)l.push(i(a+t/n*u));return l.push(i(o)),l}c.push(i(o));for(let t=n;--t>0;)c.push(i(a+t/n*u));let f=l[0],h=c[c.length-1];for(;h;){const t=i((f[0]+h[0])/2);t[0]-f[0]>=s&&ru(f,t,h)>eu?c.push(t):(f=h,l.push(h),c.pop()),h=c[c.length-1]}return l}function ru(t,e,n){const r=Math.atan2(n[1]-t[1],n[0]-t[0]),i=Math.atan2(e[1]-t[1],e[0]-t[0]);return Math.abs(r-i)}function iu(t){this._key=t?l(t):Ot,this.reset()}var au=iu.prototype;function ou(t){Xa.call(this,null,t),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}au.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},au.add=function(t){this._add.push(t)},au.rem=function(t){this._rem.push(t)},au.values=function(){if(this._get=null,0===this._rem.length)return this._add;var t,e,n,r=this._add,i=this._rem,a=this._key,o=r.length,u=i.length,s=Array(o-u),l={};for(t=0;t<u;++t)l[a(i[t])]=1;for(t=0,e=0;t<o;++t)l[a(n=r[t])]?l[a(n)]=0:s[e++]=n;return this._rem=[],this._add=s},au.distinct=function(t){for(var e,n=this.values(),r=n.length,i={},a=0;--r>=0;)it(i,e=t(n[r])+"")||(i[e]=1,++a);return a},au.extent=function(t){if(this._get!==t||!this._ext){var e=this.values(),n=nt(e,t);this._ext=[e[n[0]],e[n[1]]],this._get=t}return this._ext},au.argmin=function(t){return this.extent(t)[0]||{}},au.argmax=function(t){return this.extent(t)[1]||{}},au.min=function(t){var e=this.extent(t)[0];return null!=e?t(e):void 0},au.max=function(t){var e=this.extent(t)[1];return null!=e?t(e):void 0},au.quartile=function(t){return this._get===t&&this._q||(this._q=mo(this.values(),t),this._get=t),this._q},au.q1=function(t){return this.quartile(t)[0]},au.q2=function(t){return this.quartile(t)[1]},au.q3=function(t){return this.quartile(t)[2]},au.ci=function(t){return this._get===t&&this._ci||(this._ci=_o(this.values(),1e3,.05,t),this._get=t),this._ci},au.ci0=function(t){return this.ci(t)[0]},au.ci1=function(t){return this.ci(t)[1]},ou.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:ao},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};var uu=st(ou,Xa);uu.transform=function(t,e){var n=this,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.modified();return n.stamp=r.stamp,n.value&&(i||e.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(t):{},e.visit(e.SOURCE,t=>n.add(t))):(n.value=n.value||n.init(t),e.visit(e.REM,t=>n.rem(t)),e.visit(e.ADD,t=>n.add(t))),r.modifies(n._outputs),n._drop=!1!==t.drop,t.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),e.clean()&&n._drop&&r.clean(!0).runAfter(()=>this.clean()),n.changes(r)},uu.cross=function(){var t=this,e=t.value,n=t._dnames,r=n.map((function(){return{}})),i=n.length;function a(t){var e,a,o,u;for(e in t)for(o=t[e].tuple,a=0;a<i;++a)r[a][u=o[n[a]]]=u}a(t._prev),a(e),function a(o,u,s){var l,c,f=n[s],h=r[s++];for(l in h)u[f]=h[l],c=o?o+"|"+l:l,s<i?a(c,u,s):e[c]||t.cell(c,u)}("",{},0)},uu.init=function(t){var e=this._inputs=[],i=this._outputs=[],a={};function o(t){for(var n,i=W(r(t)),o=0,u=i.length;o<u;++o)a[n=i[o]]||(a[n]=1,e.push(n))}this._dims=W(t.groupby),this._dnames=this._dims.map((function(t){var e=n(t);return o(t),i.push(e),e})),this.cellkey=t.key?t.key:to(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];var s,l,c,f,h,d,p=t.fields||[null],g=t.ops||["count"],m=t.as||[],v=p.length,y={};for(v!==g.length&&u("Unmatched number of fields and aggregate ops."),d=0;d<v;++d)s=p[d],l=g[d],null==s&&"count"!==l&&u("Null aggregate field specified."),h=eo(l,f=n(s),m[d]),i.push(h),"count"!==l?((c=y[f])||(o(s),(c=y[f]=[]).field=s,this._measures.push(c)),"count"!==l&&(this._countOnly=!1),c.push(oo(l,h))):this._counts.push(h);return this._measures=this._measures.map((function(t){return ho(t,t.field)})),{}},uu.cellkey=to(),uu.cell=function(t,e){var n=this.value[t];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[t]=this.newcell(t,e),this._adds[this._alen++]=n),n},uu.newcell=function(t,e){var n={key:t,num:0,agg:null,tuple:this.newtuple(e,this._prev&&this._prev[t]),stamp:this.stamp,store:!1};if(!this._countOnly){var r,i=this._measures,a=i.length;for(n.agg=Array(a),r=0;r<a;++r)n.agg[r]=new i[r](n)}return n.store&&(n.data=new iu),n},uu.newtuple=function(t,e){var n,r,i=this._dnames,a=this._dims,o={};for(n=0,r=a.length;n<r;++n)o[i[n]]=a[n](t);return e?$t(e.tuple,o):qt(o)},uu.clean=function(){const t=this.value;for(const e in t)0===t[e].num&&delete t[e]},uu.add=function(t){var e,n,r,i=this.cellkey(t),a=this.cell(i,t);if(a.num+=1,!this._countOnly)for(a.store&&a.data.add(t),n=0,r=(e=a.agg).length;n<r;++n)e[n].add(e[n].get(t),t)},uu.rem=function(t){var e,n,r,i=this.cellkey(t),a=this.cell(i,t);if(a.num-=1,!this._countOnly)for(a.store&&a.data.rem(t),n=0,r=(e=a.agg).length;n<r;++n)e[n].rem(e[n].get(t),t)},uu.celltuple=function(t){var e,n,r,i=t.tuple,a=this._counts;for(t.store&&t.data.values(),n=0,r=a.length;n<r;++n)i[a[n]]=t.num;if(!this._countOnly)for(n=0,r=(e=t.agg).length;n<r;++n)e[n].set(i);return i},uu.changes=function(t){var e,n,r,i,a=this._adds,o=this._mods,u=this._prev,s=this._drop,l=t.add,c=t.rem,f=t.mod;if(u)for(n in u)e=u[n],s&&!e.num||c.push(e.tuple);for(r=0,i=this._alen;r<i;++r)l.push(this.celltuple(a[r])),a[r]=null;for(r=0,i=this._mlen;r<i;++r)(0===(e=o[r]).num&&s?c:f).push(this.celltuple(e)),o[r]=null;return this._alen=this._mlen=0,this._prev=null,t};function su(t){Xa.call(this,null,t)}su.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};var lu=st(su,Xa);function cu(t,e,n){var r=t,i=e||[],a=n||[],o={},u=0;return{add:function(t){a.push(t)},remove:function(t){o[r(t)]=++u},size:function(){return i.length},data:function(t,e){return u&&(i=i.filter((function(t){return!o[r(t)]})),o={},u=0),e&&t&&i.sort(t),a.length&&(i=t?yt(t,i,a.sort(t)):i.concat(a),a=[]),i}}}function fu(t){Xa.call(this,[],t)}function hu(t){Xt.call(this,null,du,t)}function du(t){return this.value&&!t.modified()?this.value:V(t.fields,t.orders)}function pu(t){Xa.call(this,null,t)}lu.transform=function(t,e){var n,i=!1!==t.interval,a=this._bins(t),o=a.start,u=a.step,s=t.as||["bin0","bin1"],l=s[0],c=s[1];return n=t.modified()?(e=e.reflow(!0)).SOURCE:e.modified(r(t.field))?e.ADD_MOD:e.ADD,e.visit(n,i?function(t){var e=a(t);t[l]=e,t[c]=null==e?null:o+u*(1+(e-o)/u)}:function(t){t[l]=a(t)}),e.modifies(i?s:l)},lu._bins=function(t){if(this.value&&!t.modified())return this.value;var i,a,o=t.field,u=yo(t),s=u.step,l=u.start,c=l+Math.ceil((u.stop-l)/s)*s;null!=(i=t.anchor)&&(a=i-(l+s*Math.floor((i-l)/s)),l+=a,c+=a);var f=function(t){var e=E(o(t));return null==e?null:e<l?-1/0:e>c?1/0:(e=Math.max(l,Math.min(e,c-s)),l+s*Math.floor(1e-14+(e-l)/s))};return f.start=l,f.stop=u.stop,f.step=s,this.value=e(f,r(o),t.name||"bin_"+n(o))},fu.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},st(fu,Xa).transform=function(t,e){var n=e.fork(e.ALL),r=cu(Ot,this.value,n.materialize(n.ADD).add),i=t.sort,a=e.changed()||i&&(t.modified("sort")||e.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(a),this.value=n.source=r.data(Pt(i),a),e.source&&e.source.root&&(this.value.root=e.source.root),n},st(hu,Xt),pu.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};var gu=st(pu,Xa);function mu(t){Xa.call(this,null,t)}gu.transform=function(t,e){function n(e){return function(n){for(var r,i=function(t,e,n){switch(e){case"upper":t=t.toUpperCase();break;case"lower":t=t.toLowerCase()}return t.match(n)}(u(n),t.case,a)||[],s=0,l=i.length;s<l;++s)o.test(r=i[s])||e(r)}}var r=this._parameterCheck(t,e),i=this._counts,a=this._match,o=this._stop,u=t.field,s=t.as||["text","count"],l=n((function(t){i[t]=1+(i[t]||0)})),c=n((function(t){i[t]-=1}));return r?e.visit(e.SOURCE,l):(e.visit(e.ADD,l),e.visit(e.REM,c)),this._finish(e,s)},gu._parameterCheck=function(t,e){var n=!1;return!t.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(t.stopwords||"")+"$","i"),n=!0),!t.modified("pattern")&&this._match||(this._match=new RegExp(t.pattern||"[\\w']+","g"),n=!0),(t.modified("field")||e.modified(t.field.fields))&&(n=!0),n&&(this._counts={}),n},gu._finish=function(t,e){var n,r,i,a=this._counts,o=this._tuples||(this._tuples={}),u=e[0],s=e[1],l=t.fork(t.NO_SOURCE|t.NO_FIELDS);for(n in a)r=o[n],i=a[n]||0,!r&&i?(o[n]=r=qt({}),r[u]=n,r[s]=i,l.add.push(r)):0===i?(r&&l.rem.push(r),a[n]=null,o[n]=null):r[s]!==i&&(r[s]=i,l.mod.push(r));return l.modifies(e)},mu.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},st(mu,Xa).transform=function(t,e){var n=e.fork(e.NO_SOURCE),r=this.value,i=t.as||["a","b"],a=i[0],o=i[1];return!r||e.changed(e.ADD_REM)||t.modified("as")||t.modified("filter")?(r&&(n.rem=r),r=e.materialize(e.SOURCE).source,n.add=this.value=function(t,e,n,r){for(var i,a,o=[],u={},s=t.length,l=0;l<s;++l)for(u[e]=a=t[l],i=0;i<s;++i)u[n]=t[i],r(u)&&(o.push(qt(u)),(u={})[e]=a);return o}(r,a,o,t.filter||g)):n.mod=r,n.source=this.value,n.modifies(i)};var vu={kde:Fo,mixture:Oo,normal:Co,lognormal:No,uniform:$o};function yu(t){Xa.call(this,null,t)}var _u=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],xu={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:_u},{name:"weights",type:"number",array:!0}]};function bu(t,e){return t?t.map((function(t,r){return e[r]||n(t)})):null}function wu(t,e,n){var r,i,a,o,u,s,l=[],c=function(t){return t(o)};if(null==e)l.push(t.map(n));else for(r={},i=0,a=t.length;i<a;++i)o=t[i],(s=r[u=e.map(c)])||(r[u]=s=[],s.dims=u,l.push(s)),s.push(n(o));return l}yu.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:_u.concat(xu)},{name:"as",type:"string",array:!0,default:["value","density"]}]},st(yu,Xa).transform=function(t,e){var n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){var r=function t(e,n){var r=e.function;it(vu,r)||u("Unknown distribution function: "+r);var i=vu[r]();for(var a in e)"field"===a?i.data((e.from||n()).map(e[a])):"distributions"===a?i[a](e[a].map((function(e){return t(e,n)}))):"function"==typeof i[a]&&i[a](e[a]);return i}(t.distribution,function(t){return function(){return t.materialize(t.SOURCE).source}}(e)),i=t.steps||t.minsteps||25,a=t.steps||t.maxsteps||200,o=t.method||"pdf";"pdf"!==o&&"cdf"!==o&&u("Invalid density method: "+o),t.extent||r.data||u("Missing density extent parameter."),o=r[o];var s=t.as||["value","density"],l=nu(o,t.extent||et(r.data()),i,a).map(t=>{var e={};return e[s[0]]=t[0],e[s[1]]=t[1],qt(e)});this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n};function ku(t){Xa.call(this,null,t)}ku.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]};function Au(t){Xt.call(this,null,Mu,t),this.modified(!0)}function Mu(t){var i=t.expr;return this.value&&!t.modified("expr")?this.value:e(e=>i(e,t),r(i),n(i))}function Eu(t){Xa.call(this,[void 0,void 0],t)}function Du(t,e){Xt.call(this,t),this.parent=e,this.count=0}st(ku,Xa).transform=function(t,e){if(this.value&&!t.modified()&&!e.changed())return e;const n=e.materialize(e.SOURCE).source,r=wu(e.source,t.groupby,h),i=t.smooth||!1,a=t.field,o=t.step||function(t,e){return bt(et(t,e))/30}(n,a),u=Pt((t,e)=>a(t)-a(e)),s=t.as||"bin",l=r.length;let c,f=1/0,d=-1/0,p=0;for(;p<l;++p){const t=r[p].sort(u);c=-1;for(const e of xo(t,o,i,a))e<f&&(f=e),e>d&&(d=e),t[++c][s]=e}return this.value={start:f,stop:d,step:o},e.reflow(!0).modifies(s)},st(Au,Xt),Eu.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},st(Eu,Xa).transform=function(t,e){var r,i=this.value,a=t.field,o=i[0],u=i[1];if(((r=e.changed()||e.modified(a.fields)||t.modified("field"))||null==o)&&(o=1/0,u=-1/0),e.visit(r?e.SOURCE:e.ADD,(function(t){var e=E(a(t));null!=e&&(e<o&&(o=e),e>u&&(u=e))})),!Number.isFinite(o)||!Number.isFinite(u)){let t=n(a);t&&(t=` for field "${t}"`),e.dataflow.warn(`Infinite extent${t}: [${o}, ${u}]`),o=u=void 0}this.value=[o,u]};var Cu=st(Du,Xt);function Fu(t){Xa.call(this,{},t),this._keys=ot();const e=this._targets=[];e.active=0,e.forEach=t=>{for(let n=0,r=e.active;n<r;++n)t(e[n],n,e)}}Cu.connect=function(t){return this.detachSubflow=t.detachSubflow,this.targets().add(t),t.source=this},Cu.add=function(t){this.count+=1,this.value.add.push(t)},Cu.rem=function(t){this.count-=1,this.value.rem.push(t)},Cu.mod=function(t){this.value.mod.push(t)},Cu.init=function(t){this.value.init(t,t.NO_SOURCE)},Cu.evaluate=function(){return this.value};const Su=st(Fu,Xa);function Bu(t){Xt.call(this,null,Tu,t)}function Tu(t){return this.value&&!t.modified()?this.value:_(t.name)?W(t.name).map((function(t){return l(t)})):l(t.name,t.as)}function zu(t){Xa.call(this,ot(),t)}function Nu(t){Xa.call(this,[],t)}function Ou(t){Xa.call(this,[],t)}function Ru(t){Xa.call(this,null,t)}function qu(t){Xa.call(this,[],t)}Su.activate=function(t){this._targets[this._targets.active++]=t},Su.subflow=function(t,e,n,r){let i,a,o=this.value,u=it(o,t)&&o[t];return u?u.value.stamp<n.stamp&&(u.init(n),this.activate(u)):(a=r||(a=this._group[t])&&a.tuple,i=n.dataflow,u=new Du(n.fork(n.NO_SOURCE),this),i.add(u).connect(e(i,t,a)),o[t]=u,this.activate(u)),u},Su.clean=function(){const t=this.value;for(const e in t)if(0===t[e].count){const n=t[e].detachSubflow;n&&n(),delete t[e]}},Su.initTargets=function(){const t=this._targets,e=t.length;for(let n=0;n<e&&null!=t[n];++n)t[n]=null;t.active=0},Su.transform=function(t,e){const n=e.dataflow,r=t.key,i=t.subflow,a=this._keys,o=t.modified("key"),u=t=>this.subflow(t,i,e);return this._group=t.group||{},this.initTargets(),e.visit(e.REM,t=>{const e=Ot(t),n=a.get(e);void 0!==n&&(a.delete(e),u(n).rem(t))}),e.visit(e.ADD,t=>{const e=r(t);a.set(Ot(t),e),u(e).add(t)}),o||e.modified(r.fields)?e.visit(e.MOD,t=>{const e=Ot(t),n=a.get(e),i=r(t);n===i?u(i).mod(t):(a.set(e,i),u(n).rem(t),u(i).add(t))}):e.changed(e.MOD)&&e.visit(e.MOD,t=>{u(a.get(Ot(t))).mod(t)}),o&&e.visit(e.REFLOW,t=>{const e=Ot(t),n=a.get(e),i=r(t);n!==i&&(a.set(e,i),u(n).rem(t),u(i).add(t))}),e.clean()?n.runAfter(()=>{this.clean(),a.clean()}):a.empty>n.cleanThreshold&&n.runAfter(a.clean),e},st(Bu,Xt),zu.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},st(zu,Xa).transform=function(t,e){var n=e.dataflow,r=this.value,i=e.fork(),a=i.add,o=i.rem,u=i.mod,s=t.expr,l=!0;function c(e){var n=Ot(e),i=s(e,t),c=r.get(n);i&&c?(r.delete(n),a.push(e)):i||c?l&&i&&!c&&u.push(e):(r.set(n,1),o.push(e))}return e.visit(e.REM,(function(t){var e=Ot(t);r.has(e)?r.delete(e):o.push(t)})),e.visit(e.ADD,(function(e){s(e,t)?a.push(e):r.set(Ot(e),1)})),e.visit(e.MOD,c),t.modified()&&(l=!1,e.visit(e.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i},Nu.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},st(Nu,Xa).transform=function(t,e){var n=e.fork(e.NO_SOURCE),r=t.fields,i=bu(r,t.as||[]),a=t.index||null,o=i.length;return n.rem=this.value,e.visit(e.SOURCE,(function(t){for(var e,u,s,l=r.map(e=>e(t)),c=l.reduce((t,e)=>Math.max(t,e.length),0),f=0;f<c;++f){for(u=Ut(t),e=0;e<o;++e)u[i[e]]=null==(s=l[e][f])?null:s;a&&(u[a]=f),n.add.push(u)}})),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(i)},Ou.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},st(Ou,Xa).transform=function(t,e){var r=e.fork(e.NO_SOURCE),i=t.fields,a=i.map(n),o=t.as||["key","value"],u=o[0],s=o[1],l=i.length;return r.rem=this.value,e.visit(e.SOURCE,(function(t){for(var e,n=0;n<l;++n)(e=Ut(t))[u]=a[n],e[s]=i[n](t),r.add.push(e)})),this.value=r.source=r.add,r.modifies(o)},Ru.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},st(Ru,Xa).transform=function(t,e){var n=t.expr,r=t.as,i=t.modified(),a=t.initonly?e.ADD:i?e.SOURCE:e.modified(n.fields)||e.modified(r)?e.ADD_MOD:e.ADD;return i&&(e=e.materialize().reflow(!0)),t.initonly||e.modifies(r),e.visit(a,e=>e[r]=n(e,t))},st(qu,Xa).transform=function(t,e){var n,r,i,a=this.value,o=e.fork(e.ALL),u=t.size-a.length,s=t.generator;if(u>0){for(n=[];--u>=0;)n.push(i=qt(s(t))),a.push(i);o.add=o.add.length?o.materialize(o.ADD).add.concat(n):n}else r=a.slice(0,-u),o.rem=o.rem.length?o.materialize(o.REM).rem.concat(r):r,a=a.slice(-u);return o.source=this.value=a,o};var Uu={value:"value",median:an,mean:function(t,e){let n=0,r=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(++n,r+=e);else{let i=-1;for(let a of t)null!=(a=e(a,++i,t))&&(a=+a)>=a&&(++n,r+=a)}if(n)return r/n},min:tn,max:Ke},Lu=[];function $u(t){Xa.call(this,[],t)}function Pu(t){ou.call(this,t)}$u.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},st($u,Xa).transform=function(t,e){var r,i,a,o,s,l,c,f,h,d,p=e.fork(e.ALL),g=function(t){var e,n=t.method||Uu.value;if(null!=Uu[n])return n===Uu.value?(e=void 0!==t.value?t.value:0,function(){return e}):Uu[n];u("Unrecognized imputation method: "+n)}(t),m=function(t){var e=t.field;return function(t){return t?e(t):NaN}}(t),v=n(t.field),y=n(t.key),_=(t.groupby||[]).map(n),x=function(t,e,n,r){var i,a,o,u,s,l,c,f,h=function(t){return t(f)},d=[],p=r?r.slice():[],g={},m={};for(p.forEach((function(t,e){g[t]=e+1})),u=0,c=t.length;u<c;++u)f=t[u],l=n(f),s=g[l]||(g[l]=p.push(l)),a=(i=e?e.map(h):Lu)+"",(o=m[a])||(o=m[a]=[],d.push(o),o.values=i),o[s-1]=f;return d.domain=p,d}(e.source,t.groupby,t.key,t.keyvals),b=[],w=this.value,k=x.domain.length;for(s=0,f=x.length;s<f;++s)for(a=(r=x[s]).values,i=NaN,c=0;c<k;++c)if(null==r[c]){for(o=x.domain[c],d={_impute:!0},l=0,h=a.length;l<h;++l)d[_[l]]=a[l];d[y]=o,d[v]=Number.isNaN(i)?i=g(r,m):i,b.push(qt(d))}return b.length&&(p.add=p.materialize(p.ADD).add.concat(b)),w.length&&(p.rem=p.materialize(p.REM).rem.concat(w)),this.value=b,p},Pu.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:ao},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};var ju=st(Pu,ou);function Iu(t){Xa.call(this,null,t)}function Wu(t){Xt.call(this,null,Hu,t)}function Hu(t){return this.value&&!t.modified()?this.value:gt(t.fields,t.flat)}function Yu(t){Xa.call(this,[],t),this._pending=null}function Vu(t,e,n){n.forEach(qt);const r=e.fork(e.NO_FIELDS&e.NO_SOURCE);return r.rem=t.value,t.value=r.source=r.add=n,t._pending=null,r.rem.length&&r.clean(!0),r}function Gu(t){Xa.call(this,{},t)}function Xu(t){Xt.call(this,null,Ju,t)}function Ju(t){if(this.value&&!t.modified())return this.value;var e,n,r,i=1/0,a=-1/0,o=t.extents;for(e=0,n=o.length;e<n;++e)(r=o[e])[0]<i&&(i=r[0]),r[1]>a&&(a=r[1]);return[i,a]}function Zu(t){Xt.call(this,null,Qu,t)}function Qu(t){return this.value&&!t.modified()?this.value:t.values.reduce((function(t,e){return t.concat(e)}),[])}function Ku(t){Xa.call(this,null,t)}function ts(t){ou.call(this,t)}ju.transform=function(t,e){var n,r=this,i=t.modified();return r.value&&(i||e.modified(r._inputs,!0))?(n=r.value=i?r.init(t):{},e.visit(e.SOURCE,(function(t){r.add(t)}))):(n=r.value=r.value||this.init(t),e.visit(e.REM,(function(t){r.rem(t)})),e.visit(e.ADD,(function(t){r.add(t)}))),r.changes(),e.visit(e.SOURCE,(function(t){tt(t,n[r.cellkey(t)].tuple)})),e.reflow(i).modifies(this._outputs)},ju.changes=function(){var t,e,n=this._adds,r=this._mods;for(t=0,e=this._alen;t<e;++t)this.celltuple(n[t]),n[t]=null;for(t=0,e=this._mlen;t<e;++t)this.celltuple(r[t]),r[t]=null;this._alen=this._mlen=0},Iu.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},st(Iu,Xa).transform=function(t,e){var r=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=e.materialize(e.SOURCE).source,a=wu(i,t.groupby,t.field),o=(t.groupby||[]).map(n),s=t.bandwidth,l=t.cumulative?"cdf":"pdf",c=t.as||["value","density"],f=[];let h=t.extent,d=t.steps||t.minsteps||25,p=t.steps||t.maxsteps||200;"pdf"!==l&&"cdf"!==l&&u("Invalid density method: "+l),"shared"===t.resolve&&(h||(h=et(i,t.field)),d=p=t.steps||p),a.forEach(e=>{const n=Fo(e,s)[l],r=t.counts?e.length:1;nu(n,h||et(e),d,p).forEach(t=>{const n={};for(let t=0;t<o.length;++t)n[o[t]]=e.dims[t];n[c[0]]=t[0],n[c[1]]=t[1]*r,f.push(qt(n))})}),this.value&&(r.rem=this.value),this.value=r.add=r.source=f}return r},st(Wu,Xt),st(Yu,Xa).transform=function(t,e){const n=e.dataflow;if(this._pending)return Vu(this,e,this._pending);if(function(t){return t.modified("async")&&!(t.modified("values")||t.modified("url")||t.modified("format"))}(t))return e.StopPropagation;if(t.values)return Vu(this,e,n.parse(t.values,t.format));if(t.async){return{async:n.request(t.url,t.format).then(t=>(this._pending=W(t.data),t=>t.touch(this)))}}return n.request(t.url,t.format).then(t=>Vu(this,e,W(t.data)))},Gu.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},st(Gu,Xa).transform=function(t,e){var r,i,a=e,o=t.as,s=t.fields,l=t.index,c=t.values,f=null==t.default?null:t.default,h=t.modified(),d=h?e.SOURCE:e.ADD,p=s.length;return c?(i=c.length,p>1&&!o&&u('Multi-field lookup requires explicit "as" parameter.'),o&&o.length!==p*i&&u('The "as" parameter has too few output field names.'),o=o||c.map(n),r=function(t){for(var e,n,r=0,a=0;r<p;++r)if(null==(n=l.get(s[r](t))))for(e=0;e<i;++e,++a)t[o[a]]=f;else for(e=0;e<i;++e,++a)t[o[a]]=c[e](n)}):(o||u("Missing output field names."),r=function(t){for(var e,n=0;n<p;++n)e=l.get(s[n](t)),t[o[n]]=null==e?f:e}),h?a=e.reflow(!0):d|=s.some((function(t){return e.modified(t.fields)}))?e.MOD:0,e.visit(d,r),a.modifies(o)},st(Xu,Xt),st(Zu,Xt),st(Ku,Xa),Ku.prototype.transform=function(t,e){return this.modified(t.modified()),this.value=t,e.fork(e.NO_SOURCE|e.NO_FIELDS)},ts.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:ao,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};var es=st(ts,ou);function ns(t){Fu.call(this,t)}es._transform=es.transform,es.transform=function(t,n){return this._transform(function(t,n){var i=t.field,a=t.value,o=("count"===t.op?"__count__":t.op)||"sum",u=r(i).concat(r(a)),s=function(t,e,n){var r={},i=[];return n.visit(n.SOURCE,(function(e){var n=t(e);r[n]||(r[n]=1,i.push(n))})),i.sort((function(t,e){return(t<e||null==t)&&null!=e?-1:(t>e||null==e)&&null!=t?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e==e?-1:e!=e&&t==t?1:0)})),e?i.slice(0,e):i}(i,t.limit||0,n);n.changed()&&t.set("__pivot__",null,null,!0);return{key:t.key,groupby:t.groupby,ops:s.map((function(){return o})),fields:s.map((function(t){return function(t,n,r,i){return e((function(e){return n(e)===t?r(e):NaN}),i,t+"")}(t,i,a,u)})),as:s.map((function(t){return t+""})),modified:t.modified.bind(t)}}(t,n),n)};function rs(t){Xa.call(this,null,t)}function is(t){Xa.call(this,null,t)}function as(t){Xa.call(this,null,t)}st(ns,Fu).transform=function(t,e){const n=t.subflow,i=t.field,a=t=>this.subflow(Ot(t),n,e,t);return(t.modified("field")||i&&e.modified(r(i)))&&u("PreFacet does not support field modification."),this.initTargets(),i?(e.visit(e.MOD,t=>{const e=a(t);i(t).forEach(t=>e.mod(t))}),e.visit(e.ADD,t=>{const e=a(t);i(t).forEach(t=>e.add(qt(t)))}),e.visit(e.REM,t=>{const e=a(t);i(t).forEach(t=>e.rem(t))})):(e.visit(e.MOD,t=>a(t).mod(t)),e.visit(e.ADD,t=>a(t).add(t)),e.visit(e.REM,t=>a(t).rem(t))),e.clean()&&e.runAfter(()=>this.clean()),e},rs.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},st(rs,Xa).transform=function(t,e){var n,r,i=t.fields,a=bu(t.fields,t.as||[]),o=i?function(t,e){return function(t,e,n,r){for(var i=0,a=n.length;i<a;++i)e[r[i]]=n[i](t);return e}(t,e,i,a)}:Lt;return this.value?r=this.value:(e=e.addAll(),r=this.value={}),n=e.fork(e.NO_SOURCE),e.visit(e.REM,(function(t){var e=Ot(t);n.rem.push(r[e]),r[e]=null})),e.visit(e.ADD,(function(t){var e=o(t,qt({}));r[Ot(t)]=e,n.add.push(e)})),e.visit(e.MOD,(function(t){n.mod.push(o(t,r[Ot(t)]))})),n},st(is,Xa).transform=function(t,e){return this.value=t.value,t.modified("value")?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation},as.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};var os=st(as,Xa);function us(t){Xa.call(this,null,t)}function ss(t){Xa.call(this,[],t),this.count=0}function ls(t){Xa.call(this,null,t)}function cs(t){Xa.call(this,null,t),this.modified(!0)}function fs(t){Xa.call(this,null,t)}os.transform=function(t,e){var r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.as||["prob","value"];if(this.value&&!t.modified()&&!e.changed())return r.source=this.value,r;const a=wu(e.materialize(e.SOURCE).source,t.groupby,t.field),o=(t.groupby||[]).map(n),u=[],s=t.step||.01,l=t.probs||Ye(s/2,1-1e-14,s),c=l.length;return a.forEach(t=>{const e=go(t,l);for(let n=0;n<c;++n){const r={};for(let e=0;e<o.length;++e)r[o[e]]=t.dims[e];r[i[0]]=l[n],r[i[1]]=e[n],u.push(qt(r))}}),this.value&&(r.rem=this.value),this.value=r.add=r.source=u,r},st(us,Xa).transform=function(t,e){var n,r;return this.value?r=this.value:(n=e=e.addAll(),r=this.value={}),t.derive&&(n=e.fork(e.NO_SOURCE),e.visit(e.REM,t=>{var e=Ot(t);n.rem.push(r[e]),r[e]=null}),e.visit(e.ADD,t=>{var e=Ut(t);r[Ot(t)]=e,n.add.push(e)}),e.visit(e.MOD,t=>{var e,i=r[Ot(t)];for(e in t)i[e]=t[e],n.modifies(e);n.mod.push(i)})),n},ss.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},st(ss,Xa).transform=function(e,n){var r=n.fork(n.NO_SOURCE),i=e.modified("size"),a=e.size,o=this.value,u=this.count,s=0,l=o.reduce((function(t,e){return t[Ot(e)]=1,t}),{});function c(e){var n,i;o.length<a?o.push(e):(i=~~((u+1)*t.random()))<o.length&&i>=s&&(n=o[i],l[Ot(n)]&&r.rem.push(n),o[i]=e),++u}if(n.rem.length&&(n.visit(n.REM,(function(t){var e=Ot(t);l[e]&&(l[e]=-1,r.rem.push(t)),--u})),o=o.filter((function(t){return-1!==l[Ot(t)]}))),(n.rem.length||i)&&o.length<a&&n.source&&(s=u=o.length,n.visit(n.SOURCE,(function(t){l[Ot(t)]||c(t)})),s=-1),i&&o.length>a){for(var f=0,h=o.length-a;f<h;++f)l[Ot(o[f])]=-1,r.rem.push(o[f]);o=o.slice(h)}return n.mod.length&&n.visit(n.MOD,(function(t){l[Ot(t)]&&r.mod.push(t)})),n.add.length&&n.visit(n.ADD,c),(n.add.length||s<0)&&(r.add=o.filter((function(t){return!l[Ot(t)]}))),this.count=u,this.value=r.source=o,r},ls.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},st(ls,Xa).transform=function(t,e){if(!this.value||t.modified()){var n=e.materialize().fork(e.MOD),r=t.as||"data";return n.rem=this.value?e.rem.concat(this.value):e.rem,this.value=Ye(t.start,t.stop,t.step||1).map((function(t){var e={};return e[r]=t,qt(e)})),n.add=e.add.concat(this.value),n}},st(cs,Xa).transform=function(t,e){return this.value=e.source,e.changed()?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation};const hs=["unit0","unit1"];fs.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:Ln,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:hs}]};var ds=st(fs,Xa);function ps(t){Xa.call(this,ot(),t)}function gs(t){Xa.call(this,null,t)}ds.transform=function(t,e){var n=t.field,i=!1!==t.interval,a="utc"===t.timezone,o=this._floor(t,e),u=(a?Ur:qr)(o.unit).offset,s=t.as||hs,l=s[0],c=s[1],f=o.start||1/0,h=o.stop||-1/0,d=o.step,p=e.ADD;return(t.modified()||e.modified(r(n)))&&(p=(e=e.reflow(!0)).SOURCE,f=1/0,h=-1/0),e.visit(p,(function(t){var e,r,a=n(t);null==a?(t[l]=null,i&&(t[c]=null)):(t[l]=e=r=o(a),i&&(t[c]=r=u(e,d)),e<f&&(f=e),r>h&&(h=r))})),o.start=f,o.stop=h,e.modifies(i?s:l)},ds._floor=function(t,e){const n="utc"===t.timezone;let{units:r,step:i}=t.units?{units:t.units,step:t.step||1}:Kr({extent:t.extent||et(e.materialize(e.SOURCE).source,t.field),maxbins:t.maxbins});r=Pn(r);const a=this.value||{},o=(n?Nr:Br)(r,i);return o.unit=M(r),o.units=r,o.step=i,o.start=a.start,o.stop=a.stop,this.value=o},st(ps,Xa).transform=function(t,e){var n=e.dataflow,r=t.field,i=this.value,a=!0;function o(t){i.set(r(t),t)}return t.modified("field")||e.modified(r.fields)?(i.clear(),e.visit(e.SOURCE,o)):e.changed()?(e.visit(e.REM,(function(t){i.delete(r(t))})),e.visit(e.ADD,o)):a=!1,this.modified(a),i.empty>n.cleanThreshold&&n.runAfter(i.clean),e.fork()},st(gs,Xa).transform=function(t,e){(!this.value||t.modified("field")||t.modified("sort")||e.changed()||t.sort&&e.modified(t.sort.fields))&&(this.value=(t.sort?e.source.slice().sort(Pt(t.sort)):e.source).map(t.field))};const ms={row_number:function(){return{next:t=>t.index+1}},rank:function(){let t;return{init:()=>t=1,next:e=>{let n=e.index,r=e.data;return n&&e.compare(r[n-1],r[n])?t=n+1:t}}},dense_rank:function(){let t;return{init:()=>t=1,next:e=>{let n=e.index,r=e.data;return n&&e.compare(r[n-1],r[n])?++t:t}}},percent_rank:function(){let t=ms.rank(),e=t.next;return{init:t.init,next:t=>(e(t)-1)/(t.data.length-1)}},cume_dist:function(){let t;return{init:()=>t=0,next:e=>{let n=e.index,r=e.data,i=e.compare;if(t<n){for(;n+1<r.length&&!i(r[n],r[n+1]);)++n;t=n}return(1+t)/r.length}}},ntile:function(t,e){(e=+e)>0||u("ntile num must be greater than zero.");let n=ms.cume_dist(),r=n.next;return{init:n.init,next:t=>Math.ceil(e*r(t))}},lag:function(t,e){return e=+e||1,{next:n=>{let r=n.index-e;return r>=0?t(n.data[r]):null}}},lead:function(t,e){return e=+e||1,{next:n=>{let r=n.index+e,i=n.data;return r<i.length?t(i[r]):null}}},first_value:function(t){return{next:e=>t(e.data[e.i0])}},last_value:function(t){return{next:e=>t(e.data[e.i1-1])}},nth_value:function(t,e){return(e=+e)>0||u("nth_value nth must be greater than zero."),{next:n=>{let r=n.i0+(e-1);return r<n.i1?t(n.data[r]):null}}},prev_value:function(t){let e;return{init:()=>e=null,next:n=>{let r=t(n.data[n.index]);return null!=r?e=r:e}}},next_value:function(t){let e,n;return{init:()=>(e=null,n=-1),next:r=>{let i=r.data;return r.index<=n?e:(n=function(t,e,n){for(let r=e.length;n<r;++n){if(null!=t(e[n]))return n}return-1}(t,i,r.index))<0?(n=i.length,e=null):e=t(i[n])}}}};var vs=Object.keys(ms);function ys(t){let e=this,i=W(t.ops),a=W(t.fields),o=W(t.params),s=W(t.as),l=e.outputs=[],c=e.windows=[],f={},h={},p=!0,g=[],m=[];function v(t){W(r(t)).forEach(t=>f[t]=1)}v(t.sort),i.forEach((function(t,e){let r=a[e],i=n(r),f=eo(t,i,s[e]);if(v(r),l.push(f),it(ms,t))c.push(function(t,e,n,r){let i=ms[t](e,n);return{init:i.init||d,update:function(t,e){e[r]=i.next(t)}}}(t,a[e],o[e],f));else{if(null==r&&"count"!==t&&u("Null aggregate field specified."),"count"===t)return void g.push(f);p=!1;let e=h[i];e||(e=h[i]=[],e.field=r,m.push(e)),e.push(oo(t,f))}})),(g.length||m.length)&&(e.cell=function(t,e,n){t=t.map(t=>ho(t,t.field));let r={num:0,agg:null,store:!1,count:e};if(!n)for(var i=t.length,a=r.agg=Array(i),o=0;o<i;++o)a[o]=new t[o](r);if(r.store)var u=r.data=new iu;return r.add=function(t){if(r.num+=1,!n){u&&u.add(t);for(let e=0;e<i;++e)a[e].add(a[e].get(t),t)}},r.rem=function(t){if(r.num-=1,!n){u&&u.rem(t);for(let e=0;e<i;++e)a[e].rem(a[e].get(t),t)}},r.set=function(t){let i,o;for(u&&u.values(),i=0,o=e.length;i<o;++i)t[e[i]]=r.num;if(!n)for(i=0,o=a.length;i<o;++i)a[i].set(t)},r.init=function(){r.num=0,u&&u.reset();for(let t=0;t<i;++t)a[t].init()},r}(m,g,p)),e.inputs=Object.keys(f)}const _s=ys.prototype;function xs(t){Xa.call(this,{},t),this._mlen=0,this._mods=[]}_s.init=function(){this.windows.forEach(t=>t.init()),this.cell&&this.cell.init()},_s.update=function(t,e){let n,r=this.cell,i=this.windows,a=t.data,o=i&&i.length;if(r){for(n=t.p0;n<t.i0;++n)r.rem(a[n]);for(n=t.p1;n<t.i1;++n)r.add(a[n]);r.set(e)}for(n=0;n<o;++n)i[n].update(t,e)},xs.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:vs.concat(ao)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};var bs=st(xs,Xa);function ws(t,e,n,r){var i=r.sort,a=i&&!r.ignorePeers,o=r.frame||[null,0],u=t.data(n),s=u.length,l=0,c=a?je(i):null,f={i0:0,i1:0,p0:0,p1:0,index:0,data:u,compare:i||Q(-1)};for(e.init();l<s;++l)ks(f,o,l,s),a&&As(f,c),e.update(f,u[l])}function ks(t,e,n,r){t.p0=t.i0,t.p1=t.i1,t.i0=null==e[0]?0:Math.max(0,n-Math.abs(e[0])),t.i1=null==e[1]?r:Math.min(r,n+Math.abs(e[1])+1),t.index=n}function As(t,e){var n=t.i0,r=t.i1-1,i=t.compare,a=t.data,o=a.length-1;n>0&&!i(a[n],a[n-1])&&(t.i0=e.left(a,a[n])),r<o&&!i(a[r],a[r+1])&&(t.i1=e.right(a,a[r]))}bs.transform=function(t,e){var n,r,i=this,a=i.state,o=t.modified(),u=Pt(t.sort);this.stamp=e.stamp,a&&!o||(a=i.state=new ys(t));var s=to(t.groupby);function l(t){return i.group(s(t))}for(o||e.modified(a.inputs)?(i.value={},e.visit(e.SOURCE,(function(t){l(t).add(t)}))):(e.visit(e.REM,(function(t){l(t).remove(t)})),e.visit(e.ADD,(function(t){l(t).add(t)}))),n=0,r=i._mlen;n<r;++n)ws(i._mods[n],a,u,t);return i._mlen=0,i._mods=[],e.reflow(o).modifies(a.outputs)},bs.group=function(t){var e=this.value[t];return e||((e=this.value[t]=cu(Ot)).stamp=-1),e.stamp<this.stamp&&(e.stamp=this.stamp,this._mods[this._mlen++]=e),e};var Ms=Object.freeze({__proto__:null,aggregate:ou,bin:su,collect:fu,compare:hu,countpattern:pu,cross:mu,density:yu,dotbin:ku,expression:Au,extent:Eu,facet:Fu,field:Bu,filter:zu,flatten:Nu,fold:Ou,formula:Ru,generate:qu,impute:$u,joinaggregate:Pu,kde:Iu,key:Wu,load:Yu,lookup:Gu,multiextent:Xu,multivalues:Zu,params:Ku,pivot:ts,prefacet:ns,project:rs,proxy:is,quantile:as,relay:us,sample:ss,sequence:ls,sieve:cs,subflow:Du,timeunit:fs,tupleindex:ps,values:gs,window:xs});const Es="top",Ds="left",Cs="right",Fs="end",Ss="row";var Bs=0;function Ts(t){return t&&t.gradient}function zs(t,e,n){let r=t.id,i=t.gradient,a="radial"===i?"p_":"";return r||(r=t.id="gradient_"+Bs++,"radial"===i?(t.x1=Ns(t.x1,.5),t.y1=Ns(t.y1,.5),t.r1=Ns(t.r1,0),t.x2=Ns(t.x2,.5),t.y2=Ns(t.y2,.5),t.r2=Ns(t.r2,.5),a="p_"):(t.x1=Ns(t.x1,0),t.y1=Ns(t.y1,0),t.x2=Ns(t.x2,1),t.y2=Ns(t.y2,0))),e[r]=t,"url("+(n||"")+"#"+a+r+")"}function Ns(t,e){return null!=t?t:e}function Os(t,e){var n,r=[];return n={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:r,stop:function(t,e){return r.push({offset:t,color:e}),n}}}var Rs=Math.PI,qs=2*Rs,Us=qs-1e-6;function Ls(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function $s(){return new Ls}function Ps(t){return function(){return t}}Ls.prototype=$s.prototype={constructor:Ls,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,r){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(t,e,n,r,i,a){this._+="C"+ +t+","+ +e+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(t,e,n,r,i){t=+t,e=+e,n=+n,r=+r,i=+i;var a=this._x1,o=this._y1,u=n-t,s=r-e,l=a-t,c=o-e,f=l*l+c*c;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(f>1e-6)if(Math.abs(c*u-s*l)>1e-6&&i){var h=n-a,d=r-o,p=u*u+s*s,g=h*h+d*d,m=Math.sqrt(p),v=Math.sqrt(f),y=i*Math.tan((Rs-Math.acos((p+f-g)/(2*m*v)))/2),_=y/v,x=y/m;Math.abs(_-1)>1e-6&&(this._+="L"+(t+_*l)+","+(e+_*c)),this._+="A"+i+","+i+",0,0,"+ +(c*h>l*d)+","+(this._x1=t+x*u)+","+(this._y1=e+x*s)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,r,i,a){t=+t,e=+e,a=!!a;var o=(n=+n)*Math.cos(r),u=n*Math.sin(r),s=t+o,l=e+u,c=1^a,f=a?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+s+","+l:(Math.abs(this._x1-s)>1e-6||Math.abs(this._y1-l)>1e-6)&&(this._+="L"+s+","+l),n&&(f<0&&(f=f%qs+qs),f>Us?this._+="A"+n+","+n+",0,1,"+c+","+(t-o)+","+(e-u)+"A"+n+","+n+",0,1,"+c+","+(this._x1=s)+","+(this._y1=l):f>1e-6&&(this._+="A"+n+","+n+",0,"+ +(f>=Rs)+","+c+","+(this._x1=t+n*Math.cos(i))+","+(this._y1=e+n*Math.sin(i))))},rect:function(t,e,n,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var js=Math.abs,Is=Math.atan2,Ws=Math.cos,Hs=Math.max,Ys=Math.min,Vs=Math.sin,Gs=Math.sqrt,Xs=Math.PI,Js=Xs/2,Zs=2*Xs;function Qs(t){return t>1?0:t<-1?Xs:Math.acos(t)}function Ks(t){return t>=1?Js:t<=-1?-Js:Math.asin(t)}function tl(t){return t.innerRadius}function el(t){return t.outerRadius}function nl(t){return t.startAngle}function rl(t){return t.endAngle}function il(t){return t&&t.padAngle}function al(t,e,n,r,i,a,o,u){var s=n-t,l=r-e,c=o-i,f=u-a,h=f*s-c*l;if(!(h*h<1e-12))return[t+(h=(c*(e-a)-f*(t-i))/h)*s,e+h*l]}function ol(t,e,n,r,i,a,o){var u=t-n,s=e-r,l=(o?a:-a)/Gs(u*u+s*s),c=l*s,f=-l*u,h=t+c,d=e+f,p=n+c,g=r+f,m=(h+p)/2,v=(d+g)/2,y=p-h,_=g-d,x=y*y+_*_,b=i-a,w=h*g-p*d,k=(_<0?-1:1)*Gs(Hs(0,b*b*x-w*w)),A=(w*_-y*k)/x,M=(-w*y-_*k)/x,E=(w*_+y*k)/x,D=(-w*y+_*k)/x,C=A-m,F=M-v,S=E-m,B=D-v;return C*C+F*F>S*S+B*B&&(A=E,M=D),{cx:A,cy:M,x01:-c,y01:-f,x11:A*(i/b-1),y11:M*(i/b-1)}}function ul(t){this._context=t}function sl(t){return new ul(t)}function ll(t){return t[0]}function cl(t){return t[1]}function fl(){var t=ll,e=cl,n=Ps(!0),r=null,i=sl,a=null;function o(o){var u,s,l,c=o.length,f=!1;for(null==r&&(a=i(l=$s())),u=0;u<=c;++u)!(u<c&&n(s=o[u],u,o))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+t(s,u,o),+e(s,u,o));if(l)return a=null,l+""||null}return o.x=function(e){return arguments.length?(t="function"==typeof e?e:Ps(+e),o):t},o.y=function(t){return arguments.length?(e="function"==typeof t?t:Ps(+t),o):e},o.defined=function(t){return arguments.length?(n="function"==typeof t?t:Ps(!!t),o):n},o.curve=function(t){return arguments.length?(i=t,null!=r&&(a=i(r)),o):i},o.context=function(t){return arguments.length?(null==t?r=a=null:a=i(r=t),o):r},o}function hl(){var t=ll,e=null,n=Ps(0),r=cl,i=Ps(!0),a=null,o=sl,u=null;function s(s){var l,c,f,h,d,p=s.length,g=!1,m=new Array(p),v=new Array(p);for(null==a&&(u=o(d=$s())),l=0;l<=p;++l){if(!(l<p&&i(h=s[l],l,s))===g)if(g=!g)c=l,u.areaStart(),u.lineStart();else{for(u.lineEnd(),u.lineStart(),f=l-1;f>=c;--f)u.point(m[f],v[f]);u.lineEnd(),u.areaEnd()}g&&(m[l]=+t(h,l,s),v[l]=+n(h,l,s),u.point(e?+e(h,l,s):m[l],r?+r(h,l,s):v[l]))}if(d)return u=null,d+""||null}function l(){return fl().defined(i).curve(o).context(a)}return s.x=function(n){return arguments.length?(t="function"==typeof n?n:Ps(+n),e=null,s):t},s.x0=function(e){return arguments.length?(t="function"==typeof e?e:Ps(+e),s):t},s.x1=function(t){return arguments.length?(e=null==t?null:"function"==typeof t?t:Ps(+t),s):e},s.y=function(t){return arguments.length?(n="function"==typeof t?t:Ps(+t),r=null,s):n},s.y0=function(t){return arguments.length?(n="function"==typeof t?t:Ps(+t),s):n},s.y1=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:Ps(+t),s):r},s.lineX0=s.lineY0=function(){return l().x(t).y(n)},s.lineY1=function(){return l().x(t).y(r)},s.lineX1=function(){return l().x(e).y(n)},s.defined=function(t){return arguments.length?(i="function"==typeof t?t:Ps(!!t),s):i},s.curve=function(t){return arguments.length?(o=t,null!=a&&(u=o(a)),s):o},s.context=function(t){return arguments.length?(null==t?a=u=null:u=o(a=t),s):a},s}ul.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var dl={draw:function(t,e){var n=Math.sqrt(e/Xs);t.moveTo(n,0),t.arc(0,0,n,0,Zs)}};function pl(){}function gl(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function ml(t){this._context=t}function vl(t){this._context=t}function yl(t){this._context=t}function _l(t,e){this._basis=new ml(t),this._beta=e}ml.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:gl(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:gl(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},vl.prototype={areaStart:pl,areaEnd:pl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:gl(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},yl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,r=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:gl(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},_l.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var r,i=t[0],a=e[0],o=t[n]-i,u=e[n]-a,s=-1;++s<=n;)r=s/n,this._basis.point(this._beta*t[s]+(1-this._beta)*(i+r*o),this._beta*e[s]+(1-this._beta)*(a+r*u));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};var xl=function t(e){function n(t){return 1===e?new ml(t):new _l(t,e)}return n.beta=function(e){return t(+e)},n}(.85);function bl(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function wl(t,e){this._context=t,this._k=(1-e)/6}wl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:bl(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:bl(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var kl=function t(e){function n(t){return new wl(t,e)}return n.tension=function(e){return t(+e)},n}(0);function Al(t,e){this._context=t,this._k=(1-e)/6}Al.prototype={areaStart:pl,areaEnd:pl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:bl(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Ml=function t(e){function n(t){return new Al(t,e)}return n.tension=function(e){return t(+e)},n}(0);function El(t,e){this._context=t,this._k=(1-e)/6}El.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:bl(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Dl=function t(e){function n(t){return new El(t,e)}return n.tension=function(e){return t(+e)},n}(0);function Cl(t,e,n){var r=t._x1,i=t._y1,a=t._x2,o=t._y2;if(t._l01_a>1e-12){var u=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,s=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*u-t._x0*t._l12_2a+t._x2*t._l01_2a)/s,i=(i*u-t._y0*t._l12_2a+t._y2*t._l01_2a)/s}if(t._l23_a>1e-12){var l=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,c=3*t._l23_a*(t._l23_a+t._l12_a);a=(a*l+t._x1*t._l23_2a-e*t._l12_2a)/c,o=(o*l+t._y1*t._l23_2a-n*t._l12_2a)/c}t._context.bezierCurveTo(r,i,a,o,t._x2,t._y2)}function Fl(t,e){this._context=t,this._alpha=e}Fl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:Cl(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Sl=function t(e){function n(t){return e?new Fl(t,e):new wl(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Bl(t,e){this._context=t,this._alpha=e}Bl.prototype={areaStart:pl,areaEnd:pl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Cl(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Tl=function t(e){function n(t){return e?new Bl(t,e):new Al(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function zl(t,e){this._context=t,this._alpha=e}zl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Cl(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Nl=function t(e){function n(t){return e?new zl(t,e):new El(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Ol(t){this._context=t}function Rl(t){return t<0?-1:1}function ql(t,e,n){var r=t._x1-t._x0,i=e-t._x1,a=(t._y1-t._y0)/(r||i<0&&-0),o=(n-t._y1)/(i||r<0&&-0),u=(a*i+o*r)/(r+i);return(Rl(a)+Rl(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(u))||0}function Ul(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function Ll(t,e,n){var r=t._x0,i=t._y0,a=t._x1,o=t._y1,u=(a-r)/3;t._context.bezierCurveTo(r+u,i+u*e,a-u,o-u*n,a,o)}function $l(t){this._context=t}function Pl(t){this._context=new jl(t)}function jl(t){this._context=t}function Il(t){this._context=t}function Wl(t){var e,n,r=t.length-1,i=new Array(r),a=new Array(r),o=new Array(r);for(i[0]=0,a[0]=2,o[0]=t[0]+2*t[1],e=1;e<r-1;++e)i[e]=1,a[e]=4,o[e]=4*t[e]+2*t[e+1];for(i[r-1]=2,a[r-1]=7,o[r-1]=8*t[r-1]+t[r],e=1;e<r;++e)n=i[e]/a[e-1],a[e]-=n,o[e]-=n*o[e-1];for(i[r-1]=o[r-1]/a[r-1],e=r-2;e>=0;--e)i[e]=(o[e]-i[e+1])/a[e];for(a[r-1]=(t[r]+i[r-1])/2,e=0;e<r-1;++e)a[e]=2*t[e+1]-i[e+1];return[i,a]}function Hl(t,e){this._context=t,this._t=e}Ol.prototype={areaStart:pl,areaEnd:pl,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}},$l.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Ll(this,this._t0,Ul(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,Ll(this,Ul(this,n=ql(this,t,e)),n);break;default:Ll(this,this._t0,n=ql(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(Pl.prototype=Object.create($l.prototype)).point=function(t,e){$l.prototype.point.call(this,e,t)},jl.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,i,a){this._context.bezierCurveTo(e,t,r,n,a,i)}},Il.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===n)this._context.lineTo(t[1],e[1]);else for(var r=Wl(t),i=Wl(e),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],t[o],e[o]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}},Hl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};var Yl={basis:{curve:function(t){return new ml(t)}},"basis-closed":{curve:function(t){return new vl(t)}},"basis-open":{curve:function(t){return new yl(t)}},bundle:{curve:xl,tension:"beta",value:.85},cardinal:{curve:kl,tension:"tension",value:0},"cardinal-open":{curve:Dl,tension:"tension",value:0},"cardinal-closed":{curve:Ml,tension:"tension",value:0},"catmull-rom":{curve:Sl,tension:"alpha",value:.5},"catmull-rom-closed":{curve:Tl,tension:"alpha",value:.5},"catmull-rom-open":{curve:Nl,tension:"alpha",value:.5},linear:{curve:sl},"linear-closed":{curve:function(t){return new Ol(t)}},monotone:{horizontal:function(t){return new Pl(t)},vertical:function(t){return new $l(t)}},natural:{curve:function(t){return new Il(t)}},step:{curve:function(t){return new Hl(t,.5)}},"step-after":{curve:function(t){return new Hl(t,1)}},"step-before":{curve:function(t){return new Hl(t,0)}}};function Vl(t,e,n){var r=it(Yl,t)&&Yl[t],i=null;return r&&(i=r.curve||r[e||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}var Gl={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Xl=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];function Jl(t){var e,n,r,i,a,o,u,s,l,c,f,h=[];for(s=0,c=(e=t.slice().replace(Xl[0],"###$1").split(Xl[1]).slice(1)).length;s<c;++s){for(r=(n=e[s]).slice(1).trim().replace(Xl[2],"$1###$2").split(Xl[3]),i=[o=n.charAt(0)],l=0,f=r.length;l<f;++l)(a=+r[l])===a&&i.push(a);if(u=Gl[o.toLowerCase()],i.length-1>u)for(l=1,f=i.length;l<f;l+=u)h.push([o].concat(i.slice(l,l+u)));else h.push(i)}return h}const Zl=Math.PI/180,Ql=Math.PI/2,Kl=2*Math.PI,tc=Math.sqrt(3)/2;var ec={},nc={},rc=[].join;function ic(t){var e=rc.call(t);if(nc[e])return nc[e];var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],u=t[5],s=t[6],l=t[7],c=l*o,f=-s*u,h=s*o,d=l*u,p=Math.cos(i),g=Math.sin(i),m=Math.cos(a),v=Math.sin(a),y=.5*(a-i),_=Math.sin(.5*y),x=8/3*_*_/Math.sin(y),b=n+p-x*g,w=r+g+x*p,k=n+m,A=r+v,M=k+x*v,E=A-x*m;return nc[e]=[c*b+f*w,h*b+d*w,c*M+f*E,h*M+d*E,c*k+f*A,h*k+d*A]}var ac=["l",0,0,0,0,0,0,0];function oc(t,e,n){var r=ac[0]=t[0];if("a"===r||"A"===r)ac[1]=e*t[1],ac[2]=n*t[2],ac[3]=t[3],ac[4]=t[4],ac[5]=t[5],ac[6]=e*t[6],ac[7]=n*t[7];else if("h"===r||"H"===r)ac[1]=e*t[1];else if("v"===r||"V"===r)ac[1]=n*t[1];else for(var i=1,a=t.length;i<a;++i)ac[i]=(i%2==1?e:n)*t[i];return ac}function uc(t,e,n,r,i,a){var o,u,s,l,c,f=null,h=0,d=0,p=0,g=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),null==a&&(a=i),t.beginPath&&t.beginPath();for(var m=0,v=e.length;m<v;++m){switch(o=e[m],1===i&&1===a||(o=oc(o,i,a)),o[0]){case"l":h+=o[1],d+=o[2],t.lineTo(h+n,d+r);break;case"L":h=o[1],d=o[2],t.lineTo(h+n,d+r);break;case"h":h+=o[1],t.lineTo(h+n,d+r);break;case"H":h=o[1],t.lineTo(h+n,d+r);break;case"v":d+=o[1],t.lineTo(h+n,d+r);break;case"V":d=o[1],t.lineTo(h+n,d+r);break;case"m":h+=o[1],d+=o[2],t.moveTo(h+n,d+r);break;case"M":h=o[1],d=o[2],t.moveTo(h+n,d+r);break;case"c":u=h+o[5],s=d+o[6],p=h+o[3],g=d+o[4],t.bezierCurveTo(h+o[1]+n,d+o[2]+r,p+n,g+r,u+n,s+r),h=u,d=s;break;case"C":h=o[5],d=o[6],p=o[3],g=o[4],t.bezierCurveTo(o[1]+n,o[2]+r,p+n,g+r,h+n,d+r);break;case"s":u=h+o[3],s=d+o[4],p=2*h-p,g=2*d-g,t.bezierCurveTo(p+n,g+r,h+o[1]+n,d+o[2]+r,u+n,s+r),p=h+o[1],g=d+o[2],h=u,d=s;break;case"S":u=o[3],s=o[4],p=2*h-p,g=2*d-g,t.bezierCurveTo(p+n,g+r,o[1]+n,o[2]+r,u+n,s+r),h=u,d=s,p=o[1],g=o[2];break;case"q":u=h+o[3],s=d+o[4],p=h+o[1],g=d+o[2],t.quadraticCurveTo(p+n,g+r,u+n,s+r),h=u,d=s;break;case"Q":u=o[3],s=o[4],t.quadraticCurveTo(o[1]+n,o[2]+r,u+n,s+r),h=u,d=s,p=o[1],g=o[2];break;case"t":u=h+o[1],s=d+o[2],null===f[0].match(/[QqTt]/)?(p=h,g=d):"t"===f[0]?(p=2*h-l,g=2*d-c):"q"===f[0]&&(p=2*h-p,g=2*d-g),l=p,c=g,t.quadraticCurveTo(p+n,g+r,u+n,s+r),d=s,p=(h=u)+o[1],g=d+o[2];break;case"T":u=o[1],s=o[2],p=2*h-p,g=2*d-g,t.quadraticCurveTo(p+n,g+r,u+n,s+r),h=u,d=s;break;case"a":sc(t,h+n,d+r,[o[1],o[2],o[3],o[4],o[5],o[6]+h+n,o[7]+d+r]),h+=o[6],d+=o[7];break;case"A":sc(t,h+n,d+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),h=o[6],d=o[7];break;case"z":case"Z":t.closePath()}f=o}}function sc(t,e,n,r){for(var i=function(t,e,n,r,i,a,o,u,s){var l=rc.call(arguments);if(ec[l])return ec[l];var c=o*Zl,f=Math.sin(c),h=Math.cos(c),d=h*(u-t)*.5+f*(s-e)*.5,p=h*(s-e)*.5-f*(u-t)*.5,g=d*d/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);g>1&&(n*=g=Math.sqrt(g),r*=g);var m=h/n,v=f/n,y=-f/r,_=h/r,x=m*u+v*s,b=y*u+_*s,w=m*t+v*e,k=y*t+_*e,A=(w-x)*(w-x)+(k-b)*(k-b),M=1/A-.25;M<0&&(M=0);var E=Math.sqrt(M);a==i&&(E=-E);var D=.5*(x+w)-E*(k-b),C=.5*(b+k)+E*(w-x),F=Math.atan2(b-C,x-D),S=Math.atan2(k-C,w-D),B=S-F;B<0&&1===a?B+=Kl:B>0&&0===a&&(B-=Kl);for(var T=Math.ceil(Math.abs(B/(Ql+.001))),z=[],N=0;N<T;++N){var O=F+N*B/T,R=F+(N+1)*B/T;z[N]=[D,C,O,R,n,r,f,h]}return ec[l]=z}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],e,n),a=0;a<i.length;++a){var o=ic(i[a]);t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var lc=.5773502691896257,cc={circle:{draw:function(t,e){var n=Math.sqrt(e)/2;t.moveTo(n,0),t.arc(0,0,n,0,Kl)}},cross:{draw:function(t,e){var n=Math.sqrt(e)/2,r=n/2.5;t.moveTo(-n,-r),t.lineTo(-n,r),t.lineTo(-r,r),t.lineTo(-r,n),t.lineTo(r,n),t.lineTo(r,r),t.lineTo(n,r),t.lineTo(n,-r),t.lineTo(r,-r),t.lineTo(r,-n),t.lineTo(-r,-n),t.lineTo(-r,-r),t.closePath()}},diamond:{draw:function(t,e){var n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.closePath()}},square:{draw:function(t,e){var n=Math.sqrt(e),r=-n/2;t.rect(r,r,n,n)}},arrow:{draw:function(t,e){var n=Math.sqrt(e)/2,r=n/7,i=n/2.5,a=n/8;t.moveTo(-r,n),t.lineTo(r,n),t.lineTo(r,-a),t.lineTo(i,-a),t.lineTo(0,-n),t.lineTo(-i,-a),t.lineTo(-r,-a),t.closePath()}},wedge:{draw:function(t,e){var n=Math.sqrt(e)/2,r=tc*n,i=r-n*lc,a=n/4;t.moveTo(0,-r-i),t.lineTo(-a,r-i),t.lineTo(a,r-i),t.closePath()}},triangle:{draw:function(t,e){var n=Math.sqrt(e)/2,r=tc*n,i=r-n*lc;t.moveTo(0,-r-i),t.lineTo(-n,r-i),t.lineTo(n,r-i),t.closePath()}},"triangle-up":{draw:function(t,e){var n=Math.sqrt(e)/2,r=tc*n;t.moveTo(0,-r),t.lineTo(-n,r),t.lineTo(n,r),t.closePath()}},"triangle-down":{draw:function(t,e){var n=Math.sqrt(e)/2,r=tc*n;t.moveTo(0,r),t.lineTo(-n,-r),t.lineTo(n,-r),t.closePath()}},"triangle-right":{draw:function(t,e){var n=Math.sqrt(e)/2,r=tc*n;t.moveTo(r,0),t.lineTo(-r,-n),t.lineTo(-r,n),t.closePath()}},"triangle-left":{draw:function(t,e){var n=Math.sqrt(e)/2,r=tc*n;t.moveTo(-r,0),t.lineTo(r,-n),t.lineTo(r,n),t.closePath()}},stroke:{draw:function(t,e){var n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(n,0)}}};function fc(t){return it(cc,t)?cc[t]:function(t){if(!it(hc,t)){var e=Jl(t);hc[t]={draw:function(t,n){uc(t,e,0,0,Math.sqrt(n)/2)}}}return hc[t]}(t)}var hc={};const dc=.448084975506;function pc(t){return t.x}function gc(t){return t.y}function mc(t){return t.width}function vc(t){return t.height}function yc(t){return"function"==typeof t?t:()=>+t}function _c(t,e,n){return Math.max(e,Math.min(t,n))}function xc(){var t=pc,e=gc,n=mc,r=vc,i=yc(0),a=i,o=i,u=i,s=null;function l(l,c,f){var h,d=null!=c?c:+t.call(this,l),p=null!=f?f:+e.call(this,l),g=+n.call(this,l),m=+r.call(this,l),v=Math.min(g,m)/2,y=_c(+i.call(this,l),0,v),_=_c(+a.call(this,l),0,v),x=_c(+o.call(this,l),0,v),b=_c(+u.call(this,l),0,v);if(s||(s=h=$s()),y<=0&&_<=0&&x<=0&&b<=0)s.rect(d,p,g,m);else{var w=d+g,k=p+m;s.moveTo(d+y,p),s.lineTo(w-_,p),s.bezierCurveTo(w-dc*_,p,w,p+dc*_,w,p+_),s.lineTo(w,k-b),s.bezierCurveTo(w,k-dc*b,w-dc*b,k,w-b,k),s.lineTo(d+x,k),s.bezierCurveTo(d+dc*x,k,d,k-dc*x,d,k-x),s.lineTo(d,p+y),s.bezierCurveTo(d,p+dc*y,d+dc*y,p,d+y,p),s.closePath()}if(h)return s=null,h+""||null}return l.x=function(e){return arguments.length?(t=yc(e),l):t},l.y=function(t){return arguments.length?(e=yc(t),l):e},l.width=function(t){return arguments.length?(n=yc(t),l):n},l.height=function(t){return arguments.length?(r=yc(t),l):r},l.cornerRadius=function(t,e,n,r){return arguments.length?(i=yc(t),a=null!=e?yc(e):i,u=null!=n?yc(n):i,o=null!=r?yc(r):a,l):i},l.context=function(t){return arguments.length?(s=null==t?null:t,l):s},l}function bc(){var t,e,n,r,i,a,o,u,s=null;function l(t,e,n){var r=n/2;if(i){var l=o-e,c=t-a;if(l||c){var f=Math.sqrt(l*l+c*c),h=(l/=f)*u,d=(c/=f)*u,p=Math.atan2(c,l);s.moveTo(a-h,o-d),s.lineTo(t-l*r,e-c*r),s.arc(t,e,r,p-Math.PI,p),s.lineTo(a+h,o+d),s.arc(a,o,u,p,p+Math.PI)}else s.arc(t,e,r,0,Kl);s.closePath()}else i=1;a=t,o=e,u=r}function c(a){var o,u,c,f=a.length,h=!1;for(null==s&&(s=c=$s()),o=0;o<=f;++o)!(o<f&&r(u=a[o],o,a))===h&&(h=!h)&&(i=0),h&&l(+t(u,o,a),+e(u,o,a),+n(u,o,a));if(c)return s=null,c+""||null}return c.x=function(e){return arguments.length?(t=e,c):t},c.y=function(t){return arguments.length?(e=t,c):e},c.size=function(t){return arguments.length?(n=t,c):n},c.defined=function(t){return arguments.length?(r=t,c):r},c.context=function(t){return arguments.length?(s=null==t?null:t,c):s},c}function wc(t,e){return null!=t?t:e}const kc=t=>t.x||0,Ac=t=>t.y||0,Mc=t=>!(!1===t.defined),Ec=function(){var t=tl,e=el,n=Ps(0),r=null,i=nl,a=rl,o=il,u=null;function s(){var s,l,c=+t.apply(this,arguments),f=+e.apply(this,arguments),h=i.apply(this,arguments)-Js,d=a.apply(this,arguments)-Js,p=js(d-h),g=d>h;if(u||(u=s=$s()),f<c&&(l=f,f=c,c=l),f>1e-12)if(p>Zs-1e-12)u.moveTo(f*Ws(h),f*Vs(h)),u.arc(0,0,f,h,d,!g),c>1e-12&&(u.moveTo(c*Ws(d),c*Vs(d)),u.arc(0,0,c,d,h,g));else{var m,v,y=h,_=d,x=h,b=d,w=p,k=p,A=o.apply(this,arguments)/2,M=A>1e-12&&(r?+r.apply(this,arguments):Gs(c*c+f*f)),E=Ys(js(f-c)/2,+n.apply(this,arguments)),D=E,C=E;if(M>1e-12){var F=Ks(M/c*Vs(A)),S=Ks(M/f*Vs(A));(w-=2*F)>1e-12?(x+=F*=g?1:-1,b-=F):(w=0,x=b=(h+d)/2),(k-=2*S)>1e-12?(y+=S*=g?1:-1,_-=S):(k=0,y=_=(h+d)/2)}var B=f*Ws(y),T=f*Vs(y),z=c*Ws(b),N=c*Vs(b);if(E>1e-12){var O,R=f*Ws(_),q=f*Vs(_),U=c*Ws(x),L=c*Vs(x);if(p<Xs&&(O=al(B,T,U,L,R,q,z,N))){var $=B-O[0],P=T-O[1],j=R-O[0],I=q-O[1],W=1/Vs(Qs(($*j+P*I)/(Gs($*$+P*P)*Gs(j*j+I*I)))/2),H=Gs(O[0]*O[0]+O[1]*O[1]);D=Ys(E,(c-H)/(W-1)),C=Ys(E,(f-H)/(W+1))}}k>1e-12?C>1e-12?(m=ol(U,L,B,T,f,C,g),v=ol(R,q,z,N,f,C,g),u.moveTo(m.cx+m.x01,m.cy+m.y01),C<E?u.arc(m.cx,m.cy,C,Is(m.y01,m.x01),Is(v.y01,v.x01),!g):(u.arc(m.cx,m.cy,C,Is(m.y01,m.x01),Is(m.y11,m.x11),!g),u.arc(0,0,f,Is(m.cy+m.y11,m.cx+m.x11),Is(v.cy+v.y11,v.cx+v.x11),!g),u.arc(v.cx,v.cy,C,Is(v.y11,v.x11),Is(v.y01,v.x01),!g))):(u.moveTo(B,T),u.arc(0,0,f,y,_,!g)):u.moveTo(B,T),c>1e-12&&w>1e-12?D>1e-12?(m=ol(z,N,R,q,c,-D,g),v=ol(B,T,U,L,c,-D,g),u.lineTo(m.cx+m.x01,m.cy+m.y01),D<E?u.arc(m.cx,m.cy,D,Is(m.y01,m.x01),Is(v.y01,v.x01),!g):(u.arc(m.cx,m.cy,D,Is(m.y01,m.x01),Is(m.y11,m.x11),!g),u.arc(0,0,c,Is(m.cy+m.y11,m.cx+m.x11),Is(v.cy+v.y11,v.cx+v.x11),g),u.arc(v.cx,v.cy,D,Is(v.y11,v.x11),Is(v.y01,v.x01),!g))):u.arc(0,0,c,b,x,g):u.lineTo(z,N)}else u.moveTo(0,0);if(u.closePath(),s)return u=null,s+""||null}return s.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-Xs/2;return[Ws(r)*n,Vs(r)*n]},s.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:Ps(+e),s):t},s.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:Ps(+t),s):e},s.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:Ps(+t),s):n},s.padRadius=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:Ps(+t),s):r},s.startAngle=function(t){return arguments.length?(i="function"==typeof t?t:Ps(+t),s):i},s.endAngle=function(t){return arguments.length?(a="function"==typeof t?t:Ps(+t),s):a},s.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:Ps(+t),s):o},s.context=function(t){return arguments.length?(u=null==t?null:t,s):u},s}().startAngle(t=>t.startAngle||0).endAngle(t=>t.endAngle||0).padAngle(t=>t.padAngle||0).innerRadius(t=>t.innerRadius||0).outerRadius(t=>t.outerRadius||0).cornerRadius(t=>t.cornerRadius||0),Dc=hl().x(kc).y1(Ac).y0(t=>(t.y||0)+(t.height||0)).defined(Mc),Cc=hl().y(Ac).x1(kc).x0(t=>(t.x||0)+(t.width||0)).defined(Mc),Fc=fl().x(kc).y(Ac).defined(Mc),Sc=xc().x(kc).y(Ac).width(t=>t.width||0).height(t=>t.height||0).cornerRadius(t=>wc(t.cornerRadiusTopLeft,t.cornerRadius)||0,t=>wc(t.cornerRadiusTopRight,t.cornerRadius)||0,t=>wc(t.cornerRadiusBottomRight,t.cornerRadius)||0,t=>wc(t.cornerRadiusBottomLeft,t.cornerRadius)||0),Bc=function(){var t=Ps(dl),e=Ps(64),n=null;function r(){var r;if(n||(n=r=$s()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),r)return n=null,r+""||null}return r.type=function(e){return arguments.length?(t="function"==typeof e?e:Ps(e),r):t},r.size=function(t){return arguments.length?(e="function"==typeof t?t:Ps(+t),r):e},r.context=function(t){return arguments.length?(n=null==t?null:t,r):n},r}().type(t=>fc(t.shape||"circle")).size(t=>wc(t.size,64)),Tc=bc().x(kc).y(Ac).defined(Mc).size(t=>t.size||1);function zc(t){return t.cornerRadius||t.cornerRadiusTopLeft||t.cornerRadiusTopRight||t.cornerRadiusBottomRight||t.cornerRadiusBottomLeft}function Nc(t,e,n,r){return Sc.context(t)(e,n,r)}var Oc=1;function Rc(){Oc=1}function qc(t,e,n){var r=e.clip,i=t._defs,a=e.clip_id||(e.clip_id="clip"+Oc++),o=i.clipping[a]||(i.clipping[a]={id:a});return Y(r)?o.path=r(null):zc(n)?o.path=Nc(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function Uc(t){this.clear(),t&&this.union(t)}var Lc=Uc.prototype;function $c(t){this.mark=t,this.bounds=this.bounds||new Uc}function Pc(t){$c.call(this,t),this.items=this.items||[]}function jc(t,e){if("undefined"!=typeof document&&document.createElement){var n=document.createElement("canvas");if(n&&n.getContext)return n.width=t,n.height=e,n}return null}function Ic(){return"undefined"!=typeof Image?Image:null}function Wc(t){this._pending=0,this._loader=t||Sa()}Lc.clone=function(){return new Uc(this)},Lc.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},Lc.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},Lc.equals=function(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},Lc.set=function(t,e,n,r){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this},Lc.add=function(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},Lc.expand=function(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},Lc.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},Lc.scale=function(t){return this.x1*=t,this.y1*=t,this.x2*=t,this.y2*=t,this},Lc.translate=function(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},Lc.rotate=function(t,e,n){const r=this.rotatedPoints(t,e,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},Lc.rotatedPoints=function(t,e,n){var{x1:r,y1:i,x2:a,y2:o}=this,u=Math.cos(t),s=Math.sin(t),l=e-e*u+n*s,c=n-e*s-n*u;return[u*r-s*i+l,s*r+u*i+c,u*r-s*o+l,s*r+u*o+c,u*a-s*i+l,s*a+u*i+c,u*a-s*o+l,s*a+u*o+c]},Lc.union=function(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},Lc.intersect=function(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this},Lc.encloses=function(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},Lc.alignsWith=function(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},Lc.intersects=function(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},Lc.contains=function(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},Lc.width=function(){return this.x2-this.x1},Lc.height=function(){return this.y2-this.y1},st(Pc,$c);var Hc=Wc.prototype;function Yc(t){t._pending+=1}function Vc(t){t._pending-=1}function Gc(t,e,n){if(e.stroke&&0!==e.opacity&&0!==e.strokeOpacity){const r=null!=e.strokeWidth?+e.strokeWidth:1;t.expand(r+(n?function(t,e){return t.strokeJoin&&"miter"!==t.strokeJoin?0:e}(e,r):0))}return t}Hc.pending=function(){return this._pending},Hc.sanitizeURL=function(t){var e=this;return Yc(e),e._loader.sanitize(t,{context:"href"}).then((function(t){return Vc(e),t})).catch((function(){return Vc(e),null}))},Hc.loadImage=function(t){const e=this,n=Ic();return Yc(e),e._loader.sanitize(t,{context:"image"}).then((function(t){const r=t.href;if(!r||!n)throw{url:r};const i=new n,a=it(t,"crossOrigin")?t.crossOrigin:"anonymous";return null!=a&&(i.crossOrigin=a),i.onload=()=>Vc(e),i.onerror=()=>Vc(e),i.src=r,i})).catch((function(t){return Vc(e),{complete:!1,width:0,height:0,src:t&&t.url||""}}))},Hc.ready=function(){var t=this;return new Promise((function(e){!function n(r){t.pending()?setTimeout((function(){n(!0)}),10):e(r)}(!1)}))};var Xc,Jc,Zc,Qc=Kl-1e-8;function Kc(t){return Xc=t,Kc}function tf(){}function ef(t,e){Xc.add(t,e)}function nf(t,e){ef(Jc=t,Zc=e)}function rf(t){ef(t,Xc.y1)}function af(t){ef(Xc.x1,t)}function of(t,e,n,r){const i=(t-e)/(t+n-2*e);0<i&&i<1&&r(t+(e-t)*i)}function uf(t,e,n,r,i){const a=r-t+3*e-3*n,o=t+n-2*e,u=t-e;let s,l=0,c=0;Math.abs(a)>1e-14?(s=o*o+u*a,s>=0&&(s=Math.sqrt(s),l=(-o+s)/a,c=(-o-s)/a)):l=.5*u/o,0<l&&l<1&&i(sf(l,t,e,n,r)),0<c&&c<1&&i(sf(c,t,e,n,r))}function sf(t,e,n,r,i){const a=1-t,o=a*a,u=t*t;return o*a*e+3*o*t*n+3*a*u*r+u*t*i}Kc.beginPath=tf,Kc.closePath=tf,Kc.moveTo=nf,Kc.lineTo=nf,Kc.rect=function(t,e,n,r){ef(t+n,e+r),nf(t,e)},Kc.quadraticCurveTo=function(t,e,n,r){of(Jc,t,n,rf),of(Zc,e,r,af),nf(n,r)},Kc.bezierCurveTo=function(t,e,n,r,i,a){uf(Jc,t,n,i,rf),uf(Zc,e,r,a,af),nf(i,a)},Kc.arc=function(t,e,n,r,i,a){if(Jc=n*Math.cos(i)+t,Zc=n*Math.sin(i)+e,Math.abs(i-r)>Qc)ef(t-n,e-n),ef(t+n,e+n);else{const o=r=>ef(n*Math.cos(r)+t,n*Math.sin(r)+e);let u,s;if(o(r),o(i),i!==r)if((r%=Kl)<0&&(r+=Kl),(i%=Kl)<0&&(i+=Kl),i<r&&(a=!a,u=r,r=i,i=u),a)for(i-=Kl,u=r-r%Ql,s=0;s<4&&u>i;++s,u-=Ql)o(u);else for(u=r-r%Ql+Ql,s=0;s<4&&u<i;++s,u+=Ql)o(u)}};var lf=(lf=jc(1,1))?lf.getContext("2d"):null;const cf=new Uc;function ff(t){return function(e,n){if(!lf)return!0;t(lf,e),cf.clear().union(e.bounds).intersect(n).round();const{x1:r,y1:i,x2:a,y2:o}=cf;for(let t=i;t<=o;++t)for(let e=r;e<=a;++e)if(lf.isPointInPath(e,t))return!0;return!1}}function hf(t,e){return e.contains(t.x||0,t.y||0)}function df(t,e){const n=t.x||0,r=t.y||0,i=t.width||0,a=t.height||0;return e.intersects(cf.set(n,r,n+i,r+a))}function pf(t,e){const n=t.x||0,r=t.y||0;return gf(e,n,r,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r)}function gf(t,e,n,r,i){const{x1:a,y1:o,x2:u,y2:s}=t,l=r-e,c=i-n;let f,h,d,p,g=0,m=1;for(p=0;p<4;++p){if(0===p&&(f=-l,h=-(a-e)),1===p&&(f=l,h=u-e),2===p&&(f=-c,h=-(o-n)),3===p&&(f=c,h=s-n),Math.abs(f)<1e-10&&h<0)return!1;if(d=h/f,f<0){if(d>m)return!1;d>g&&(g=d)}else if(f>0){if(d<g)return!1;d<m&&(m=d)}}return!0}function mf(t,e){t.globalCompositeOperation=e.blend||"source-over"}function vf(t,e){return null==t?e:t}function yf(t,e){const n=e.length;for(let r=0;r<n;++r)t.addColorStop(e[r].offset,e[r].color);return t}function _f(t,e,n){return Ts(n)?function(t,e,n){const r=n.width(),i=n.height();let a;if("radial"===e.gradient)a=t.createRadialGradient(n.x1+vf(e.x1,.5)*r,n.y1+vf(e.y1,.5)*i,Math.max(r,i)*vf(e.r1,0),n.x1+vf(e.x2,.5)*r,n.y1+vf(e.y2,.5)*i,Math.max(r,i)*vf(e.r2,.5));else{const o=vf(e.x1,0),u=vf(e.y1,0),s=vf(e.x2,1),l=vf(e.y2,0);if(o!==s&&u!==l&&r!==i){const n=jc(Math.ceil(r),Math.ceil(i)),a=n.getContext("2d");return a.scale(r,i),a.fillStyle=yf(a.createLinearGradient(o,u,s,l),e.stops),a.fillRect(0,0,r,i),t.createPattern(n,"no-repeat")}a=t.createLinearGradient(n.x1+o*r,n.y1+u*i,n.x1+s*r,n.y1+l*i)}return yf(a,e.stops)}(t,n,e.bounds):n}function xf(t,e,n){return(n*=null==e.fillOpacity?1:e.fillOpacity)>0&&(t.globalAlpha=n,t.fillStyle=_f(t,e,e.fill),!0)}var bf=[];function wf(t,e,n){var r=null!=(r=e.strokeWidth)?r:1;return!(r<=0)&&((n*=null==e.strokeOpacity?1:e.strokeOpacity)>0&&(t.globalAlpha=n,t.strokeStyle=_f(t,e,e.stroke),t.lineWidth=r,t.lineCap=e.strokeCap||"butt",t.lineJoin=e.strokeJoin||"miter",t.miterLimit=e.strokeMiterLimit||10,t.setLineDash&&(t.setLineDash(e.strokeDash||bf),t.lineDashOffset=e.strokeDashOffset||0),!0))}function kf(t,e){return t.zindex-e.zindex||t.index-e.index}function Af(t){if(!t.zdirty)return t.zitems;var e,n,r,i=t.items,a=[];for(n=0,r=i.length;n<r;++n)(e=i[n]).index=n,e.zindex&&a.push(e);return t.zdirty=!1,t.zitems=a.sort(kf)}function Mf(t,e){var n,r,i=t.items;if(i&&i.length){var a=Af(t);if(a&&a.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||e(i[n]);i=a}for(n=0,r=i.length;n<r;++n)e(i[n])}}function Ef(t,e){var n,r,i=t.items;if(!i||!i.length)return null;var a=Af(t);for(a&&a.length&&(i=a),r=i.length;--r>=0;)if(n=e(i[r]))return n;if(i===a)for(r=(i=t.items).length;--r>=0;)if(!i[r].zindex&&(n=e(i[r])))return n;return null}function Df(t){return function(e,n,r){Mf(n,(function(n){r&&!r.intersects(n.bounds)||Ff(t,e,n,n)}))}}function Cf(t){return function(e,n,r){!n.items.length||r&&!r.intersects(n.bounds)||Ff(t,e,n.items[0],n.items)}}function Ff(t,e,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(t(e,r)||(mf(e,n),n.fill&&xf(e,n,i)&&e.fill(),n.stroke&&wf(e,n,i)&&e.stroke()))}function Sf(t){return t=t||g,function(e,n,r,i,a,o){return r*=e.pixelRatio,i*=e.pixelRatio,Ef(n,(function(n){var u=n.bounds;if((!u||u.contains(a,o))&&u)return t(e,n,r,i,a,o)?n:void 0}))}}function Bf(t,e){return function(n,r,i,a){var o,u,s=Array.isArray(r)?r[0]:r,l=null==e?s.fill:e,c=s.stroke&&n.isPointInStroke;return c&&(o=s.strokeWidth,u=s.strokeCap,n.lineWidth=null!=o?o:1,n.lineCap=null!=u?u:"butt"),!t(n,r)&&(l&&n.isPointInPath(i,a)||c&&n.isPointInStroke(i,a))}}function Tf(t){return Sf(Bf(t))}function zf(t,e){return"translate("+t+","+e+")"}function Nf(t){return"rotate("+t+")"}function Of(t){return zf(t.x||0,t.y||0)}function Rf(t){return zf(t.x||0,t.y||0)+(t.angle?" "+Nf(t.angle):"")+(t.scaleX||t.scaleY?" "+(e=t.scaleX||1,n=t.scaleY||1,"scale("+e+","+n+")"):"");var e,n}function qf(t,e,n){function r(t,n){var r=n.x||0,i=n.y||0,a=n.angle||0;t.translate(r,i),a&&t.rotate(a*=Zl),t.beginPath(),e(t,n),a&&t.rotate(-a),t.translate(-r,-i)}return{type:t,tag:"path",nested:!1,attr:function(t,n){t("transform",Rf(n)),t("d",e(null,n))},bound:function(t,n){var r=n.x||0,i=n.y||0;return e(Kc(t),n),Gc(t,n).translate(r,i),n.angle&&t.rotate(n.angle*Zl,r,i),t},draw:Df(r),pick:Tf(r),isect:n||ff(r)}}var Uf=qf("arc",(function(t,e){return Ec.context(t)(e)}));function Lf(t,e,n){function r(t,n){t.beginPath(),e(t,n)}var i=Bf(r);return{type:t,tag:"path",nested:!0,attr:function(t,n){var r=n.mark.items;r.length&&t("d",e(null,r))},bound:function(t,n){var r=n.items;return 0===r.length?t:(e(Kc(t),r),Gc(t,r[0]))},draw:Cf(r),pick:function(t,e,n,r,a,o){var u=e.items,s=e.bounds;return!u||!u.length||s&&!s.contains(a,o)?null:(n*=t.pixelRatio,r*=t.pixelRatio,i(t,u,n,r)?u[0]:null)},isect:hf,tip:n}}var $f=Lf("area",(function(t,e){var n=e[0],r=n.interpolate||"linear";return("horizontal"===n.orient?Cc:Dc).curve(Vl(r,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,r,i="horizontal"===t[0].orient?e[1]:e[0],a="horizontal"===t[0].orient?"y":"x",o=t.length,u=1/0;--o>=0;)!1!==t[o].defined&&(r=Math.abs(t[o][a]-i))<u&&(u=r,n=t[o]);return n}));function Pf(t,e){t.beginPath(),zc(e)?Nc(t,e,0,0):t.rect(0,0,e.width||0,e.height||0),t.clip()}function jf(t){const e=vf(t.strokeWidth,1);return null!=t.strokeOffset?t.strokeOffset:t.stroke&&e>.5&&e<1.5?.5-Math.abs(e-1):0}function If(t,e){const n=jf(e);t("d",Nc(null,e,n,n))}function Wf(t,e,n,r){const i=jf(e);t.beginPath(),Nc(t,e,(n||0)+i,(r||0)+i)}const Hf=Bf(Wf),Yf=Bf(Wf,!1);var Vf={type:"group",tag:"g",nested:!1,attr:function(t,e){t("transform",Of(e))},bound:function(t,e){if(!e.clip&&e.items){const n=e.items,r=n.length;for(let e=0;e<r;++e)t.union(n[e].bounds)}return(e.clip||e.width||e.height)&&!e.noBound&&t.add(0,0).add(e.width||0,e.height||0),Gc(t,e),t.translate(e.x||0,e.y||0)},draw:function(t,e,n){Mf(e,e=>{const r=e.x||0,i=e.y||0,a=e.strokeForeground,o=null==e.opacity?1:e.opacity;(e.stroke||e.fill)&&o&&(Wf(t,e,r,i),mf(t,e),e.fill&&xf(t,e,o)&&t.fill(),e.stroke&&!a&&wf(t,e,o)&&t.stroke()),t.save(),t.translate(r,i),e.clip&&Pf(t,e),n&&n.translate(-r,-i),Mf(e,e=>{this.draw(t,e,n)}),n&&n.translate(r,i),t.restore(),a&&e.stroke&&o&&(Wf(t,e,r,i),mf(t,e),wf(t,e,o)&&t.stroke())})},pick:function(t,e,n,r,i,a){if(e.bounds&&!e.bounds.contains(i,a)||!e.items)return null;const o=n*t.pixelRatio,u=r*t.pixelRatio;return Ef(e,s=>{let l,c,f,h,d,p,g,m,v;if(m=s.bounds,(!m||m.contains(i,a))&&(h=s.x||0,d=s.y||0,p=h+(s.width||0),g=d+(s.height||0),v=s.clip,!v||!(i<h||i>p||a<d||a>g)))return t.save(),t.translate(h,d),h=i-h,d=a-d,v&&zc(s)&&!Hf(t,s,o,u)?(t.restore(),null):(c=s.strokeForeground,f=!1!==e.interactive,f&&c&&s.stroke&&Yf(t,s,o,u)?(t.restore(),s):(l=Ef(s,t=>function(t,e,n){return(!1!==t.interactive||"group"===t.marktype)&&t.bounds&&t.bounds.contains(e,n)}(t,h,d)?this.pick(t,n,r,h,d):null),!l&&f&&(s.fill||!c&&s.stroke)&&Hf(t,s,o,u)&&(l=s),t.restore(),l||null))})},isect:df,content:function(t,e,n){t("clip-path",e.clip?qc(n,e,e):null)},background:function(t,e){t("class","background"),t("aria-hidden",!0),If(t,e)},foreground:function(t,e){t("class","foreground"),t("aria-hidden",!0),e.strokeForeground?If(t,e):t("d","")}},Gf={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};function Xf(t,e){var n=t.image;return(!n||t.url&&t.url!==n.url)&&(n={complete:!1,width:0,height:0},e.loadImage(t.url).then(e=>{t.image=e,t.image.url=t.url})),n}function Jf(t,e){return null!=t.width?t.width:e&&e.width?!1!==t.aspect&&t.height?t.height*e.width/e.height:e.width:0}function Zf(t,e){return null!=t.height?t.height:e&&e.height?!1!==t.aspect&&t.width?t.width*e.height/e.width:e.height:0}function Qf(t,e){return"center"===t?e/2:"right"===t?e:0}function Kf(t,e){return"middle"===t?e/2:"bottom"===t?e:0}var th={type:"image",tag:"image",nested:!1,attr:function(t,e,n){const r=Xf(e,n),i=Jf(e,r),a=Zf(e,r),o=(e.x||0)-Qf(e.align,i),u=(e.y||0)-Kf(e.baseline,a);t("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",Gf["xmlns:xlink"],"xlink:href"),t("transform",zf(o,u)),t("width",i),t("height",a),t("preserveAspectRatio",!1===e.aspect?"none":"xMidYMid")},bound:function(t,e){const n=e.image,r=Jf(e,n),i=Zf(e,n),a=(e.x||0)-Qf(e.align,r),o=(e.y||0)-Kf(e.baseline,i);return t.set(a,o,a+r,o+i)},draw:function(t,e,n){Mf(e,e=>{if(n&&!n.intersects(e.bounds))return;let r,i,a,o,u=Xf(e,this),s=Jf(e,u),l=Zf(e,u),c=(e.x||0)-Qf(e.align,s),f=(e.y||0)-Kf(e.baseline,l);!1!==e.aspect&&(i=u.width/u.height,a=e.width/e.height,i==i&&a==a&&i!==a&&(a<i?(o=s/i,f+=(l-o)/2,l=o):(o=l*i,c+=(s-o)/2,s=o))),(u.complete||u.toDataURL)&&(mf(t,e),t.globalAlpha=null!=(r=e.opacity)?r:1,t.imageSmoothingEnabled=!1!==e.smooth,t.drawImage(u,c,f,s,l))})},pick:Sf(),isect:g,get:Xf,xOffset:Qf,yOffset:Kf},eh=Lf("line",(function(t,e){var n=e[0],r=n.interpolate||"linear";return Fc.curve(Vl(r,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,r,i=Math.pow(t[0].strokeWidth||1,2),a=t.length;--a>=0;)if(!1!==t[a].defined&&(n=t[a].x-e[0])*n+(r=t[a].y-e[1])*r<i)return t[a];return null}));function nh(t,e){var n=e.path;if(null==n)return!0;var r=e.x||0,i=e.y||0,a=e.scaleX||1,o=e.scaleY||1,u=(e.angle||0)*Zl,s=e.pathCache;s&&s.path===n||((e.pathCache=s=Jl(n)).path=n),u&&t.rotate&&t.translate?(t.translate(r,i),t.rotate(u),uc(t,s,0,0,a,o),t.rotate(-u),t.translate(-r,-i)):uc(t,s,r,i,a,o)}var rh={type:"path",tag:"path",nested:!1,attr:function(t,e){var n=e.scaleX||1,r=e.scaleY||1;1===n&&1===r||t("vector-effect","non-scaling-stroke"),t("transform",Rf(e)),t("d",e.path)},bound:function(t,e){return nh(Kc(t),e)?t.set(0,0,0,0):Gc(t,e,!0),e.angle&&t.rotate(e.angle*Zl,e.x||0,e.y||0),t},draw:Df(nh),pick:Tf(nh),isect:ff(nh)};function ih(t,e){t.beginPath(),Nc(t,e)}var ah={type:"rect",tag:"path",nested:!1,attr:function(t,e){t("d",Nc(null,e))},bound:function(t,e){var n,r;return Gc(t.set(n=e.x||0,r=e.y||0,n+e.width||0,r+e.height||0),e)},draw:Df(ih),pick:Tf(ih),isect:df};function oh(t,e,n){var r,i,a,o;return!(!e.stroke||!wf(t,e,n))&&(r=e.x||0,i=e.y||0,a=null!=e.x2?e.x2:r,o=null!=e.y2?e.y2:i,t.beginPath(),t.moveTo(r,i),t.lineTo(a,o),!0)}var uh={type:"rule",tag:"line",nested:!1,attr:function(t,e){t("transform",Of(e)),t("x2",null!=e.x2?e.x2-(e.x||0):0),t("y2",null!=e.y2?e.y2-(e.y||0):0)},bound:function(t,e){var n,r;return Gc(t.set(n=e.x||0,r=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r),e)},draw:function(t,e,n){Mf(e,(function(e){if(!n||n.intersects(e.bounds)){var r=null==e.opacity?1:e.opacity;r&&oh(t,e,r)&&(mf(t,e),t.stroke())}}))},pick:Sf((function(t,e,n,r){return!!t.isPointInStroke&&(oh(t,e,1)&&t.isPointInStroke(n,r))})),isect:pf},sh=qf("shape",(function(t,e){return(e.mark.shape||e.shape).context(t)(e)})),lh=qf("symbol",(function(t,e){return Bc.context(t)(e)}),hf);const ch=vt();var fh={height:vh,measureWidth:gh,estimateWidth:dh,width:dh,canvas:hh};function hh(t){fh.width=t&&lf?gh:dh}function dh(t,e){return ph(bh(t,e),vh(t))}function ph(t,e){return~~(.8*t.length*e)}function gh(t,e){return vh(t)<=0||!(e=bh(t,e))?0:mh(e,kh(t))}function mh(t,e){const n=`(${e}) ${t}`;let r=ch.get(n);return void 0===r&&(lf.font=e,r=lf.measureText(t).width,ch.set(n,r)),r}function vh(t){return null!=t.fontSize?+t.fontSize||0:11}function yh(t){return null!=t.lineHeight?t.lineHeight:vh(t)+2}function _h(t){return e=t.lineBreak&&t.text&&!_(t.text)?t.text.split(t.lineBreak):t.text,_(e)?e.length>1?e:e[0]:e;var e}function xh(t){const e=_h(t);return(_(e)?e.length-1:0)*yh(t)}function bh(t,e){const n=null==e?"":(e+"").trim();return t.limit>0&&n.length?function(t,e){var n=+t.limit,r=function(t){if(fh.width===gh){const e=kh(t);return t=>mh(t,e)}{const e=vh(t);return t=>ph(t,e)}}(t);if(r(e)<n)return e;var i,a=t.ellipsis||"
",o="rtl"===t.dir,u=0,s=e.length;if(n-=r(a),o){for(;u<s;)i=u+s>>>1,r(e.slice(i))>n?u=i+1:s=i;return a+e.slice(u)}for(;u<s;)i=1+(u+s>>>1),r(e.slice(0,i))<n?u=i:s=i-1;return e.slice(0,u)+a}(t,n):n}function wh(t,e){var n=t.font;return(e&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function kh(t,e){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+vh(t)+"px "+wh(t,e)}function Ah(t){var e=t.baseline,n=vh(t);return Math.round("top"===e?.79*n:"middle"===e?.3*n:"bottom"===e?-.21*n:"line-top"===e?.29*n+.5*yh(t):"line-bottom"===e?.29*n-.5*yh(t):0)}hh(!0);var Mh={left:"start",center:"middle",right:"end"},Eh=new Uc;function Dh(t){var e,n=t.x||0,r=t.y||0,i=t.radius||0;return i&&(e=(t.theta||0)-Ql,n+=i*Math.cos(e),r+=i*Math.sin(e)),Eh.x1=n,Eh.y1=r,Eh}function Ch(t,e,n){var r,i=fh.height(e),a=e.align,o=Dh(e),u=o.x1,s=o.y1,l=e.dx||0,c=(e.dy||0)+Ah(e)-Math.round(.8*i),f=_h(e);if(_(f)?(i+=yh(e)*(f.length-1),r=f.reduce((t,n)=>Math.max(t,fh.width(e,n)),0)):r=fh.width(e,f),"center"===a?l-=r/2:"right"===a&&(l-=r),t.set(l+=u,c+=s,l+r,c+i),e.angle&&!n)t.rotate(e.angle*Zl,u,s);else if(2===n)return t.rotatedPoints(e.angle*Zl,u,s);return t}var Fh={arc:Uf,area:$f,group:Vf,image:th,line:eh,path:rh,rect:ah,rule:uh,shape:sh,symbol:lh,text:{type:"text",tag:"text",nested:!1,attr:function(t,e){var n,r=e.dx||0,i=(e.dy||0)+Ah(e),a=Dh(e),o=a.x1,u=a.y1,s=e.angle||0;t("text-anchor",Mh[e.align]||"start"),s?(n=zf(o,u)+" "+Nf(s),(r||i)&&(n+=" "+zf(r,i))):n=zf(o+r,u+i),t("transform",n)},bound:Ch,draw:function(t,e,n){Mf(e,(function(e){var r,i,a,o,u,s,l,c=null==e.opacity?1:e.opacity;if(!(n&&!n.intersects(e.bounds)||0===c||e.fontSize<=0||null==e.text||0===e.text.length)){if(t.font=kh(e),t.textAlign=e.align||"left",i=(r=Dh(e)).x1,a=r.y1,e.angle&&(t.save(),t.translate(i,a),t.rotate(e.angle*Zl),i=a=0),i+=e.dx||0,a+=(e.dy||0)+Ah(e),s=_h(e),mf(t,e),_(s))for(u=yh(e),o=0;o<s.length;++o)l=bh(e,s[o]),e.fill&&xf(t,e,c)&&t.fillText(l,i,a),e.stroke&&wf(t,e,c)&&t.strokeText(l,i,a),a+=u;else l=bh(e,s),e.fill&&xf(t,e,c)&&t.fillText(l,i,a),e.stroke&&wf(t,e,c)&&t.strokeText(l,i,a);e.angle&&t.restore()}}))},pick:Sf((function(t,e,n,r,i,a){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var o=Dh(e),u=o.x1,s=o.y1,l=Ch(Eh,e,1),c=-e.angle*Zl,f=Math.cos(c),h=Math.sin(c),d=f*i-h*a+(u-f*u+h*s),p=h*i+f*a+(s-h*u-f*s);return l.contains(d,p)})),isect:function(t,e){var n=Ch(Eh,t,2);return gf(e,n[0],n[1],n[2],n[3])||gf(e,n[0],n[1],n[4],n[5])||gf(e,n[4],n[5],n[6],n[7])||gf(e,n[2],n[3],n[6],n[7])}},trail:Lf("trail",(function(t,e){return Tc.context(t)(e)}),(function(t,e){for(var n,r,i=t.length;--i>=0;)if(!1!==t[i].defined&&(n=t[i].x-e[0])*n+(r=t[i].y-e[1])*r<(n=t[i].size||1)*n)return t[i];return null}))};function Sh(t,e,n){var r=Fh[t.mark.marktype],i=e||r.bound;return r.nested&&(t=t.mark),i(t.bounds||(t.bounds=new Uc),t,n)}var Bh={mark:null};function Th(t,e,n){var r,i,a,o,u=Fh[t.marktype],s=u.bound,l=t.items,c=l&&l.length;if(u.nested)return c?a=l[0]:(Bh.mark=t,a=Bh),o=Sh(a,s,n),e=e&&e.union(o)||o;if(e=e||t.bounds&&t.bounds.clear()||new Uc,c)for(r=0,i=l.length;r<i;++r)e.union(Sh(l[r],s,n));return t.bounds=e}var zh=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Nh(t,e){return JSON.stringify(t,zh,e)}function Oh(t){return function t(e){var n,r,i,a=e.marktype,o=e.items;if(o)for(r=0,i=o.length;r<i;++r)n=a?"mark":"group",o[r][n]=e,o[r].zindex&&(o[r][n].zdirty=!0),"group"===(a||n)&&t(o[r]);a&&Th(e);return e}("string"==typeof t?JSON.parse(t):t)}function Rh(t){arguments.length?this.root=Oh(t):(this.root=Uh({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Pc(this.root)])}var qh=Rh.prototype;function Uh(t,e){const n={bounds:new Uc,clip:!!t.clip,group:e,interactive:!1!==t.interactive,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0};return null!=t.aria&&(n.aria=t.aria),t.description&&(n.description=t.description),n}function Lh(t,e,n){return!t&&"undefined"!=typeof document&&document.createElement&&(t=document),t?n?t.createElementNS(n,e):t.createElement(e):null}function $h(t,e){e=e.toLowerCase();for(var n=t.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===e)return n[r]}function Ph(t,e,n,r){var i,a=t.childNodes[e];return a&&a.tagName.toLowerCase()===n.toLowerCase()||(i=a||null,a=Lh(t.ownerDocument,n,r),t.insertBefore(a,i)),a}function jh(t,e){for(var n=t.childNodes,r=n.length;r>e;)t.removeChild(n[--r]);return t}function Ih(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function Wh(t,e){var n=e.getBoundingClientRect();return[t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0)]}function Hh(t,e){this._active=null,this._handlers={},this._loader=t||Sa(),this._tooltip=e||Yh}function Yh(t,e,n,r){t.element().setAttribute("title",r||"")}qh.toJSON=function(t){return Nh(this.root,t||0)},qh.mark=function(t,e,n){var r=Uh(t,e=e||this.root.items[0]);return e.items[n]=r,r.zindex&&(r.group.zdirty=!0),r};const Vh=Hh.prototype;function Gh(t){this._el=null,this._bgcolor=null,this._loader=new Wc(t)}Vh.initialize=function(t,e,n){return this._el=t,this._obj=n||null,this.origin(e)},Vh.element=function(){return this._el},Vh.canvas=function(){return this._el&&this._el.firstChild},Vh.origin=function(t){return arguments.length?(this._origin=t||[0,0],this):this._origin.slice()},Vh.scene=function(t){return arguments.length?(this._scene=t,this):this._scene},Vh.on=function(){},Vh.off=function(){},Vh._handlerIndex=function(t,e,n){for(let r=t?t.length:0;--r>=0;)if(t[r].type===e&&(!n||t[r].handler===n))return r;return-1},Vh.handlers=function(t){const e=this._handlers,n=[];if(t)n.push.apply(n,e[this.eventName(t)]);else for(const t in e)n.push.apply(n,e[t]);return n},Vh.eventName=function(t){const e=t.indexOf(".");return e<0?t:t.slice(0,e)},Vh.handleHref=function(t,e,n){this._loader.sanitize(n,{context:"href"}).then(e=>{const n=new MouseEvent(t.type,t),r=Lh(null,"a");for(const t in e)r.setAttribute(t,e[t]);r.dispatchEvent(n)}).catch((function(){}))},Vh.handleTooltip=function(t,e,n){if(e&&null!=e.tooltip){e=function(t,e,n,r){var i,a,o=t&&t.mark;if(o&&(i=Fh[o.marktype]).tip){for((a=Wh(e,n))[0]-=r[0],a[1]-=r[1];t=t.mark.group;)a[0]-=t.x||0,a[1]-=t.y||0;t=i.tip(o.items,a)}return t}(e,t,this.canvas(),this._origin);const r=n&&e&&e.tooltip||null;this._tooltip.call(this._obj,this,t,e,r)}},Vh.getItemBoundingClientRect=function(t){const e=this.canvas();if(!e)return;const n=e.getBoundingClientRect(),r=this._origin,i=t.bounds,a=i.width(),o=i.height();let u=i.x1+r[0]+n.left,s=i.y1+r[1]+n.top;for(;t.mark&&(t=t.mark.group);)u+=t.x||0,s+=t.y||0;return{x:u,y:s,width:a,height:o,left:u,top:s,right:u+a,bottom:s+o}};var Xh=Gh.prototype;Xh.initialize=function(t,e,n,r,i){return this._el=t,this.resize(e,n,r,i)},Xh.element=function(){return this._el},Xh.canvas=function(){return this._el&&this._el.firstChild},Xh.background=function(t){return 0===arguments.length?this._bgcolor:(this._bgcolor=t,this)},Xh.resize=function(t,e,n,r){return this._width=t,this._height=e,this._origin=n||[0,0],this._scale=r||1,this},Xh.dirty=function(){},Xh.render=function(t){var e=this;return e._call=function(){e._render(t)},e._call(),e._call=null,e},Xh._render=function(){},Xh.renderAsync=function(t){var e=this.render(t);return this._ready?this._ready.then((function(){return e})):Promise.resolve(e)},Xh._load=function(t,e){var n=this,r=n._loader[t](e);if(!n._ready){var i=n._call;n._ready=n._loader.ready().then((function(t){t&&i(),n._ready=null}))}return r},Xh.sanitizeURL=function(t){return this._load("sanitizeURL",t)},Xh.loadImage=function(t){return this._load("loadImage",t)};const Jh="dragleave",Zh="mousedown",Qh="mousemove",Kh="mouseout",td="click",ed=["keydown","keypress","keyup","dragenter",Jh,"dragover",Zh,"mouseup",Qh,Kh,"mouseover",td,"dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],nd=Qh,rd=Kh,id=td;function ad(t,e){Hh.call(this,t,e),this._down=null,this._touch=null,this._first=!0,this._events={}}const od=st(ad,Hh);od.initialize=function(t,e,n){return this._canvas=t&&$h(t,"canvas"),[td,Zh,Qh,Kh,Jh].forEach(t=>ud(this,t)),Hh.prototype.initialize.call(this,t,e,n)};function ud(t,e){(t=>"touchstart"===t||"touchmove"===t||"touchend"===t?["touchstart","touchmove","touchend"]:[t])(e).forEach(e=>function(t,e){const n=t.canvas();n&&!t._events[e]&&(t._events[e]=1,n.addEventListener(e,t[e]?n=>t[e](n):n=>t.fire(e,n)))}(t,e))}function sd(t,e,n){return function(r){const i=this._active,a=this.pickEvent(r);a===i||(i&&i.exit||this.fire(n,r),this._active=a,this.fire(e,r)),this.fire(t,r)}}function ld(t){return function(e){this.fire(t,e),this._active=null}}od.canvas=function(){return this._canvas},od.context=function(){return this._canvas.getContext("2d")},od.events=ed,od.DOMMouseScroll=function(t){this.fire("mousewheel",t)},od.mousemove=sd(Qh,"mouseover",Kh),od.dragover=sd("dragover","dragenter",Jh),od.mouseout=ld(Kh),od.dragleave=ld(Jh),od.mousedown=function(t){this._down=this._active,this.fire(Zh,t)},od.click=function(t){this._down===this._active&&(this.fire(td,t),this._down=null)},od.touchstart=function(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",t,!0)},od.touchmove=function(t){this.fire("touchmove",t,!0)},od.touchend=function(t){this.fire("touchend",t,!0),this._touch=null},od.fire=function(t,e,n){const r=n?this._touch:this._active,i=this._handlers[t];if(e.vegaType=t,t===id&&r&&r.href?this.handleHref(e,r,r.href):t!==nd&&t!==rd||this.handleTooltip(e,r,t!==rd),i)for(let t=0,n=i.length;t<n;++t)i[t].handler.call(this._obj,e,r)},od.on=function(t,e){const n=this.eventName(t),r=this._handlers;return this._handlerIndex(r[n],t,e)<0&&(ud(this,t),(r[n]||(r[n]=[])).push({type:t,handler:e})),this},od.off=function(t,e){const n=this.eventName(t),r=this._handlers[n],i=this._handlerIndex(r,t,e);return i>=0&&r.splice(i,1),this},od.pickEvent=function(t){const e=Wh(t,this._canvas),n=this._origin;return this.pick(this._scene,e[0],e[1],e[0]-n[0],e[1]-n[1])},od.pick=function(t,e,n,r,i){const a=this.context();return Fh[t.marktype].pick.call(this,a,t,e,n,r,i)};var cd="undefined"!=typeof window&&window.devicePixelRatio||1;function fd(t){Gh.call(this,t),this._options={},this._redraw=!1,this._dirty=new Uc,this._tempb=new Uc}const hd=st(fd,Gh),dd=Gh.prototype;hd.initialize=function(t,e,n,r,i,a){return this._options=a||{},this._canvas=this._options.externalContext?null:jc(1,1,this._options.type),t&&this._canvas&&(jh(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),dd.initialize.call(this,t,e,n,r,i)},hd.resize=function(t,e,n,r){if(dd.resize.call(this,t,e,n,r),this._canvas)!function(t,e,n,r,i,a){const o="undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&null!=t.parentNode,u=t.getContext("2d"),s=o?cd:i;t.width=e*s,t.height=n*s;for(const t in a)u[t]=a[t];o&&1!==s&&(t.style.width=e+"px",t.style.height=n+"px"),u.pixelRatio=s,u.setTransform(s,0,0,s,s*r[0],s*r[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const t=this._options.externalContext;t||u("CanvasRenderer is missing a valid canvas or context"),t.scale(this._scale,this._scale),t.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},hd.canvas=function(){return this._canvas},hd.context=function(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},hd.dirty=function(t){let e=this._tempb.clear().union(t.bounds),n=t.mark.group;for(;n;)e.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(e)};function pd(t,e){Hh.call(this,t,e);const n=this;n._hrefHandler=md(n,(t,e)=>{e&&e.href&&n.handleHref(t,e,e.href)}),n._tooltipHandler=md(n,(t,e)=>{n.handleTooltip(t,e,t.type!==rd)})}hd._render=function(t){const e=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty,o=((t,e,n)=>(new Uc).set(0,0,e,n).translate(-t[0],-t[1]))(n,r,i);e.save();const u=this._redraw||a.empty()?(this._redraw=!1,o.expand(1)):function(t,e,n){return e.expand(1).round(),t.pixelRatio%1&&e.scale(t.pixelRatio).round().scale(1/t.pixelRatio),e.translate(-n[0]%1,-n[1]%1),t.beginPath(),t.rect(e.x1,e.y1,e.width(),e.height()),t.clip(),e}(e,o.intersect(a),n);return this.clear(-n[0],-n[1],r,i),this.draw(e,t,u),e.restore(),a.clear(),this},hd.draw=function(t,e,n){const r=Fh[e.marktype];e.clip&&function(t,e){var n=e.clip;t.save(),Y(n)?(t.beginPath(),n(t),t.clip()):Pf(t,e.group)}(t,e),r.draw.call(this,t,e,n),e.clip&&t.restore()},hd.clear=function(t,e,n,r){const i=this._options,a=this.context();"pdf"===i.type||i.externalContext||a.clearRect(t,e,n,r),null!=this._bgcolor&&(a.fillStyle=this._bgcolor,a.fillRect(t,e,n,r))};const gd=st(pd,Hh);gd.initialize=function(t,e,n){let r=this._svg;return r&&(r.removeEventListener(id,this._hrefHandler),r.removeEventListener(nd,this._tooltipHandler),r.removeEventListener(rd,this._tooltipHandler)),this._svg=r=t&&$h(t,"svg"),r&&(r.addEventListener(id,this._hrefHandler),r.addEventListener(nd,this._tooltipHandler),r.addEventListener(rd,this._tooltipHandler)),Hh.prototype.initialize.call(this,t,e,n)},gd.canvas=function(){return this._svg};const md=(t,e)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,e.call(t._obj,n,r)};function vd(t,e,n){var r=t-e+2*n;return t?r>0?r:1:0}gd.on=function(t,e){const n=this.eventName(t),r=this._handlers;if(this._handlerIndex(r[n],t,e)<0){const i={type:t,handler:e,listener:md(this,e)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},gd.off=function(t,e){const n=this.eventName(t),r=this._handlers[n],i=this._handlerIndex(r,t,e);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this};const yd="log",_d="time",xd="utc",bd="continuous";function wd(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function kd(t,e){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof e?this.interpolator(e):this.range(e)}return this}const Ad=Symbol("implicit");function Md(){var t=new Map,e=[],n=[],r=Ad;function i(i){var a=i+"",o=t.get(a);if(!o){if(r!==Ad)return r;t.set(a,o=e.push(i))}return n[(o-1)%n.length]}return i.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new Map;for(const r of n){const n=r+"";t.has(n)||t.set(n,e.push(r))}return i},i.range=function(t){return arguments.length?(n=Array.from(t),i):n.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return Md(e,n).unknown(r)},wd.apply(i,arguments),i}function Ed(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Dd(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Cd(){}var Fd="\\s*([+-]?\\d+)\\s*",Sd="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Bd="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Td=/^#([0-9a-f]{3,8})$/,zd=new RegExp("^rgb\\("+[Fd,Fd,Fd]+"\\)$"),Nd=new RegExp("^rgb\\("+[Bd,Bd,Bd]+"\\)$"),Od=new RegExp("^rgba\\("+[Fd,Fd,Fd,Sd]+"\\)$"),Rd=new RegExp("^rgba\\("+[Bd,Bd,Bd,Sd]+"\\)$"),qd=new RegExp("^hsl\\("+[Sd,Bd,Bd]+"\\)$"),Ud=new RegExp("^hsla\\("+[Sd,Bd,Bd,Sd]+"\\)$"),Ld={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function $d(){return this.rgb().formatHex()}function Pd(){return this.rgb().formatRgb()}function jd(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Td.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Id(e):3===n?new Vd(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Wd(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Wd(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=zd.exec(t))?new Vd(e[1],e[2],e[3],1):(e=Nd.exec(t))?new Vd(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Od.exec(t))?Wd(e[1],e[2],e[3],e[4]):(e=Rd.exec(t))?Wd(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=qd.exec(t))?Zd(e[1],e[2]/100,e[3]/100,1):(e=Ud.exec(t))?Zd(e[1],e[2]/100,e[3]/100,e[4]):Ld.hasOwnProperty(t)?Id(Ld[t]):"transparent"===t?new Vd(NaN,NaN,NaN,0):null}function Id(t){return new Vd(t>>16&255,t>>8&255,255&t,1)}function Wd(t,e,n,r){return r<=0&&(t=e=n=NaN),new Vd(t,e,n,r)}function Hd(t){return t instanceof Cd||(t=jd(t)),t?new Vd((t=t.rgb()).r,t.g,t.b,t.opacity):new Vd}function Yd(t,e,n,r){return 1===arguments.length?Hd(t):new Vd(t,e,n,null==r?1:r)}function Vd(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Gd(){return"#"+Jd(this.r)+Jd(this.g)+Jd(this.b)}function Xd(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function Jd(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Zd(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new tp(t,e,n,r)}function Qd(t){if(t instanceof tp)return new tp(t.h,t.s,t.l,t.opacity);if(t instanceof Cd||(t=jd(t)),!t)return new tp;if(t instanceof tp)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),o=NaN,u=a-i,s=(a+i)/2;return u?(o=e===a?(n-r)/u+6*(n<r):n===a?(r-e)/u+2:(e-n)/u+4,u/=s<.5?a+i:2-a-i,o*=60):u=s>0&&s<1?0:o,new tp(o,u,s,t.opacity)}function Kd(t,e,n,r){return 1===arguments.length?Qd(t):new tp(t,e,n,null==r?1:r)}function tp(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function ep(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}Ed(Cd,jd,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:$d,formatHex:$d,formatHsl:function(){return Qd(this).formatHsl()},formatRgb:Pd,toString:Pd}),Ed(Vd,Yd,Dd(Cd,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Vd(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Vd(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Gd,formatHex:Gd,formatRgb:Xd,toString:Xd})),Ed(tp,Kd,Dd(Cd,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new tp(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new tp(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Vd(ep(t>=240?t-240:t+120,i,r),ep(t,i,r),ep(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var np=Math.PI/180,rp=180/Math.PI,ip=6/29*3*(6/29);function ap(t){if(t instanceof up)return new up(t.l,t.a,t.b,t.opacity);if(t instanceof pp)return gp(t);t instanceof Vd||(t=Hd(t));var e,n,r=fp(t.r),i=fp(t.g),a=fp(t.b),o=sp((.2225045*r+.7168786*i+.0606169*a)/1);return r===i&&i===a?e=n=o:(e=sp((.4360747*r+.3850649*i+.1430804*a)/.96422),n=sp((.0139322*r+.0971045*i+.7141733*a)/.82521)),new up(116*o-16,500*(e-o),200*(o-n),t.opacity)}function op(t,e,n,r){return 1===arguments.length?ap(t):new up(t,e,n,null==r?1:r)}function up(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function sp(t){return t>6/29*(6/29)*(6/29)?Math.pow(t,1/3):t/ip+4/29}function lp(t){return t>6/29?t*t*t:ip*(t-4/29)}function cp(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function fp(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function hp(t){if(t instanceof pp)return new pp(t.h,t.c,t.l,t.opacity);if(t instanceof up||(t=ap(t)),0===t.a&&0===t.b)return new pp(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*rp;return new pp(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function dp(t,e,n,r){return 1===arguments.length?hp(t):new pp(t,e,n,null==r?1:r)}function pp(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function gp(t){if(isNaN(t.h))return new up(t.l,0,0,t.opacity);var e=t.h*np;return new up(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}Ed(up,op,Dd(Cd,{brighter:function(t){return new up(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new up(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new Vd(cp(3.1338561*(e=.96422*lp(e))-1.6168667*(t=1*lp(t))-.4906146*(n=.82521*lp(n))),cp(-.9787684*e+1.9161415*t+.033454*n),cp(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),Ed(pp,dp,Dd(Cd,{brighter:function(t){return new pp(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new pp(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return gp(this).rgb()}}));var mp=-.14861,vp=1.78277,yp=-.29227,_p=-.90649,xp=1.97294,bp=xp*_p,wp=xp*vp,kp=vp*yp-_p*mp;function Ap(t){if(t instanceof Ep)return new Ep(t.h,t.s,t.l,t.opacity);t instanceof Vd||(t=Hd(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(kp*r+bp*e-wp*n)/(kp+bp-wp),a=r-i,o=(xp*(n-i)-yp*a)/_p,u=Math.sqrt(o*o+a*a)/(xp*i*(1-i)),s=u?Math.atan2(o,a)*rp-120:NaN;return new Ep(s<0?s+360:s,u,i,t.opacity)}function Mp(t,e,n,r){return 1===arguments.length?Ap(t):new Ep(t,e,n,null==r?1:r)}function Ep(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Dp(t,e,n,r,i){var a=t*t,o=a*t;return((1-3*t+3*a-o)*e+(4-6*a+3*o)*n+(1+3*t+3*a-3*o)*r+o*i)/6}function Cp(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],a=t[r+1],o=r>0?t[r-1]:2*i-a,u=r<e-1?t[r+2]:2*a-i;return Dp((n-r/e)*e,o,i,a,u)}}function Fp(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],a=t[r%e],o=t[(r+1)%e],u=t[(r+2)%e];return Dp((n-r/e)*e,i,a,o,u)}}function Sp(t){return function(){return t}}function Bp(t,e){return function(n){return t+n*e}}function Tp(t,e){var n=e-t;return n?Bp(t,n>180||n<-180?n-360*Math.round(n/360):n):Sp(isNaN(t)?e:t)}function zp(t){return 1==(t=+t)?Np:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):Sp(isNaN(e)?n:e)}}function Np(t,e){var n=e-t;return n?Bp(t,n):Sp(isNaN(t)?e:t)}Ed(Ep,Mp,Dd(Cd,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Ep(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Ep(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*np,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new Vd(255*(e+n*(mp*r+vp*i)),255*(e+n*(yp*r+_p*i)),255*(e+n*(xp*r)),this.opacity)}}));var Op=function t(e){var n=zp(e);function r(t,e){var r=n((t=Yd(t)).r,(e=Yd(e)).r),i=n(t.g,e.g),a=n(t.b,e.b),o=Np(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=a(e),t.opacity=o(e),t+""}}return r.gamma=t,r}(1);function Rp(t){return function(e){var n,r,i=e.length,a=new Array(i),o=new Array(i),u=new Array(i);for(n=0;n<i;++n)r=Yd(e[n]),a[n]=r.r||0,o[n]=r.g||0,u[n]=r.b||0;return a=t(a),o=t(o),u=t(u),r.opacity=1,function(t){return r.r=a(t),r.g=o(t),r.b=u(t),r+""}}}var qp=Rp(Cp),Up=Rp(Fp);function Lp(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(a){for(n=0;n<r;++n)i[n]=t[n]*(1-a)+e[n]*a;return i}}function $p(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Pp(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=Gp(t[n],e[n]);for(;n<r;++n)o[n]=e[n];return function(t){for(n=0;n<i;++n)o[n]=a[n](t);return o}}function jp(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Ip(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Wp(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=Gp(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var Hp=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Yp=new RegExp(Hp.source,"g");function Vp(t,e){var n,r,i,a=Hp.lastIndex=Yp.lastIndex=0,o=-1,u=[],s=[];for(t+="",e+="";(n=Hp.exec(t))&&(r=Yp.exec(e));)(i=r.index)>a&&(i=e.slice(a,i),u[o]?u[o]+=i:u[++o]=i),(n=n[0])===(r=r[0])?u[o]?u[o]+=r:u[++o]=r:(u[++o]=null,s.push({i:o,x:Ip(n,r)})),a=Yp.lastIndex;return a<e.length&&(i=e.slice(a),u[o]?u[o]+=i:u[++o]=i),u.length<2?s[0]?function(t){return function(e){return t(e)+""}}(s[0].x):function(t){return function(){return t}}(e):(e=s.length,function(t){for(var n,r=0;r<e;++r)u[(n=s[r]).i]=n.x(t);return u.join("")})}function Gp(t,e){var n,r=typeof e;return null==e||"boolean"===r?Sp(e):("number"===r?Ip:"string"===r?(n=jd(e))?(e=n,Op):Vp:e instanceof jd?Op:e instanceof Date?jp:$p(e)?Lp:Array.isArray(e)?Pp:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?Wp:Ip)(t,e)}function Xp(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Jp,Zp,Qp,Kp,tg=180/Math.PI,eg={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ng(t,e,n,r,i,a){var o,u,s;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(s=t*n+e*r)&&(n-=t*s,r-=e*s),(u=Math.sqrt(n*n+r*r))&&(n/=u,r/=u,s/=u),t*r<e*n&&(t=-t,e=-e,s=-s,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(e,t)*tg,skewX:Math.atan(s)*tg,scaleX:o,scaleY:u}}function rg(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(a,o){var u=[],s=[];return a=t(a),o=t(o),function(t,r,i,a,o,u){if(t!==i||r!==a){var s=o.push("translate(",null,e,null,n);u.push({i:s-4,x:Ip(t,i)},{i:s-2,x:Ip(r,a)})}else(i||a)&&o.push("translate("+i+e+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,u,s),function(t,e,n,a){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Ip(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(a.rotate,o.rotate,u,s),function(t,e,n,a){t!==e?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Ip(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(a.skewX,o.skewX,u,s),function(t,e,n,r,a,o){if(t!==n||e!==r){var u=a.push(i(a)+"scale(",null,",",null,")");o.push({i:u-4,x:Ip(t,n)},{i:u-2,x:Ip(e,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,u,s),a=o=null,function(t){for(var e,n=-1,r=s.length;++n<r;)u[(e=s[n]).i]=e.x(t);return u.join("")}}}var ig=rg((function(t){return"none"===t?eg:(Jp||(Jp=document.createElement("DIV"),Zp=document.documentElement,Qp=document.defaultView),Jp.style.transform=t,t=Qp.getComputedStyle(Zp.appendChild(Jp),null).getPropertyValue("transform"),Zp.removeChild(Jp),ng(+(t=t.slice(7,-1).split(","))[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}),"px, ","px)","deg)"),ag=rg((function(t){return null==t?eg:(Kp||(Kp=document.createElementNS("http://www.w3.org/2000/svg","g")),Kp.setAttribute("transform",t),(t=Kp.transform.baseVal.consolidate())?ng((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):eg)}),", ",")",")"),og=Math.SQRT2;function ug(t){return((t=Math.exp(t))+1/t)/2}function sg(t){return function(e,n){var r=t((e=Kd(e)).h,(n=Kd(n)).h),i=Np(e.s,n.s),a=Np(e.l,n.l),o=Np(e.opacity,n.opacity);return function(t){return e.h=r(t),e.s=i(t),e.l=a(t),e.opacity=o(t),e+""}}}var lg=sg(Tp),cg=sg(Np);function fg(t){return function(e,n){var r=t((e=dp(e)).h,(n=dp(n)).h),i=Np(e.c,n.c),a=Np(e.l,n.l),o=Np(e.opacity,n.opacity);return function(t){return e.h=r(t),e.c=i(t),e.l=a(t),e.opacity=o(t),e+""}}}var hg=fg(Tp),dg=fg(Np);function pg(t){return function e(n){function r(e,r){var i=t((e=Mp(e)).h,(r=Mp(r)).h),a=Np(e.s,r.s),o=Np(e.l,r.l),u=Np(e.opacity,r.opacity);return function(t){return e.h=i(t),e.s=a(t),e.l=o(Math.pow(t,n)),e.opacity=u(t),e+""}}return n=+n,r.gamma=e,r}(1)}var gg=pg(Tp),mg=pg(Np);function vg(t,e){for(var n=0,r=e.length-1,i=e[0],a=new Array(r<0?0:r);n<r;)a[n]=t(i,i=e[++n]);return function(t){var e=Math.max(0,Math.min(r-1,Math.floor(t*=r)));return a[e](t-e)}}var yg=Object.freeze({__proto__:null,interpolate:Gp,interpolateArray:function(t,e){return($p(e)?Lp:Pp)(t,e)},interpolateBasis:Cp,interpolateBasisClosed:Fp,interpolateDate:jp,interpolateDiscrete:function(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}},interpolateHue:function(t,e){var n=Tp(+t,+e);return function(t){var e=n(t);return e-360*Math.floor(e/360)}},interpolateNumber:Ip,interpolateNumberArray:Lp,interpolateObject:Wp,interpolateRound:Xp,interpolateString:Vp,interpolateTransformCss:ig,interpolateTransformSvg:ag,interpolateZoom:function(t,e){var n,r,i=t[0],a=t[1],o=t[2],u=e[0],s=e[1],l=e[2],c=u-i,f=s-a,h=c*c+f*f;if(h<1e-12)r=Math.log(l/o)/og,n=function(t){return[i+t*c,a+t*f,o*Math.exp(og*t*r)]};else{var d=Math.sqrt(h),p=(l*l-o*o+4*h)/(2*o*2*d),g=(l*l-o*o-4*h)/(2*l*2*d),m=Math.log(Math.sqrt(p*p+1)-p),v=Math.log(Math.sqrt(g*g+1)-g);r=(v-m)/og,n=function(t){var e=t*r,n=ug(m),u=o/(2*d)*(n*function(t){return((t=Math.exp(2*t))-1)/(t+1)}(og*e+m)-function(t){return((t=Math.exp(t))-1/t)/2}(m));return[i+u*c,a+u*f,o*n/ug(og*e+m)]}}return n.duration=1e3*r,n},interpolateRgb:Op,interpolateRgbBasis:qp,interpolateRgbBasisClosed:Up,interpolateHsl:lg,interpolateHslLong:cg,interpolateLab:function(t,e){var n=Np((t=op(t)).l,(e=op(e)).l),r=Np(t.a,e.a),i=Np(t.b,e.b),a=Np(t.opacity,e.opacity);return function(e){return t.l=n(e),t.a=r(e),t.b=i(e),t.opacity=a(e),t+""}},interpolateHcl:hg,interpolateHclLong:dg,interpolateCubehelix:gg,interpolateCubehelixLong:mg,piecewise:vg,quantize:function(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t(r/(e-1));return n}});function _g(t){return+t}var xg=[0,1];function bg(t){return t}function wg(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:function(t){return function(){return t}}(isNaN(e)?NaN:.5)}function kg(t,e,n){var r=t[0],i=t[1],a=e[0],o=e[1];return i<r?(r=wg(i,r),a=n(o,a)):(r=wg(r,i),a=n(a,o)),function(t){return a(r(t))}}function Ag(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),a=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=wg(t[o],t[o+1]),a[o]=n(e[o],e[o+1]);return function(e){var n=We(t,e,1,r)-1;return a[n](i[n](e))}}function Mg(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Eg(){var t,e,n,r,i,a,o=xg,u=xg,s=Gp,l=bg;function c(){var t=Math.min(o.length,u.length);return l!==bg&&(l=function(t,e){var n;return t>e&&(n=t,t=e,e=n),function(n){return Math.max(t,Math.min(e,n))}}(o[0],o[t-1])),r=t>2?Ag:kg,i=a=null,f}function f(e){return isNaN(e=+e)?n:(i||(i=r(o.map(t),u,s)))(t(l(e)))}return f.invert=function(n){return l(e((a||(a=r(u,o.map(t),Ip)))(n)))},f.domain=function(t){return arguments.length?(o=Array.from(t,_g),c()):o.slice()},f.range=function(t){return arguments.length?(u=Array.from(t),c()):u.slice()},f.rangeRound=function(t){return u=Array.from(t),s=Xp,c()},f.clamp=function(t){return arguments.length?(l=!!t||bg,c()):l!==bg},f.interpolate=function(t){return arguments.length?(s=t,c()):s},f.unknown=function(t){return arguments.length?(n=t,f):n},function(n,r){return t=n,e=r,c()}}function Dg(){return Eg()(bg,bg)}function Cg(t,e,n,r){var i,a=Qe(t,e,n);switch((r=fn(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=kn(a,o))||(r.precision=i),yn(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=An(a,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=wn(a))||(r.precision=i-2*("%"===r.type))}return vn(r)}function Fg(t){var e=t.domain;return t.ticks=function(t){var n=e();return Je(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return Cg(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i=e(),a=0,o=i.length-1,u=i[a],s=i[o];return s<u&&(r=u,u=s,s=r,r=a,a=o,o=r),(r=Ze(u,s,n))>0?r=Ze(u=Math.floor(u/r)*r,s=Math.ceil(s/r)*r,n):r<0&&(r=Ze(u=Math.ceil(u*r)/r,s=Math.floor(s*r)/r,n)),r>0?(i[a]=Math.floor(u/r)*r,i[o]=Math.ceil(s/r)*r,e(i)):r<0&&(i[a]=Math.ceil(u*r)/r,i[o]=Math.floor(s*r)/r,e(i)),t},t}function Sg(t,e){var n,r=0,i=(t=t.slice()).length-1,a=t[r],o=t[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),t[r]=e.floor(a),t[i]=e.ceil(o),t}function Bg(t){return Math.log(t)}function Tg(t){return Math.exp(t)}function zg(t){return-Math.log(-t)}function Ng(t){return-Math.exp(-t)}function Og(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Rg(t){return function(e){return-t(-e)}}function qg(t){var e,n,r=t(Bg,Tg),i=r.domain,a=10;function o(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}(a),n=function(t){return 10===t?Og:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}(a),i()[0]<0?(e=Rg(e),n=Rg(n),t(zg,Ng)):t(Bg,Tg),r}return r.base=function(t){return arguments.length?(a=+t,o()):a},r.domain=function(t){return arguments.length?(i(t),o()):i()},r.ticks=function(t){var r,o=i(),u=o[0],s=o[o.length-1];(r=s<u)&&(h=u,u=s,s=h);var l,c,f,h=e(u),d=e(s),p=null==t?10:+t,g=[];if(!(a%1)&&d-h<p){if(h=Math.floor(h),d=Math.ceil(d),u>0){for(;h<=d;++h)for(c=1,l=n(h);c<a;++c)if(!((f=l*c)<u)){if(f>s)break;g.push(f)}}else for(;h<=d;++h)for(c=a-1,l=n(h);c>=1;--c)if(!((f=l*c)<u)){if(f>s)break;g.push(f)}2*g.length<p&&(g=Je(u,s,p))}else g=Je(h,d,Math.min(d-h,p)).map(n);return r?g.reverse():g},r.tickFormat=function(t,i){if(null==i&&(i=10===a?".0e":","),"function"!=typeof i&&(i=vn(i)),t===1/0)return i;null==t&&(t=10);var o=Math.max(1,a*t/r.ticks().length);return function(t){var r=t/n(Math.round(e(t)));return r*a<a-.5&&(r*=a),r<=o?i(t):""}},r.nice=function(){return i(Sg(i(),{floor:function(t){return n(Math.floor(e(t)))},ceil:function(t){return n(Math.ceil(e(t)))}}))},r}function Ug(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function Lg(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function $g(t){var e=1,n=t(Ug(e),Lg(e));return n.constant=function(n){return arguments.length?t(Ug(e=+n),Lg(e)):e},Fg(n)}function Pg(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function jg(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function Ig(t){return t<0?-t*t:t*t}function Wg(t){var e=t(bg,bg),n=1;function r(){return 1===n?t(bg,bg):.5===n?t(jg,Ig):t(Pg(n),Pg(1/n))}return e.exponent=function(t){return arguments.length?(n=+t,r()):n},Fg(e)}function Hg(){var t=Wg(Eg());return t.copy=function(){return Mg(t,Hg()).exponent(t.exponent())},wd.apply(t,arguments),t}function Yg(t){return new Date(t)}function Vg(t){return t instanceof Date?+t:+new Date(+t)}function Gg(t,e,n,r,i,a,o,u,s){var l=Dg(),c=l.invert,f=l.domain,h=s(".%L"),d=s(":%S"),p=s("%I:%M"),g=s("%I %p"),m=s("%a %d"),v=s("%b %d"),y=s("%B"),_=s("%Y"),x=[[o,1,1e3],[o,5,5e3],[o,15,15e3],[o,30,3e4],[a,1,6e4],[a,5,3e5],[a,15,9e5],[a,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[e,1,2592e6],[e,3,7776e6],[t,1,31536e6]];function b(u){return(o(u)<u?h:a(u)<u?d:i(u)<u?p:r(u)<u?g:e(u)<u?n(u)<u?m:v:t(u)<u?y:_)(u)}function w(e,n,r){if(null==e&&(e=10),"number"==typeof e){var i,a=Math.abs(r-n)/e,o=je((function(t){return t[2]})).right(x,a);return o===x.length?(i=Qe(n/31536e6,r/31536e6,e),e=t):o?(i=(o=x[a/x[o-1][2]<x[o][2]/a?o-1:o])[1],e=o[0]):(i=Math.max(Qe(n,r,e),1),e=u),e.every(i)}return e}return l.invert=function(t){return new Date(c(t))},l.domain=function(t){return arguments.length?f(Array.from(t,Vg)):f().map(Yg)},l.ticks=function(t){var e,n=f(),r=n[0],i=n[n.length-1],a=i<r;return a&&(e=r,r=i,i=e),e=(e=w(t,r,i))?e.range(r,i+1):[],a?e.reverse():e},l.tickFormat=function(t,e){return null==e?b:s(e)},l.nice=function(t){var e=f();return(t=w(t,e[0],e[e.length-1]))?f(Sg(e,t)):l},l.copy=function(){return Mg(l,Gg(t,e,n,r,i,a,o,u,s))},l}function Xg(){var t,e,n,r,i,a=0,o=1,u=bg,s=!1;function l(e){return isNaN(e=+e)?i:u(0===n?.5:(e=(r(e)-t)*n,s?Math.max(0,Math.min(1,e)):e))}function c(t){return function(e){var n,r;return arguments.length?([n,r]=e,u=t(n,r),l):[u(0),u(1)]}}return l.domain=function(i){return arguments.length?([a,o]=i,t=r(a=+a),e=r(o=+o),n=t===e?0:1/(e-t),l):[a,o]},l.clamp=function(t){return arguments.length?(s=!!t,l):s},l.interpolator=function(t){return arguments.length?(u=t,l):u},l.range=c(Gp),l.rangeRound=c(Xp),l.unknown=function(t){return arguments.length?(i=t,l):i},function(i){return r=i,t=i(a),e=i(o),n=t===e?0:1/(e-t),l}}function Jg(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function Zg(){var t=Fg(Xg()(bg));return t.copy=function(){return Jg(t,Zg())},kd.apply(t,arguments)}function Qg(){var t=Wg(Xg());return t.copy=function(){return Jg(t,Qg()).exponent(t.exponent())},kd.apply(t,arguments)}function Kg(){var t,e,n,r,i,a,o,u=0,s=.5,l=1,c=1,f=bg,h=!1;function d(t){return isNaN(t=+t)?o:(t=.5+((t=+a(t))-e)*(c*t<c*e?r:i),f(h?Math.max(0,Math.min(1,t)):t))}function p(t){return function(e){var n,r,i;return arguments.length?([n,r,i]=e,f=vg(t,[n,r,i]),d):[f(0),f(.5),f(1)]}}return d.domain=function(o){return arguments.length?([u,s,l]=o,t=a(u=+u),e=a(s=+s),n=a(l=+l),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),c=e<t?-1:1,d):[u,s,l]},d.clamp=function(t){return arguments.length?(h=!!t,d):h},d.interpolator=function(t){return arguments.length?(f=t,d):f},d.range=p(Gp),d.rangeRound=p(Xp),d.unknown=function(t){return arguments.length?(o=t,d):o},function(o){return a=o,t=o(u),e=o(s),n=o(l),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),c=e<t?-1:1,d}}function tm(){var t=Wg(Kg());return t.copy=function(){return Jg(t,tm()).exponent(t.exponent())},kd.apply(t,arguments)}function em(){var t,e,n=Md().unknown(void 0),r=n.domain,i=n.range,a=[0,1],o=!1,u=0,s=0,l=.5;function c(){var n=r().length,c=a[1]<a[0],f=a[c-0],h=a[1-c],d=vd(n,u,s);t=(h-f)/(d||1),o&&(t=Math.floor(t)),f+=(h-f-t*(n-u))*l,e=t*(1-u),o&&(f=Math.round(f),e=Math.round(e));var p=Ye(n).map((function(e){return f+t*e}));return i(c?p.reverse():p)}return delete n.unknown,n.domain=function(t){return arguments.length?(r(t),c()):r()},n.range=function(t){return arguments.length?(a=[+t[0],+t[1]],c()):a.slice()},n.rangeRound=function(t){return a=[+t[0],+t[1]],o=!0,c()},n.bandwidth=function(){return e},n.step=function(){return t},n.round=function(t){return arguments.length?(o=!!t,c()):o},n.padding=function(t){return arguments.length?(s=Math.max(0,Math.min(1,t)),u=s,c()):u},n.paddingInner=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),c()):u},n.paddingOuter=function(t){return arguments.length?(s=Math.max(0,Math.min(1,t)),c()):s},n.align=function(t){return arguments.length?(l=Math.max(0,Math.min(1,t)),c()):l},n.invertRange=function(t){if(null!=t[0]&&null!=t[1]){var n,o,u,s=+t[0],l=+t[1],c=a[1]<a[0],f=c?i().reverse():i(),h=f.length-1;if(s==s&&l==l&&(l<s&&(u=s,s=l,l=u),!(l<f[0]||s>a[1-c])))return n=Math.max(0,We(f,s)-1),o=s===l?n:We(f,l)-1,s-f[n]>e+1e-10&&++n,c&&(u=n,n=h-o,o=h-u),n>o?void 0:r().slice(n,o+1)}},n.invert=function(t){var e=n.invertRange([t,t]);return e?e[0]:e},n.copy=function(){return em().domain(r()).range(a).round(o).paddingInner(u).paddingOuter(s).align(l)},c()}var nm=Array.prototype.map;function rm(t){return nm.call(t,(function(t){return+t}))}var im=Array.prototype.slice;const am={};function om(t,e,n){const r=function(){var n=e();return n.invertRange||(n.invertRange=n.invert?function(t){return function(e){var n,r=e[0],i=e[1];return i<r&&(n=r,r=i,i=n),[t.invert(r),t.invert(i)]}}(n):n.invertExtent?function(t){return function(e){var n,r,i,a,o=t.range(),u=e[0],s=e[1],l=-1;for(s<u&&(r=u,u=s,s=r),i=0,a=o.length;i<a;++i)o[i]>=u&&o[i]<=s&&(l<0&&(l=i),n=i);if(!(l<0))return u=t.invertExtent(o[l]),s=t.invertExtent(o[n]),[void 0===u[0]?u[1]:u[0],void 0===s[1]?s[0]:s[1]]}}(n):void 0),n.type=t,n};return r.metadata=Dt(W(n)),r}function um(t,e,n){return arguments.length>1?(am[t]=om(t,e,n),this):sm(t)?am[t]:void 0}function sm(t){return it(am,t)}function lm(t,e){const n=am[t];return n&&n.metadata[e]}function cm(t){return lm(t,bd)}function fm(t){return lm(t,"discrete")}function hm(t){return lm(t,"discretizing")}function dm(t){return lm(t,yd)}function pm(t){return lm(t,"interpolating")}function gm(t){return lm(t,"quantile")}um("identity",(function t(e){var n;function r(t){return isNaN(t=+t)?n:t}return r.invert=r,r.domain=r.range=function(t){return arguments.length?(e=Array.from(t,_g),r):e.slice()},r.unknown=function(t){return arguments.length?(n=t,r):n},r.copy=function(){return t(e).unknown(n)},e=arguments.length?Array.from(e,_g):[0,1],Fg(r)})),um("linear",(function t(){var e=Dg();return e.copy=function(){return Mg(e,t())},wd.apply(e,arguments),Fg(e)}),bd),um(yd,(function t(){var e=qg(Eg()).domain([1,10]);return e.copy=function(){return Mg(e,t()).base(e.base())},wd.apply(e,arguments),e}),[bd,yd]),um("pow",Hg,bd),um("sqrt",(function(){return Hg.apply(null,arguments).exponent(.5)}),bd),um("symlog",(function t(){var e=$g(Eg());return e.copy=function(){return Mg(e,t()).constant(e.constant())},wd.apply(e,arguments)}),bd),um(_d,(function(){return wd.apply(Gg(rr,nr,Kn,Zn,Jn,Xn,Gn,Vn,ai).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[bd,"temporal"]),um(xd,(function(){return wd.apply(Gg(hr,fr,sr,or,ar,ir,Gn,Vn,ui).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[bd,"temporal"]),um("sequential",Zg,[bd,"interpolating"]),um("sequential-linear",Zg,[bd,"interpolating"]),um("sequential-log",(function t(){var e=qg(Xg()).domain([1,10]);return e.copy=function(){return Jg(e,t()).base(e.base())},kd.apply(e,arguments)}),[bd,"interpolating",yd]),um("sequential-pow",Qg,[bd,"interpolating"]),um("sequential-sqrt",(function(){return Qg.apply(null,arguments).exponent(.5)}),[bd,"interpolating"]),um("sequential-symlog",(function t(){var e=$g(Xg());return e.copy=function(){return Jg(e,t()).constant(e.constant())},kd.apply(e,arguments)}),[bd,"interpolating"]),um("diverging-linear",(function t(){var e=Fg(Kg()(bg));return e.copy=function(){return Jg(e,t())},kd.apply(e,arguments)}),[bd,"interpolating"]),um("diverging-log",(function t(){var e=qg(Kg()).domain([.1,1,10]);return e.copy=function(){return Jg(e,t()).base(e.base())},kd.apply(e,arguments)}),[bd,"interpolating",yd]),um("diverging-pow",tm,[bd,"interpolating"]),um("diverging-sqrt",(function(){return tm.apply(null,arguments).exponent(.5)}),[bd,"interpolating"]),um("diverging-symlog",(function t(){var e=$g(Kg());return e.copy=function(){return Jg(e,t()).constant(e.constant())},kd.apply(e,arguments)}),[bd,"interpolating"]),um("quantile",(function t(){var e,n=[],r=[],i=[];function a(){var t=0,e=Math.max(1,r.length);for(i=new Array(e-1);++t<e;)i[t-1]=rn(n,t/e);return o}function o(t){return isNaN(t=+t)?e:r[We(i,t)]}return o.invertExtent=function(t){var e=r.indexOf(t);return e<0?[NaN,NaN]:[e>0?i[e-1]:n[0],e<i.length?i[e]:n[n.length-1]]},o.domain=function(t){if(!arguments.length)return n.slice();n=[];for(let e of t)null==e||isNaN(e=+e)||n.push(e);return n.sort(Pe),a()},o.range=function(t){return arguments.length?(r=Array.from(t),a()):r.slice()},o.unknown=function(t){return arguments.length?(e=t,o):e},o.quantiles=function(){return i.slice()},o.copy=function(){return t().domain(n).range(r).unknown(e)},wd.apply(o,arguments)}),["discretizing","quantile"]),um("quantize",(function t(){var e,n=0,r=1,i=1,a=[.5],o=[0,1];function u(t){return t<=t?o[We(a,t,0,i)]:e}function s(){var t=-1;for(a=new Array(i);++t<i;)a[t]=((t+1)*r-(t-i)*n)/(i+1);return u}return u.domain=function(t){return arguments.length?([n,r]=t,n=+n,r=+r,s()):[n,r]},u.range=function(t){return arguments.length?(i=(o=Array.from(t)).length-1,s()):o.slice()},u.invertExtent=function(t){var e=o.indexOf(t);return e<0?[NaN,NaN]:e<1?[n,a[0]]:e>=i?[a[i-1],r]:[a[e-1],a[e]]},u.unknown=function(t){return arguments.length?(e=t,u):u},u.thresholds=function(){return a.slice()},u.copy=function(){return t().domain([n,r]).range(o).unknown(e)},wd.apply(Fg(u),arguments)}),"discretizing"),um("threshold",(function t(){var e,n=[.5],r=[0,1],i=1;function a(t){return t<=t?r[We(n,t,0,i)]:e}return a.domain=function(t){return arguments.length?(n=Array.from(t),i=Math.min(n.length,r.length-1),a):n.slice()},a.range=function(t){return arguments.length?(r=Array.from(t),i=Math.min(n.length,r.length-1),a):r.slice()},a.invertExtent=function(t){var e=r.indexOf(t);return[n[e-1],n[e]]},a.unknown=function(t){return arguments.length?(e=t,a):e},a.copy=function(){return t().domain(n).range(r).unknown(e)},wd.apply(a,arguments)}),"discretizing"),um("bin-ordinal",(function t(){var e=[],n=[];function r(t){return null==t||t!=t?void 0:n[(We(e,t)-1)%n.length]}return r.domain=function(t){return arguments.length?(e=rm(t),r):e.slice()},r.range=function(t){return arguments.length?(n=im.call(t),r):n.slice()},r.tickFormat=function(t,n){return Cg(e[0],M(e),null==t?10:t,n)},r.copy=function(){return t().domain(r.domain()).range(r.range())},r}),["discrete","discretizing"]),um("ordinal",Md,"discrete"),um("band",em,"discrete"),um("point",(function(){return function t(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return t(n())},e}(em().paddingInner(1))}),"discrete");const mm=["clamp","base","constant","exponent"];function vm(t,e){var n=e[0],r=M(e)-n;return function(e){return t(n+e*r)}}function ym(t,e,n){return vg(bm(e||"rgb",n),t)}function _m(t,e){for(var n=new Array(e),r=e+1,i=0;i<e;)n[i]=t(++i/r);return n}function xm(t,e,n){var r,i,a,o=n-e;return o&&Number.isFinite(o)?(r=(i=t.type).indexOf("-"),i=r<0?i:i.slice(r+1),a=um(i)().domain([e,n]).range([0,1]),mm.forEach(e=>t[e]?a[e](t[e]()):0),a):Q(.5)}function bm(t,e){var n=yg[function(t){return"interpolate"+t.toLowerCase().split("-").map((function(t){return t[0].toUpperCase()+t.slice(1)})).join("")}(t)];return null!=e&&n&&n.gamma?n.gamma(e):n}function wm(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}function km(t,e){for(let n in t)Mm(n,e(t[n]))}const Am={};function Mm(t,e){return t=t&&t.toLowerCase(),arguments.length>1?(Am[t]=e,this):Am[t]}km({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},wm),km({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},t=>ym(wm(t)));const Em=t=>_(t)?t.map(t=>String(t)):String(t),Dm=(t,e)=>t[1]-e[1],Cm=(t,e)=>e[1]-t[1];function Fm(t,e,n){var r;return ht(e)&&(t.bins&&(e=Math.max(e,t.bins.length)),null!=n&&(e=Math.min(e,Math.floor(bt(t.domain())/n||1)))),x(e)&&(r=e.step,e=e.interval),pt(e)&&(e=t.type===_d?qr(e):t.type==xd?Ur(e):u("Only time and utc scales accept interval strings."),r&&(e=e.every(r))),e}function Sm(t,e,n){let r=t.range(),i=r[0],a=M(r),o=Dm;if(i>a&&(r=a,a=i,i=r,o=Cm),i=Math.floor(i),a=Math.ceil(a),e=e.map(e=>[e,t(e)]).filter(t=>i<=t[1]&&t[1]<=a).sort(o).map(t=>t[0]),n>0&&e.length>1){const t=[e[0],M(e)];for(;e.length>n&&e.length>=3;)e=e.filter((t,e)=>!(e%2));e.length<3&&(e=t)}return e}function Bm(t,e){return t.bins?Sm(t,t.bins):t.ticks?t.ticks(e):t.domain()}function Tm(t,e,n,r,i,a){var o=e.type;let u=Em;if(o===_d||i===_d)u=t.timeFormat(r);else if(o===xd||i===xd)u=t.utcFormat(r);else if(dm(o)){const i=t.formatFloat(r);if(a||e.bins)u=i;else{const t=zm(e,n,!1);u=e=>t(e)?i(e):""}}else if(e.tickFormat){const i=e.domain();u=t.formatSpan(i[0],i[i.length-1],n,r)}else r&&(u=t.format(r));return u}function zm(t,e,n){const r=Bm(t,e),i=t.base(),a=Math.log(i),o=Math.max(1,i*e/r.length),u=t=>{let e=t/Math.pow(i,Math.round(Math.log(t)/a));return e*i<i-.5&&(e*=i),e<=o};return n?r.filter(u):u}const Nm={quantile:"quantiles",quantize:"thresholds",threshold:"domain"},Om={quantile:"quantiles",quantize:"domain"};function Rm(t,e){return t.bins?function(t){const e=t.slice(0,-1);return e.max=M(t),e}(t.bins):t.type===yd?zm(t,e,!0):Nm[t.type]?function(t){const e=[-1/0].concat(t);return e.max=1/0,e}(t[Nm[t.type]]()):Bm(t,e)}function qm(t,e,n,r,i,a,o){const u=Om[e.type]&&a!==_d&&a!==xd?function(t,e,n){var r,i=e[Om[e.type]](),a=i.length,o=a>1?i[1]-i[0]:i[0];for(r=1;r<a;++r)o=Math.min(o,i[r]-i[r-1]);return t.formatSpan(0,o,30,n)}(t,e,i):Tm(t,e,n,i,a,o);return"symbol"===r&&function(t){return Nm[t.type]||t.bins}(e)?function(t){return(e,n,r)=>{var i=Um(r[n+1],Um(r.max,1/0)),a=Lm(e,t),o=Lm(i,t);return a&&o?a+" 
 "+o:o?"< "+o:"
 "+a}}(u):"discrete"===r?function(t){return(e,n)=>n?t(e):null}(u):function(t){return e=>t(e)}(u)}function Um(t,e){return null!=t?t:e}function Lm(t,e){return Number.isFinite(t)?e(t):null}function $m(t,e,n,r){const i=r||e.type;return pt(n)&&function(t){return lm(t,"temporal")}(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==_d?n||i!==xd?qm(t,e,5,null,n,r,!0):t.utcFormat("%A, %d %B %Y, %X UTC"):t.timeFormat("%A, %d %B %Y, %X")}function Pm(t,e,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=$m(t,e,n.format,n.formatType);if(hm(e.type)){const t=Rm(e).slice(1).map(i),n=t.length;return`${n} boundar${1===n?"y":"ies"}: ${t.join(", ")}`}if(fm(e.type)){const t=e.domain(),n=t.length;return`${n} value${1===n?"":"s"}: ${n>r?t.slice(0,r-2).map(i).join(", ")+", ending with "+t.slice(-1).map(i):t.map(i).join(", ")}`}{const t=e.domain();return`values from ${i(t[0])} to ${i(M(t))}`}}const jm=(t,e,n)=>({role:t,"aria-roledescription":e,"aria-label":n||void 0}),Im=Dt(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),Wm={axis:{desc:"axis",caption:function(t){const e=t.datum,n=t.orient,r=e.title?Xm(t):null,i=t.context,a=i.scales[e.scale].value,o=i.dataflow.locale(),u=a.type;return("left"===n||"right"===n?"Y":"X")+"-axis"+(r?` titled '${r}'`:"")+` for a ${fm(u)?"discrete":u} scale with `+Pm(o,a,t)}},legend:{desc:"legend",caption:function(t){const e=t.datum,n=e.title?Xm(t):null,r=((e.type||"")+" legend").trim(),i=e.scales,a=Object.keys(i),o=t.context,u=o.scales[i[a[0]]].value,s=o.dataflow.locale();return l=r,(l.length?l[0].toUpperCase()+l.slice(1):l)+(n?` titled '${n}'`:"")+" for "+function(t){return(t=t.map(t=>t+("fill"===t||"stroke"===t?" color":""))).length<2?t[0]:t.slice(0,-1).join(", ")+" and "+M(t)}(a)+" with "+Pm(s,u,t);var l}},"title-text":{desc:"title",caption:t=>`Title text '${Gm(t)}'`},"title-subtitle":{desc:"subtitle",caption:t=>`Subtitle text '${Gm(t)}'`}},Hm={ariaRole:"role",ariaRoleDescription:"aria-roledescription",description:"aria-label"};function Ym(t,e){const n=!1===e.aria;if(t("aria-hidden",n||void 0),n||null==e.description)for(const e in Hm)t(Hm[e],void 0);else{const n=e.mark.marktype;t("aria-label",e.description),t("role",e.ariaRole||("group"===n?"graphics-object":"graphics-symbol")),t("aria-roledescription",e.ariaRoleDescription||n+" mark")}}function Vm(t){return!1===t.aria?{"aria-hidden":!0}:Im[t.role]?null:Wm[t.role]?function(t,e){try{const n=t.items[0],r=e.caption||(()=>"");return jm(e.role||"graphics-symbol",e.desc,n.description||r(n))}catch(t){return null}}(t,Wm[t.role]):function(t){const e=t.marktype,n="group"===e||"text"===e||t.items.some(t=>null!=t.description&&!1!==t.aria);return jm(n?"graphics-object":"graphics-symbol",e+" mark container",t.description)}(t)}function Gm(t){return W(t.text).join(" ")}function Xm(t){try{return W(M(t.items).items[0].text).join(" ")}catch(t){return null}}const Jm=t=>(t+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;");function Zm(t,e,n){var r,i,a="<"+t;if(e)for(r in e)null!=(i=e[r])&&(a+=" "+r+'="'+Jm(i)+'"');return n&&(a+=" "+n),a+">"}function Qm(t){return"</"+t+">"}const Km={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},tv={fill:"none","stroke-miterlimit":10},ev=Gf.xmlns;function nv(t){Gh.call(this,t),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}var rv=st(nv,Gh),iv=Gh.prototype;function av(t,e,n){var r,i,a;if("radial"===e.gradient){var o=Ph(t,n++,"pattern",ev);o.setAttribute("id","p_"+e.id),o.setAttribute("viewBox","0,0,1,1"),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("preserveAspectRatio","xMidYMid slice"),(o=Ph(o,0,"rect",ev)).setAttribute("width","1"),o.setAttribute("height","1"),o.setAttribute("fill","url("+gv()+"#"+e.id+")"),(t=Ph(t,n++,"radialGradient",ev)).setAttribute("id",e.id),t.setAttribute("fx",e.x1),t.setAttribute("fy",e.y1),t.setAttribute("fr",e.r1),t.setAttribute("cx",e.x2),t.setAttribute("cy",e.y2),t.setAttribute("r",e.r2)}else(t=Ph(t,n++,"linearGradient",ev)).setAttribute("id",e.id),t.setAttribute("x1",e.x1),t.setAttribute("x2",e.x2),t.setAttribute("y1",e.y1),t.setAttribute("y2",e.y2);for(r=0,i=e.stops.length;r<i;++r)(a=Ph(t,r,"stop",ev)).setAttribute("offset",e.stops[r].offset),a.setAttribute("stop-color",e.stops[r].color);return jh(t,r),n}function ov(t,e,n){var r;return(t=Ph(t,n,"clipPath",ev)).setAttribute("id",e.id),e.path?(r=Ph(t,0,"path",ev)).setAttribute("d",e.path):((r=Ph(t,0,"rect",ev)).setAttribute("x",0),r.setAttribute("y",0),r.setAttribute("width",e.width),r.setAttribute("height",e.height)),jh(t,1),n+1}function uv(t,e){for(;t&&t.dirty!==e;t=t.mark.group){if(t.dirty=e,!t.mark||t.mark.dirty===e)return;t.mark.dirty=e}}function sv(t,e,n,r,i){let a,o=t._svg;if(!o&&(a=e.ownerDocument,o=Lh(a,r,ev),t._svg=o,t.mark&&(o.__data__=t,o.__values__={fill:"default"},"g"===r))){const e=Lh(a,"path",ev);o.appendChild(e),e.__data__=t;const n=Lh(a,"g",ev);o.appendChild(n),n.__data__=t;const r=Lh(a,"path",ev);o.appendChild(r),r.__data__=t,r.__values__={fill:"default"}}return(o.ownerSVGElement!==i||function(t,e){return t.parentNode&&t.parentNode.childNodes.length>1&&t.previousSibling!=e}(o,n))&&e.insertBefore(o,n?n.nextSibling:e.firstChild),o}rv.initialize=function(t,e,n,r){if(this._defs={gradient:{},clipping:{}},t){this._svg=Ph(t,0,"svg",ev),this._svg.setAttribute("class","marks"),jh(t,1),this._root=Ph(this._svg,0,"g",ev);for(const t in tv)this._root.setAttribute(t,tv[t]);jh(this._svg,1)}return this.background(this._bgcolor),iv.initialize.call(this,t,e,n,r)},rv.background=function(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),iv.background.apply(this,arguments)},rv.resize=function(t,e,n,r){return iv.resize.call(this,t,e,n,r),this._svg&&(this._svg.setAttribute("width",this._width*this._scale),this._svg.setAttribute("height",this._height*this._scale),this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height),this._root.setAttribute("transform","translate("+this._origin+")")),this._dirty=[],this},rv.canvas=function(){return this._svg},rv.svg=function(){if(!this._svg)return null;var t={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var e in Gf)t[e]=Gf[e];var n=this._bgcolor?Zm("rect",{width:this._width,height:this._height,fill:this._bgcolor})+Qm("rect"):"";return Zm("svg",t)+(this._defs.el?this._defs.el.outerHTML:"")+n+this._root.outerHTML+Qm("svg")},rv._render=function(t){return this._dirtyCheck()&&(this._dirtyAll&&this._resetDefs(),this.draw(this._root,t),jh(this._root,1)),this.updateDefs(),this._dirty=[],++this._dirtyID,this},rv.updateDefs=function(){const t=this._svg,e=this._defs;let n=e.el,r=0;for(const i in e.gradient)n||(e.el=n=Ph(t,0,"defs",ev)),r=av(n,e.gradient[i],r);for(const i in e.clipping)n||(e.el=n=Ph(t,0,"defs",ev)),r=ov(n,e.clipping[i],r);n&&(0===r?(t.removeChild(n),e.el=null):jh(n,r))},rv._resetDefs=function(){var t=this._defs;t.gradient={},t.clipping={}},rv.dirty=function(t){t.dirty!==this._dirtyID&&(t.dirty=this._dirtyID,this._dirty.push(t))},rv.isDirty=function(t){return this._dirtyAll||!t._svg||t.dirty===this._dirtyID},rv._dirtyCheck=function(){this._dirtyAll=!0;var t=this._dirty;if(!t.length||!this._dirtyID)return!0;var e,n,r,i,a,o,u,s=++this._dirtyID;for(a=0,o=t.length;a<o;++a)(n=(e=t[a]).mark).marktype!==r&&(r=n.marktype,i=Fh[r]),n.zdirty&&n.dirty!==s&&(this._dirtyAll=!1,uv(e,s),n.items.forEach((function(t){t.dirty=s}))),n.zdirty||(e.exit?(i.nested&&n.items.length?(u=n.items[0])._svg&&this._update(i,u._svg,u):e._svg&&(u=e._svg.parentNode)&&u.removeChild(e._svg),e._svg=null):(e=i.nested?n.items[0]:e)._update!==s&&(e._svg&&e._svg.ownerSVGElement?this._update(i,e._svg,e):(this._dirtyAll=!1,uv(e,s)),e._update=s));return!this._dirtyAll},rv.draw=function(t,e,n){if(!this.isDirty(e))return e._svg;var r,i=this._svg,a=Fh[e.marktype],o=!1===e.interactive?"none":null,u="g"===a.tag,s=null,l=0;(r=sv(e,t,n,"g",i)).setAttribute("class",Ih(e));const c=Vm(e);for(const t in c)pv(r,t,c[t]);u||pv(r,"pointer-events",o),pv(r,"clip-path",e.clip?qc(this,e,e.group):null);const f=t=>{const e=this.isDirty(t),n=sv(t,r,s,a.tag,i);e&&(this._update(a,n,t),u&&function(t,e,n){e=e.lastChild.previousSibling;let r,i=0;Mf(n,n=>{r=t.draw(e,n,r),++i}),jh(e,1+i)}(this,n,t)),s=n,++l};return a.nested?e.items.length&&f(e.items[0]):Mf(e,f),jh(r,l),r};var lv=null,cv=null,fv={group:function(t,e,n){const r=lv=e.childNodes[2];cv=r.__values__,t.foreground(dv,n,this),cv=e.__values__,lv=e.childNodes[1],t.content(dv,n,this);const i=lv=e.childNodes[0];t.background(dv,n,this);const a=!1===n.mark.interactive?"none":null;if(a!==cv.events&&(pv(r,"pointer-events",a),pv(i,"pointer-events",a),cv.events=a),n.strokeForeground&&n.stroke){const t=n.fill;pv(r,"display",null),this.style(i,n),pv(i,"stroke",null),t&&(n.fill=null),cv=r.__values__,this.style(r,n),t&&(n.fill=t),lv=null}else pv(r,"display","none")},image:function(t,e,n){!1===n.smooth?(hv(e,"image-rendering","optimizeSpeed"),hv(e,"image-rendering","pixelated")):hv(e,"image-rendering",null)},text:function(t,e,n){let r,i,a,o,u=_h(n);_(u)?(i=u.map(t=>bh(n,t)),r=i.join("\n"),r!==cv.text&&(jh(e,0),a=e.ownerDocument,o=yh(n),i.forEach((t,r)=>{const i=Lh(a,"tspan",ev);i.__data__=n,i.textContent=t,r&&(i.setAttribute("x",0),i.setAttribute("dy",o)),e.appendChild(i)}),cv.text=r)):(i=bh(n,u),i!==cv.text&&(e.textContent=i,cv.text=i)),pv(e,"font-family",wh(n)),pv(e,"font-size",vh(n)+"px"),pv(e,"font-style",n.fontStyle),pv(e,"font-variant",n.fontVariant),pv(e,"font-weight",n.fontWeight)}};function hv(t,e,n){n!==cv[e]&&(null==n?t.style.removeProperty(e):t.style.setProperty(e,n+""),cv[e]=n)}function dv(t,e,n){e!==cv[t]&&(n?function(t,e,n,r){null!=n?t.setAttributeNS(r,e,n):t.removeAttributeNS(r,e)}(lv,t,e,n):pv(lv,t,e),cv[t]=e)}function pv(t,e,n){null!=n?t.setAttribute(e,n):t.removeAttribute(e)}function gv(){let t;return"undefined"==typeof window?"":(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}function mv(t){Gh.call(this,t),this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""},this._defs={gradient:{},clipping:{}}}rv._update=function(t,e,n){lv=e,cv=e.__values__,Ym(dv,n),t.attr(dv,n,this);const r=fv[t.type];r&&r.call(this,t,e,n),lv&&this.style(lv,n)},rv.style=function(t,e){if(null!=e)for(const n in Km){let r="font"===n?wh(e):e[n];if(r===cv[n])continue;const i=Km[n];null==r?t.removeAttribute(i):(Ts(r)&&(r=zs(r,this._defs.gradient,gv())),t.setAttribute(i,r+"")),cv[n]=r}};var vv=st(mv,Gh),yv=Gh.prototype;function _v(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}vv.resize=function(t,e,n,r){yv.resize.call(this,t,e,n,r);var i=this._origin,a=this._text,o={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var u in Gf)o[u]=Gf[u];a.head=Zm("svg",o);var s=this._bgcolor;return"transparent"!==s&&"none"!==s||(s=null),a.bg=s?Zm("rect",{width:this._width,height:this._height,fill:s})+Qm("rect"):"",a.root=Zm("g",tt({},tv,{transform:"translate("+i+")"})),a.foot=Qm("g")+Qm("svg"),this},vv.background=function(){var t=yv.background.apply(this,arguments);return arguments.length&&this._text.head&&this.resize(this._width,this._height,this._origin,this._scale),t},vv.svg=function(){var t=this._text;return t.head+t.defs+t.bg+t.root+t.body+t.foot},vv._render=function(t){return this._text.body=this.mark(t),this._text.defs=this.buildDefs(),this},vv.buildDefs=function(){let t,e="";for(const n in this._defs.gradient){const r=this._defs.gradient[n],i=r.stops;"radial"===r.gradient?(e+=Zm(t="pattern",{id:"p_"+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e+=Zm("rect",{width:"1",height:"1",fill:"url(#"+n+")"})+Qm("rect"),e+=Qm(t),e+=Zm(t="radialGradient",{id:n,fx:r.x1,fy:r.y1,fr:r.r1,cx:r.x2,cy:r.y2,r:r.r2})):e+=Zm(t="linearGradient",{id:n,x1:r.x1,x2:r.x2,y1:r.y1,y2:r.y2});for(let t=0;t<i.length;++t)e+=Zm("stop",{offset:i[t].offset,"stop-color":i[t].color})+Qm("stop");e+=Qm(t)}for(const t in this._defs.clipping){const n=this._defs.clipping[t];e+=Zm("clipPath",{id:t}),n.path?e+=Zm("path",{d:n.path})+Qm("path"):e+=Zm("rect",{x:0,y:0,width:n.width,height:n.height})+Qm("rect"),e+=Qm("clipPath")}return e?Zm("defs")+e+Qm("defs"):""},vv.attr=function(t,e,n,r){const i={},a=(t,e,n,r)=>{i[r||t]=e};return Array.isArray(n)?n.forEach(t=>t(a,e,this)):n(a,e,this),r&&function(t,e,n,r,i){if(null==e)return t;"bgrect"===r&&!1===n.interactive&&(t["pointer-events"]="none");if("bgfore"===r&&(!1===n.interactive&&(t["pointer-events"]="none"),t.display="none",null!==e.fill))return t;"image"===r&&!1===e.smooth&&(t.style="image-rendering: optimizeSpeed; image-rendering: pixelated;");"text"===r&&(t["font-family"]=wh(e),t["font-size"]=vh(e)+"px",e.fontStyle&&(t["font-style"]=e.fontStyle),e.fontVariant&&(t["font-variant"]=e.fontVariant),e.fontWeight&&(t["font-weight"]=e.fontWeight));for(const n in Km){let r=e[n];const a=Km[n];("transparent"!==r||"fill"!==a&&"stroke"!==a)&&null!=r&&(Ts(r)&&(r=zs(r,i.gradient,"")),t[a]=r)}}(i,e,t,r,this._defs),i},vv.href=function(t){var e,n=this,r=t.href;if(r){if(e=n._hrefs&&n._hrefs[r])return e;n.sanitizeURL(r).then(t=>{t["xlink:href"]=t.href,t.href=null,(n._hrefs||(n._hrefs={}))[r]=t})}return null},vv.mark=function(t){const e=Fh[t.marktype],n=e.tag,r=[Ym,e.attr];let i="";i+=Zm("g",tt({class:Ih(t),"clip-path":t.clip?qc(this,t,t.group):null},Vm(t),{"pointer-events":"g"!==n&&!1===t.interactive?"none":null}));const a=a=>{const o=this.href(a);if(o&&(i+=Zm("a",o)),i+=Zm(n,this.attr(t,a,r,"g"!==n?n:null)),"text"===n){const t=_h(a);if(_(t)){const e={x:0,dy:yh(a)};for(let n=0;n<t.length;++n)i+=Zm("tspan",n?e:null)+_v(bh(a,t[n]))+Qm("tspan")}else i+=_v(bh(a,t))}else if("g"===n){const n=a.strokeForeground,r=a.fill,o=a.stroke;n&&o&&(a.stroke=null),i+=Zm("path",this.attr(t,a,e.background,"bgrect"))+Qm("path"),i+=Zm("g",this.attr(t,a,e.content))+this.markGroup(a)+Qm("g"),n&&o?(r&&(a.fill=null),a.stroke=o,i+=Zm("path",this.attr(t,a,e.foreground,"bgrect"))+Qm("path"),r&&(a.fill=r)):i+=Zm("path",this.attr(t,a,e.foreground,"bgfore"))+Qm("path")}i+=Qm(n),o&&(i+=Qm("a"))};return e.nested?t.items&&t.items.length&&a(t.items[0]):Mf(t,a),i+Qm("g")},vv.markGroup=function(t){let e="";return Mf(t,t=>{e+=this.mark(t)}),e};var xv={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},bv={};function wv(t,e){return t=String(t||"").toLowerCase(),arguments.length>1?(bv[t]=e,this):bv[t]}function kv(t,e,n){const r=[],i=(new Uc).union(e),a=t.marktype;return a?Av(t,i,n,r):"group"===a?Mv(t,i,n,r):u("Intersect scene must be mark node or group item.")}function Av(t,e,n,r){if(function(t,e,n){return t.bounds&&e.intersects(t.bounds)&&("group"===t.marktype||!1!==t.interactive&&(!n||n(t)))}(t,e,n)){const i=t.items,a=t.marktype,o=i.length;let u=0;if("group"===a)for(;u<o;++u)Mv(i[u],e,n,r);else for(const t=Fh[a].isect;u<o;++u){let n=i[u];Ev(n,e,t)&&r.push(n)}}return r}function Mv(t,e,n,r){n&&n(t.mark)&&Ev(t,e,Fh.group.isect)&&r.push(t);const i=t.items,a=i&&i.length;if(a){const o=t.x||0,u=t.y||0;e.translate(-o,-u);for(let t=0;t<a;++t)Av(i[t],e,n,r);e.translate(o,u)}return r}function Ev(t,e,n){const r=t.bounds;return e.encloses(r)||e.intersects(r)&&n(t,e)}bv.canvas=bv.png={renderer:fd,headless:fd,handler:ad},bv.svg={renderer:nv,headless:mv,handler:pd},bv.none={};var Dv=new Uc;function Cv(t){var e=t.clip;if(Y(e))e(Kc(Dv.clear()));else{if(!e)return;Dv.set(0,0,t.group.width,t.group.height)}t.bounds.intersect(Dv)}function Fv(t,e,n){return t===e||("path"===n?Sv(t,e):t instanceof Date&&e instanceof Date?+t==+e:ht(t)&&ht(e)?Math.abs(t-e)<=1e-9:t&&e&&(x(t)||x(e))?null!=t&&null!=e&&function(t,e){var n,r,i=Object.keys(t),a=Object.keys(e);if(i.length!==a.length)return!1;for(i.sort(),a.sort(),r=i.length-1;r>=0;r--)if(i[r]!=a[r])return!1;for(r=i.length-1;r>=0;r--)if(n=i[r],!Fv(t[n],e[n],n))return!1;return typeof t==typeof e}(t,e):t==e)}function Sv(t,e){return Fv(Jl(t),Jl(e))}function Bv(t){Xa.call(this,null,t)}function Tv(t,e,n){return e(t.bounds.clear(),t,n)}st(Bv,Xa).transform=function(t,e){var n,r=e.dataflow,i=t.mark,a=i.marktype,o=Fh[a],u=o.bound,s=i.bounds;if(o.nested)i.items.length&&r.dirty(i.items[0]),s=Tv(i,u),i.items.forEach((function(t){t.bounds.clear().union(s)}));else if("group"===a||t.modified())switch(e.visit(e.MOD,t=>r.dirty(t)),s.clear(),i.items.forEach(t=>s.union(Tv(t,u))),i.role){case"axis":case"legend":case"title":e.reflow()}else n=e.changed(e.REM),e.visit(e.ADD,t=>{s.union(Tv(t,u))}),e.visit(e.MOD,t=>{n=n||s.alignsWith(t.bounds),r.dirty(t),s.union(Tv(t,u))}),n&&(s.clear(),i.items.forEach(t=>s.union(t.bounds)));return Cv(i),e.modifies("bounds")};function zv(t){Xa.call(this,0,t)}function Nv(t){Xa.call(this,null,t)}function Ov(t){Xa.call(this,null,t)}zv.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},st(zv,Xa).transform=function(t,e){var n=function(t){var e=t._signals[":vega_identifier:"];e||(t._signals[":vega_identifier:"]=e=t.add(0));return e}(e.dataflow),r=n.value,i=t.as;return e.visit(e.ADD,t=>{t[i]||(t[i]=++r)}),n.set(this.value=r),e},st(Nv,Xa).transform=function(t,e){var n=this.value;n||((n=e.dataflow.scenegraph().mark(t.markdef,function(t){var e=t.groups,n=t.parent;return e&&1===e.size?e.get(Object.keys(e.object)[0]):e&&n?e.lookup(n):null}(t),t.index)).group.context=t.context,t.context.group||(t.context.group=n.group),n.source=this.source,n.clip=t.clip,n.interactive=t.interactive,this.value=n);var r="group"===n.marktype?Pc:$c;return e.visit(e.ADD,t=>r.call(t,n)),(t.modified("clip")||t.modified("interactive"))&&(n.clip=t.clip,n.interactive=!!t.interactive,n.zdirty=!0,e.reflow()),n.items=e.source,e};var Rv=st(Ov,Xa),qv={parity:t=>t.filter((t,e)=>e%2?t.opacity=0:1),greedy:(t,e)=>{var n;return t.filter((t,r)=>r&&Uv(n.bounds,t.bounds,e)?t.opacity=0:(n=t,1))}};function Uv(t,e,n){return n>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2)}function Lv(t,e){for(var n,r=1,i=t.length,a=t[0].bounds;r<i;a=n,++r)if(Uv(a,n=t[r].bounds,e))return!0}function $v(t){var e=t.bounds;return e.width()>1&&e.height()>1}function Pv(t){return t.forEach(t=>t.opacity=1),t}function jv(t,e){return t.reflow(e.modified()).modifies("opacity")}function Iv(t){Xa.call(this,null,t)}Rv.transform=function(t,e){var n,r,i,a=qv[t.method]||qv.parity,o=e.materialize(e.SOURCE).source,u=t.separation||0;if(o&&o.length){if(!t.method)return t.modified("method")&&(Pv(o),e=jv(e,t)),e;if((o=o.filter($v)).length){if(t.sort&&(o=o.slice().sort(t.sort)),n=Pv(o),e=jv(e,t),n.length>=3&&Lv(n,u)){do{n=a(n,u)}while(n.length>=3&&Lv(n,u));n.length<3&&!M(o).opacity&&(n.length>1&&(M(n).opacity=0),M(o).opacity=1)}return t.boundScale&&t.boundTolerance>=0&&(r=function(t,e,n){var r=t.range(),i=new Uc;return e===Es||"bottom"===e?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),t=>i.encloses(t.bounds)}(t.boundScale,t.boundOrient,+t.boundTolerance),o.forEach(t=>{r(t)||(t.opacity=0)})),i=n[0].mark.bounds.clear(),o.forEach(t=>{t.opacity&&i.union(t.bounds)}),e}}},st(Iv,Xa).transform=function(t,e){var n=e.dataflow;if(e.visit(e.ALL,t=>n.dirty(t)),e.fields&&e.fields.zindex){var r=e.source&&e.source[0];r&&(r.mark.zdirty=!0)}};const Wv=new Uc;function Hv(t,e,n){return t[e]===n?0:(t[e]=n,1)}function Yv(t){var e=t.items[0].orient;return e===Ds||e===Cs}function Vv(t,e,n,r){var i,a,o=e.items[0],u=o.datum,s=null!=o.translate?o.translate:.5,l=o.orient,c=function(t){var e=+t.grid;return[t.ticks?e++:-1,t.labels?e++:-1,e+ +t.domain]}(u),f=o.range,h=o.offset,d=o.position,p=o.minExtent,g=o.maxExtent,m=u.title&&o.items[c[2]].items[0],v=o.titlePadding,y=o.bounds,_=m&&xh(m),x=0,b=0;switch(Wv.clear().union(y),y.clear(),(i=c[0])>-1&&y.union(o.items[i].bounds),(i=c[1])>-1&&y.union(o.items[i].bounds),l){case Es:x=d||0,b=-h,a=Math.max(p,Math.min(g,-y.y1)),y.add(0,-a).add(f,0),m&&Gv(t,m,a,v,_,0,-1,y);break;case Ds:x=-h,b=d||0,a=Math.max(p,Math.min(g,-y.x1)),y.add(-a,0).add(0,f),m&&Gv(t,m,a,v,_,1,-1,y);break;case Cs:x=n+h,b=d||0,a=Math.max(p,Math.min(g,y.x2)),y.add(0,0).add(a,f),m&&Gv(t,m,a,v,_,1,1,y);break;case"bottom":x=d||0,b=r+h,a=Math.max(p,Math.min(g,y.y2)),y.add(0,0).add(f,a),m&&Gv(t,m,a,v,0,0,1,y);break;default:x=o.x,b=o.y}return Gc(y.translate(x,b),o),Hv(o,"x",x+s)|Hv(o,"y",b+s)&&(o.bounds=Wv,t.dirty(o),o.bounds=y,t.dirty(o)),o.mark.bounds.clear().union(y)}function Gv(t,e,n,r,i,a,o,u){const s=e.bounds;if(e.auto){const u=o*(n+i+r);let l=0,c=0;t.dirty(e),a?l=(e.x||0)-(e.x=u):c=(e.y||0)-(e.y=u),e.mark.bounds.clear().union(s.translate(-l,-c)),t.dirty(e)}u.union(s)}const Xv=(t,e)=>Math.floor(Math.min(t,e)),Jv=(t,e)=>Math.ceil(Math.max(t,e));function Zv(t){return(new Uc).set(0,0,t.width||0,t.height||0)}function Qv(t){var e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function Kv(t,e,n){var r=x(t)?t[e]:t;return null!=r?r:void 0!==n?n:0}function ty(t){return t<0?Math.ceil(-t):0}function ey(t,e,n){var r,i,a,o,u,s,l,c,f,h,d,p=!n.nodirty,g="flush"===n.bounds?Zv:Qv,m=Wv.set(0,0,0,0),v=Kv(n.align,"column"),y=Kv(n.align,Ss),_=Kv(n.padding,"column"),x=Kv(n.padding,Ss),b=n.columns||e.length,w=b<=0?1:Math.ceil(e.length/b),k=e.length,A=Array(k),M=Array(b),E=0,D=Array(k),C=Array(w),F=0,S=Array(k),B=Array(k),T=Array(k);for(i=0;i<b;++i)M[i]=0;for(i=0;i<w;++i)C[i]=0;for(i=0;i<k;++i)s=e[i],u=T[i]=g(s),s.x=s.x||0,S[i]=0,s.y=s.y||0,B[i]=0,a=i%b,o=~~(i/b),E=Math.max(E,l=Math.ceil(u.x2)),F=Math.max(F,c=Math.ceil(u.y2)),M[a]=Math.max(M[a],l),C[o]=Math.max(C[o],c),A[i]=_+ty(u.x1),D[i]=x+ty(u.y1),p&&t.dirty(e[i]);for(i=0;i<k;++i)i%b==0&&(A[i]=0),i<b&&(D[i]=0);if("each"===v)for(a=1;a<b;++a){for(d=0,i=a;i<k;i+=b)d<A[i]&&(d=A[i]);for(i=a;i<k;i+=b)A[i]=d+M[a-1]}else if("all"===v){for(d=0,i=0;i<k;++i)i%b&&d<A[i]&&(d=A[i]);for(i=0;i<k;++i)i%b&&(A[i]=d+E)}else for(v=!1,a=1;a<b;++a)for(i=a;i<k;i+=b)A[i]+=M[a-1];if("each"===y)for(o=1;o<w;++o){for(d=0,r=(i=o*b)+b;i<r;++i)d<D[i]&&(d=D[i]);for(i=o*b;i<r;++i)D[i]=d+C[o-1]}else if("all"===y){for(d=0,i=b;i<k;++i)d<D[i]&&(d=D[i]);for(i=b;i<k;++i)D[i]=d+F}else for(y=!1,o=1;o<w;++o)for(r=(i=o*b)+b;i<r;++i)D[i]+=C[o-1];for(f=0,i=0;i<k;++i)f=A[i]+(i%b?f:0),S[i]+=f-e[i].x;for(a=0;a<b;++a)for(h=0,i=a;i<k;i+=b)h+=D[i],B[i]+=h-e[i].y;if(v&&Kv(n.center,"column")&&w>1)for(i=0;i<k;++i)(f=(u="all"===v?E:M[i%b])-T[i].x2-e[i].x-S[i])>0&&(S[i]+=f/2);if(y&&Kv(n.center,Ss)&&1!==b)for(i=0;i<k;++i)(h=(u="all"===y?F:C[~~(i/b)])-T[i].y2-e[i].y-B[i])>0&&(B[i]+=h/2);for(i=0;i<k;++i)m.union(T[i].translate(S[i],B[i]));switch(f=Kv(n.anchor,"x"),h=Kv(n.anchor,"y"),Kv(n.anchor,"column")){case Fs:f-=m.width();break;case"middle":f-=m.width()/2}switch(Kv(n.anchor,Ss)){case Fs:h-=m.height();break;case"middle":h-=m.height()/2}for(f=Math.round(f),h=Math.round(h),m.clear(),i=0;i<k;++i)e[i].mark.bounds.clear();for(i=0;i<k;++i)(s=e[i]).x+=S[i]+=f,s.y+=B[i]+=h,m.union(s.mark.bounds.union(s.bounds.translate(S[i],B[i]))),p&&t.dirty(s);return m}function ny(t,e){return"x1"===e?t.x||0:"y1"===e?t.y||0:"x2"===e?(t.x||0)+(t.width||0):"y2"===e?(t.y||0)+(t.height||0):void 0}function ry(t,e){return t.bounds[e]}function iy(t,e,n,r,i,a,o,u,s,l,c,f,h,d){var p,g,m,v,y,_,x,b,w,k=n.length,A=0,M=0;if(!k)return A;for(p=c;p<k;p+=f)n[p]&&(A=o(A,s(n[p],l)));if(!e.length)return A;for(e.length>i&&(t.warn("Grid headers exceed limit: "+i),e=e.slice(0,i)),A+=a,g=0,v=e.length;g<v;++g)t.dirty(e[g]),e[g].mark.bounds.clear();for(p=c,g=0,v=e.length;g<v;++g,p+=f){for(y=(_=e[g]).mark.bounds,m=p;m>=0&&null==(x=n[m]);m-=h);u?(b=null==d?x.x:Math.round(x.bounds.x1+d*x.bounds.width()),w=A):(b=A,w=null==d?x.y:Math.round(x.bounds.y1+d*x.bounds.height())),y.union(_.bounds.translate(b-(_.x||0),w-(_.y||0))),_.x=b,_.y=w,t.dirty(_),M=o(M,y[l])}return M}function ay(t,e,n,r,i,a){if(e){t.dirty(e);var o=n,u=n;r?o=Math.round(i.x1+a*i.width()):u=Math.round(i.y1+a*i.height()),e.bounds.translate(o-(e.x||0),u-(e.y||0)),e.mark.bounds.clear().union(e.bounds),e.x=o,e.y=u,t.dirty(e)}}function oy(t,e,n,r,i,a,o){const u=function(t,e){const n=t[e]||{};return(e,r)=>null!=n[e]?n[e]:null!=t[e]?t[e]:r}(n,e),s=function(t,e){var n=-1/0;return t.forEach(t=>{null!=t.offset&&(n=Math.max(n,t.offset))}),n>-1/0?n:e}(t,u("offset",0)),l=u("anchor","start"),c=l===Fs?1:"middle"===l?.5:0,f={align:"each",bounds:u("bounds","flush"),columns:"vertical"===u("direction")?1:t.length,padding:u("margin",8),center:u("center"),nodirty:!0};switch(e){case Ds:f.anchor={x:Math.floor(r.x1)-s,column:Fs,y:c*(o||r.height()+2*r.y1),row:l};break;case Cs:f.anchor={x:Math.ceil(r.x2)+s,y:c*(o||r.height()+2*r.y1),row:l};break;case Es:f.anchor={y:Math.floor(i.y1)-s,row:Fs,x:c*(a||i.width()+2*i.x1),column:l};break;case"bottom":f.anchor={y:Math.ceil(i.y2)+s,x:c*(a||i.width()+2*i.x1),column:l};break;case"top-left":f.anchor={x:s,y:s};break;case"top-right":f.anchor={x:a-s,y:s,column:Fs};break;case"bottom-left":f.anchor={x:s,y:o-s,row:Fs};break;case"bottom-right":f.anchor={x:a-s,y:o-s,column:Fs,row:Fs}}return f}function uy(t,e){var n,r,i,a,o=e.items[0],u=o.datum,s=o.orient,l=o.bounds,c=o.x,f=o.y;return o._bounds?o._bounds.clear().union(l):o._bounds=l.clone(),l.clear(),function(t,e,n){var r=e.padding,i=r-n.x,a=r-n.y;if(e.datum.title){var o=e.items[1].items[0],u=o.anchor,s=e.titlePadding||0,l=r-o.x,c=r-o.y;switch(o.orient){case Ds:i+=Math.ceil(o.bounds.width())+s;break;case Cs:case"bottom":break;default:a+=o.bounds.height()+s}switch((i||a)&&ly(t,n,i,a),o.orient){case Ds:c+=sy(e,n,o,u,1,1);break;case Cs:l+=sy(e,n,o,Fs,0,0)+s,c+=sy(e,n,o,u,1,1);break;case"bottom":l+=sy(e,n,o,u,0,0),c+=sy(e,n,o,Fs,-1,0,1)+s;break;default:l+=sy(e,n,o,u,0,0)}(l||c)&&ly(t,o,l,c),(l=Math.round(o.bounds.x1-r))<0&&(ly(t,n,-l,0),ly(t,o,-l,0))}else(i||a)&&ly(t,n,i,a)}(t,o,o.items[0].items[0]),l=function(t,e){return t.items.forEach(t=>e.union(t.bounds)),e.x1=t.padding,e.y1=t.padding,e}(o,l),n=2*o.padding,r=2*o.padding,l.empty()||(n=Math.ceil(l.width()+n),r=Math.ceil(l.height()+r)),"symbol"===u.type&&(i=o.items[0].items[0].items[0].items,a=i.reduce((t,e)=>(t[e.column]=Math.max(e.bounds.x2-e.x,t[e.column]||0),t),{}),i.forEach(t=>{t.width=a[t.column],t.height=t.bounds.y2-t.y})),"none"!==s&&(o.x=c=0,o.y=f=0),o.width=n,o.height=r,Gc(l.set(c,f,c+n,f+r),o),o.mark.bounds.clear().union(l),o}function sy(t,e,n,r,i,a,o){const u="symbol"!==t.datum.type,s=n.datum.vgrad,l=(!u||!a&&s||o?e:e.items[0]).bounds[i?"y2":"x2"]-t.padding,c=s&&a?l:0,f=s&&a?0:l,h=i<=0?0:xh(n);return Math.round("start"===r?c:r===Fs?f-h:.5*(l-h))}function ly(t,e,n,r){e.x+=n,e.y+=r,e.bounds.translate(n,r),e.mark.bounds.translate(n,r),t.dirty(e)}function cy(t){Xa.call(this,null,t)}st(cy,Xa).transform=function(t,e){var n=e.dataflow;return t.mark.items.forEach(e=>{t.layout&&function(t,e,n){var r,i,a,o,u,s,l,c=function(t){for(var e,n,r=t.items,i=r.length,a=0,o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};a<i;++a)if(n=(e=r[a]).items,"group"===e.marktype)switch(e.role){case"axis":case"legend":case"title":break;case"row-header":o.rowheaders.push(...n);break;case"row-footer":o.rowfooters.push(...n);break;case"column-header":o.colheaders.push(...n);break;case"column-footer":o.colfooters.push(...n);break;case"row-title":o.rowtitle=n[0];break;case"column-title":o.coltitle=n[0];break;default:o.marks.push(...n)}return o}(e),f=c.marks,h="flush"===n.bounds?ny:ry,d=n.offset,p=n.columns||f.length,g=p<=0?1:Math.ceil(f.length/p),m=g*p;const v=ey(t,f,n);v.empty()&&v.set(0,0,0,0),c.rowheaders&&(s=Kv(n.headerBand,Ss,null),r=iy(t,c.rowheaders,f,p,g,-Kv(d,"rowHeader"),Xv,0,h,"x1",0,p,1,s)),c.colheaders&&(s=Kv(n.headerBand,"column",null),i=iy(t,c.colheaders,f,p,p,-Kv(d,"columnHeader"),Xv,1,h,"y1",0,1,p,s)),c.rowfooters&&(s=Kv(n.footerBand,Ss,null),a=iy(t,c.rowfooters,f,p,g,Kv(d,"rowFooter"),Jv,0,h,"x2",p-1,p,1,s)),c.colfooters&&(s=Kv(n.footerBand,"column",null),o=iy(t,c.colfooters,f,p,p,Kv(d,"columnFooter"),Jv,1,h,"y2",m-p,1,p,s)),c.rowtitle&&(u=Kv(n.titleAnchor,Ss),l=Kv(d,"rowTitle"),l=u===Fs?a+l:r-l,s=Kv(n.titleBand,Ss,.5),ay(t,c.rowtitle,l,0,v,s)),c.coltitle&&(u=Kv(n.titleAnchor,"column"),l=Kv(d,"columnTitle"),l=u===Fs?o+l:i-l,s=Kv(n.titleBand,"column",.5),ay(t,c.coltitle,l,1,v,s))}(n,e,t.layout),function(t,e,n){var r,i,a,o,u,s=e.items,l=Math.max(0,e.width||0),c=Math.max(0,e.height||0),f=(new Uc).set(0,0,l,c),h=f.clone(),d=f.clone(),p=[];for(o=0,u=s.length;o<u;++o)switch((i=s[o]).role){case"axis":(Yv(i)?h:d).union(Vv(t,i,l,c));break;case"title":r=i;break;case"legend":p.push(uy(t,i));break;case"frame":case"scope":case"row-header":case"row-footer":case"row-title":case"column-header":case"column-footer":case"column-title":h.union(i.bounds),d.union(i.bounds);break;default:f.union(i.bounds)}if(p.length){const e={};p.forEach(t=>{"none"!==(a=t.orient||Cs)&&(e[a]||(e[a]=[])).push(t)});for(let r in e){const i=e[r];ey(t,i,oy(i,r,n.legends,h,d,l,c))}p.forEach(e=>{const r=e.bounds;if(r.equals(e._bounds)||(e.bounds=e._bounds,t.dirty(e),e.bounds=r,t.dirty(e)),n.autosize&&"fit"===n.autosize.type)switch(e.orient){case Ds:case Cs:f.add(r.x1,0).add(r.x2,0);break;case Es:case"bottom":f.add(0,r.y1).add(0,r.y2)}else f.union(r)})}f.union(h).union(d),r&&f.union(function(t,e,n,r,i){var a,o=e.items[0],u=o.frame,s=o.orient,l=o.anchor,c=o.offset,f=o.padding,h=o.items[0].items[0],d=o.items[1]&&o.items[1].items[0],p=s===Ds||s===Cs?r:n,g=0,m=0,v=0,y=0,_=0;if("group"!==u?s===Ds?(g=i.y2,p=i.y1):s===Cs?(g=i.y1,p=i.y2):(g=i.x1,p=i.x2):s===Ds&&(g=r,p=0),a="start"===l?g:l===Fs?p:(g+p)/2,d&&d.text){switch(s){case Es:case"bottom":_=h.bounds.height()+f;break;case Ds:y=h.bounds.width()+f;break;case Cs:y=-h.bounds.width()-f}Wv.clear().union(d.bounds),Wv.translate(y-(d.x||0),_-(d.y||0)),Hv(d,"x",y)|Hv(d,"y",_)&&(t.dirty(d),d.bounds.clear().union(Wv),d.mark.bounds.clear().union(Wv),t.dirty(d)),Wv.clear().union(d.bounds)}else Wv.clear();switch(Wv.union(h.bounds),s){case Es:m=a,v=i.y1-Wv.height()-c;break;case Ds:m=i.x1-Wv.width()-c,v=a;break;case Cs:m=i.x2+Wv.width()+c,v=a;break;case"bottom":m=a,v=i.y2+c;break;default:m=o.x,v=o.y}return Hv(o,"x",m)|Hv(o,"y",v)&&(Wv.translate(m,v),t.dirty(o),o.bounds.clear().union(Wv),e.bounds.clear().union(Wv),t.dirty(o)),o.bounds}(t,r,l,c,f));e.clip&&f.set(0,0,e.width||0,e.height||0);!function(t,e,n,r){const i=r.autosize||{},a=i.type;if(t._autosize<1||!a)return;let o=t._width,u=t._height,s=Math.max(0,e.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,Math.ceil(n.x2-s)),f=Math.max(0,e.height||0),h=Math.max(0,Math.ceil(-n.y1)),d=Math.max(0,Math.ceil(n.y2-f));if("padding"===i.contains){const e=t.padding();o-=e.left+e.right,u-=e.top+e.bottom}"none"===a?(l=0,h=0,s=o,f=u):"fit"===a?(s=Math.max(0,o-l-c),f=Math.max(0,u-h-d)):"fit-x"===a?(s=Math.max(0,o-l-c),u=f+h+d):"fit-y"===a?(o=s+l+c,f=Math.max(0,u-h-d)):"pad"===a&&(o=s+l+c,u=f+h+d);t._resizeView(o,u,s,f,[l,h],i.resize)}(t,e,f,n)}(n,e,t)}),function(t){return t&&"legend-entry"!==t.mark.role}(t.mark.group)?e.reflow():e};var fy=Object.freeze({__proto__:null,bound:Bv,identifier:zv,mark:Nv,overlap:Ov,render:Iv,viewlayout:cy});function hy(t){Xa.call(this,null,t)}function dy(t){Xa.call(this,null,t)}function py(){return qt({})}function gy(t){Xa.call(this,null,t)}function my(t){Xa.call(this,[],t)}st(hy,Xa).transform=function(t,e){if(this.value&&!t.modified())return e.StopPropagation;var n=e.dataflow.locale(),r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=this.value,a=t.scale,o=Fm(a,null==t.count?t.values?t.values.length:10:t.count,t.minstep),u=t.format||Tm(n,a,o,t.formatSpecifier,t.formatType,!!t.values),s=t.values?Sm(a,t.values,o):Bm(a,o);return i&&(r.rem=i),i=s.map((function(t,e){return qt({index:e/(s.length-1||1),value:t,label:u(t)})})),t.extra&&i.length&&i.push(qt({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r},st(dy,Xa).transform=function(t,e){var n=e.dataflow,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.item||py,a=t.key||Ot,o=this.value;return _(r.encode)&&(r.encode=null),o&&(t.modified("key")||e.modified(a))&&u("DataJoin does not support modified key function or fields."),o||(e=e.addAll(),this.value=o=function(t){const e=ot().test(t=>t.exit);return e.lookup=n=>e.get(t(n)),e}(a)),e.visit(e.ADD,t=>{const e=a(t);let n=o.get(e);n?n.exit?(o.empty--,r.add.push(n)):r.mod.push(n):(n=i(t),o.set(e,n),r.add.push(n)),n.datum=t,n.exit=!1}),e.visit(e.MOD,t=>{const e=a(t),n=o.get(e);n&&(n.datum=t,r.mod.push(n))}),e.visit(e.REM,t=>{const e=a(t),n=o.get(e);t!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++o.empty)}),e.changed(e.ADD_MOD)&&r.modifies("datum"),(e.clean()||t.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r},st(gy,Xa).transform=function(t,e){var n=e.fork(e.ADD_REM),r=t.mod||!1,i=t.encoders,a=e.encode;if(_(a)){if(!n.changed()&&!a.every((function(t){return i[t]})))return e.StopPropagation;a=a[0],n.encode=null}var o="enter"===a,u=i.update||m,s=i.enter||m,l=i.exit||m,c=(a&&!o?i[a]:u)||m;if(e.changed(e.ADD)&&(e.visit(e.ADD,(function(e){s(e,t),u(e,t)})),n.modifies(s.output),n.modifies(u.output),c!==m&&c!==u&&(e.visit(e.ADD,(function(e){c(e,t)})),n.modifies(c.output))),e.changed(e.REM)&&l!==m&&(e.visit(e.REM,(function(e){l(e,t)})),n.modifies(l.output)),o||c!==m){var f=e.MOD|(t.modified()?e.REFLOW:0);o?(e.visit(f,(function(e){var i=s(e,t)||r;(c(e,t)||i)&&n.mod.push(e)})),n.mod.length&&n.modifies(s.output)):e.visit(f,(function(e){(c(e,t)||r)&&n.mod.push(e)})),n.mod.length&&n.modifies(c.output)}return n.changed()?n:e.StopPropagation},st(my,Xa).transform=function(t,e){if(null!=this.value&&!t.modified())return e.StopPropagation;var n,r,i,a,o,u=e.dataflow.locale(),s=e.fork(e.NO_SOURCE|e.NO_FIELDS),l=this.value,c=t.type||"symbol",f=t.scale,h=+t.limit,d=Fm(f,null==t.count?5:t.count,t.minstep),p=!!t.values||"symbol"===c,g=t.format||qm(u,f,d,c,t.formatSpecifier,t.formatType,p),m=t.values||Rm(f,d);return l&&(s.rem=l),"symbol"===c?(h&&m.length>h?(e.dataflow.warn("Symbol legend count exceeds limit, filtering items."),l=m.slice(0,h-1),o=!0):l=m,Y(i=t.size)?(t.values||0!==f(l[0])||(l=l.slice(1)),a=l.reduce((function(e,n){return Math.max(e,i(n,t))}),0)):i=Q(a=i||8),l=l.map((function(e,n){return qt({index:n,label:g(e,n,l),value:e,offset:a,size:i(e,t)})})),o&&(o=m[l.length],l.push(qt({index:l.length,label:`
${m.length-l.length} entries`,value:o,offset:a,size:i(o,t)})))):"gradient"===c?(n=f.domain(),r=xm(f,n[0],M(n)),m.length<3&&!t.values&&n[0]!==M(n)&&(m=[n[0],M(n)]),l=m.map((function(t,e){return qt({index:e,label:g(t,e,m),value:t,perc:r(t)})}))):(i=m.length-1,r=function(t){var e=t.domain(),n=e.length-1,r=+e[0],i=+M(e),a=i-r;if("threshold"===t.type){const t=n?a/n:.1;a=(i+=t)-(r-=t)}return t=>(t-r)/a}(f),l=m.map((function(t,e){return qt({index:e,label:g(t,e,m),value:t,perc:e?r(t):0,perc2:e===i?1:r(m[e+1])})}))),s.source=l,s.add=l,this.value=l,s};var vy=ot({line:ky,"line-radial":function(t,e,n,r){return ky(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n))},arc:Ay,"arc-radial":function(t,e,n,r){return Ay(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n))},curve:My,"curve-radial":function(t,e,n,r){return My(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n))},"orthogonal-horizontal":function(t,e,n,r){return"M"+t+","+e+"V"+r+"H"+n},"orthogonal-vertical":function(t,e,n,r){return"M"+t+","+e+"H"+n+"V"+r},"orthogonal-radial":function(t,e,n,r){var i=Math.cos(t),a=Math.sin(t),o=Math.cos(n),u=Math.sin(n),s=Math.abs(n-t)>Math.PI?n<=t:n>t;return"M"+e*i+","+e*a+"A"+e+","+e+" 0 0,"+(s?1:0)+" "+e*o+","+e*u+"L"+r*o+","+r*u},"diagonal-horizontal":function(t,e,n,r){var i=(t+n)/2;return"M"+t+","+e+"C"+i+","+e+" "+i+","+r+" "+n+","+r},"diagonal-vertical":function(t,e,n,r){var i=(e+r)/2;return"M"+t+","+e+"C"+t+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":function(t,e,n,r){var i=Math.cos(t),a=Math.sin(t),o=Math.cos(n),u=Math.sin(n),s=(e+r)/2;return"M"+e*i+","+e*a+"C"+s*i+","+s*a+" "+s*o+","+s*u+" "+r*o+","+r*u}});function yy(t){return t.source.x}function _y(t){return t.source.y}function xy(t){return t.target.x}function by(t){return t.target.y}function wy(t){Xa.call(this,{},t)}function ky(t,e,n,r){return"M"+t+","+e+"L"+n+","+r}function Ay(t,e,n,r){var i=n-t,a=r-e,o=Math.sqrt(i*i+a*a)/2;return"M"+t+","+e+"A"+o+","+o+" "+180*Math.atan2(a,i)/Math.PI+" 0 1 "+n+","+r}function My(t,e,n,r){var i=n-t,a=r-e,o=.2*(i+a),u=.2*(a-i);return"M"+t+","+e+"C"+(t+o)+","+(e+u)+" "+(n+u)+","+(r-o)+" "+n+","+r}function Ey(t){Xa.call(this,null,t)}wy.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},st(wy,Xa).transform=function(t,e){var n=t.sourceX||yy,r=t.sourceY||_y,i=t.targetX||xy,a=t.targetY||by,o=t.as||"path",s=t.orient||"vertical",l=t.shape||"line",c=vy.get(l+"-"+s)||vy.get(l);return c||u("LinkPath unsupported type: "+t.shape+(t.orient?"-"+t.orient:"")),e.visit(e.SOURCE,(function(t){t[o]=c(n(t),r(t),i(t),a(t))})),e.reflow(t.modified()).modifies(o)},Ey.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},st(Ey,Xa).transform=function(t,e){var n,r,i,a=t.as||["startAngle","endAngle"],o=a[0],u=a[1],s=t.field||p,l=t.startAngle||0,c=null!=t.endAngle?t.endAngle:2*Math.PI,f=e.source,h=f.map(s),d=h.length,g=l,m=(c-l)/on(h),v=Ye(d);for(t.sort&&v.sort((function(t,e){return h[t]-h[e]})),n=0;n<d;++n)i=h[v[n]],(r=f[v[n]])[o]=g,r[u]=g+=i*m;return this.value=h,e.reflow(t.modified()).modifies(a)};function Dy(t){return cm(t)&&"sequential"!==t}var Cy=Dt(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function Fy(t){Xa.call(this,null,t),this.modified(!0)}function Sy(t,e,n){dm(t)&&(Math.abs(e.reduce((function(t,e){return t+(e<0?-1:e>0?1:0)}),0))!==e.length&&n.warn("Log scale domain includes zero: "+wt(e)));return e}function By(t,e,n){return Y(t)&&(e||n)?vm(t,Ty(e||[0,1],n)):t}function Ty(t,e){return e?t.slice().reverse():t}function zy(t){Xa.call(this,null,t)}st(Fy,Xa).transform=function(t,e){var n=e.dataflow,r=this.value,i=function(t){var e,n=t.type,r="";if("sequential"===n)return"sequential-linear";(function(t){const e=t.type;return cm(e)&&e!==_d&&e!==xd&&(t.scheme||t.range&&t.range.length&&t.range.every(pt))})(t)&&(e=t.rawDomain?t.rawDomain.length:t.domain?t.domain.length+ +(null!=t.domainMid):0,r=2===e?"sequential-":3===e?"diverging-":"");return(r+n||"linear").toLowerCase()}(t);for(i in r&&i===r.type||(this.value=r=um(i)()),t)if(!Cy[i]){if("padding"===i&&Dy(r.type))continue;Y(r[i])?r[i](t[i]):n.warn("Unsupported scale property: "+i)}return function(t,e,n){var r=t.type,i=e.round||!1,a=e.range;if(null!=e.rangeStep)a=function(t,e,n){"band"!==t&&"point"!==t&&u("Only band and point scales support rangeStep.");var r=(null!=e.paddingOuter?e.paddingOuter:e.padding)||0,i="point"===t?1:(null!=e.paddingInner?e.paddingInner:e.padding)||0;return[0,e.rangeStep*vd(n,i,r)]}(r,e,n);else if(e.scheme&&(a=function(t,e,n){var r,i,a=e.schemeExtent;_(e.scheme)?i=ym(e.scheme,e.interpolate,e.interpolateGamma):(r=e.scheme.toLowerCase(),(i=Mm(r))||u("Unrecognized scheme name: "+e.scheme));return n="threshold"===t?n+1:"bin-ordinal"===t?n-1:"quantile"===t||"quantize"===t?+e.schemeCount||5:n,pm(t)?By(i,a,e.reverse):Y(i)?_m(By(i,a),n):"ordinal"===t?i:i.slice(0,n)}(r,e,n),Y(a))){if(t.interpolator)return t.interpolator(a);u(`Scale type ${r} does not support interpolating color schemes.`)}if(a&&pm(r))return t.interpolator(ym(Ty(a,e.reverse),e.interpolate,e.interpolateGamma));a&&e.interpolate&&t.interpolate?t.interpolate(bm(e.interpolate,e.interpolateGamma)):Y(t.round)?t.round(i):Y(t.rangeRound)&&t.interpolate(i?Xp:Gp);a&&t.range(Ty(a,e.reverse))}(r,t,function(t,e,n){let r=e.bins;if(r&&!_(r)){let e=t.domain(),n=e[0],i=M(e),a=null==r.start?n:r.start,o=null==r.stop?i:r.stop,s=r.step;s||u("Scale bins parameter missing step property."),a<n&&(a=s*Math.ceil(n/s)),o>i&&(o=s*Math.floor(i/s)),r=Ye(a,o+s/2,s)}r?t.bins=r:t.bins&&delete t.bins;"bin-ordinal"===t.type&&(r?e.domain||e.domainRaw||(t.domain(r),n=r.length):t.bins=t.domain());return n}(r,t,function(t,e,n){var r=function(t,e,n){return e?(t.domain(Sy(t.type,e,n)),e.length):-1}(t,e.domainRaw,n);if(r>-1)return r;var i,a,o=e.domain,u=t.type,s=e.zero||void 0===e.zero&&function(t){const e=t.type;return!t.bins&&("linear"===e||"pow"===e||"sqrt"===e)}(t);if(!o)return 0;Dy(u)&&e.padding&&o[0]!==M(o)&&(o=function(t,e,n,r,i,a){var o=Math.abs(M(n)-n[0]),u=o/(o-2*r),s=t===yd?L(e,null,u):"sqrt"===t?$(e,null,u,.5):"pow"===t?$(e,null,u,i||1):"symlog"===t?P(e,null,u,a||1):U(e,null,u);return(e=e.slice())[0]=s[0],e[e.length-1]=s[1],e}(u,o,e.range,e.padding,e.exponent,e.constant));if((s||null!=e.domainMin||null!=e.domainMax||null!=e.domainMid)&&(i=(o=o.slice()).length-1||1,s&&(o[0]>0&&(o[0]=0),o[i]<0&&(o[i]=0)),null!=e.domainMin&&(o[0]=e.domainMin),null!=e.domainMax&&(o[i]=e.domainMax),null!=e.domainMid)){const t=(a=e.domainMid)>o[i]?i+1:a<o[0]?0:i;t!==i&&n.warn("Scale domainMid exceeds domain min or max.",a),o.splice(t,0,a)}t.domain(Sy(u,o,n)),"ordinal"===u&&t.unknown(e.domainImplicit?Ad:void 0);e.nice&&t.nice&&t.nice(!0!==e.nice&&Fm(t,e.nice)||null);return o.length}(r,t,n))),e.fork(e.NO_SOURCE|e.NO_FIELDS)},st(zy,Xa).transform=function(t,e){var n=t.modified("sort")||e.changed(e.ADD)||e.modified(t.sort.fields)||e.modified("datum");return n&&e.source.sort(Pt(t.sort)),this.modified(n),e};var Ny=["y0","y1"];function Oy(t){Xa.call(this,null,t)}function Ry(t,e,n,r,i){for(var a,o=(e-t.sum)/2,u=t.length,s=0;s<u;++s)(a=t[s])[r]=o,a[i]=o+=Math.abs(n(a))}function qy(t,e,n,r,i){for(var a,o=1/t.sum,u=0,s=t.length,l=0,c=0;l<s;++l)(a=t[l])[r]=u,a[i]=u=o*(c+=Math.abs(n(a)))}function Uy(t,e,n,r,i){for(var a,o,u=0,s=0,l=t.length,c=0;c<l;++c)(a=+n(o=t[c]))<0?(o[r]=s,o[i]=s+=a):(o[r]=u,o[i]=u+=a)}Oy.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:"zero",values:["zero","center","normalize"]},{name:"as",type:"string",array:!0,length:2,default:Ny}]},st(Oy,Xa).transform=function(t,e){var n,r,i,a,o=t.as||Ny,u=o[0],s=o[1],l=Pt(t.sort),c=t.field||p,f="center"===t.offset?Ry:"normalize"===t.offset?qy:Uy;for(n=function(t,e,n,r){var i,a,o,u,s,l,c,f,h,d=[],p=function(t){return t(s)};if(null==e)d.push(t.slice());else for(i={},a=0,o=t.length;a<o;++a)s=t[a],l=e.map(p),(c=i[l])||(i[l]=c=[],d.push(c)),c.push(s);for(l=0,h=0,u=d.length;l<u;++l){for(c=d[l],a=0,f=0,o=c.length;a<o;++a)f+=Math.abs(r(c[a]));c.sum=f,f>h&&(h=f),n&&c.sort(n)}return d.max=h,d}(e.source,t.groupby,l,c),r=0,i=n.length,a=n.max;r<i;++r)f(n[r],a,c,u,s);return e.reflow(t.modified()).modifies(o)};var Ly=Object.freeze({__proto__:null,axisticks:hy,datajoin:dy,encode:gy,legendentries:my,linkpath:wy,pie:Ey,scale:Fy,sortitems:zy,stack:Oy});function $y(){}const Py=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function jy(){var t=1,e=1,n=o;function r(t,e){return e.map(e=>i(t,e))}function i(r,i){var o=[],u=[];return function(n,r,i){var o,u,s,l,c,f,h=new Array,d=new Array;o=u=-1,l=n[0]>=r,Py[l<<1].forEach(p);for(;++o<t-1;)s=l,l=n[o+1]>=r,Py[s|l<<1].forEach(p);Py[l<<0].forEach(p);for(;++u<e-1;){for(o=-1,l=n[u*t+t]>=r,c=n[u*t]>=r,Py[l<<1|c<<2].forEach(p);++o<t-1;)s=l,l=n[u*t+t+o+1]>=r,f=c,c=n[u*t+o+1]>=r,Py[s|l<<1|c<<2|f<<3].forEach(p);Py[l|c<<3].forEach(p)}o=-1,c=n[u*t]>=r,Py[c<<2].forEach(p);for(;++o<t-1;)f=c,c=n[u*t+o+1]>=r,Py[c<<2|f<<3].forEach(p);function p(t){var e,n,r=[t[0][0]+o,t[0][1]+u],s=[t[1][0]+o,t[1][1]+u],l=a(r),c=a(s);(e=d[l])?(n=h[c])?(delete d[e.end],delete h[n.start],e===n?(e.ring.push(s),i(e.ring)):h[e.start]=d[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete d[e.end],e.ring.push(s),d[e.end=c]=e):(e=h[c])?(n=d[l])?(delete h[e.start],delete d[n.end],e===n?(e.ring.push(s),i(e.ring)):h[n.start]=d[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete h[e.start],e.ring.unshift(r),h[e.start=l]=e):h[l]=d[c]={start:l,end:c,ring:[r,s]}}Py[c<<3].forEach(p)}(r,i,(function(t){n(t,r,i),function(t){var e=0,n=t.length,r=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];for(;++e<n;)r+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return r}(t)>0?o.push([t]):u.push(t)})),u.forEach((function(t){for(var e,n=0,r=o.length;n<r;++n)if(-1!==Iy((e=o[n])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:i,coordinates:o}}function a(e){return 2*e[0]+e[1]*(t+1)*4}function o(n,r,i){n.forEach((function(n){var a,o=n[0],u=n[1],s=0|o,l=0|u,c=r[l*t+s];o>0&&o<t&&s===o&&(a=r[l*t+s-1],n[0]=o+(i-a)/(c-a)-.5),u>0&&u<e&&l===u&&(a=r[(l-1)*t+s],n[1]=u+(i-a)/(c-a)-.5)}))}return r.contour=i,r.size=function(n){if(!arguments.length)return[t,e];var i=Math.floor(n[0]),a=Math.floor(n[1]);return i>=0&&a>=0||u("invalid size"),t=i,e=a,r},r.smooth=function(t){return arguments.length?(n=t?o:$y,r):n===o},r}function Iy(t,e){for(var n,r=-1,i=e.length;++r<i;)if(n=Wy(t,e[r]))return n;return 0}function Wy(t,e){for(var n=e[0],r=e[1],i=-1,a=0,o=t.length,u=o-1;a<o;u=a++){var s=t[a],l=s[0],c=s[1],f=t[u],h=f[0],d=f[1];if(Hy(s,f,e))return 0;c>r!=d>r&&n<(h-l)*(r-c)/(d-c)+l&&(i=-i)}return i}function Hy(t,e,n){var r,i,a,o;return function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(e[1]-t[1])}(t,e,n)&&(i=t[r=+(t[0]===e[0])],a=n[r],o=e[r],i<=a&&a<=o||o<=a&&a<=i)}function Yy(t,e,n){return function(r){var i=et(r),a=n?Math.min(i[0],0):i[0],o=i[1],u=o-a,s=e?Qe(a,o,t):u/(t+1);return Ye(s,o,s)}}function Vy(t){Xa.call(this,null,t)}function Gy(t,e,n,r,i){const a=t.x1||0,o=t.y1||0,u=e*n<0;function s(t){t.forEach(l)}function l(t){u&&t.reverse(),t.forEach(c)}function c(t){t[0]=(t[0]-a)*e+r,t[1]=(t[1]-o)*n+i}return function(t){return t.coordinates.forEach(s),t}}function Xy(t,e,n){const r=t>=0?t:vo(e,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function Jy(t){return Y(t)?t:Q(+t)}function Zy(){var t=t=>t[0],e=t=>t[1],n=p,r=[-1,-1],i=960,a=500,o=2;function s(u,s){const l=Xy(r[0],u,t)>>o,c=Xy(r[1],u,e)>>o,f=l?l+2:0,h=c?c+2:0,d=2*f+(i>>o),p=2*h+(a>>o),g=new Float32Array(d*p),m=new Float32Array(d*p);let v=g;u.forEach(r=>{const i=f+(+t(r)>>o),a=h+(+e(r)>>o);i>=0&&i<d&&a>=0&&a<p&&(g[i+a*d]+=+n(r))}),l>0&&c>0?(Qy(d,p,g,m,l),Ky(d,p,m,g,c),Qy(d,p,g,m,l),Ky(d,p,m,g,c),Qy(d,p,g,m,l),Ky(d,p,m,g,c)):l>0?(Qy(d,p,g,m,l),Qy(d,p,m,g,l),Qy(d,p,g,m,l),v=m):c>0&&(Ky(d,p,g,m,c),Ky(d,p,m,g,c),Ky(d,p,g,m,c),v=m);let y=s?Math.pow(2,-2*o):1/on(v);for(let t=0,e=d*p;t<e;++t)v[t]*=y;return{values:v,scale:1<<o,width:d,height:p,x1:f,y1:h,x2:f+(i>>o),y2:h+(a>>o)}}return s.x=function(e){return arguments.length?(t=Jy(e),s):t},s.y=function(t){return arguments.length?(e=Jy(t),s):e},s.weight=function(t){return arguments.length?(n=Jy(t),s):n},s.size=function(t){if(!arguments.length)return[i,a];var e=+t[0],n=+t[1];return e>=0&&n>=0||u("invalid size"),i=e,a=n,s},s.cellSize=function(t){return arguments.length?((t=+t)>=1||u("invalid cell size"),o=Math.floor(Math.log(t)/Math.LN2),s):1<<o},s.bandwidth=function(t){return arguments.length?(1===(t=W(t)).length&&(t=[+t[0],+t[0]]),2!==t.length&&u("invalid bandwidth"),r=t,s):r},s}function Qy(t,e,n,r,i){const a=1+(i<<1);for(let o=0;o<e;++o)for(let e=0,u=0;e<t+i;++e)e<t&&(u+=n[e+o*t]),e>=i&&(e>=a&&(u-=n[e-a+o*t]),r[e-i+o*t]=u/Math.min(e+1,t-1+a-e,a))}function Ky(t,e,n,r,i){const a=1+(i<<1);for(let o=0;o<t;++o)for(let u=0,s=0;u<e+i;++u)u<e&&(s+=n[o+u*t]),u>=i&&(u>=a&&(s-=n[o+(u-a)*t]),r[o+(u-i)*t]=s/Math.min(u+1,e-1+a-u,a))}function t_(t){Xa.call(this,null,t)}Vy.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},st(Vy,Xa).transform=function(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=e.materialize(e.SOURCE).source,i=t.field||h,a=jy().smooth(!1!==t.smooth),o=t.thresholds||function(t,e,n){const r=Yy(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?r:r(t.map(t=>Ke(e(t).values)))}(r,i,t),u=null===t.as?null:t.as||"contour",s=[];return r.forEach(e=>{const n=i(e),r=a.size([n.width,n.height])(n.values,_(o)?o:o(n.values));!function(t,e,n,r){let i=r.scale||e.scale,a=r.translate||e.translate;Y(i)&&(i=i(n,r));Y(a)&&(a=a(n,r));if((1===i||null==i)&&!a)return;const o=(ht(i)?i:i[0])||1,u=(ht(i)?i:i[1])||1,s=a&&a[0]||0,l=a&&a[1]||0;t.forEach(Gy(e,o,u,s,l))}(r,n,e,t),r.forEach(t=>{s.push(Lt(e,qt(null!=u?{[u]:t}:t)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=s,n},t_.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};var e_=st(t_,Xa);const n_=["x","y","weight","size","cellSize","bandwidth"];function r_(t,e){return n_.forEach(n=>null!=e[n]?t[n](e[n]):0),t}function i_(t){Xa.call(this,null,t)}e_.transform=function(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var r,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),a=function(t,e){var n,r,i,a,o,u,s=[],l=t=>t(a);if(null==e)s.push(t);else for(n={},r=0,i=t.length;r<i;++r)a=t[r],o=e.map(l),(u=n[o])||(n[o]=u=[],u.dims=o,s.push(u)),u.push(a);return s}(e.materialize(e.SOURCE).source,t.groupby),o=(t.groupby||[]).map(n),u=r_(Zy(),t),s=t.as||"grid";return r=a.map(e=>qt(function(t,e){for(let n=0;n<o.length;++n)t[o[n]]=e[n];return t}({[s]:u(e,t.counts)},e.dims))),this.value&&(i.rem=this.value),this.value=i.source=i.add=r,i},i_.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},st(i_,Xa).transform=function(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n,r,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),a=jy().smooth(!1!==t.smooth),o=t.values,u=t.thresholds||Yy(t.count||10,t.nice,!!o),s=t.size;return o||(o=e.materialize(e.SOURCE).source,r=Gy(n=r_(Zy(),t)(o,!0),n.scale||1,n.scale||1,0,0),s=[n.width,n.height],o=n.values),u=_(u)?u:u(o),o=a.size(s)(o,u),r&&o.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(o||[]).map(qt),i};function a_(t){Xa.call(this,null,t)}function o_(){return new u_}function u_(){this.reset()}a_.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},st(a_,Xa).transform=function(t,e){var n,i=this._features,a=this._points,o=t.fields,u=o&&o[0],s=o&&o[1],l=t.geojson||!o&&h,c=e.ADD;n=t.modified()||e.changed(e.REM)||e.modified(r(l))||u&&e.modified(r(u))||s&&e.modified(r(s)),this.value&&!n||(c=e.SOURCE,this._features=i=[],this._points=a=[]),l&&e.visit(c,(function(t){i.push(l(t))})),u&&s&&(e.visit(c,(function(t){var e=u(t),n=s(t);null!=e&&null!=n&&(e=+e)===e&&(n=+n)===n&&a.push([e,n])})),i=i.concat({type:"Feature",geometry:{type:"MultiPoint",coordinates:a}})),this.value={type:"FeatureCollection",features:i}},u_.prototype={constructor:u_,reset:function(){this.s=this.t=0},add:function(t){l_(s_,t,this.t),l_(this,s_.s,this.s),this.s?this.t+=s_.t:this.s=s_.t},valueOf:function(){return this.s}};var s_=new u_;function l_(t,e,n){var r=t.s=e+n,i=r-e,a=r-i;t.t=e-a+(n-i)}var c_=Math.PI,f_=c_/2,h_=c_/4,d_=2*c_,p_=180/c_,g_=c_/180,m_=Math.abs,v_=Math.atan,y_=Math.atan2,__=Math.cos,x_=Math.ceil,b_=Math.exp,w_=Math.log,k_=Math.pow,A_=Math.sin,M_=Math.sign||function(t){return t>0?1:t<0?-1:0},E_=Math.sqrt,D_=Math.tan;function C_(t){return t>1?0:t<-1?c_:Math.acos(t)}function F_(t){return t>1?f_:t<-1?-f_:Math.asin(t)}function S_(){}function B_(t,e){t&&z_.hasOwnProperty(t.type)&&z_[t.type](t,e)}var T_={Feature:function(t,e){B_(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)B_(n[r].geometry,e)}},z_={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){N_(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)N_(n[r],e,0)},Polygon:function(t,e){O_(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)O_(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)B_(n[r],e)}};function N_(t,e,n){var r,i=-1,a=t.length-n;for(e.lineStart();++i<a;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function O_(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)N_(t[n],e,1);e.polygonEnd()}function R_(t,e){t&&T_.hasOwnProperty(t.type)?T_[t.type](t,e):B_(t,e)}var q_,U_,L_,$_,P_,j_=o_(),I_=o_(),W_={point:S_,lineStart:S_,lineEnd:S_,polygonStart:function(){j_.reset(),W_.lineStart=H_,W_.lineEnd=Y_},polygonEnd:function(){var t=+j_;I_.add(t<0?d_+t:t),this.lineStart=this.lineEnd=this.point=S_},sphere:function(){I_.add(d_)}};function H_(){W_.point=V_}function Y_(){G_(q_,U_)}function V_(t,e){W_.point=G_,q_=t,U_=e,L_=t*=g_,$_=__(e=(e*=g_)/2+h_),P_=A_(e)}function G_(t,e){var n=(t*=g_)-L_,r=n>=0?1:-1,i=r*n,a=__(e=(e*=g_)/2+h_),o=A_(e),u=P_*o,s=$_*a+u*__(i),l=u*r*A_(i);j_.add(y_(l,s)),L_=t,$_=a,P_=o}function X_(t){return[y_(t[1],t[0]),F_(t[2])]}function J_(t){var e=t[0],n=t[1],r=__(n);return[r*__(e),r*A_(e),A_(n)]}function Z_(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Q_(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function K_(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function tx(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function ex(t){var e=E_(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var nx,rx,ix,ax,ox,ux,sx,lx,cx,fx,hx,dx,px,gx,mx,vx,yx,_x,xx,bx,wx,kx,Ax,Mx,Ex,Dx,Cx=o_(),Fx={point:Sx,lineStart:Tx,lineEnd:zx,polygonStart:function(){Fx.point=Nx,Fx.lineStart=Ox,Fx.lineEnd=Rx,Cx.reset(),W_.polygonStart()},polygonEnd:function(){W_.polygonEnd(),Fx.point=Sx,Fx.lineStart=Tx,Fx.lineEnd=zx,j_<0?(nx=-(ix=180),rx=-(ax=90)):Cx>1e-6?ax=90:Cx<-1e-6&&(rx=-90),fx[0]=nx,fx[1]=ix},sphere:function(){nx=-(ix=180),rx=-(ax=90)}};function Sx(t,e){cx.push(fx=[nx=t,ix=t]),e<rx&&(rx=e),e>ax&&(ax=e)}function Bx(t,e){var n=J_([t*g_,e*g_]);if(lx){var r=Q_(lx,n),i=Q_([r[1],-r[0],0],r);ex(i),i=X_(i);var a,o=t-ox,u=o>0?1:-1,s=i[0]*p_*u,l=m_(o)>180;l^(u*ox<s&&s<u*t)?(a=i[1]*p_)>ax&&(ax=a):l^(u*ox<(s=(s+360)%360-180)&&s<u*t)?(a=-i[1]*p_)<rx&&(rx=a):(e<rx&&(rx=e),e>ax&&(ax=e)),l?t<ox?qx(nx,t)>qx(nx,ix)&&(ix=t):qx(t,ix)>qx(nx,ix)&&(nx=t):ix>=nx?(t<nx&&(nx=t),t>ix&&(ix=t)):t>ox?qx(nx,t)>qx(nx,ix)&&(ix=t):qx(t,ix)>qx(nx,ix)&&(nx=t)}else cx.push(fx=[nx=t,ix=t]);e<rx&&(rx=e),e>ax&&(ax=e),lx=n,ox=t}function Tx(){Fx.point=Bx}function zx(){fx[0]=nx,fx[1]=ix,Fx.point=Sx,lx=null}function Nx(t,e){if(lx){var n=t-ox;Cx.add(m_(n)>180?n+(n>0?360:-360):n)}else ux=t,sx=e;W_.point(t,e),Bx(t,e)}function Ox(){W_.lineStart()}function Rx(){Nx(ux,sx),W_.lineEnd(),m_(Cx)>1e-6&&(nx=-(ix=180)),fx[0]=nx,fx[1]=ix,lx=null}function qx(t,e){return(e-=t)<0?e+360:e}function Ux(t,e){return t[0]-e[0]}function Lx(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var $x={sphere:S_,point:Px,lineStart:Ix,lineEnd:Yx,polygonStart:function(){$x.lineStart=Vx,$x.lineEnd=Gx},polygonEnd:function(){$x.lineStart=Ix,$x.lineEnd=Yx}};function Px(t,e){t*=g_;var n=__(e*=g_);jx(n*__(t),n*A_(t),A_(e))}function jx(t,e,n){++hx,px+=(t-px)/hx,gx+=(e-gx)/hx,mx+=(n-mx)/hx}function Ix(){$x.point=Wx}function Wx(t,e){t*=g_;var n=__(e*=g_);Mx=n*__(t),Ex=n*A_(t),Dx=A_(e),$x.point=Hx,jx(Mx,Ex,Dx)}function Hx(t,e){t*=g_;var n=__(e*=g_),r=n*__(t),i=n*A_(t),a=A_(e),o=y_(E_((o=Ex*a-Dx*i)*o+(o=Dx*r-Mx*a)*o+(o=Mx*i-Ex*r)*o),Mx*r+Ex*i+Dx*a);dx+=o,vx+=o*(Mx+(Mx=r)),yx+=o*(Ex+(Ex=i)),_x+=o*(Dx+(Dx=a)),jx(Mx,Ex,Dx)}function Yx(){$x.point=Px}function Vx(){$x.point=Xx}function Gx(){Jx(kx,Ax),$x.point=Px}function Xx(t,e){kx=t,Ax=e,t*=g_,e*=g_,$x.point=Jx;var n=__(e);Mx=n*__(t),Ex=n*A_(t),Dx=A_(e),jx(Mx,Ex,Dx)}function Jx(t,e){t*=g_;var n=__(e*=g_),r=n*__(t),i=n*A_(t),a=A_(e),o=Ex*a-Dx*i,u=Dx*r-Mx*a,s=Mx*i-Ex*r,l=E_(o*o+u*u+s*s),c=F_(l),f=l&&-c/l;xx+=f*o,bx+=f*u,wx+=f*s,dx+=c,vx+=c*(Mx+(Mx=r)),yx+=c*(Ex+(Ex=i)),_x+=c*(Dx+(Dx=a)),jx(Mx,Ex,Dx)}function Zx(t,e){function n(n,r){return n=t(n,r),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,r){return(n=e.invert(n,r))&&t.invert(n[0],n[1])}),n}function Qx(t,e){return[m_(t)>c_?t+Math.round(-t/d_)*d_:t,e]}function Kx(t,e,n){return(t%=d_)?e||n?Zx(eb(t),nb(e,n)):eb(t):e||n?nb(e,n):Qx}function tb(t){return function(e,n){return[(e+=t)>c_?e-d_:e<-c_?e+d_:e,n]}}function eb(t){var e=tb(t);return e.invert=tb(-t),e}function nb(t,e){var n=__(t),r=A_(t),i=__(e),a=A_(e);function o(t,e){var o=__(e),u=__(t)*o,s=A_(t)*o,l=A_(e),c=l*n+u*r;return[y_(s*i-c*a,u*n-l*r),F_(c*i+s*a)]}return o.invert=function(t,e){var o=__(e),u=__(t)*o,s=A_(t)*o,l=A_(e),c=l*i-s*a;return[y_(s*i+l*a,u*n+c*r),F_(c*n-u*r)]},o}function rb(t,e){(e=J_(e))[0]-=t,ex(e);var n=C_(-e[1]);return((-e[2]<0?-n:n)+d_-1e-6)%d_}function ib(){var t,e=[];return{point:function(e,n,r){t.push([e,n,r])},lineStart:function(){e.push(t=[])},lineEnd:S_,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function ab(t,e){return m_(t[0]-e[0])<1e-6&&m_(t[1]-e[1])<1e-6}function ob(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function ub(t,e,n,r,i){var a,o,u=[],s=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,r=t[0],o=t[e];if(ab(r,o)){if(!r[2]&&!o[2]){for(i.lineStart(),a=0;a<e;++a)i.point((r=t[a])[0],r[1]);return void i.lineEnd()}o[0]+=2e-6}u.push(n=new ob(r,t,null,!0)),s.push(n.o=new ob(r,null,n,!1)),u.push(n=new ob(o,t,null,!1)),s.push(n.o=new ob(o,null,n,!0))}})),u.length){for(s.sort(e),sb(u),sb(s),a=0,o=s.length;a<o;++a)s[a].e=n=!n;for(var l,c,f=u[0];;){for(var h=f,d=!0;h.v;)if((h=h.n)===f)return;l=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(a=0,o=l.length;a<o;++a)i.point((c=l[a])[0],c[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(d)for(l=h.p.z,a=l.length-1;a>=0;--a)i.point((c=l[a])[0],c[1]);else r(h.x,h.p.x,-1,i);h=h.p}l=(h=h.o).z,d=!d}while(!h.v);i.lineEnd()}}}function sb(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}Qx.invert=Qx;var lb=o_();function cb(t){return m_(t[0])<=c_?t[0]:M_(t[0])*((m_(t[0])+c_)%d_-c_)}function fb(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}!function(t){var e;1===t.length&&(e=t,t=function(t,n){return fb(e(t),n)})}(fb);function hb(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),a=new Array(i);++r<i;)a[r]=t+r*n;return a}function db(t){for(var e,n,r,i=t.length,a=-1,o=0;++a<i;)o+=t[a].length;for(n=new Array(o);--i>=0;)for(e=(r=t[i]).length;--e>=0;)n[--o]=r[e];return n}function pb(t,e,n,r){return function(i){var a,o,u,s=e(i),l=ib(),c=e(l),f=!1,h={point:d,lineStart:g,lineEnd:m,polygonStart:function(){h.point=v,h.lineStart=y,h.lineEnd=_,o=[],a=[]},polygonEnd:function(){h.point=d,h.lineStart=g,h.lineEnd=m,o=db(o);var t=function(t,e){var n=cb(e),r=e[1],i=A_(r),a=[A_(n),-__(n),0],o=0,u=0;lb.reset(),1===i?r=f_+1e-6:-1===i&&(r=-f_-1e-6);for(var s=0,l=t.length;s<l;++s)if(f=(c=t[s]).length)for(var c,f,h=c[f-1],d=cb(h),p=h[1]/2+h_,g=A_(p),m=__(p),v=0;v<f;++v,d=_,g=b,m=w,h=y){var y=c[v],_=cb(y),x=y[1]/2+h_,b=A_(x),w=__(x),k=_-d,A=k>=0?1:-1,M=A*k,E=M>c_,D=g*b;if(lb.add(y_(D*A*A_(M),m*w+D*__(M))),o+=E?k+A*d_:k,E^d>=n^_>=n){var C=Q_(J_(h),J_(y));ex(C);var F=Q_(a,C);ex(F);var S=(E^k>=0?-1:1)*F_(F[2]);(r>S||r===S&&(C[0]||C[1]))&&(u+=E^k>=0?1:-1)}}return(o<-1e-6||o<1e-6&&lb<-1e-6)^1&u}(a,r);o.length?(f||(i.polygonStart(),f=!0),ub(o,mb,t,n,i)):t&&(f||(i.polygonStart(),f=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),f&&(i.polygonEnd(),f=!1),o=a=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(e,n){t(e,n)&&i.point(e,n)}function p(t,e){s.point(t,e)}function g(){h.point=p,s.lineStart()}function m(){h.point=d,s.lineEnd()}function v(t,e){u.push([t,e]),c.point(t,e)}function y(){c.lineStart(),u=[]}function _(){v(u[0][0],u[0][1]),c.lineEnd();var t,e,n,r,s=c.clean(),h=l.result(),d=h.length;if(u.pop(),a.push(u),u=null,d)if(1&s){if((e=(n=h[0]).length-1)>0){for(f||(i.polygonStart(),f=!0),i.lineStart(),t=0;t<e;++t)i.point((r=n[t])[0],r[1]);i.lineEnd()}}else d>1&&2&s&&h.push(h.pop().concat(h.shift())),o.push(h.filter(gb))}return h}}function gb(t){return t.length>1}function mb(t,e){return((t=t.x)[0]<0?t[1]-f_-1e-6:f_-t[1])-((e=e.x)[0]<0?e[1]-f_-1e-6:f_-e[1])}var vb=pb((function(){return!0}),(function(t){var e,n=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(a,o){var u=a>0?c_:-c_,s=m_(a-n);m_(s-c_)<1e-6?(t.point(n,r=(r+o)/2>0?f_:-f_),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(u,r),t.point(a,r),e=0):i!==u&&s>=c_&&(m_(n-i)<1e-6&&(n-=1e-6*i),m_(a-u)<1e-6&&(a-=1e-6*u),r=function(t,e,n,r){var i,a,o=A_(t-n);return m_(o)>1e-6?v_((A_(e)*(a=__(r))*A_(n)-A_(r)*(i=__(e))*A_(t))/(i*a*o)):(e+r)/2}(n,r,a,o),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(u,r),e=0),t.point(n=a,r=o),i=u},lineEnd:function(){t.lineEnd(),n=r=NaN},clean:function(){return 2-e}}}),(function(t,e,n,r){var i;if(null==t)i=n*f_,r.point(-c_,i),r.point(0,i),r.point(c_,i),r.point(c_,0),r.point(c_,-i),r.point(0,-i),r.point(-c_,-i),r.point(-c_,0),r.point(-c_,i);else if(m_(t[0]-e[0])>1e-6){var a=t[0]<e[0]?c_:-c_;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(e[0],e[1])}),[-c_,-f_]);function yb(t){var e=__(t),n=6*g_,r=e>0,i=m_(e)>1e-6;function a(t,n){return __(t)*__(n)>e}function o(t,n,r){var i=[1,0,0],a=Q_(J_(t),J_(n)),o=Z_(a,a),u=a[0],s=o-u*u;if(!s)return!r&&t;var l=e*o/s,c=-e*u/s,f=Q_(i,a),h=tx(i,l);K_(h,tx(a,c));var d=f,p=Z_(h,d),g=Z_(d,d),m=p*p-g*(Z_(h,h)-1);if(!(m<0)){var v=E_(m),y=tx(d,(-p-v)/g);if(K_(y,h),y=X_(y),!r)return y;var _,x=t[0],b=n[0],w=t[1],k=n[1];b<x&&(_=x,x=b,b=_);var A=b-x,M=m_(A-c_)<1e-6;if(!M&&k<w&&(_=w,w=k,k=_),M||A<1e-6?M?w+k>0^y[1]<(m_(y[0]-x)<1e-6?w:k):w<=y[1]&&y[1]<=k:A>c_^(x<=y[0]&&y[0]<=b)){var E=tx(d,(-p+v)/g);return K_(E,h),[y,X_(E)]}}}function u(e,n){var i=r?t:c_-t,a=0;return e<-i?a|=1:e>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}return pb(a,(function(t){var e,n,s,l,c;return{lineStart:function(){l=s=!1,c=1},point:function(f,h){var d,p=[f,h],g=a(f,h),m=r?g?0:u(f,h):g?u(f+(f<0?c_:-c_),h):0;if(!e&&(l=s=g)&&t.lineStart(),g!==s&&(!(d=o(e,p))||ab(e,d)||ab(p,d))&&(p[2]=1),g!==s)c=0,g?(t.lineStart(),d=o(p,e),t.point(d[0],d[1])):(d=o(e,p),t.point(d[0],d[1],2),t.lineEnd()),e=d;else if(i&&e&&r^g){var v;m&n||!(v=o(p,e,!0))||(c=0,r?(t.lineStart(),t.point(v[0][0],v[0][1]),t.point(v[1][0],v[1][1]),t.lineEnd()):(t.point(v[1][0],v[1][1]),t.lineEnd(),t.lineStart(),t.point(v[0][0],v[0][1],3)))}!g||e&&ab(e,p)||t.point(p[0],p[1]),e=p,s=g,n=m},lineEnd:function(){s&&t.lineEnd(),e=null},clean:function(){return c|(l&&s)<<1}}}),(function(e,r,i,a){!function(t,e,n,r,i,a){if(n){var o=__(e),u=A_(e),s=r*n;null==i?(i=e+r*d_,a=e-s/2):(i=rb(o,i),a=rb(o,a),(r>0?i<a:i>a)&&(i+=r*d_));for(var l,c=i;r>0?c>a:c<a;c-=s)l=X_([o,-u*__(c),-u*A_(c)]),t.point(l[0],l[1])}}(a,t,n,i,e,r)}),r?[0,-t]:[-c_,t-c_])}function _b(t,e,n,r){function i(i,a){return t<=i&&i<=n&&e<=a&&a<=r}function a(i,a,u,l){var c=0,f=0;if(null==i||(c=o(i,u))!==(f=o(a,u))||s(i,a)<0^u>0)do{l.point(0===c||3===c?t:n,c>1?r:e)}while((c=(c+u+4)%4)!==f);else l.point(a[0],a[1])}function o(r,i){return m_(r[0]-t)<1e-6?i>0?0:3:m_(r[0]-n)<1e-6?i>0?2:1:m_(r[1]-e)<1e-6?i>0?1:0:i>0?3:2}function u(t,e){return s(t.x,e.x)}function s(t,e){var n=o(t,1),r=o(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(o){var s,l,c,f,h,d,p,g,m,v,y,_=o,x=ib(),b={point:w,lineStart:function(){b.point=k,l&&l.push(c=[]);v=!0,m=!1,p=g=NaN},lineEnd:function(){s&&(k(f,h),d&&m&&x.rejoin(),s.push(x.result()));b.point=w,m&&_.lineEnd()},polygonStart:function(){_=x,s=[],l=[],y=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,i=l.length;n<i;++n)for(var a,o,u=l[n],s=1,c=u.length,f=u[0],h=f[0],d=f[1];s<c;++s)a=h,o=d,f=u[s],h=f[0],d=f[1],o<=r?d>r&&(h-a)*(r-o)>(d-o)*(t-a)&&++e:d<=r&&(h-a)*(r-o)<(d-o)*(t-a)&&--e;return e}(),n=y&&e,i=(s=db(s)).length;(n||i)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),i&&ub(s,u,e,a,o),o.polygonEnd());_=o,s=l=c=null}};function w(t,e){i(t,e)&&_.point(t,e)}function k(a,o){var u=i(a,o);if(l&&c.push([a,o]),v)f=a,h=o,d=u,v=!1,u&&(_.lineStart(),_.point(a,o));else if(u&&m)_.point(a,o);else{var s=[p=Math.max(-1e9,Math.min(1e9,p)),g=Math.max(-1e9,Math.min(1e9,g))],x=[a=Math.max(-1e9,Math.min(1e9,a)),o=Math.max(-1e9,Math.min(1e9,o))];!function(t,e,n,r,i,a){var o,u=t[0],s=t[1],l=0,c=1,f=e[0]-u,h=e[1]-s;if(o=n-u,f||!(o>0)){if(o/=f,f<0){if(o<l)return;o<c&&(c=o)}else if(f>0){if(o>c)return;o>l&&(l=o)}if(o=i-u,f||!(o<0)){if(o/=f,f<0){if(o>c)return;o>l&&(l=o)}else if(f>0){if(o<l)return;o<c&&(c=o)}if(o=r-s,h||!(o>0)){if(o/=h,h<0){if(o<l)return;o<c&&(c=o)}else if(h>0){if(o>c)return;o>l&&(l=o)}if(o=a-s,h||!(o<0)){if(o/=h,h<0){if(o>c)return;o>l&&(l=o)}else if(h>0){if(o<l)return;o<c&&(c=o)}return l>0&&(t[0]=u+l*f,t[1]=s+l*h),c<1&&(e[0]=u+c*f,e[1]=s+c*h),!0}}}}}(s,x,t,e,n,r)?u&&(_.lineStart(),_.point(a,o),y=!1):(m||(_.lineStart(),_.point(s[0],s[1])),_.point(x[0],x[1]),u||_.lineEnd(),y=!1)}p=a,g=o,m=u}return b}}function xb(t,e,n){var r=hb(t,e-1e-6,n).concat(e);return function(t){return r.map((function(e){return[t,e]}))}}function bb(t,e,n){var r=hb(t,e-1e-6,n).concat(e);return function(t){return r.map((function(e){return[e,t]}))}}function wb(t){return t}var kb,Ab,Mb,Eb,Db=o_(),Cb=o_(),Fb={point:S_,lineStart:S_,lineEnd:S_,polygonStart:function(){Fb.lineStart=Sb,Fb.lineEnd=zb},polygonEnd:function(){Fb.lineStart=Fb.lineEnd=Fb.point=S_,Db.add(m_(Cb)),Cb.reset()},result:function(){var t=Db/2;return Db.reset(),t}};function Sb(){Fb.point=Bb}function Bb(t,e){Fb.point=Tb,kb=Mb=t,Ab=Eb=e}function Tb(t,e){Cb.add(Eb*t-Mb*e),Mb=t,Eb=e}function zb(){Tb(kb,Ab)}var Nb=1/0,Ob=Nb,Rb=-Nb,qb=Rb,Ub={point:function(t,e){t<Nb&&(Nb=t);t>Rb&&(Rb=t);e<Ob&&(Ob=e);e>qb&&(qb=e)},lineStart:S_,lineEnd:S_,polygonStart:S_,polygonEnd:S_,result:function(){var t=[[Nb,Ob],[Rb,qb]];return Rb=qb=-(Ob=Nb=1/0),t}};var Lb,$b,Pb,jb,Ib=0,Wb=0,Hb=0,Yb=0,Vb=0,Gb=0,Xb=0,Jb=0,Zb=0,Qb={point:Kb,lineStart:tw,lineEnd:rw,polygonStart:function(){Qb.lineStart=iw,Qb.lineEnd=aw},polygonEnd:function(){Qb.point=Kb,Qb.lineStart=tw,Qb.lineEnd=rw},result:function(){var t=Zb?[Xb/Zb,Jb/Zb]:Gb?[Yb/Gb,Vb/Gb]:Hb?[Ib/Hb,Wb/Hb]:[NaN,NaN];return Ib=Wb=Hb=Yb=Vb=Gb=Xb=Jb=Zb=0,t}};function Kb(t,e){Ib+=t,Wb+=e,++Hb}function tw(){Qb.point=ew}function ew(t,e){Qb.point=nw,Kb(Pb=t,jb=e)}function nw(t,e){var n=t-Pb,r=e-jb,i=E_(n*n+r*r);Yb+=i*(Pb+t)/2,Vb+=i*(jb+e)/2,Gb+=i,Kb(Pb=t,jb=e)}function rw(){Qb.point=Kb}function iw(){Qb.point=ow}function aw(){uw(Lb,$b)}function ow(t,e){Qb.point=uw,Kb(Lb=Pb=t,$b=jb=e)}function uw(t,e){var n=t-Pb,r=e-jb,i=E_(n*n+r*r);Yb+=i*(Pb+t)/2,Vb+=i*(jb+e)/2,Gb+=i,Xb+=(i=jb*t-Pb*e)*(Pb+t),Jb+=i*(jb+e),Zb+=3*i,Kb(Pb=t,jb=e)}function sw(t){this._context=t}sw.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,d_)}},result:S_};var lw,cw,fw,hw,dw,pw=o_(),gw={point:S_,lineStart:function(){gw.point=mw},lineEnd:function(){lw&&vw(cw,fw),gw.point=S_},polygonStart:function(){lw=!0},polygonEnd:function(){lw=null},result:function(){var t=+pw;return pw.reset(),t}};function mw(t,e){gw.point=vw,cw=hw=t,fw=dw=e}function vw(t,e){hw-=t,dw-=e,pw.add(E_(hw*hw+dw*dw)),hw=t,dw=e}function yw(){this._string=[]}function _w(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function xw(t,e){var n,r,i=4.5;function a(t){return t&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),R_(t,n(r))),r.result()}return a.area=function(t){return R_(t,n(Fb)),Fb.result()},a.measure=function(t){return R_(t,n(gw)),gw.result()},a.bounds=function(t){return R_(t,n(Ub)),Ub.result()},a.centroid=function(t){return R_(t,n(Qb)),Qb.result()},a.projection=function(e){return arguments.length?(n=null==e?(t=null,wb):(t=e).stream,a):t},a.context=function(t){return arguments.length?(r=null==t?(e=null,new yw):new sw(e=t),"function"!=typeof i&&r.pointRadius(i),a):e},a.pointRadius=function(t){return arguments.length?(i="function"==typeof t?t:(r.pointRadius(+t),+t),a):i},a.projection(t).context(e)}function bw(t){return function(e){var n=new ww;for(var r in t)n[r]=t[r];return n.stream=e,n}}function ww(){}function kw(t,e,n){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=r&&t.clipExtent(null),R_(n,t.stream(Ub)),e(Ub.result()),null!=r&&t.clipExtent(r),t}function Aw(t,e,n){return kw(t,(function(n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+e[0][0]+(r-a*(n[1][0]+n[0][0]))/2,u=+e[0][1]+(i-a*(n[1][1]+n[0][1]))/2;t.scale(150*a).translate([o,u])}),n)}function Mw(t,e,n){return Aw(t,[[0,0],e],n)}function Ew(t,e,n){return kw(t,(function(n){var r=+e,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];t.scale(150*i).translate([a,o])}),n)}function Dw(t,e,n){return kw(t,(function(n){var r=+e,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;t.scale(150*i).translate([a,o])}),n)}yw.prototype={_radius:4.5,_circle:_w(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=_w(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}},ww.prototype={constructor:ww,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Cw=__(30*g_);function Fw(t,e){return+e?function(t,e){function n(r,i,a,o,u,s,l,c,f,h,d,p,g,m){var v=l-r,y=c-i,_=v*v+y*y;if(_>4*e&&g--){var x=o+h,b=u+d,w=s+p,k=E_(x*x+b*b+w*w),A=F_(w/=k),M=m_(m_(w)-1)<1e-6||m_(a-f)<1e-6?(a+f)/2:y_(b,x),E=t(M,A),D=E[0],C=E[1],F=D-r,S=C-i,B=y*F-v*S;(B*B/_>e||m_((v*F+y*S)/_-.5)>.3||o*h+u*d+s*p<Cw)&&(n(r,i,a,o,u,s,D,C,M,x/=k,b/=k,w,g,m),m.point(D,C),n(D,C,M,x,b,w,l,c,f,h,d,p,g,m))}}return function(e){var r,i,a,o,u,s,l,c,f,h,d,p,g={point:m,lineStart:v,lineEnd:_,polygonStart:function(){e.polygonStart(),g.lineStart=x},polygonEnd:function(){e.polygonEnd(),g.lineStart=v}};function m(n,r){n=t(n,r),e.point(n[0],n[1])}function v(){c=NaN,g.point=y,e.lineStart()}function y(r,i){var a=J_([r,i]),o=t(r,i);n(c,f,l,h,d,p,c=o[0],f=o[1],l=r,h=a[0],d=a[1],p=a[2],16,e),e.point(c,f)}function _(){g.point=m,e.lineEnd()}function x(){v(),g.point=b,g.lineEnd=w}function b(t,e){y(r=t,e),i=c,a=f,o=h,u=d,s=p,g.point=y}function w(){n(c,f,l,h,d,p,i,a,r,o,u,s,16,e),g.lineEnd=_,_()}return g}}(t,e):function(t){return bw({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}(t)}var Sw=bw({point:function(t,e){this.stream.point(t*g_,e*g_)}});function Bw(t,e,n,r,i){function a(a,o){return[e+t*(a*=r),n-t*(o*=i)]}return a.invert=function(a,o){return[(a-e)/t*r,(n-o)/t*i]},a}function Tw(t,e,n,r,i,a){var o=__(a),u=A_(a),s=o*t,l=u*t,c=o/t,f=u/t,h=(u*n-o*e)/t,d=(u*e+o*n)/t;function p(t,a){return[s*(t*=r)-l*(a*=i)+e,n-l*t-s*a]}return p.invert=function(t,e){return[r*(c*t-f*e+h),i*(d-f*t-c*e)]},p}function zw(t){return Nw((function(){return t}))()}function Nw(t){var e,n,r,i,a,o,u,s,l,c,f=150,h=480,d=250,p=0,g=0,m=0,v=0,y=0,_=0,x=1,b=1,w=null,k=vb,A=null,M=wb,E=.5;function D(t){return s(t[0]*g_,t[1]*g_)}function C(t){return(t=s.invert(t[0],t[1]))&&[t[0]*p_,t[1]*p_]}function F(){var t=Tw(f,0,0,x,b,_).apply(null,e(p,g)),r=(_?Tw:Bw)(f,h-t[0],d-t[1],x,b,_);return n=Kx(m,v,y),u=Zx(e,r),s=Zx(n,u),o=Fw(u,E),S()}function S(){return l=c=null,D}return D.stream=function(t){return l&&c===t?l:l=Sw(function(t){return bw({point:function(e,n){var r=t(e,n);return this.stream.point(r[0],r[1])}})}(n)(k(o(M(c=t)))))},D.preclip=function(t){return arguments.length?(k=t,w=void 0,S()):k},D.postclip=function(t){return arguments.length?(M=t,A=r=i=a=null,S()):M},D.clipAngle=function(t){return arguments.length?(k=+t?yb(w=t*g_):(w=null,vb),S()):w*p_},D.clipExtent=function(t){return arguments.length?(M=null==t?(A=r=i=a=null,wb):_b(A=+t[0][0],r=+t[0][1],i=+t[1][0],a=+t[1][1]),S()):null==A?null:[[A,r],[i,a]]},D.scale=function(t){return arguments.length?(f=+t,F()):f},D.translate=function(t){return arguments.length?(h=+t[0],d=+t[1],F()):[h,d]},D.center=function(t){return arguments.length?(p=t[0]%360*g_,g=t[1]%360*g_,F()):[p*p_,g*p_]},D.rotate=function(t){return arguments.length?(m=t[0]%360*g_,v=t[1]%360*g_,y=t.length>2?t[2]%360*g_:0,F()):[m*p_,v*p_,y*p_]},D.angle=function(t){return arguments.length?(_=t%360*g_,F()):_*p_},D.reflectX=function(t){return arguments.length?(x=t?-1:1,F()):x<0},D.reflectY=function(t){return arguments.length?(b=t?-1:1,F()):b<0},D.precision=function(t){return arguments.length?(o=Fw(u,E=t*t),S()):E_(E)},D.fitExtent=function(t,e){return Aw(D,t,e)},D.fitSize=function(t,e){return Mw(D,t,e)},D.fitWidth=function(t,e){return Ew(D,t,e)},D.fitHeight=function(t,e){return Dw(D,t,e)},function(){return e=t.apply(this,arguments),D.invert=e.invert&&C,F()}}function Ow(t){var e=0,n=c_/3,r=Nw(t),i=r(e,n);return i.parallels=function(t){return arguments.length?r(e=t[0]*g_,n=t[1]*g_):[e*p_,n*p_]},i}function Rw(t,e){var n=A_(t),r=(n+A_(e))/2;if(m_(r)<1e-6)return function(t){var e=__(t);function n(t,n){return[t*e,A_(n)/e]}return n.invert=function(t,n){return[t/e,F_(n*e)]},n}(t);var i=1+n*(2*r-n),a=E_(i)/r;function o(t,e){var n=E_(i-2*r*A_(e))/r;return[n*A_(t*=r),a-n*__(t)]}return o.invert=function(t,e){var n=a-e,o=y_(t,m_(n))*M_(n);return n*r<0&&(o-=c_*M_(t)*M_(n)),[o/r,F_((i-(t*t+n*n)*r*r)/(2*r))]},o}function qw(){return Ow(Rw).scale(155.424).center([0,33.6442])}function Uw(){return qw().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Lw(t){return function(e,n){var r=__(e),i=__(n),a=t(r*i);return[a*i*A_(e),a*A_(n)]}}function $w(t){return function(e,n){var r=E_(e*e+n*n),i=t(r),a=A_(i),o=__(i);return[y_(e*a,r*o),F_(r&&n*a/r)]}}var Pw=Lw((function(t){return E_(2/(1+t))}));Pw.invert=$w((function(t){return 2*F_(t/2)}));var jw=Lw((function(t){return(t=C_(t))&&t/A_(t)}));function Iw(t,e){return[t,w_(D_((f_+e)/2))]}function Ww(t){var e,n,r,i=zw(t),a=i.center,o=i.scale,u=i.translate,s=i.clipExtent,l=null;function c(){var a=c_*o(),u=i(function(t){function e(e){return(e=t(e[0]*g_,e[1]*g_))[0]*=p_,e[1]*=p_,e}return t=Kx(t[0]*g_,t[1]*g_,t.length>2?t[2]*g_:0),e.invert=function(e){return(e=t.invert(e[0]*g_,e[1]*g_))[0]*=p_,e[1]*=p_,e},e}(i.rotate()).invert([0,0]));return s(null==l?[[u[0]-a,u[1]-a],[u[0]+a,u[1]+a]]:t===Iw?[[Math.max(u[0]-a,l),e],[Math.min(u[0]+a,n),r]]:[[l,Math.max(u[1]-a,e)],[n,Math.min(u[1]+a,r)]])}return i.scale=function(t){return arguments.length?(o(t),c()):o()},i.translate=function(t){return arguments.length?(u(t),c()):u()},i.center=function(t){return arguments.length?(a(t),c()):a()},i.clipExtent=function(t){return arguments.length?(null==t?l=e=n=r=null:(l=+t[0][0],e=+t[0][1],n=+t[1][0],r=+t[1][1]),c()):null==l?null:[[l,e],[n,r]]},c()}function Hw(t){return D_((f_+t)/2)}function Yw(t,e){var n=__(t),r=t===e?A_(t):w_(n/__(e))/w_(Hw(e)/Hw(t)),i=n*k_(Hw(t),r)/r;if(!r)return Iw;function a(t,e){i>0?e<1e-6-f_&&(e=1e-6-f_):e>f_-1e-6&&(e=f_-1e-6);var n=i/k_(Hw(e),r);return[n*A_(r*t),i-n*__(r*t)]}return a.invert=function(t,e){var n=i-e,a=M_(r)*E_(t*t+n*n),o=y_(t,m_(n))*M_(n);return n*r<0&&(o-=c_*M_(t)*M_(n)),[o/r,2*v_(k_(i/a,1/r))-f_]},a}function Vw(t,e){return[t,e]}function Gw(t,e){var n=__(t),r=t===e?A_(t):(n-__(e))/(e-t),i=n/r+t;if(m_(r)<1e-6)return Vw;function a(t,e){var n=i-e,a=r*t;return[n*A_(a),i-n*__(a)]}return a.invert=function(t,e){var n=i-e,a=y_(t,m_(n))*M_(n);return n*r<0&&(a-=c_*M_(t)*M_(n)),[a/r,i-M_(r)*E_(t*t+n*n)]},a}jw.invert=$w((function(t){return t})),Iw.invert=function(t,e){return[t,2*v_(b_(e))-f_]},Vw.invert=Vw;var Xw=1.340264,Jw=-.081106,Zw=893e-6,Qw=.003796,Kw=E_(3)/2;function tk(t,e){var n=F_(Kw*A_(e)),r=n*n,i=r*r*r;return[t*__(n)/(Kw*(Xw+3*Jw*r+i*(7*Zw+9*Qw*r))),n*(Xw+Jw*r+i*(Zw+Qw*r))]}function ek(t,e){var n=__(e),r=__(t)*n;return[n*A_(t)/r,A_(e)/r]}function nk(t,e){var n=e*e,r=n*n;return[t*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),e*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}function rk(t,e){return[__(e)*A_(t),A_(e)]}function ik(t,e){var n=__(e),r=1+__(t)*n;return[n*A_(t)/r,A_(e)/r]}function ak(t,e){return[w_(D_((f_+e)/2)),-t]}tk.invert=function(t,e){for(var n,r=e,i=r*r,a=i*i*i,o=0;o<12&&(a=(i=(r-=n=(r*(Xw+Jw*i+a*(Zw+Qw*i))-e)/(Xw+3*Jw*i+a*(7*Zw+9*Qw*i)))*r)*i*i,!(m_(n)<1e-12));++o);return[Kw*t*(Xw+3*Jw*i+a*(7*Zw+9*Qw*i))/__(r),F_(A_(r)/Kw)]},ek.invert=$w(v_),nk.invert=function(t,e){var n,r=e,i=25;do{var a=r*r,o=a*a;r-=n=(r*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))-e)/(1.007226+a*(.045255+o*(.259866*a-.311325-.005916*11*o)))}while(m_(n)>1e-6&&--i>0);return[t/(.8707+(a=r*r)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979)),r]},rk.invert=$w(F_),ik.invert=$w((function(t){return 2*v_(t)})),ak.invert=function(t,e){return[-e,2*v_(b_(t))-f_]};var ok=Math.abs,uk=Math.cos,sk=Math.sin,lk=Math.PI,ck=lk/2,fk=function(t){return t>0?Math.sqrt(t):0}(2);function hk(t){return t>1?ck:t<-1?-ck:Math.asin(t)}function dk(t,e){var n,r=t*sk(e),i=30;do{e-=n=(e+sk(e)-r)/(1+uk(e))}while(ok(n)>1e-6&&--i>0);return e/2}var pk=function(t,e,n){function r(r,i){return[t*r*uk(i=dk(n,i)),e*sk(i)]}return r.invert=function(r,i){return i=hk(i/e),[r/(t*uk(i)),hk((2*i+sk(2*i))/n)]},r}(fk/ck,fk,lk);var gk=xw(),mk=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function vk(t,e){return function n(){var r=e();return r.type=t,r.path=xw().projection(r),r.copy=r.copy||function(){var t=n();return mk.forEach((function(e){r[e]&&t[e](r[e]())})),t.path.pointRadius(r.path.pointRadius()),t},r}}function yk(t,e){if(!t||"string"!=typeof t)throw new Error("Projection type must be a name string.");return t=t.toLowerCase(),arguments.length>1?(xk[t]=vk(t,e),this):xk[t]||null}function _k(t){return t&&t.path||gk}var xk={albers:Uw,albersusa:function(){var t,e,n,r,i,a,o=Uw(),u=qw().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=qw().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(t,e){a=[t,e]}};function c(t){var e=t[0],o=t[1];return a=null,n.point(e,o),a||(r.point(e,o),a)||(i.point(e,o),a)}function f(){return t=e=null,c}return c.invert=function(t){var e=o.scale(),n=o.translate(),r=(t[0]-n[0])/e,i=(t[1]-n[1])/e;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?u:i>=.166&&i<.234&&r>=-.214&&r<-.115?s:o).invert(t)},c.stream=function(n){return t&&e===n?t:(r=[o.stream(e=n),u.stream(n),s.stream(n)],i=r.length,t={point:function(t,e){for(var n=-1;++n<i;)r[n].point(t,e)},sphere:function(){for(var t=-1;++t<i;)r[t].sphere()},lineStart:function(){for(var t=-1;++t<i;)r[t].lineStart()},lineEnd:function(){for(var t=-1;++t<i;)r[t].lineEnd()},polygonStart:function(){for(var t=-1;++t<i;)r[t].polygonStart()},polygonEnd:function(){for(var t=-1;++t<i;)r[t].polygonEnd()}});var r,i},c.precision=function(t){return arguments.length?(o.precision(t),u.precision(t),s.precision(t),f()):o.precision()},c.scale=function(t){return arguments.length?(o.scale(t),u.scale(.35*t),s.scale(t),c.translate(o.translate())):o.scale()},c.translate=function(t){if(!arguments.length)return o.translate();var e=o.scale(),a=+t[0],c=+t[1];return n=o.translate(t).clipExtent([[a-.455*e,c-.238*e],[a+.455*e,c+.238*e]]).stream(l),r=u.translate([a-.307*e,c+.201*e]).clipExtent([[a-.425*e+1e-6,c+.12*e+1e-6],[a-.214*e-1e-6,c+.234*e-1e-6]]).stream(l),i=s.translate([a-.205*e,c+.212*e]).clipExtent([[a-.214*e+1e-6,c+.166*e+1e-6],[a-.115*e-1e-6,c+.234*e-1e-6]]).stream(l),f()},c.fitExtent=function(t,e){return Aw(c,t,e)},c.fitSize=function(t,e){return Mw(c,t,e)},c.fitWidth=function(t,e){return Ew(c,t,e)},c.fitHeight=function(t,e){return Dw(c,t,e)},c.scale(1070)},azimuthalequalarea:function(){return zw(Pw).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return zw(jw).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return Ow(Yw).scale(109.5).parallels([30,30])},conicequalarea:qw,conicequidistant:function(){return Ow(Gw).scale(131.154).center([0,13.9389])},equalEarth:function(){return zw(tk).scale(177.158)},equirectangular:function(){return zw(Vw).scale(152.63)},gnomonic:function(){return zw(ek).scale(144.049).clipAngle(60)},identity:function(){var t,e,n,r,i,a,o,u=1,s=0,l=0,c=1,f=1,h=0,d=null,p=1,g=1,m=bw({point:function(t,e){var n=_([t,e]);this.stream.point(n[0],n[1])}}),v=wb;function y(){return p=u*c,g=u*f,a=o=null,_}function _(n){var r=n[0]*p,i=n[1]*g;if(h){var a=i*t-r*e;r=r*t+i*e,i=a}return[r+s,i+l]}return _.invert=function(n){var r=n[0]-s,i=n[1]-l;if(h){var a=i*t+r*e;r=r*t-i*e,i=a}return[r/p,i/g]},_.stream=function(t){return a&&o===t?a:a=m(v(o=t))},_.postclip=function(t){return arguments.length?(v=t,d=n=r=i=null,y()):v},_.clipExtent=function(t){return arguments.length?(v=null==t?(d=n=r=i=null,wb):_b(d=+t[0][0],n=+t[0][1],r=+t[1][0],i=+t[1][1]),y()):null==d?null:[[d,n],[r,i]]},_.scale=function(t){return arguments.length?(u=+t,y()):u},_.translate=function(t){return arguments.length?(s=+t[0],l=+t[1],y()):[s,l]},_.angle=function(n){return arguments.length?(e=A_(h=n%360*g_),t=__(h),y()):h*p_},_.reflectX=function(t){return arguments.length?(c=t?-1:1,y()):c<0},_.reflectY=function(t){return arguments.length?(f=t?-1:1,y()):f<0},_.fitExtent=function(t,e){return Aw(_,t,e)},_.fitSize=function(t,e){return Mw(_,t,e)},_.fitWidth=function(t,e){return Ew(_,t,e)},_.fitHeight=function(t,e){return Dw(_,t,e)},_},mercator:function(){return Ww(Iw).scale(961/d_)},mollweide:function(){return zw(pk).scale(169.529)},naturalEarth1:function(){return zw(nk).scale(175.295)},orthographic:function(){return zw(rk).scale(249.5).clipAngle(90.000001)},stereographic:function(){return zw(ik).scale(250).clipAngle(142)},transversemercator:function(){var t=Ww(ak),e=t.center,n=t.rotate;return t.center=function(t){return arguments.length?e([-t[1],t[0]]):[(t=e())[1],-t[0]]},t.rotate=function(t){return arguments.length?n([t[0],t[1],t.length>2?t[2]+90:90]):[(t=n())[0],t[1],t[2]-90]},n([0,0,90]).scale(159.155)}};for(var bk in xk)yk(bk,xk[bk]);function wk(t){Xa.call(this,null,t)}function kk(t){Xa.call(this,null,t)}function Ak(t){Xa.call(this,null,t)}function Mk(t){Xa.call(this,[],t),this.generator=function(){var t,e,n,r,i,a,o,u,s,l,c,f,h=10,d=h,p=90,g=360,m=2.5;function v(){return{type:"MultiLineString",coordinates:y()}}function y(){return hb(x_(r/p)*p,n,p).map(c).concat(hb(x_(u/g)*g,o,g).map(f)).concat(hb(x_(e/h)*h,t,h).filter((function(t){return m_(t%p)>1e-6})).map(s)).concat(hb(x_(a/d)*d,i,d).filter((function(t){return m_(t%g)>1e-6})).map(l))}return v.lines=function(){return y().map((function(t){return{type:"LineString",coordinates:t}}))},v.outline=function(){return{type:"Polygon",coordinates:[c(r).concat(f(o).slice(1),c(n).reverse().slice(1),f(u).reverse().slice(1))]}},v.extent=function(t){return arguments.length?v.extentMajor(t).extentMinor(t):v.extentMinor()},v.extentMajor=function(t){return arguments.length?(r=+t[0][0],n=+t[1][0],u=+t[0][1],o=+t[1][1],r>n&&(t=r,r=n,n=t),u>o&&(t=u,u=o,o=t),v.precision(m)):[[r,u],[n,o]]},v.extentMinor=function(n){return arguments.length?(e=+n[0][0],t=+n[1][0],a=+n[0][1],i=+n[1][1],e>t&&(n=e,e=t,t=n),a>i&&(n=a,a=i,i=n),v.precision(m)):[[e,a],[t,i]]},v.step=function(t){return arguments.length?v.stepMajor(t).stepMinor(t):v.stepMinor()},v.stepMajor=function(t){return arguments.length?(p=+t[0],g=+t[1],v):[p,g]},v.stepMinor=function(t){return arguments.length?(h=+t[0],d=+t[1],v):[h,d]},v.precision=function(h){return arguments.length?(m=+h,s=xb(a,i,90),l=bb(e,t,m),c=xb(u,o,90),f=bb(r,n,m),v):m},v.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function Ek(t){Xa.call(this,null,t)}function Dk(t){if(!Y(t))return!1;const e=Dt(r(t));return e.$x||e.$y||e.$value||e.$max}function Ck(t){Xa.call(this,null,t),this.modified(!0)}function Fk(t,e,n){Y(t[e])&&t[e](n)}wk.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},st(wk,Xa).transform=function(t,e){var n=e.fork(e.ALL),r=this.value,i=t.field||h,a=t.as||"path",o=n.SOURCE;!r||t.modified()?(this.value=r=_k(t.projection),n.materialize().reflow()):o=i===h||e.modified(i.fields)?n.ADD_MOD:n.ADD;var u=function(t,e){var n=t.pointRadius();t.context(null),null!=e&&t.pointRadius(e);return n}(r,t.pointRadius);return n.visit(o,(function(t){t[a]=r(i(t))})),r.pointRadius(u),n.modifies(a)},kk.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},st(kk,Xa).transform=function(t,e){var n,r=t.projection,i=t.fields[0],a=t.fields[1],o=t.as||["x","y"],u=o[0],s=o[1];function l(t){var e=r([i(t),a(t)]);e?(t[u]=e[0],t[s]=e[1]):(t[u]=void 0,t[s]=void 0)}return t.modified()?e=e.materialize().reflow(!0).visit(e.SOURCE,l):(n=e.modified(i.fields)||e.modified(a.fields),e.visit(n?e.ADD_MOD:e.ADD,l)),e.modifies(o)},Ak.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},st(Ak,Xa).transform=function(t,e){var n=e.fork(e.ALL),r=this.value,i=t.as||"shape",a=n.ADD;return r&&!t.modified()||(this.value=r=function(t,e,n){var r=null==n?function(n){return t(e(n))}:function(r){var i=t.pointRadius(),a=t.pointRadius(n)(e(r));return t.pointRadius(i),a};return r.context=function(e){return t.context(e),r},r}(_k(t.projection),t.field||l("datum"),t.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,(function(t){t[i]=r})),n.modifies(i)},Mk.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},st(Mk,Xa).transform=function(t,e){var n,r=this.value,i=this.generator;if(!r.length||t.modified())for(var a in t)Y(i[a])&&i[a](t[a]);return n=i(),r.length?e.mod.push($t(r[0],n)):e.add.push(qt(n)),r[0]=n,e},Ek.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},st(Ek,Xa).transform=function(t,e){if(!e.changed()&&!t.modified())return e.StopPropagation;var n=e.materialize(e.SOURCE).source,r="shared"===t.resolve,i=t.field||h,a=function(t,e){let n;Y(t)?(n=n=>t(n,e),n.dep=Dk(t)):t?n=Q(t):(n=t=>t.$value/t.$max||0,n.dep=!0);return n}(t.opacity,t),o=function(t,e){let n;Y(t)?(n=n=>Yd(t(n,e)),n.dep=Dk(t)):n=Q(Yd(t||"#888"));return n}(t.color,t),u=t.as||"image",s={$x:0,$y:0,$value:0,$max:r?Ke(n.map(t=>Ke(i(t).values))):0};return n.forEach(t=>{const e=i(t),n=tt({},t,s);r||(n.$max=Ke(e.values||[])),t[u]=function(t,e,n,r){const i=t.width,a=t.height,o=t.x1||0,u=t.y1||0,s=t.x2||i,l=t.y2||a,c=t.values,f=c?t=>c[t]:d,h=jc(s-o,l-u),p=h.getContext("2d"),g=p.getImageData(0,0,s-o,l-u),m=g.data;for(let t=u,a=0;t<l;++t){e.$y=t-u;for(let u=o,l=t*i;u<s;++u,a+=4){e.$x=u-o,e.$value=f(u+l);const t=n(e);m[a+0]=t.r,m[a+1]=t.g,m[a+2]=t.b,m[a+3]=~~(255*r(e))}}return p.putImageData(g,0,0),h}(e,n,o.dep?o:Q(o(n)),a.dep?a:Q(a(n)))}),e.reflow(!0).modifies(u)},st(Ck,Xa).transform=function(t,e){var n=this.value;return!n||t.modified("type")?(this.value=n=function(t){var e=yk((t||"mercator").toLowerCase());e||u("Unrecognized projection type: "+t);return e()}(t.type),mk.forEach((function(e){null!=t[e]&&Fk(n,e,t[e])}))):mk.forEach((function(e){t.modified(e)&&Fk(n,e,t[e])})),null!=t.pointRadius&&n.path.pointRadius(t.pointRadius),t.fit&&function(t,e){var n=function(t){return 1===(t=W(t)).length?t[0]:{type:"FeatureCollection",features:t.reduce((t,e)=>t.concat(function(t){return"FeatureCollection"===t.type?t.features:W(t).filter(t=>null!=t).map(t=>"Feature"===t.type?t:{type:"Feature",geometry:t})}(e)),[])}}(e.fit);e.extent?t.fitExtent(e.extent,n):e.size&&t.fitSize(e.size,n)}(n,t),e.fork(e.NO_SOURCE|e.NO_FIELDS)};var Sk=Object.freeze({__proto__:null,contour:i_,geojson:a_,geopath:wk,geopoint:kk,geoshape:Ak,graticule:Mk,heatmap:Ek,isocontour:Vy,kde2d:t_,projection:Ck});function Bk(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,a,o,u,s,l,c,f,h,d=t._root,p={data:r},g=t._x0,m=t._y0,v=t._x1,y=t._y1;if(!d)return t._root=p,t;for(;d.length;)if((l=e>=(a=(g+v)/2))?g=a:v=a,(c=n>=(o=(m+y)/2))?m=o:y=o,i=d,!(d=d[f=c<<1|l]))return i[f]=p,t;if(u=+t._x.call(null,d.data),s=+t._y.call(null,d.data),e===u&&n===s)return p.next=d,i?i[f]=p:t._root=p,t;do{i=i?i[f]=new Array(4):t._root=new Array(4),(l=e>=(a=(g+v)/2))?g=a:v=a,(c=n>=(o=(m+y)/2))?m=o:y=o}while((f=c<<1|l)==(h=(s>=o)<<1|u>=a));return i[h]=d,i[f]=p,t}function Tk(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function zk(t){return t[0]}function Nk(t){return t[1]}function Ok(t,e,n){var r=new Rk(null==e?zk:e,null==n?Nk:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function Rk(t,e,n,r,i,a){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=a,this._root=void 0}function qk(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Uk=Ok.prototype=Rk.prototype;function Lk(t){return function(){return t}}function $k(){return 1e-6*(Math.random()-.5)}function Pk(t){return t.x+t.vx}function jk(t){return t.y+t.vy}function Ik(t){return t.index}function Wk(t,e){var n=t.get(e);if(!n)throw new Error("missing: "+e);return n}Uk.copy=function(){var t,e,n=new Rk(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=qk(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=qk(e));return n},Uk.add=function(t){var e=+this._x.call(null,t),n=+this._y.call(null,t);return Bk(this.cover(e,n),e,n,t)},Uk.addAll=function(t){var e,n,r,i,a=t.length,o=new Array(a),u=new Array(a),s=1/0,l=1/0,c=-1/0,f=-1/0;for(n=0;n<a;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(o[n]=r,u[n]=i,r<s&&(s=r),r>c&&(c=r),i<l&&(l=i),i>f&&(f=i));if(s>c||l>f)return this;for(this.cover(s,l).cover(c,f),n=0;n<a;++n)Bk(this,o[n],u[n],t[n]);return this},Uk.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,a=(r=Math.floor(e))+1;else{for(var o,u,s=i-n,l=this._root;n>t||t>=i||r>e||e>=a;)switch(u=(e<r)<<1|t<n,(o=new Array(4))[u]=l,l=o,s*=2,u){case 0:i=n+s,a=r+s;break;case 1:n=i-s,a=r+s;break;case 2:i=n+s,r=a-s;break;case 3:n=i-s,r=a-s}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=r,this._x1=i,this._y1=a,this},Uk.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},Uk.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Uk.find=function(t,e,n){var r,i,a,o,u,s,l,c=this._x0,f=this._y0,h=this._x1,d=this._y1,p=[],g=this._root;for(g&&p.push(new Tk(g,c,f,h,d)),null==n?n=1/0:(c=t-n,f=e-n,h=t+n,d=e+n,n*=n);s=p.pop();)if(!(!(g=s.node)||(i=s.x0)>h||(a=s.y0)>d||(o=s.x1)<c||(u=s.y1)<f))if(g.length){var m=(i+o)/2,v=(a+u)/2;p.push(new Tk(g[3],m,v,o,u),new Tk(g[2],i,v,m,u),new Tk(g[1],m,a,o,v),new Tk(g[0],i,a,m,v)),(l=(e>=v)<<1|t>=m)&&(s=p[p.length-1],p[p.length-1]=p[p.length-1-l],p[p.length-1-l]=s)}else{var y=t-+this._x.call(null,g.data),_=e-+this._y.call(null,g.data),x=y*y+_*_;if(x<n){var b=Math.sqrt(n=x);c=t-b,f=e-b,h=t+b,d=e+b,r=g.data}}return r},Uk.remove=function(t){if(isNaN(a=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,n,r,i,a,o,u,s,l,c,f,h,d=this._root,p=this._x0,g=this._y0,m=this._x1,v=this._y1;if(!d)return this;if(d.length)for(;;){if((l=a>=(u=(p+m)/2))?p=u:m=u,(c=o>=(s=(g+v)/2))?g=s:v=s,e=d,!(d=d[f=c<<1|l]))return this;if(!d.length)break;(e[f+1&3]||e[f+2&3]||e[f+3&3])&&(n=e,h=f)}for(;d.data!==t;)if(r=d,!(d=d.next))return this;return(i=d.next)&&delete d.next,r?(i?r.next=i:delete r.next,this):e?(i?e[f]=i:delete e[f],(d=e[0]||e[1]||e[2]||e[3])&&d===(e[3]||e[2]||e[1]||e[0])&&!d.length&&(n?n[h]=d:this._root=d),this):(this._root=i,this)},Uk.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Uk.root=function(){return this._root},Uk.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},Uk.visit=function(t){var e,n,r,i,a,o,u=[],s=this._root;for(s&&u.push(new Tk(s,this._x0,this._y0,this._x1,this._y1));e=u.pop();)if(!t(s=e.node,r=e.x0,i=e.y0,a=e.x1,o=e.y1)&&s.length){var l=(r+a)/2,c=(i+o)/2;(n=s[3])&&u.push(new Tk(n,l,c,a,o)),(n=s[2])&&u.push(new Tk(n,r,c,l,o)),(n=s[1])&&u.push(new Tk(n,l,i,a,c)),(n=s[0])&&u.push(new Tk(n,r,i,l,c))}return this},Uk.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Tk(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var a,o=e.x0,u=e.y0,s=e.x1,l=e.y1,c=(o+s)/2,f=(u+l)/2;(a=i[0])&&n.push(new Tk(a,o,u,c,f)),(a=i[1])&&n.push(new Tk(a,c,u,s,f)),(a=i[2])&&n.push(new Tk(a,o,f,c,l)),(a=i[3])&&n.push(new Tk(a,c,f,s,l))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},Uk.x=function(t){return arguments.length?(this._x=t,this):this._x},Uk.y=function(t){return arguments.length?(this._y=t,this):this._y};var Hk={value:function(){}};function Yk(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new Vk(r)}function Vk(t){this._=t}function Gk(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function Xk(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function Jk(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Hk,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}Vk.prototype=Yk.prototype={constructor:Vk,on:function(t,e){var n,r=this._,i=Gk(t+"",r),a=-1,o=i.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<o;)if(n=(t=i[a]).type)r[n]=Jk(r[n],t.name,e);else if(null==e)for(n in r)r[n]=Jk(r[n],t.name,null);return this}for(;++a<o;)if((n=(t=i[a]).type)&&(n=Xk(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Vk(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=0,n=(r=this._[t]).length;a<n;++a)r[a].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,a=r.length;i<a;++i)r[i].value.apply(e,n)}};var Zk,Qk,Kk=0,tA=0,eA=0,nA=0,rA=0,iA=0,aA="object"==typeof performance&&performance.now?performance:Date,oA="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function uA(){return rA||(oA(sA),rA=aA.now()+iA)}function sA(){rA=0}function lA(){this._call=this._time=this._next=null}function cA(t,e,n){var r=new lA;return r.restart(t,e,n),r}function fA(){rA=(nA=aA.now())+iA,Kk=tA=0;try{!function(){uA(),++Kk;for(var t,e=Zk;e;)(t=rA-e._time)>=0&&e._call.call(null,t),e=e._next;--Kk}()}finally{Kk=0,function(){var t,e,n=Zk,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Zk=e);Qk=t,dA(r)}(),rA=0}}function hA(){var t=aA.now(),e=t-nA;e>1e3&&(iA-=e,nA=t)}function dA(t){Kk||(tA&&(tA=clearTimeout(tA)),t-rA>24?(t<1/0&&(tA=setTimeout(fA,t-aA.now()-iA)),eA&&(eA=clearInterval(eA))):(eA||(nA=aA.now(),eA=setInterval(hA,1e3)),Kk=1,oA(fA)))}function pA(t){return t.x}function gA(t){return t.y}lA.prototype=cA.prototype={constructor:lA,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?uA():+n)+(null==e?0:+e),this._next||Qk===this||(Qk?Qk._next=this:Zk=this,Qk=this),this._call=t,this._time=n,dA()},stop:function(){this._call&&(this._call=null,this._time=1/0,dA())}};var mA=Math.PI*(3-Math.sqrt(5));var vA={center:function(t,e){var n;function r(){var r,i,a=n.length,o=0,u=0;for(r=0;r<a;++r)o+=(i=n[r]).x,u+=i.y;for(o=o/a-t,u=u/a-e,r=0;r<a;++r)(i=n[r]).x-=o,i.y-=u}return null==t&&(t=0),null==e&&(e=0),r.initialize=function(t){n=t},r.x=function(e){return arguments.length?(t=+e,r):t},r.y=function(t){return arguments.length?(e=+t,r):e},r},collide:function(t){var e,n,r=1,i=1;function a(){for(var t,a,u,s,l,c,f,h=e.length,d=0;d<i;++d)for(a=Ok(e,Pk,jk).visitAfter(o),t=0;t<h;++t)u=e[t],c=n[u.index],f=c*c,s=u.x+u.vx,l=u.y+u.vy,a.visit(p);function p(t,e,n,i,a){var o=t.data,h=t.r,d=c+h;if(!o)return e>s+d||i<s-d||n>l+d||a<l-d;if(o.index>u.index){var p=s-o.x-o.vx,g=l-o.y-o.vy,m=p*p+g*g;m<d*d&&(0===p&&(m+=(p=$k())*p),0===g&&(m+=(g=$k())*g),m=(d-(m=Math.sqrt(m)))/m*r,u.vx+=(p*=m)*(d=(h*=h)/(f+h)),u.vy+=(g*=m)*d,o.vx-=p*(d=1-d),o.vy-=g*d)}}}function o(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function u(){if(e){var r,i,a=e.length;for(n=new Array(a),r=0;r<a;++r)i=e[r],n[i.index]=+t(i,r,e)}}return"function"!=typeof t&&(t=Lk(null==t?1:+t)),a.initialize=function(t){e=t,u()},a.iterations=function(t){return arguments.length?(i=+t,a):i},a.strength=function(t){return arguments.length?(r=+t,a):r},a.radius=function(e){return arguments.length?(t="function"==typeof e?e:Lk(+e),u(),a):t},a},nbody:function(){var t,e,n,r,i=Lk(-30),a=1,o=1/0,u=.81;function s(r){var i,a=t.length,o=Ok(t,pA,gA).visitAfter(c);for(n=r,i=0;i<a;++i)e=t[i],o.visit(f)}function l(){if(t){var e,n,a=t.length;for(r=new Array(a),e=0;e<a;++e)n=t[e],r[n.index]=+i(n,e,t)}}function c(t){var e,n,i,a,o,u=0,s=0;if(t.length){for(i=a=o=0;o<4;++o)(e=t[o])&&(n=Math.abs(e.value))&&(u+=e.value,s+=n,i+=n*e.x,a+=n*e.y);t.x=i/s,t.y=a/s}else{(e=t).x=e.data.x,e.y=e.data.y;do{u+=r[e.data.index]}while(e=e.next)}t.value=u}function f(t,i,s,l){if(!t.value)return!0;var c=t.x-e.x,f=t.y-e.y,h=l-i,d=c*c+f*f;if(h*h/u<d)return d<o&&(0===c&&(d+=(c=$k())*c),0===f&&(d+=(f=$k())*f),d<a&&(d=Math.sqrt(a*d)),e.vx+=c*t.value*n/d,e.vy+=f*t.value*n/d),!0;if(!(t.length||d>=o)){(t.data!==e||t.next)&&(0===c&&(d+=(c=$k())*c),0===f&&(d+=(f=$k())*f),d<a&&(d=Math.sqrt(a*d)));do{t.data!==e&&(h=r[t.data.index]*n/d,e.vx+=c*h,e.vy+=f*h)}while(t=t.next)}}return s.initialize=function(e){t=e,l()},s.strength=function(t){return arguments.length?(i="function"==typeof t?t:Lk(+t),l(),s):i},s.distanceMin=function(t){return arguments.length?(a=t*t,s):Math.sqrt(a)},s.distanceMax=function(t){return arguments.length?(o=t*t,s):Math.sqrt(o)},s.theta=function(t){return arguments.length?(u=t*t,s):Math.sqrt(u)},s},link:function(t){var e,n,r,i,a,o=Ik,u=function(t){return 1/Math.min(i[t.source.index],i[t.target.index])},s=Lk(30),l=1;function c(r){for(var i=0,o=t.length;i<l;++i)for(var u,s,c,f,h,d,p,g=0;g<o;++g)s=(u=t[g]).source,f=(c=u.target).x+c.vx-s.x-s.vx||$k(),h=c.y+c.vy-s.y-s.vy||$k(),f*=d=((d=Math.sqrt(f*f+h*h))-n[g])/d*r*e[g],h*=d,c.vx-=f*(p=a[g]),c.vy-=h*p,s.vx+=f*(p=1-p),s.vy+=h*p}function f(){if(r){var u,s,l=r.length,c=t.length,f=new Map(r.map((t,e)=>[o(t,e,r),t]));for(u=0,i=new Array(l);u<c;++u)(s=t[u]).index=u,"object"!=typeof s.source&&(s.source=Wk(f,s.source)),"object"!=typeof s.target&&(s.target=Wk(f,s.target)),i[s.source.index]=(i[s.source.index]||0)+1,i[s.target.index]=(i[s.target.index]||0)+1;for(u=0,a=new Array(c);u<c;++u)s=t[u],a[u]=i[s.source.index]/(i[s.source.index]+i[s.target.index]);e=new Array(c),h(),n=new Array(c),d()}}function h(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+u(t[n],n,t)}function d(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+s(t[e],e,t)}return null==t&&(t=[]),c.initialize=function(t){r=t,f()},c.links=function(e){return arguments.length?(t=e,f(),c):t},c.id=function(t){return arguments.length?(o=t,c):o},c.iterations=function(t){return arguments.length?(l=+t,c):l},c.strength=function(t){return arguments.length?(u="function"==typeof t?t:Lk(+t),h(),c):u},c.distance=function(t){return arguments.length?(s="function"==typeof t?t:Lk(+t),d(),c):s},c},x:function(t){var e,n,r,i=Lk(.1);function a(t){for(var i,a=0,o=e.length;a<o;++a)(i=e[a]).vx+=(r[a]-i.x)*n[a]*t}function o(){if(e){var a,o=e.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+t(e[a],a,e))?0:+i(e[a],a,e)}}return"function"!=typeof t&&(t=Lk(null==t?0:+t)),a.initialize=function(t){e=t,o()},a.strength=function(t){return arguments.length?(i="function"==typeof t?t:Lk(+t),o(),a):i},a.x=function(e){return arguments.length?(t="function"==typeof e?e:Lk(+e),o(),a):t},a},y:function(t){var e,n,r,i=Lk(.1);function a(t){for(var i,a=0,o=e.length;a<o;++a)(i=e[a]).vy+=(r[a]-i.y)*n[a]*t}function o(){if(e){var a,o=e.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+t(e[a],a,e))?0:+i(e[a],a,e)}}return"function"!=typeof t&&(t=Lk(null==t?0:+t)),a.initialize=function(t){e=t,o()},a.strength=function(t){return arguments.length?(i="function"==typeof t?t:Lk(+t),o(),a):i},a.y=function(e){return arguments.length?(t="function"==typeof e?e:Lk(+e),o(),a):t},a}},yA=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],_A=["static","iterations"],xA=["x","y","vx","vy"];function bA(t){Xa.call(this,null,t)}bA.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:xA}]};var wA=st(bA,Xa);function kA(t,e,n,r){var i,a,o,u,s=W(e.forces);for(i=0,a=yA.length;i<a;++i)"forces"!==(o=yA[i])&&e.modified(o)&&t[o](e[o]);for(i=0,a=s.length;i<a;++i)u="forces"+i,(o=n||e.modified("forces",i)?MA(s[i]):r&&AA(s[i],r)?t.force(u):null)&&t.force(u,o);for(a=t.numForces||0;i<a;++i)t.force("forces"+i,null);return t.numForces=s.length,t}function AA(t,e){var n,i;for(n in t)if(Y(i=t[n])&&e.modified(r(i)))return 1;return 0}function MA(t){var e,n;for(n in it(vA,t.force)||u("Unrecognized force: "+t.force),e=vA[t.force](),t)Y(e[n])&&EA(e[n],t[n],t);return e}function EA(t,e,n){t(Y(e)?function(t){return e(t,n)}:e)}wA.transform=function(t,e){var n,r,i=this.value,a=e.changed(e.ADD_REM),o=t.modified(yA),u=t.iterations||300;if(i?(a&&(e.modifies("index"),i.nodes(e.source)),(o||e.changed(e.MOD))&&kA(i,t,0,e)):(this.value=i=function(t,e){var n=function(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),a=0,o=.6,u=new Map,s=cA(c),l=Yk("tick","end");function c(){f(),l.call("tick",e),n<r&&(s.stop(),l.call("end",e))}function f(r){var s,l,c=t.length;void 0===r&&(r=1);for(var f=0;f<r;++f)for(n+=(a-n)*i,u.forEach((function(t){t(n)})),s=0;s<c;++s)null==(l=t[s]).fx?l.x+=l.vx*=o:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=o:(l.y=l.fy,l.vy=0);return e}function h(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var i=10*Math.sqrt(n),a=n*mA;e.x=i*Math.cos(a),e.y=i*Math.sin(a)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function d(e){return e.initialize&&e.initialize(t),e}return null==t&&(t=[]),h(),e={tick:f,restart:function(){return s.restart(c),e},stop:function(){return s.stop(),e},nodes:function(n){return arguments.length?(t=n,h(),u.forEach(d),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(r=+t,e):r},alphaDecay:function(t){return arguments.length?(i=+t,e):+i},alphaTarget:function(t){return arguments.length?(a=+t,e):a},velocityDecay:function(t){return arguments.length?(o=1-t,e):1-o},force:function(t,n){return arguments.length>1?(null==n?u.delete(t):u.set(t,d(n)),e):u.get(t)},find:function(e,n,r){var i,a,o,u,s,l=0,c=t.length;for(null==r?r=1/0:r*=r,l=0;l<c;++l)(o=(i=e-(u=t[l]).x)*i+(a=n-u.y)*a)<r&&(s=u,r=o);return s},on:function(t,n){return arguments.length>1?(l.on(t,n),e):l.on(t)}}}(t),r=!1,i=n.stop,a=n.restart;return n.stopped=function(){return r},n.restart=function(){return r=!1,a()},n.stop=function(){return r=!0,i()},kA(n,e,!0).on("end",(function(){r=!0}))}(e.source,t),i.on("tick",(n=e.dataflow,r=this,function(){n.touch(r).run()})),t.static||(a=!0,i.tick()),e.modifies("index")),o||a||t.modified(_A)||e.changed()&&t.restart)if(i.alpha(Math.max(i.alpha(),t.alpha||1)).alphaDecay(1-Math.pow(i.alphaMin(),1/u)),t.static)for(i.stop();--u>=0;)i.tick();else if(i.stopped()&&i.restart(),!a)return e.StopPropagation;return this.finish(t,e)},wA.finish=function(t,e){for(var n,r=e.dataflow,i=this._argops,a=0,o=i.length;a<o;++a)if("forces"===(n=i[a]).name&&"link"===n.op._argval.force)for(var u,s=n.op._argops,l=0,c=s.length;l<c;++l)if("links"===s[l].name&&(u=s[l].op.source)){r.pulse(u,r.changeset().reflow());break}return e.reflow(t.modified()).modifies(xA)};var DA=Object.freeze({__proto__:null,force:bA});function CA(t,e,n){var r={};return t.each((function(t){var i=t.data;n(i)&&(r[e(i)]=t)})),t.lookup=r,t}function FA(t,e){return t.parent===e.parent?1:2}function SA(t,e){return t+e.x}function BA(t,e){return Math.max(t,e.y)}function TA(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}function zA(t,e){var n,r,i,a,o,u=new qA(t),s=+t.value&&(u.value=t.value),l=[u];for(null==e&&(e=NA);n=l.pop();)if(s&&(n.value=+n.data.value),(i=e(n.data))&&(o=i.length))for(n.children=new Array(o),a=o-1;a>=0;--a)l.push(r=n.children[a]=new qA(i[a])),r.parent=n,r.depth=n.depth+1;return u.eachBefore(RA)}function NA(t){return t.children}function OA(t){t.data=t.data.data}function RA(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function qA(t){this.data=t,this.depth=this.height=0,this.parent=null}qA.prototype=zA.prototype={constructor:qA,count:function(){return this.eachAfter(TA)},each:function(t){var e,n,r,i,a=this,o=[a];do{for(e=o.reverse(),o=[];a=e.pop();)if(t(a),n=a.children)for(r=0,i=n.length;r<i;++r)o.push(n[r])}while(o.length);return this},eachAfter:function(t){for(var e,n,r,i=this,a=[i],o=[];i=a.pop();)if(o.push(i),e=i.children)for(n=0,r=e.length;n<r;++n)a.push(e[n]);for(;i=o.pop();)t(i);return this},eachBefore:function(t){for(var e,n,r=this,i=[r];r=i.pop();)if(t(r),e=r.children)for(n=e.length-1;n>=0;--n)i.push(e[n]);return this},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)n+=r[i].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),i=null;t=n.pop(),e=r.pop();for(;t===e;)i=t,t=n.pop(),e=r.pop();return i}(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var i=r.length;t!==n;)r.splice(i,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){var t=[];return this.each((function(e){t.push(e)})),t},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return zA(this).eachBefore(OA)}};var UA=Array.prototype.slice;function LA(t){for(var e,n,r=0,i=(t=function(t){for(var e,n,r=t.length;r;)n=Math.random()*r--|0,e=t[r],t[r]=t[n],t[n]=e;return t}(UA.call(t))).length,a=[];r<i;)e=t[r],n&&jA(n,e)?++r:(n=WA(a=$A(a,e)),r=0);return n}function $A(t,e){var n,r;if(IA(e,t))return[e];for(n=0;n<t.length;++n)if(PA(e,t[n])&&IA(HA(t[n],e),t))return[t[n],e];for(n=0;n<t.length-1;++n)for(r=n+1;r<t.length;++r)if(PA(HA(t[n],t[r]),e)&&PA(HA(t[n],e),t[r])&&PA(HA(t[r],e),t[n])&&IA(YA(t[n],t[r],e),t))return[t[n],t[r],e];throw new Error}function PA(t,e){var n=t.r-e.r,r=e.x-t.x,i=e.y-t.y;return n<0||n*n<r*r+i*i}function jA(t,e){var n=t.r-e.r+1e-6,r=e.x-t.x,i=e.y-t.y;return n>0&&n*n>r*r+i*i}function IA(t,e){for(var n=0;n<e.length;++n)if(!jA(t,e[n]))return!1;return!0}function WA(t){switch(t.length){case 1:return{x:(e=t[0]).x,y:e.y,r:e.r};case 2:return HA(t[0],t[1]);case 3:return YA(t[0],t[1],t[2])}var e}function HA(t,e){var n=t.x,r=t.y,i=t.r,a=e.x,o=e.y,u=e.r,s=a-n,l=o-r,c=u-i,f=Math.sqrt(s*s+l*l);return{x:(n+a+s/f*c)/2,y:(r+o+l/f*c)/2,r:(f+i+u)/2}}function YA(t,e,n){var r=t.x,i=t.y,a=t.r,o=e.x,u=e.y,s=e.r,l=n.x,c=n.y,f=n.r,h=r-o,d=r-l,p=i-u,g=i-c,m=s-a,v=f-a,y=r*r+i*i-a*a,_=y-o*o-u*u+s*s,x=y-l*l-c*c+f*f,b=d*p-h*g,w=(p*x-g*_)/(2*b)-r,k=(g*m-p*v)/b,A=(d*_-h*x)/(2*b)-i,M=(h*v-d*m)/b,E=k*k+M*M-1,D=2*(a+w*k+A*M),C=w*w+A*A-a*a,F=-(E?(D+Math.sqrt(D*D-4*E*C))/(2*E):C/D);return{x:r+w+k*F,y:i+A+M*F,r:F}}function VA(t,e,n){var r,i,a,o,u=t.x-e.x,s=t.y-e.y,l=u*u+s*s;l?(i=e.r+n.r,i*=i,o=t.r+n.r,i>(o*=o)?(r=(l+o-i)/(2*l),a=Math.sqrt(Math.max(0,o/l-r*r)),n.x=t.x-r*u-a*s,n.y=t.y-r*s+a*u):(r=(l+i-o)/(2*l),a=Math.sqrt(Math.max(0,i/l-r*r)),n.x=e.x+r*u-a*s,n.y=e.y+r*s+a*u)):(n.x=e.x+n.r,n.y=e.y)}function GA(t,e){var n=t.r+e.r-1e-6,r=e.x-t.x,i=e.y-t.y;return n>0&&n*n>r*r+i*i}function XA(t){var e=t._,n=t.next._,r=e.r+n.r,i=(e.x*n.r+n.x*e.r)/r,a=(e.y*n.r+n.y*e.r)/r;return i*i+a*a}function JA(t){this._=t,this.next=null,this.previous=null}function ZA(t){return null==t?null:QA(t)}function QA(t){if("function"!=typeof t)throw new Error;return t}function KA(){return 0}function tM(t){return function(){return t}}function eM(t){return Math.sqrt(t.value)}function nM(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function rM(t,e){return function(n){if(r=n.children){var r,i,a,o=r.length,u=t(n)*e||0;if(u)for(i=0;i<o;++i)r[i].r+=u;if(a=function(t){if(!(i=t.length))return 0;var e,n,r,i,a,o,u,s,l,c,f;if((e=t[0]).x=0,e.y=0,!(i>1))return e.r;if(n=t[1],e.x=-n.r,n.x=e.r,n.y=0,!(i>2))return e.r+n.r;VA(n,e,r=t[2]),e=new JA(e),n=new JA(n),r=new JA(r),e.next=r.previous=n,n.next=e.previous=r,r.next=n.previous=e;t:for(u=3;u<i;++u){VA(e._,n._,r=t[u]),r=new JA(r),s=n.next,l=e.previous,c=n._.r,f=e._.r;do{if(c<=f){if(GA(s._,r._)){n=s,e.next=n,n.previous=e,--u;continue t}c+=s._.r,s=s.next}else{if(GA(l._,r._)){(e=l).next=n,n.previous=e,--u;continue t}f+=l._.r,l=l.previous}}while(s!==l.next);for(r.previous=e,r.next=n,e.next=n.previous=n=r,a=XA(e);(r=r.next)!==n;)(o=XA(r))<a&&(e=r,a=o);n=e.next}for(e=[n._],r=n;(r=r.next)!==n;)e.push(r._);for(r=LA(e),u=0;u<i;++u)(e=t[u]).x-=r.x,e.y-=r.y;return r.r}(r),u)for(i=0;i<o;++i)r[i].r-=u;n.r=a+u}}}function iM(t){return function(e){var n=e.parent;e.r*=t,n&&(e.x=n.x+t*e.x,e.y=n.y+t*e.y)}}function aM(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function oM(t,e,n,r,i){for(var a,o=t.children,u=-1,s=o.length,l=t.value&&(r-e)/t.value;++u<s;)(a=o[u]).y0=n,a.y1=i,a.x0=e,a.x1=e+=a.value*l}var uM={depth:-1},sM={};function lM(t){return t.id}function cM(t){return t.parentId}function fM(){var t=lM,e=cM;function n(n){var r,i,a,o,u,s,l,c=n.length,f=new Array(c),h={};for(i=0;i<c;++i)r=n[i],u=f[i]=new qA(r),null!=(s=t(r,i,n))&&(s+="")&&(h[l="$"+(u.id=s)]=l in h?sM:u);for(i=0;i<c;++i)if(u=f[i],null!=(s=e(n[i],i,n))&&(s+="")){if(!(o=h["$"+s]))throw new Error("missing: "+s);if(o===sM)throw new Error("ambiguous: "+s);o.children?o.children.push(u):o.children=[u],u.parent=o}else{if(a)throw new Error("multiple roots");a=u}if(!a)throw new Error("no root");if(a.parent=uM,a.eachBefore((function(t){t.depth=t.parent.depth+1,--c})).eachBefore(RA),a.parent=null,c>0)throw new Error("cycle");return a}return n.id=function(e){return arguments.length?(t=QA(e),n):t},n.parentId=function(t){return arguments.length?(e=QA(t),n):e},n}function hM(t,e){return t.parent===e.parent?1:2}function dM(t){var e=t.children;return e?e[0]:t.t}function pM(t){var e=t.children;return e?e[e.length-1]:t.t}function gM(t,e,n){var r=n/(e.i-t.i);e.c-=r,e.s+=n,t.c+=r,e.z+=n,e.m+=n}function mM(t,e,n){return t.a.parent===e.parent?t.a:n}function vM(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}function yM(t,e,n,r,i){for(var a,o=t.children,u=-1,s=o.length,l=t.value&&(i-n)/t.value;++u<s;)(a=o[u]).x0=e,a.x1=r,a.y0=n,a.y1=n+=a.value*l}vM.prototype=Object.create(qA.prototype);var _M=(1+Math.sqrt(5))/2;function xM(t,e,n,r,i,a){for(var o,u,s,l,c,f,h,d,p,g,m,v=[],y=e.children,_=0,x=0,b=y.length,w=e.value;_<b;){s=i-n,l=a-r;do{c=y[x++].value}while(!c&&x<b);for(f=h=c,m=c*c*(g=Math.max(l/s,s/l)/(w*t)),p=Math.max(h/m,m/f);x<b;++x){if(c+=u=y[x].value,u<f&&(f=u),u>h&&(h=u),m=c*c*g,(d=Math.max(h/m,m/f))>p){c-=u;break}p=d}v.push(o={value:c,dice:s<l,children:y.slice(_,x)}),o.dice?oM(o,n,r,i,w?r+=l*c/w:a):yM(o,n,r,w?n+=s*c/w:i,a),w-=c,_=x}return v}var bM=function t(e){function n(t,n,r,i,a){xM(e,t,n,r,i,a)}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(_M);var wM=function t(e){function n(t,n,r,i,a){if((o=t._squarify)&&o.ratio===e)for(var o,u,s,l,c,f=-1,h=o.length,d=t.value;++f<h;){for(s=(u=o[f]).children,l=u.value=0,c=s.length;l<c;++l)u.value+=s[l].value;u.dice?oM(u,n,r,i,r+=(a-r)*u.value/d):yM(u,n,r,n+=(i-n)*u.value/d,a),d-=u.value}else t._squarify=o=xM(e,t,n,r,i,a),o.ratio=e}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(_M);function kM(t){Xa.call(this,null,t)}function AM(t){return t.values}function MM(){var t,e=[];return t={entries:t=>function t(n,r){if(++r>e.length)return n;var i,a=[];for(i in n)a.push({key:i,values:t(n[i],r)});return a}(function t(n,r){if(r>=e.length)return n;for(var i,a,o,u=-1,s=n.length,l=e[r++],c={},f={};++u<s;)(o=c[i=l(a=n[u])+""])?o.push(a):c[i]=[a];for(i in c)f[i]=t(c[i],r);return f}(t,0),0),key:n=>(e.push(n),t)}}function EM(t){Xa.call(this,null,t)}function DM(t,e){return t.parent===e.parent?1:2}kM.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]},st(kM,Xa).transform=function(t,e){e.source||u("Nest transform requires an upstream data source.");var n=t.generate,r=t.modified(),i=e.clone(),a=this.value;return(!a||r||e.changed())&&(a&&a.each(t=>{t.children&&Nt(t.data)&&i.rem.push(t.data)}),this.value=a=zA({values:W(t.keys).reduce((t,e)=>(t.key(e),t),MM()).entries(i.source)},AM),n&&a.each(t=>{t.children&&(t=qt(t.data),i.add.push(t),i.source.push(t))}),CA(a,Ot,Ot)),i.source.root=a,i},st(EM,Xa).transform=function(t,e){e.source&&e.source.root||u(this.constructor.name+" transform requires a backing tree data source.");var n=this.layout(t.method),r=this.fields,i=e.source.root,a=t.as||r;t.field?i.sum(t.field):i.count(),t.sort&&i.sort(Pt(t.sort,t=>t.data)),function(t,e,n){for(var r,i=0,a=e.length;i<a;++i)(r=e[i])in n&&t[r](n[r])}(n,this.params,t),n.separation&&n.separation(!1!==t.separation?DM:p);try{this.value=n(i)}catch(t){u(t)}return i.each((function(t){!function(t,e,n){for(var r=t.data,i=0,a=e.length-1;i<a;++i)r[n[i]]=t[e[i]];r[n[a]]=t.children?t.children.length:0}(t,r,a)})),e.reflow(t.modified()).modifies(a).modifies("leaf")};var CM=["x","y","r","depth","children"];function FM(t){EM.call(this,t)}FM.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:CM.length,default:CM}]};var SM=st(FM,EM);SM.layout=function(){var t=null,e=1,n=1,r=KA;function i(i){return i.x=e/2,i.y=n/2,t?i.eachBefore(nM(t)).eachAfter(rM(r,.5)).eachBefore(iM(1)):i.eachBefore(nM(eM)).eachAfter(rM(KA,1)).eachAfter(rM(r,i.r/Math.min(e,n))).eachBefore(iM(Math.min(e,n)/(2*i.r))),i}return i.radius=function(e){return arguments.length?(t=ZA(e),i):t},i.size=function(t){return arguments.length?(e=+t[0],n=+t[1],i):[e,n]},i.padding=function(t){return arguments.length?(r="function"==typeof t?t:tM(+t),i):r},i},SM.params=["radius","size","padding"],SM.fields=CM;var BM=["x0","y0","x1","y1","depth","children"];function TM(t){EM.call(this,t)}TM.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:BM.length,default:BM}]};var zM=st(TM,EM);function NM(t){Xa.call(this,null,t)}zM.layout=function(){var t=1,e=1,n=0,r=!1;function i(i){var a=i.height+1;return i.x0=i.y0=n,i.x1=t,i.y1=e/a,i.eachBefore(function(t,e){return function(r){r.children&&oM(r,r.x0,t*(r.depth+1)/e,r.x1,t*(r.depth+2)/e);var i=r.x0,a=r.y0,o=r.x1-n,u=r.y1-n;o<i&&(i=o=(i+o)/2),u<a&&(a=u=(a+u)/2),r.x0=i,r.y0=a,r.x1=o,r.y1=u}}(e,a)),r&&i.eachBefore(aM),i}return i.round=function(t){return arguments.length?(r=!!t,i):r},i.size=function(n){return arguments.length?(t=+n[0],e=+n[1],i):[t,e]},i.padding=function(t){return arguments.length?(n=+t,i):n},i},zM.params=["size","round","padding"],zM.fields=BM,NM.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},st(NM,Xa).transform=function(t,e){e.source||u("Stratify transform requires an upstream data source.");var n=this.value,r=t.modified(),i=e.fork(e.ALL).materialize(e.SOURCE),a=!this.value||r||e.changed(e.ADD_REM)||e.modified(t.key.fields)||e.modified(t.parentKey.fields);return i.source=i.source.slice(),a&&(n=i.source.length?CA(fM().id(t.key).parentId(t.parentKey)(i.source),t.key,g):CA(fM()([{}]),t.key,t.key)),i.source.root=this.value=n,i};var OM={tidy:function(){var t=hM,e=1,n=1,r=null;function i(i){var s=function(t){for(var e,n,r,i,a,o=new vM(t,0),u=[o];e=u.pop();)if(r=e._.children)for(e.children=new Array(a=r.length),i=a-1;i>=0;--i)u.push(n=e.children[i]=new vM(r[i],i)),n.parent=e;return(o.parent=new vM(null,0)).children=[o],o}(i);if(s.eachAfter(a),s.parent.m=-s.z,s.eachBefore(o),r)i.eachBefore(u);else{var l=i,c=i,f=i;i.eachBefore((function(t){t.x<l.x&&(l=t),t.x>c.x&&(c=t),t.depth>f.depth&&(f=t)}));var h=l===c?1:t(l,c)/2,d=h-l.x,p=e/(c.x+h+d),g=n/(f.depth||1);i.eachBefore((function(t){t.x=(t.x+d)*p,t.y=t.depth*g}))}return i}function a(e){var n=e.children,r=e.parent.children,i=e.i?r[e.i-1]:null;if(n){!function(t){for(var e,n=0,r=0,i=t.children,a=i.length;--a>=0;)(e=i[a]).z+=n,e.m+=n,n+=e.s+(r+=e.c)}(e);var a=(n[0].z+n[n.length-1].z)/2;i?(e.z=i.z+t(e._,i._),e.m=e.z-a):e.z=a}else i&&(e.z=i.z+t(e._,i._));e.parent.A=function(e,n,r){if(n){for(var i,a=e,o=e,u=n,s=a.parent.children[0],l=a.m,c=o.m,f=u.m,h=s.m;u=pM(u),a=dM(a),u&&a;)s=dM(s),(o=pM(o)).a=e,(i=u.z+f-a.z-l+t(u._,a._))>0&&(gM(mM(u,e,r),e,i),l+=i,c+=i),f+=u.m,l+=a.m,h+=s.m,c+=o.m;u&&!pM(o)&&(o.t=u,o.m+=f-c),a&&!dM(s)&&(s.t=a,s.m+=l-h,r=e)}return r}(e,i,e.parent.A||r[0])}function o(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function u(t){t.x*=e,t.y=t.depth*n}return i.separation=function(e){return arguments.length?(t=e,i):t},i.size=function(t){return arguments.length?(r=!1,e=+t[0],n=+t[1],i):r?null:[e,n]},i.nodeSize=function(t){return arguments.length?(r=!0,e=+t[0],n=+t[1],i):r?[e,n]:null},i},cluster:function(){var t=FA,e=1,n=1,r=!1;function i(i){var a,o=0;i.eachAfter((function(e){var n=e.children;n?(e.x=function(t){return t.reduce(SA,0)/t.length}(n),e.y=function(t){return 1+t.reduce(BA,0)}(n)):(e.x=a?o+=t(e,a):0,e.y=0,a=e)}));var u=function(t){for(var e;e=t.children;)t=e[0];return t}(i),s=function(t){for(var e;e=t.children;)t=e[e.length-1];return t}(i),l=u.x-t(u,s)/2,c=s.x+t(s,u)/2;return i.eachAfter(r?function(t){t.x=(t.x-i.x)*e,t.y=(i.y-t.y)*n}:function(t){t.x=(t.x-l)/(c-l)*e,t.y=(1-(i.y?t.y/i.y:1))*n})}return i.separation=function(e){return arguments.length?(t=e,i):t},i.size=function(t){return arguments.length?(r=!1,e=+t[0],n=+t[1],i):r?null:[e,n]},i.nodeSize=function(t){return arguments.length?(r=!0,e=+t[0],n=+t[1],i):r?[e,n]:null},i}},RM=["x","y","depth","children"];function qM(t){EM.call(this,t)}qM.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:RM.length,default:RM}]};var UM=st(qM,EM);function LM(t){Xa.call(this,[],t)}UM.layout=function(t){var e=t||"tidy";if(it(OM,e))return OM[e]();u("Unrecognized Tree layout method: "+e)},UM.params=["size","nodeSize"],UM.fields=RM,LM.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},st(LM,Xa).transform=function(t,e){var n=this.value,r=e.source&&e.source.root,i=e.fork(e.NO_SOURCE),a={};return r||u("TreeLinks transform requires a tree data source."),e.changed(e.ADD_REM)?(i.rem=n,e.visit(e.SOURCE,(function(t){a[Ot(t)]=1})),r.each((function(t){var e=t.data,n=t.parent&&t.parent.data;n&&a[Ot(e)]&&a[Ot(n)]&&i.add.push(qt({source:n,target:e}))})),this.value=i.add):e.changed(e.MOD)&&(e.visit(e.MOD,(function(t){a[Ot(t)]=1})),n.forEach((function(t){(a[Ot(t.source)]||a[Ot(t.target)])&&i.mod.push(t)}))),i};var $M={binary:function(t,e,n,r,i){var a,o,u=t.children,s=u.length,l=new Array(s+1);for(l[0]=o=a=0;a<s;++a)l[a+1]=o+=u[a].value;!function t(e,n,r,i,a,o,s){if(e>=n-1){var c=u[e];return c.x0=i,c.y0=a,c.x1=o,void(c.y1=s)}var f=l[e],h=r/2+f,d=e+1,p=n-1;for(;d<p;){var g=d+p>>>1;l[g]<h?d=g+1:p=g}h-l[d-1]<l[d]-h&&e+1<d&&--d;var m=l[d]-f,v=r-m;if(o-i>s-a){var y=(i*v+o*m)/r;t(e,d,m,i,a,y,s),t(d,n,v,y,a,o,s)}else{var _=(a*v+s*m)/r;t(e,d,m,i,a,o,_),t(d,n,v,i,_,o,s)}}(0,s,t.value,e,n,r,i)},dice:oM,slice:yM,slicedice:function(t,e,n,r,i){(1&t.depth?yM:oM)(t,e,n,r,i)},squarify:bM,resquarify:wM},PM=["x0","y0","x1","y1","depth","children"];function jM(t){EM.call(this,t)}jM.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:PM.length,default:PM}]};var IM=st(jM,EM);IM.layout=function(){var t=function(){var t=bM,e=!1,n=1,r=1,i=[0],a=KA,o=KA,u=KA,s=KA,l=KA;function c(t){return t.x0=t.y0=0,t.x1=n,t.y1=r,t.eachBefore(f),i=[0],e&&t.eachBefore(aM),t}function f(e){var n=i[e.depth],r=e.x0+n,c=e.y0+n,f=e.x1-n,h=e.y1-n;f<r&&(r=f=(r+f)/2),h<c&&(c=h=(c+h)/2),e.x0=r,e.y0=c,e.x1=f,e.y1=h,e.children&&(n=i[e.depth+1]=a(e)/2,r+=l(e)-n,c+=o(e)-n,(f-=u(e)-n)<r&&(r=f=(r+f)/2),(h-=s(e)-n)<c&&(c=h=(c+h)/2),t(e,r,c,f,h))}return c.round=function(t){return arguments.length?(e=!!t,c):e},c.size=function(t){return arguments.length?(n=+t[0],r=+t[1],c):[n,r]},c.tile=function(e){return arguments.length?(t=QA(e),c):t},c.padding=function(t){return arguments.length?c.paddingInner(t).paddingOuter(t):c.paddingInner()},c.paddingInner=function(t){return arguments.length?(a="function"==typeof t?t:tM(+t),c):a},c.paddingOuter=function(t){return arguments.length?c.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):c.paddingTop()},c.paddingTop=function(t){return arguments.length?(o="function"==typeof t?t:tM(+t),c):o},c.paddingRight=function(t){return arguments.length?(u="function"==typeof t?t:tM(+t),c):u},c.paddingBottom=function(t){return arguments.length?(s="function"==typeof t?t:tM(+t),c):s},c.paddingLeft=function(t){return arguments.length?(l="function"==typeof t?t:tM(+t),c):l},c}();return t.ratio=function(e){var n=t.tile();n.ratio&&t.tile(n.ratio(e))},t.method=function(e){it($M,e)?t.tile($M[e]):u("Unrecognized Treemap layout method: "+e)},t},IM.params=["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],IM.fields=PM;var WM=Object.freeze({__proto__:null,nest:kM,pack:FM,partition:TM,stratify:NM,tree:qM,treelinks:LM,treemap:jM});function HM(t,e){var n,r,i,a,o,u,s=[],l=function(t){return t(a)};if(null==e)s.push(t);else for(n={},r=0,i=t.length;r<i;++r)a=t[r],(u=n[o=e.map(l)])||(n[o]=u=[],u.dims=o,s.push(u)),u.push(a);return s}function YM(t){Xa.call(this,null,t)}YM.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},st(YM,Xa).transform=function(t,e){var r=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=HM(e.materialize(e.SOURCE).source,t.groupby),a=(t.groupby||[]).map(n),o=a.length,u=t.as||[n(t.x),n(t.y)],s=[];i.forEach(e=>{Qo(e,t.x,t.y,t.bandwidth||.3).forEach(t=>{const n={};for(let t=0;t<o;++t)n[a[t]]=e.dims[t];n[u[0]]=t[0],n[u[1]]=t[1],s.push(qt(n))})}),this.value&&(r.rem=this.value),this.value=r.add=r.source=s}return r};const VM={linear:Ho,log:Yo,exp:Vo,pow:Go,quad:Xo,poly:Jo};function GM(t){Xa.call(this,null,t)}GM.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(VM)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},st(GM,Xa).transform=function(t,e){var r=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=HM(e.materialize(e.SOURCE).source,t.groupby),a=(t.groupby||[]).map(n),o=t.method||"linear",s=t.order||3,l=function(t,e){return"poly"===t?e:"quad"===t?2:1}(o,s),c=t.as||[n(t.x),n(t.y)],f=VM[o],h=[];let d=t.extent;it(VM,o)||u("Invalid regression method: "+o),null!=d&&"log"===o&&d[0]<=0&&(e.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null),i.forEach(n=>{if(n.length<=l)return void e.dataflow.warn("Skipping regression with more parameters than data points.");const r=f(n,t.x,t.y,s);if(t.params)return void h.push(qt({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));const i=d||et(n,t.x),u=t=>{const e={};for(let t=0;t<a.length;++t)e[a[t]]=n.dims[t];e[c[0]]=t[0],e[c[1]]=t[1],h.push(qt(e))};"linear"===o?i.forEach(t=>u([t,r.predict(t)])):nu(r.predict,i,25,200).forEach(u)}),this.value&&(r.rem=this.value),this.value=r.add=r.source=h}return r};var XM=Object.freeze({__proto__:null,loess:YM,regression:GM});const JM=Math.pow(2,-52),ZM=new Uint32Array(512);class QM{static from(t,e=oE,n=uE){const r=t.length,i=new Float64Array(2*r);for(let a=0;a<r;a++){const r=t[a];i[2*a]=e(r),i[2*a+1]=n(r)}return new QM(i)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:r,_hullHash:i}=this,a=t.length>>1;let o=1/0,u=1/0,s=-1/0,l=-1/0;for(let e=0;e<a;e++){const n=t[2*e],r=t[2*e+1];n<o&&(o=n),r<u&&(u=r),n>s&&(s=n),r>l&&(l=r),this._ids[e]=e}const c=(o+s)/2,f=(u+l)/2;let h,d,p,g=1/0;for(let e=0;e<a;e++){const n=KM(c,f,t[2*e],t[2*e+1]);n<g&&(h=e,g=n)}const m=t[2*h],v=t[2*h+1];g=1/0;for(let e=0;e<a;e++){if(e===h)continue;const n=KM(m,v,t[2*e],t[2*e+1]);n<g&&n>0&&(d=e,g=n)}let y=t[2*d],_=t[2*d+1],x=1/0;for(let e=0;e<a;e++){if(e===h||e===d)continue;const n=rE(m,v,y,_,t[2*e],t[2*e+1]);n<x&&(p=e,x=n)}let b=t[2*p],w=t[2*p+1];if(x===1/0){for(let e=0;e<a;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];iE(this._ids,this._dists,0,a-1);const e=new Uint32Array(a);let n=0;for(let t=0,r=-1/0;t<a;t++){const i=this._ids[t];this._dists[i]>r&&(e[n++]=i,r=this._dists[i])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(eE(m,v,y,_,b,w)){const t=d,e=y,n=_;d=p,y=b,_=w,p=t,b=e,w=n}const k=function(t,e,n,r,i,a){const o=n-t,u=r-e,s=i-t,l=a-e,c=o*o+u*u,f=s*s+l*l,h=.5/(o*l-u*s);return{x:t+(l*c-u*f)*h,y:e+(o*f-s*c)*h}}(m,v,y,_,b,w);this._cx=k.x,this._cy=k.y;for(let e=0;e<a;e++)this._dists[e]=KM(t[2*e],t[2*e+1],k.x,k.y);iE(this._ids,this._dists,0,a-1),this._hullStart=h;let A=3;n[h]=e[p]=d,n[d]=e[h]=p,n[p]=e[d]=h,r[h]=0,r[d]=1,r[p]=2,i.fill(-1),i[this._hashKey(m,v)]=h,i[this._hashKey(y,_)]=d,i[this._hashKey(b,w)]=p,this.trianglesLen=0,this._addTriangle(h,d,p,-1,-1,-1);for(let a,o,u=0;u<this._ids.length;u++){const s=this._ids[u],l=t[2*s],c=t[2*s+1];if(u>0&&Math.abs(l-a)<=JM&&Math.abs(c-o)<=JM)continue;if(a=l,o=c,s===h||s===d||s===p)continue;let f=0;for(let t=0,e=this._hashKey(l,c);t<this._hashSize&&(f=i[(e+t)%this._hashSize],-1===f||f===n[f]);t++);f=e[f];let g,m=f;for(;g=n[m],!eE(l,c,t[2*m],t[2*m+1],t[2*g],t[2*g+1]);)if(m=g,m===f){m=-1;break}if(-1===m)continue;let v=this._addTriangle(m,s,n[m],-1,-1,r[m]);r[s]=this._legalize(v+2),r[m]=v,A++;let y=n[m];for(;g=n[y],eE(l,c,t[2*y],t[2*y+1],t[2*g],t[2*g+1]);)v=this._addTriangle(y,s,g,r[s],-1,r[y]),r[s]=this._legalize(v+2),n[y]=y,A--,y=g;if(m===f)for(;g=e[m],eE(l,c,t[2*g],t[2*g+1],t[2*m],t[2*m+1]);)v=this._addTriangle(g,s,m,-1,r[m],r[g]),this._legalize(v+2),r[g]=v,n[m]=m,A--,m=g;this._hullStart=e[s]=m,n[m]=e[y]=s,n[s]=y,i[this._hashKey(l,c)]=s,i[this._hashKey(t[2*m],t[2*m+1])]=m}this.hull=new Uint32Array(A);for(let t=0,e=this._hullStart;t<A;t++)this.hull[t]=e,e=n[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:r}=this;let i=0,a=0;for(;;){const o=n[t],u=t-t%3;if(a=u+(t+2)%3,-1===o){if(0===i)break;t=ZM[--i];continue}const s=o-o%3,l=u+(t+1)%3,c=s+(o+2)%3,f=e[a],h=e[t],d=e[l],p=e[c];if(nE(r[2*f],r[2*f+1],r[2*h],r[2*h+1],r[2*d],r[2*d+1],r[2*p],r[2*p+1])){e[t]=p,e[o]=f;const r=n[c];if(-1===r){let e=this._hullStart;do{if(this._hullTri[e]===c){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,r),this._link(o,n[a]),this._link(a,c);const u=s+(o+1)%3;i<ZM.length&&(ZM[i++]=u)}else{if(0===i)break;t=ZM[--i]}}return a}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,r,i,a){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=e,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o}}function KM(t,e,n,r){const i=t-n,a=e-r;return i*i+a*a}function tE(t,e,n,r,i,a){const o=(r-e)*(i-t),u=(n-t)*(a-e);return Math.abs(o-u)>=33306690738754716e-32*Math.abs(o+u)?o-u:0}function eE(t,e,n,r,i,a){return(tE(i,a,t,e,n,r)||tE(t,e,n,r,i,a)||tE(n,r,i,a,t,e))<0}function nE(t,e,n,r,i,a,o,u){const s=t-o,l=e-u,c=n-o,f=r-u,h=i-o,d=a-u,p=c*c+f*f,g=h*h+d*d;return s*(f*g-p*d)-l*(c*g-p*h)+(s*s+l*l)*(c*d-f*h)<0}function rE(t,e,n,r,i,a){const o=n-t,u=r-e,s=i-t,l=a-e,c=o*o+u*u,f=s*s+l*l,h=.5/(o*l-u*s),d=(l*c-u*f)*h,p=(o*f-s*c)*h;return d*d+p*p}function iE(t,e,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=t[i],a=e[r];let o=i-1;for(;o>=n&&e[t[o]]>a;)t[o+1]=t[o--];t[o+1]=r}else{let i=n+1,a=r;aE(t,n+r>>1,i),e[t[n]]>e[t[r]]&&aE(t,n,r),e[t[i]]>e[t[r]]&&aE(t,i,r),e[t[n]]>e[t[i]]&&aE(t,n,i);const o=t[i],u=e[o];for(;;){do{i++}while(e[t[i]]<u);do{a--}while(e[t[a]]>u);if(a<i)break;aE(t,i,a)}t[n+1]=t[a],t[a]=o,r-i+1>=a-n?(iE(t,e,i,r),iE(t,e,n,a-1)):(iE(t,e,n,a-1),iE(t,e,i,r))}}function aE(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function oE(t){return t[0]}function uE(t){return t[1]}class sE{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,n){const r=(t=+t)+(n=+n),i=e=+e;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>1e-6||Math.abs(this._y1-i)>1e-6)&&(this._+="L"+r+","+i),n&&(this._+=`A${n},${n},0,1,1,${t-n},${e}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(t,e,n,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class lE{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class cE{constructor(t,[e,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(e=+e)&&(i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=r,this.xmin=e,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:n},vectors:r}=this,i=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let e,r,a=0,o=0,u=n.length;a<u;a+=3,o+=2){const u=2*n[a],s=2*n[a+1],l=2*n[a+2],c=t[u],f=t[u+1],h=t[s],d=t[s+1],p=t[l],g=t[l+1],m=h-c,v=d-f,y=p-c,_=g-f,x=m*m+v*v,b=y*y+_*_,w=2*(m*_-v*y);if(w)if(Math.abs(w)<1e-8)e=(c+p)/2,r=(f+g)/2;else{const t=1/w;e=c+(_*x-v*b)*t,r=f+(m*b-y*x)*t}else e=(c+p)/2-1e8*_,r=(f+g)/2+1e8*y;i[o]=e,i[o+1]=r}let a,o,u,s=e[e.length-1],l=4*s,c=t[2*s],f=t[2*s+1];r.fill(0);for(let n=0;n<e.length;++n)s=e[n],a=l,o=c,u=f,l=4*s,c=t[2*s],f=t[2*s+1],r[a+2]=r[l]=u-f,r[a+3]=r[l+1]=c-o}render(t){const e=null==t?t=new sE:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:a,vectors:o}=this;if(i.length<=1)return null;for(let e=0,r=n.length;e<r;++e){const r=n[e];if(r<e)continue;const i=2*Math.floor(e/3),o=2*Math.floor(r/3),u=a[i],s=a[i+1],l=a[o],c=a[o+1];this._renderSegment(u,s,l,c,t)}let u,s=i[i.length-1];for(let e=0;e<i.length;++e){u=s,s=i[e];const n=2*Math.floor(r[s]/3),l=a[n],c=a[n+1],f=4*u,h=this._project(l,c,o[f+2],o[f+3]);h&&this._renderSegment(l,c,h[0],h[1],t)}return e&&e.value()}renderBounds(t){const e=null==t?t=new sE:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const n=null==e?e=new sE:void 0,r=this._clip(t);if(null===r||!r.length)return;e.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let t=2;t<i;t+=2)r[t]===r[t-2]&&r[t+1]===r[t-1]||e.lineTo(r[t],r[t+1]);return e.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,n=t.length/2;e<n;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new lE;return this.renderCell(t,e),e.value()}_renderSegment(t,e,n,r,i){let a;const o=this._regioncode(t,e),u=this._regioncode(n,r);0===o&&0===u?(i.moveTo(t,e),i.lineTo(n,r)):(a=this._clipSegment(t,e,n,r,o,u))&&(i.moveTo(a[0],a[1]),i.lineTo(a[2],a[3]))}contains(t,e,n){return(e=+e)==e&&(n=+n)==n&&this.delaunay._step(t,e,n)===t}*neighbors(t){const e=this._clip(t);if(e)for(const n of this.delaunay.neighbors(t)){const t=this._clip(n);if(t)t:for(let r=0,i=e.length;r<i;r+=2)for(let a=0,o=t.length;a<o;a+=2)if(e[r]==t[a]&&e[r+1]==t[a+1]&&e[(r+2)%i]==t[(a+o-2)%o]&&e[(r+3)%i]==t[(a+o-1)%o]){yield n;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,a=n[t];if(-1===a)return null;const o=[];let u=a;do{const n=Math.floor(u/3);if(o.push(e[2*n],e[2*n+1]),u=u%3==2?u-2:u+1,i[u]!==t)break;u=r[u]}while(u!==a&&-1!==u);return o}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:n}=this,r=4*t;return n[r]||n[r+1]?this._clipInfinite(t,e,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(t,e)}_clipFinite(t,e){const n=e.length;let r,i,a,o,u,s=null,l=e[n-2],c=e[n-1],f=this._regioncode(l,c);for(let h=0;h<n;h+=2)if(r=l,i=c,l=e[h],c=e[h+1],a=f,f=this._regioncode(l,c),0===a&&0===f)o=u,u=0,s?s.push(l,c):s=[l,c];else{let e,n,h,d,p;if(0===a){if(null===(e=this._clipSegment(r,i,l,c,a,f)))continue;[n,h,d,p]=e}else{if(null===(e=this._clipSegment(l,c,r,i,f,a)))continue;[d,p,n,h]=e,o=u,u=this._edgecode(n,h),o&&u&&this._edge(t,o,u,s,s.length),s?s.push(n,h):s=[n,h]}o=u,u=this._edgecode(d,p),o&&u&&this._edge(t,o,u,s,s.length),s?s.push(d,p):s=[d,p]}if(s)o=u,u=this._edgecode(s[0],s[1]),o&&u&&this._edge(t,o,u,s,s.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return s}_clipSegment(t,e,n,r,i,a){for(;;){if(0===i&&0===a)return[t,e,n,r];if(i&a)return null;let o,u,s=i||a;8&s?(o=t+(n-t)*(this.ymax-e)/(r-e),u=this.ymax):4&s?(o=t+(n-t)*(this.ymin-e)/(r-e),u=this.ymin):2&s?(u=e+(r-e)*(this.xmax-t)/(n-t),o=this.xmax):(u=e+(r-e)*(this.xmin-t)/(n-t),o=this.xmin),i?(t=o,e=u,i=this._regioncode(t,e)):(n=o,r=u,a=this._regioncode(n,r))}}_clipInfinite(t,e,n,r,i,a){let o,u=Array.from(e);if((o=this._project(u[0],u[1],n,r))&&u.unshift(o[0],o[1]),(o=this._project(u[u.length-2],u[u.length-1],i,a))&&u.push(o[0],o[1]),u=this._clipFinite(t,u))for(let e,n=0,r=u.length,i=this._edgecode(u[r-2],u[r-1]);n<r;n+=2)e=i,i=this._edgecode(u[n],u[n+1]),e&&i&&(n=this._edge(t,e,i,u,n),r=u.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(u=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return u}_edge(t,e,n,r,i){for(;e!==n;){let n,a;switch(e){case 5:e=4;continue;case 4:e=6,n=this.xmax,a=this.ymin;break;case 6:e=2;continue;case 2:e=10,n=this.xmax,a=this.ymax;break;case 10:e=8;continue;case 8:e=9,n=this.xmin,a=this.ymax;break;case 9:e=1;continue;case 1:e=5,n=this.xmin,a=this.ymin}r[i]===n&&r[i+1]===a||!this.contains(t,n,a)||(r.splice(i,0,n,a),i+=2)}if(r.length>4)for(let t=0;t<r.length;t+=2){const e=(t+2)%r.length,n=(t+4)%r.length;(r[t]===r[e]&&r[e]===r[n]||r[t+1]===r[e+1]&&r[e+1]===r[n+1])&&(r.splice(e,2),t-=2)}return i}_project(t,e,n,r){let i,a,o,u=1/0;if(r<0){if(e<=this.ymin)return null;(i=(this.ymin-e)/r)<u&&(o=this.ymin,a=t+(u=i)*n)}else if(r>0){if(e>=this.ymax)return null;(i=(this.ymax-e)/r)<u&&(o=this.ymax,a=t+(u=i)*n)}if(n>0){if(t>=this.xmax)return null;(i=(this.xmax-t)/n)<u&&(a=this.xmax,o=e+(u=i)*r)}else if(n<0){if(t<=this.xmin)return null;(i=(this.xmin-t)/n)<u&&(a=this.xmin,o=e+(u=i)*r)}return[a,o]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}const fE=2*Math.PI,hE=Math.pow;function dE(t){return t[0]}function pE(t){return t[1]}function gE(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class mE{static from(t,e=dE,n=pE,r){return new mE("length"in t?function(t,e,n,r){const i=t.length,a=new Float64Array(2*i);for(let o=0;o<i;++o){const i=t[o];a[2*o]=e.call(r,i,o,t),a[2*o+1]=n.call(r,i,o,t)}return a}(t,e,n,r):Float64Array.from(function*(t,e,n,r){let i=0;for(const a of t)yield e.call(r,a,i,t),yield n.call(r,a,i,t),++i}(t,e,n,r)))}constructor(t){this._delaunator=new QM(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:n}=t;for(let t=0;t<e.length;t+=3){const r=2*e[t],i=2*e[t+1],a=2*e[t+2];if((n[a]-n[r])*(n[i+1]-n[r+1])-(n[i]-n[r])*(n[a+1]-n[r+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},(t,e)=>e).sort((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]);const t=this.collinear[0],n=this.collinear[this.collinear.length-1],r=[e[2*t],e[2*t+1],e[2*n],e[2*n+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let t=0,n=e.length/2;t<n;++t){const n=gE(e[2*t],e[2*t+1],i);e[2*t]=n[0],e[2*t+1]=n[1]}this._delaunator=new QM(e)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let t=0,e=n.length;t<e;++t){const e=i[t%3==2?t-2:t+1];-1!==n[t]&&-1!==a[e]||(a[e]=t)}for(let t=0,e=r.length;t<e;++t)o[r[t]]=t;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],this.triangles[1]=r[1],this.triangles[2]=r[1],a[r[0]]=1,2===r.length&&(a[r[1]]=0))}voronoi(t){return new cE(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:r,halfedges:i,triangles:a,collinear:o}=this;if(o){const e=o.indexOf(t);return e>0&&(yield o[e-1]),void(e<o.length-1&&(yield o[e+1]))}const u=e[t];if(-1===u)return;let s=u,l=-1;do{if(yield l=a[s],s=s%3==2?s-2:s+1,a[s]!==t)return;if(s=i[s],-1===s){const e=n[(r[t]+1)%n.length];return void(e!==l&&(yield e))}}while(s!==u)}find(t,e,n=0){if((t=+t)!=t||(e=+e)!=e)return-1;const r=n;let i;for(;(i=this._step(n,t,e))>=0&&i!==n&&i!==r;)n=i;return i}_step(t,e,n){const{inedges:r,hull:i,_hullIndex:a,halfedges:o,triangles:u,points:s}=this;if(-1===r[t]||!s.length)return(t+1)%(s.length>>1);let l=t,c=hE(e-s[2*t],2)+hE(n-s[2*t+1],2);const f=r[t];let h=f;do{let r=u[h];const f=hE(e-s[2*r],2)+hE(n-s[2*r+1],2);if(f<c&&(c=f,l=r),h=h%3==2?h-2:h+1,u[h]!==t)break;if(h=o[h],-1===h){if(h=i[(a[t]+1)%i.length],h!==r&&hE(e-s[2*h],2)+hE(n-s[2*h+1],2)<c)return h;break}}while(h!==f);return l}render(t){const e=null==t?t=new sE:void 0,{points:n,halfedges:r,triangles:i}=this;for(let e=0,a=r.length;e<a;++e){const a=r[e];if(a<e)continue;const o=2*i[e],u=2*i[a];t.moveTo(n[o],n[o+1]),t.lineTo(n[u],n[u+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e=2){const n=null==t?t=new sE:void 0,{points:r}=this;for(let n=0,i=r.length;n<i;n+=2){const i=r[n],a=r[n+1];t.moveTo(i+e,a),t.arc(i,a,e,0,fE)}return n&&n.value()}renderHull(t){const e=null==t?t=new sE:void 0,{hull:n,points:r}=this,i=2*n[0],a=n.length;t.moveTo(r[i],r[i+1]);for(let e=1;e<a;++e){const i=2*n[e];t.lineTo(r[i],r[i+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new lE;return this.renderHull(t),t.value()}renderTriangle(t,e){const n=null==e?e=new sE:void 0,{points:r,triangles:i}=this,a=2*i[t*=3],o=2*i[t+1],u=2*i[t+2];return e.moveTo(r[a],r[a+1]),e.lineTo(r[o],r[o+1]),e.lineTo(r[u],r[u+1]),e.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new lE;return this.renderTriangle(t,e),e.value()}}function vE(t){Xa.call(this,null,t)}vE.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const yE=st(vE,Xa),_E=[-1e5,-1e5,1e5,1e5];function xE(t){const e=t[0][0],n=t[0][1];let r=t.length-1;for(;t[r][0]===e&&t[r][1]===n;--r);return"M"+t.slice(0,r+1).join("L")+"Z"}yE.transform=function(t,e){const n=t.as||"path",r=e.source;if(!r||!r.length)return e;let i=t.size;i=i?[0,0,i[0],i[1]]:(i=t.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:_E;const a=this.value=mE.from(r,t.x,t.y).voronoi(i);for(let t=0,e=r.length;t<e;++t){const e=a.cellPolygon(t);r[t][n]=e?xE(e):null}return e.reflow(t.modified()).modifies(n)};var bE=Object.freeze({__proto__:null,voronoi:vE}),wE=Math.PI/180;function kE(){var t,e,n,r,i,a,o,u=[256,256],s=CE,l=[],c=Math.random,f={};function h(t,e,n){for(var r,i,a,o=e.x,l=e.y,f=Math.sqrt(u[0]*u[0]+u[1]*u[1]),h=s(u),d=c()<.5?1:-1,p=-d;(r=h(p+=d))&&(i=~~r[0],a=~~r[1],!(Math.min(Math.abs(i),Math.abs(a))>=f));)if(e.x=o+i,e.y=l+a,!(e.x+e.x0<0||e.y+e.y0<0||e.x+e.x1>u[0]||e.y+e.y1>u[1])&&(!n||!ME(e,t,u[0]))&&(!n||DE(e,n))){for(var g,m=e.sprite,v=e.width>>5,y=u[0]>>5,_=e.x-(v<<4),x=127&_,b=32-x,w=e.y1-e.y0,k=(e.y+e.y0)*y+(_>>5),A=0;A<w;A++){g=0;for(var M=0;M<=v;M++)t[k+M]|=g<<b|(M<v?(g=m[A*v+M])>>>x:0);k+=y}return e.sprite=null,!0}return!1}return f.layout=function(){for(var s=function(t){t.width=t.height=1;var e=Math.sqrt(t.getContext("2d").getImageData(0,0,1,1).data.length>>2);t.width=2048/e,t.height=2048/e;var n=t.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:e}}(jc()),f=function(t){var e=[],n=-1;for(;++n<t;)e[n]=0;return e}((u[0]>>5)*u[1]),d=null,p=l.length,g=-1,m=[],v=l.map((function(u){return{text:t(u),font:e(u),style:r(u),weight:i(u),rotate:a(u),size:~~(n(u)+1e-14),padding:o(u),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:u}})).sort((function(t,e){return e.size-t.size}));++g<p;){var y=v[g];y.x=u[0]*(c()+.5)>>1,y.y=u[1]*(c()+.5)>>1,AE(s,y,v,g),y.hasText&&h(f,y,d)&&(m.push(y),d?EE(d,y):d=[{x:y.x+y.x0,y:y.y+y.y0},{x:y.x+y.x1,y:y.y+y.y1}],y.x-=u[0]>>1,y.y-=u[1]>>1)}return m},f.words=function(t){return arguments.length?(l=t,f):l},f.size=function(t){return arguments.length?(u=[+t[0],+t[1]],f):u},f.font=function(t){return arguments.length?(e=FE(t),f):e},f.fontStyle=function(t){return arguments.length?(r=FE(t),f):r},f.fontWeight=function(t){return arguments.length?(i=FE(t),f):i},f.rotate=function(t){return arguments.length?(a=FE(t),f):a},f.text=function(e){return arguments.length?(t=FE(e),f):t},f.spiral=function(t){return arguments.length?(s=SE[t]||t,f):s},f.fontSize=function(t){return arguments.length?(n=FE(t),f):n},f.padding=function(t){return arguments.length?(o=FE(t),f):o},f.random=function(t){return arguments.length?(c=t,f):c},f}function AE(t,e,n,r){if(!e.sprite){var i=t.context,a=t.ratio;i.clearRect(0,0,2048/a,2048/a);var o,u,s,l,c,f=0,h=0,d=0,p=n.length;for(--r;++r<p;){if(e=n[r],i.save(),i.font=e.style+" "+e.weight+" "+~~((e.size+1)/a)+"px "+e.font,o=i.measureText(e.text+"m").width*a,s=e.size<<1,e.rotate){var g=Math.sin(e.rotate*wE),m=Math.cos(e.rotate*wE),v=o*m,y=o*g,_=s*m,x=s*g;o=Math.max(Math.abs(v+x),Math.abs(v-x))+31>>5<<5,s=~~Math.max(Math.abs(y+_),Math.abs(y-_))}else o=o+31>>5<<5;if(s>d&&(d=s),f+o>=2048&&(f=0,h+=d,d=0),h+s>=2048)break;i.translate((f+(o>>1))/a,(h+(s>>1))/a),e.rotate&&i.rotate(e.rotate*wE),i.fillText(e.text,0,0),e.padding&&(i.lineWidth=2*e.padding,i.strokeText(e.text,0,0)),i.restore(),e.width=o,e.height=s,e.xoff=f,e.yoff=h,e.x1=o>>1,e.y1=s>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,f+=o}for(var b=i.getImageData(0,0,2048/a,2048/a).data,w=[];--r>=0;)if((e=n[r]).hasText){for(u=(o=e.width)>>5,s=e.y1-e.y0,l=0;l<s*u;l++)w[l]=0;if(null==(f=e.xoff))return;h=e.yoff;var k=0,A=-1;for(c=0;c<s;c++){for(l=0;l<o;l++){var M=u*c+(l>>5),E=b[2048*(h+c)+(f+l)<<2]?1<<31-l%32:0;w[M]|=E,k|=E}k?A=c:(e.y0++,s--,c--,h++)}e.y1=e.y0+A,e.sprite=w.slice(0,(e.y1-e.y0)*u)}}}function ME(t,e,n){n>>=5;for(var r,i=t.sprite,a=t.width>>5,o=t.x-(a<<4),u=127&o,s=32-u,l=t.y1-t.y0,c=(t.y+t.y0)*n+(o>>5),f=0;f<l;f++){r=0;for(var h=0;h<=a;h++)if((r<<s|(h<a?(r=i[f*a+h])>>>u:0))&e[c+h])return!0;c+=n}return!1}function EE(t,e){var n=t[0],r=t[1];e.x+e.x0<n.x&&(n.x=e.x+e.x0),e.y+e.y0<n.y&&(n.y=e.y+e.y0),e.x+e.x1>r.x&&(r.x=e.x+e.x1),e.y+e.y1>r.y&&(r.y=e.y+e.y1)}function DE(t,e){return t.x+t.x1>e[0].x&&t.x+t.x0<e[1].x&&t.y+t.y1>e[0].y&&t.y+t.y0<e[1].y}function CE(t){var e=t[0]/t[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function FE(t){return"function"==typeof t?t:function(){return t}}var SE={archimedean:CE,rectangular:function(t){var e=4*t[0]/t[1],n=0,r=0;return function(t){var i=t<0?-1:1;switch(Math.sqrt(1+4*i*t)-i&3){case 0:n+=e;break;case 1:r+=4;break;case 2:n-=e;break;default:r-=4}return[n,r]}}},BE=["x","y","font","fontSize","fontStyle","fontWeight","angle"],TE=["text","font","rotate","fontSize","fontStyle","fontWeight"];function zE(t){Xa.call(this,kE(),t)}zE.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:BE}]},st(zE,Xa).transform=function(e,n){!e.size||e.size[0]&&e.size[1]||u("Wordcloud size dimensions must be non-zero.");var r=e.modified();if(r||n.changed(n.ADD_REM)||TE.some((function(t){var r=e[t];return Y(r)&&n.modified(r.fields)}))){var i,a=n.materialize(n.SOURCE).source,o=this.value,s=e.as||BE,l=e.fontSize||14;if(Y(l)?i=e.fontSizeRange:l=Q(l),i){var c=l,f=um("sqrt")().domain(et(a,c)).range(i);l=function(t){return f(c(t))}}a.forEach((function(t){t[s[0]]=NaN,t[s[1]]=NaN,t[s[3]]=0}));for(var h,d,p=o.words(a).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(l).random(t.random).layout(),g=o.size(),m=g[0]>>1,v=g[1]>>1,y=0,_=p.length;y<_;++y)(d=(h=p[y]).datum)[s[0]]=h.x+m,d[s[1]]=h.y+v,d[s[2]]=h.font,d[s[3]]=h.size,d[s[4]]=h.style,d[s[5]]=h.weight,d[s[6]]=h.rotate;return n.reflow(r).modifies(s)}};var NE=Object.freeze({__proto__:null,wordcloud:zE});function OE(t){return new Uint8Array(t)}function RE(t){return new Uint16Array(t)}function qE(t){return new Uint32Array(t)}function UE(t,e,n){var r=(e<257?OE:e<65537?RE:qE)(t);return n&&r.set(n),r}function LE(t,e,n){var r=1<<e;return{one:r,zero:~r,range:n.slice(),bisect:t.bisect,index:t.index,size:t.size,onAdd:function(t,e){var n,i=this.bisect(this.range,t.value),a=t.index,o=i[0],u=i[1],s=a.length;for(n=0;n<o;++n)e[a[n]]|=r;for(n=u;n<s;++n)e[a[n]]|=r;return this}}}function $E(){var t=qE(0),e=[],n=0;return{insert:function(r,i,a){if(!i.length)return[];var o,u,s,l=n,c=i.length,f=Array(c),h=qE(c);for(s=0;s<c;++s)f[s]=r(i[s]),h[s]=s;if(f=function(t,e){return t.sort.call(e,(function(e,n){var r=t[e],i=t[n];return r<i?-1:r>i?1:0})),function(t,e){return Array.from(e,e=>t[e])}(t,e)}(f,h),l)o=e,u=t,e=Array(l+c),t=qE(l+c),function(t,e,n,r,i,a,o,u,s){var l,c=0,f=0;for(l=0;c<r&&f<o;++l)e[c]<i[f]?(u[l]=e[c],s[l]=n[c++]):(u[l]=i[f],s[l]=a[f++]+t);for(;c<r;++c,++l)u[l]=e[c],s[l]=n[c];for(;f<o;++f,++l)u[l]=i[f],s[l]=a[f]+t}(a,o,u,l,f,h,c,e,t);else{if(a>0)for(s=0;s<c;++s)h[s]+=a;e=f,t=h}return n=l+c,{index:h,value:f}},remove:function(r,i){var a,o,u,s=n;for(o=0;!i[t[o]]&&o<s;++o);for(u=o;o<s;++o)i[a=t[o]]||(t[u]=a,e[u]=e[o],++u);n=s-r},bisect:function(t,r){var i;return r?i=r.length:(r=e,i=n),[He(r,t[0],0,i),We(r,t[1],0,i)]},reindex:function(e){for(var r=0,i=n;r<i;++r)t[r]=e[t[r]]},index:function(){return t},size:function(){return n}}}function PE(t){Xa.call(this,function(){var t=8,e=[],n=qE(0),r=UE(0,t),i=UE(0,t);return{data:function(){return e},seen:function(){return n=function(t,e,n){return t.length>=e?t:((n=n||new t.constructor(e)).set(t),n)}(n,e.length)},add:function(t){for(var n,r=0,i=e.length,a=t.length;r<a;++r)(n=t[r])._index=i++,e.push(n)},remove:function(t,n){var a,o,u,s=e.length,l=Array(s-t),c=e;for(o=0;!n[o]&&o<s;++o)l[o]=e[o],c[o]=o;for(u=o;o<s;++o)a=e[o],n[o]?c[o]=-1:(c[o]=u,r[u]=r[o],i[u]=i[o],l[u]=a,a._index=u++),r[o]=0;return e=l,c},size:function(){return e.length},curr:function(){return r},prev:function(){return i},reset:function(t){i[t]=r[t]},all:function(){return t<257?255:t<65537?65535:4294967295},set:function(t,e){r[t]|=e},clear:function(t,e){r[t]&=~e},resize:function(e,n){(e>r.length||n>t)&&(t=Math.max(n,t),r=UE(e,t,r),i=UE(e,t))}}}(),t),this._indices=null,this._dims=null}PE.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};var jE=st(PE,Xa);function IE(t){Xa.call(this,null,t)}jE.transform=function(t,e){return this._dims?t.modified("fields")||t.fields.some((function(t){return e.modified(t.fields)}))?this.reinit(t,e):this.eval(t,e):this.init(t,e)},jE.init=function(t,e){for(var n,r,i=t.fields,a=t.query,o=this._indices={},u=this._dims=[],s=a.length,l=0;l<s;++l)r=o[n=i[l].fname]||(o[n]=$E()),u.push(LE(r,l,a[l]));return this.eval(t,e)},jE.reinit=function(t,e){var n,r,i,a,o,u,s,l,c,f=e.materialize().fork(),h=t.fields,d=t.query,p=this._indices,g=this._dims,m=this.value,v=m.curr(),y=m.prev(),_=m.all(),x=f.rem=f.add,b=f.mod,w=d.length,k={};if(y.set(v),e.rem.length&&(o=this.remove(t,e,f)),e.add.length&&m.add(e.add),e.mod.length)for(u={},s=0,l=(a=e.mod).length;s<l;++s)u[a[s]._index]=1;for(s=0;s<w;++s)c=h[s],(!g[s]||t.modified("fields",s)||e.modified(c.fields))&&((n=k[i=c.fname])||(p[i]=r=$E(),k[i]=n=r.insert(c,e.source,0)),g[s]=LE(r,s,d[s]).onAdd(n,v));for(s=0,l=m.data().length;s<l;++s)o[s]||(y[s]!==v[s]?x.push(s):u[s]&&v[s]!==_&&b.push(s));return m.mask=(1<<w)-1,f},jE.eval=function(t,e){var n=e.materialize().fork(),r=this._dims.length,i=0;return e.rem.length&&(this.remove(t,e,n),i|=(1<<r)-1),t.modified("query")&&!t.modified("fields")&&(i|=this.update(t,e,n)),e.add.length&&(this.insert(t,e,n),i|=(1<<r)-1),e.mod.length&&(this.modify(e,n),i|=(1<<r)-1),this.value.mask=i,n},jE.insert=function(t,e,n){var r,i,a,o=e.add,u=this.value,s=this._dims,l=this._indices,c=t.fields,f={},h=n.add,d=u.size(),p=d+o.length,g=s.length;u.resize(p,g),u.add(o);var m=u.curr(),v=u.prev(),y=u.all();for(r=0;r<g;++r)a=f[i=c[r].fname]||(f[i]=l[i].insert(c[r],o,d)),s[r].onAdd(a,m);for(;d<p;++d)v[d]=y,m[d]!==y&&h.push(d)},jE.modify=function(t,e){var n,r,i,a=e.mod,o=this.value,u=o.curr(),s=o.all(),l=t.mod;for(n=0,r=l.length;n<r;++n)u[i=l[n]._index]!==s&&a.push(i)},jE.remove=function(t,e,n){var r,i,a,o,u=this._indices,s=this.value,l=s.curr(),c=s.prev(),f=s.all(),h={},d=n.rem,p=e.rem;for(r=0,i=p.length;r<i;++r)h[a=p[r]._index]=1,c[a]=o=l[a],l[a]=f,o!==f&&d.push(a);for(a in u)u[a].remove(i,h);return this.reindex(e,i,h),h},jE.reindex=function(t,e,n){var r=this._indices,i=this.value;t.runAfter((function(){var t=i.remove(e,n);for(var a in r)r[a].reindex(t)}))},jE.update=function(t,e,n){var r,i,a=this._dims,o=t.query,u=e.stamp,s=a.length,l=0;for(n.filters=0,i=0;i<s;++i)t.modified("query",i)&&(r=i,++l);if(1===l)l=a[r].one,this.incrementOne(a[r],o[r],n.add,n.rem);else for(i=0,l=0;i<s;++i)t.modified("query",i)&&(l|=a[i].one,this.incrementAll(a[i],o[i],u,n.add),n.rem=n.add);return l},jE.incrementAll=function(t,e,n,r){var i,a,o,u=this.value,s=u.seen(),l=u.curr(),c=u.prev(),f=t.index(),h=t.bisect(t.range),d=t.bisect(e),p=d[0],g=d[1],m=h[0],v=h[1],y=t.one;if(p<m)for(i=p,a=Math.min(m,g);i<a;++i)s[o=f[i]]!==n&&(c[o]=l[o],s[o]=n,r.push(o)),l[o]^=y;else if(p>m)for(i=m,a=Math.min(p,v);i<a;++i)s[o=f[i]]!==n&&(c[o]=l[o],s[o]=n,r.push(o)),l[o]^=y;if(g>v)for(i=Math.max(p,v),a=g;i<a;++i)s[o=f[i]]!==n&&(c[o]=l[o],s[o]=n,r.push(o)),l[o]^=y;else if(g<v)for(i=Math.max(m,g),a=v;i<a;++i)s[o=f[i]]!==n&&(c[o]=l[o],s[o]=n,r.push(o)),l[o]^=y;t.range=e.slice()},jE.incrementOne=function(t,e,n,r){var i,a,o,u=this.value.curr(),s=t.index(),l=t.bisect(t.range),c=t.bisect(e),f=c[0],h=c[1],d=l[0],p=l[1],g=t.one;if(f<d)for(i=f,a=Math.min(d,h);i<a;++i)u[o=s[i]]^=g,n.push(o);else if(f>d)for(i=d,a=Math.min(f,p);i<a;++i)u[o=s[i]]^=g,r.push(o);if(h>p)for(i=Math.max(f,p),a=h;i<a;++i)u[o=s[i]]^=g,n.push(o);else if(h<p)for(i=Math.max(d,h),a=p;i<a;++i)u[o=s[i]]^=g,r.push(o);t.range=e.slice()},IE.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},st(IE,Xa).transform=function(t,e){var n=~(t.ignore||0),r=t.filter,i=r.mask;if(0==(i&n))return e.StopPropagation;var a=e.fork(e.ALL),o=r.data(),u=r.curr(),s=r.prev(),l=function(t){return u[t]&n?null:o[t]};return a.filter(a.MOD,l),i&i-1?(a.filter(a.ADD,(function(t){var e=u[t]&n;return!e&&e^s[t]&n?o[t]:null})),a.filter(a.REM,(function(t){var e=u[t]&n;return e&&!(e^e^s[t]&n)?o[t]:null}))):(a.filter(a.ADD,l),a.filter(a.REM,(function(t){return(u[t]&n)===i?o[t]:null}))),a.filter(a.SOURCE,(function(t){return l(t._index)}))};var WE=Object.freeze({__proto__:null,crossfilter:PE,resolvefilter:IE});function HE(t,e){t&&(null==e?t.removeAttribute("aria-label"):t.setAttribute("aria-label",e))}function YE(t,e){const n=t.globalCursor()?"undefined"!=typeof document&&document.body:t.container();if(n)return null==e?n.style.removeProperty("cursor"):n.style.cursor=e}function VE(t,e){var n=t._runtime.data;return it(n,e)||u("Unrecognized data set: "+e),n[e]}function GE(t,e){jt(e)||u("Second argument to changes must be a changeset.");var n=VE(this,t);return n.modified=!0,this.pulse(n.input,e)}function XE(t){var e=t.padding();return Math.max(0,t._viewWidth+e.left+e.right)}function JE(t){var e=t.padding();return Math.max(0,t._viewHeight+e.top+e.bottom)}function ZE(t){var e=t.padding(),n=t._origin;return[e.left+n[0],e.top+n[1]]}function QE(t,e,n){var r,i,a=t._renderer,o=a&&a.canvas();return o&&(i=ZE(t),(r=Wh(e.changedTouches?e.changedTouches[0]:e,o))[0]-=i[0],r[1]-=i[1]),e.dataflow=t,e.item=n,e.vega=function(t,e,n){var r=e?"group"===e.mark.marktype?e:e.mark.group:null;function i(t){var n,i=r;if(t)for(n=e;n;n=n.mark.group)if(n.mark.name===t){i=n;break}return i&&i.mark&&i.mark.interactive?i:{}}function a(t){if(!t)return n;pt(t)&&(t=i(t));for(var e=n.slice();t;)e[0]-=t.x||0,e[1]-=t.y||0,t=t.mark&&t.mark.group;return e}return{view:Q(t),item:Q(e||{}),group:i,xy:a,x:function(t){return a(t)[0]},y:function(t){return a(t)[1]}}}(t,n,r),e}const KE={trap:!1};function tD(t,e,n){const r=t._eventConfig&&t._eventConfig[e];return!(!1===r||x(r)&&!r[n])||(t.warn(`Blocked ${e} ${n} event listener.`),!1)}function eD(t){return t.item}function nD(t){return t.item.mark.source}function rD(t){return function(e,n){return n.vega.view().changeset().encode(n.item,t)}}function iD(t,e,n){var r=document.createElement(t);for(var i in e)r.setAttribute(i,e[i]);return null!=n&&(r.textContent=n),r}function aD(t,e,n){if(!e)return;const r=n.param;let i=n.state;return i||(i=n.state={elements:null,active:!1,set:null,update:e=>{e!==t.signal(r.signal)&&t.runAsync(null,(function(){i.source=!0,t.signal(r.signal,e)}))}},r.debounce&&(i.update=K(r.debounce,i.update))),function(t,e,n,r){const i=iD("div",{class:"vega-bind"}),a="radio"===n.input?i:i.appendChild(iD("label"));a.appendChild(iD("span",{class:"vega-bind-name"},n.name||n.signal)),e.appendChild(i);let o=oD;switch(n.input){case"checkbox":o=uD;break;case"select":o=sD;break;case"radio":o=lD;break;case"range":o=cD}o(t,a,n,r)}(i,e,r,t.signal(r.signal)),i.active||(t.on(t._signals[r.signal],null,()=>{i.source?i.source=!1:i.set(t.signal(r.signal))}),i.active=!0),i}function oD(t,e,n,r){const i=iD("input");for(const t in n)"signal"!==t&&"element"!==t&&i.setAttribute("input"===t?"type":t,n[t]);i.setAttribute("name",n.signal),i.value=r,e.appendChild(i),i.addEventListener("input",()=>t.update(i.value)),t.elements=[i],t.set=t=>i.value=t}function uD(t,e,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const a=iD("input",i);e.appendChild(a),a.addEventListener("change",()=>t.update(a.checked)),t.elements=[a],t.set=t=>a.checked=!!t||null}function sD(t,e,n,r){const i=iD("select",{name:n.signal}),a=n.labels||[];n.options.forEach((t,e)=>{const n={value:t};fD(t,r)&&(n.selected=!0),i.appendChild(iD("option",n,(a[e]||t)+""))}),e.appendChild(i),i.addEventListener("change",()=>{t.update(n.options[i.selectedIndex])}),t.elements=[i],t.set=t=>{for(let e=0,r=n.options.length;e<r;++e)if(fD(n.options[e],t))return void(i.selectedIndex=e)}}function lD(t,e,n,r){const i=iD("span",{class:"vega-bind-radio"}),a=n.labels||[];e.appendChild(i),t.elements=n.options.map((e,o)=>{const u={type:"radio",name:n.signal,value:e};fD(e,r)&&(u.checked=!0);const s=iD("input",u);s.addEventListener("change",()=>t.update(e));const l=iD("label",{},(a[o]||e)+"");return l.prepend(s),i.appendChild(l),s}),t.set=e=>{const n=t.elements,r=n.length;for(let t=0;t<r;++t)fD(n[t].value,e)&&(n[t].checked=!0)}}function cD(t,e,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;const i=null!=n.max?n.max:Math.max(100,+r)||100,a=n.min||Math.min(0,i,+r)||0,o=n.step||Qe(a,i,100),u=iD("input",{type:"range",name:n.signal,min:a,max:i,step:o});u.value=r;const s=iD("span",{},+r);e.appendChild(u),e.appendChild(s);const l=()=>{s.textContent=u.value,t.update(+u.value)};u.addEventListener("input",l),u.addEventListener("change",l),t.elements=[u],t.set=t=>{u.value=t,s.textContent=t}}function fD(t,e){return t===e||t+""==e+""}function hD(t,e,n,r,i,a){return(e=e||new r(t.loader())).initialize(n,XE(t),JE(t),ZE(t),i,a).background(t.background())}function dD(t,e){return e?function(){try{e.apply(this,arguments)}catch(e){t.error(e)}}:null}function pD(t,e){if("string"==typeof e){if("undefined"==typeof document)return t.error("DOM document instance not found."),null;if(!(e=document.querySelector(e)))return t.error("Signal bind element not found: "+e),null}if(e)try{e.innerHTML=""}catch(n){e=null,t.error(n)}return e}const gD=t=>+t||0;function mD(t){return x(t)?{top:gD(t.top),bottom:gD(t.bottom),left:gD(t.left),right:gD(t.right)}:(t=>({top:t,bottom:t,left:t,right:t}))(gD(t))}async function vD(t,e,n,r){const i=wv(e),a=i&&i.headless;return a||u("Unrecognized renderer type: "+e),await t.runAsync(),hD(t,null,null,a,n,r).renderAsync(t._scenegraph.root)}function yD(t){const e=this.context.data[t];return e?e.values.value:[]}const _D=t=>function(e,n){return this.context.dataflow.locale()[t](n)(e)},xD=_D("format"),bD=_D("timeFormat"),wD=_D("utcFormat"),kD=_D("timeParse"),AD=_D("utcParse");var MD=new Date(2e3,0,1);function ED(t,e,n){return Number.isInteger(t)&&Number.isInteger(e)?(MD.setYear(2e3),MD.setMonth(t),MD.setDate(e),bD.call(this,MD,n)):""}var DD,CD,FD,SD,BD;function TD(t){this.type=t}TD.prototype.visit=function(t){var e,n,r;if(t(this))return 1;for(n=0,r=(e=function(t){switch(t.type){case"ArrayExpression":return t.elements;case"BinaryExpression":case"LogicalExpression":return[t.left,t.right];case"CallExpression":var e=t.arguments.slice();return e.unshift(t.callee),e;case"ConditionalExpression":return[t.test,t.consequent,t.alternate];case"MemberExpression":return[t.object,t.property];case"ObjectExpression":return t.properties;case"Property":return[t.key,t.value];case"UnaryExpression":return[t.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this)).length;n<r;++n)if(e[n].visit(t))return 1};(DD={})[1]="Boolean",DD[2]="<end>",DD[3]="Identifier",DD[4]="Keyword",DD[5]="Null",DD[6]="Numeric",DD[7]="Punctuator",DD[8]="String",DD[9]="RegularExpression";var zD="ILLEGAL",ND=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),OD=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function RD(t,e){if(!t)throw new Error("ASSERT: "+e)}function qD(t){return t>=48&&t<=57}function UD(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function LD(t){return"01234567".indexOf(t)>=0}function $D(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function PD(t){return 10===t||13===t||8232===t||8233===t}function jD(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&ND.test(String.fromCharCode(t))}function ID(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&OD.test(String.fromCharCode(t))}var WD={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function HD(){for(var t;FD<SD&&($D(t=CD.charCodeAt(FD))||PD(t));)++FD}function YD(t){var e,n,r,i=0;for(n="u"===t?4:2,e=0;e<n;++e)FD<SD&&UD(CD[FD])?(r=CD[FD++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):sC({},"Unexpected token %0",zD);return String.fromCharCode(i)}function VD(){var t,e,n,r;for(e=0,"}"===(t=CD[FD])&&sC({},"Unexpected token %0",zD);FD<SD&&UD(t=CD[FD++]);)e=16*e+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||"}"!==t)&&sC({},"Unexpected token %0",zD),e<=65535?String.fromCharCode(e):(n=55296+(e-65536>>10),r=56320+(e-65536&1023),String.fromCharCode(n,r))}function GD(){var t,e;for(t=CD.charCodeAt(FD++),e=String.fromCharCode(t),92===t&&(117!==CD.charCodeAt(FD)&&sC({},"Unexpected token %0",zD),++FD,(t=YD("u"))&&"\\"!==t&&jD(t.charCodeAt(0))||sC({},"Unexpected token %0",zD),e=t);FD<SD&&ID(t=CD.charCodeAt(FD));)++FD,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==CD.charCodeAt(FD)&&sC({},"Unexpected token %0",zD),++FD,(t=YD("u"))&&"\\"!==t&&ID(t.charCodeAt(0))||sC({},"Unexpected token %0",zD),e+=t);return e}function XD(){var t,e;return t=FD,{type:1===(e=92===CD.charCodeAt(FD)?GD():function(){var t,e;for(t=FD++;FD<SD;){if(92===(e=CD.charCodeAt(FD)))return FD=t,GD();if(!ID(e))break;++FD}return CD.slice(t,FD)}()).length?3:WD.hasOwnProperty(e)?4:"null"===e?5:"true"===e||"false"===e?1:3,value:e,start:t,end:FD}}function JD(){var t,e,n,r,i=FD,a=CD.charCodeAt(FD),o=CD[FD];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++FD,{type:7,value:String.fromCharCode(a),start:i,end:FD};default:if(61===(t=CD.charCodeAt(FD+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return FD+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(t),start:i,end:FD};case 33:case 61:return FD+=2,61===CD.charCodeAt(FD)&&++FD,{type:7,value:CD.slice(i,FD),start:i,end:FD}}}return">>>="===(r=CD.substr(FD,4))?{type:7,value:r,start:i,end:FD+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:FD+=3}:o===(e=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===e?{type:7,value:e,start:i,end:FD+=2}:"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:i,end:++FD}:void sC({},"Unexpected token %0",zD)}function ZD(){var t,e,n;if(RD(qD((n=CD[FD]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),e=FD,t="","."!==n){if(t=CD[FD++],n=CD[FD],"0"===t){if("x"===n||"X"===n)return++FD,function(t){for(var e="";FD<SD&&UD(CD[FD]);)e+=CD[FD++];return 0===e.length&&sC({},"Unexpected token %0",zD),jD(CD.charCodeAt(FD))&&sC({},"Unexpected token %0",zD),{type:6,value:parseInt("0x"+e,16),start:t,end:FD}}(e);if(LD(n))return function(t){for(var e="0"+CD[FD++];FD<SD&&LD(CD[FD]);)e+=CD[FD++];return(jD(CD.charCodeAt(FD))||qD(CD.charCodeAt(FD)))&&sC({},"Unexpected token %0",zD),{type:6,value:parseInt(e,8),octal:!0,start:t,end:FD}}(e);n&&qD(n.charCodeAt(0))&&sC({},"Unexpected token %0",zD)}for(;qD(CD.charCodeAt(FD));)t+=CD[FD++];n=CD[FD]}if("."===n){for(t+=CD[FD++];qD(CD.charCodeAt(FD));)t+=CD[FD++];n=CD[FD]}if("e"===n||"E"===n)if(t+=CD[FD++],"+"!==(n=CD[FD])&&"-"!==n||(t+=CD[FD++]),qD(CD.charCodeAt(FD)))for(;qD(CD.charCodeAt(FD));)t+=CD[FD++];else sC({},"Unexpected token %0",zD);return jD(CD.charCodeAt(FD))&&sC({},"Unexpected token %0",zD),{type:6,value:parseFloat(t),start:e,end:FD}}function QD(){var t,e,n,r;return BD=null,HD(),t=FD,e=function(){var t,e,n,r;for(RD("/"===(t=CD[FD]),"Regular expression literal must start with a slash"),e=CD[FD++],n=!1,r=!1;FD<SD;)if(e+=t=CD[FD++],"\\"===t)PD((t=CD[FD++]).charCodeAt(0))&&sC({},"Invalid regular expression: missing /"),e+=t;else if(PD(t.charCodeAt(0)))sC({},"Invalid regular expression: missing /");else if(n)"]"===t&&(n=!1);else{if("/"===t){r=!0;break}"["===t&&(n=!0)}return r||sC({},"Invalid regular expression: missing /"),{value:e.substr(1,e.length-2),literal:e}}(),n=function(){var t,e,n;for(e="",n="";FD<SD&&ID((t=CD[FD]).charCodeAt(0));)++FD,"\\"===t&&FD<SD?sC({},"Unexpected token %0",zD):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&sC({},"Invalid regular expression",n),{value:n,literal:e}}(),r=function(t,e){var n=t;e.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(t,e){if(parseInt(e,16)<=1114111)return"x";sC({},"Invalid regular expression")})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(t){sC({},"Invalid regular expression")}try{return new RegExp(t,e)}catch(t){return null}}(e.value,n.value),{literal:e.literal+n.literal,value:r,regex:{pattern:e.value,flags:n.value},start:t,end:FD}}function KD(){var t;return HD(),FD>=SD?{type:2,start:FD,end:FD}:jD(t=CD.charCodeAt(FD))?XD():40===t||41===t||59===t?JD():39===t||34===t?function(){var t,e,n,r,i="",a=!1;for(RD("'"===(t=CD[FD])||'"'===t,"String literal must starts with a quote"),e=FD,++FD;FD<SD;){if((n=CD[FD++])===t){t="";break}if("\\"===n)if((n=CD[FD++])&&PD(n.charCodeAt(0)))"\r"===n&&"\n"===CD[FD]&&++FD;else switch(n){case"u":case"x":"{"===CD[FD]?(++FD,i+=VD()):i+=YD(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:LD(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),FD<SD&&LD(CD[FD])&&(a=!0,r=8*r+"01234567".indexOf(CD[FD++]),"0123".indexOf(n)>=0&&FD<SD&&LD(CD[FD])&&(r=8*r+"01234567".indexOf(CD[FD++]))),i+=String.fromCharCode(r)):i+=n}else{if(PD(n.charCodeAt(0)))break;i+=n}}return""!==t&&sC({},"Unexpected token %0",zD),{type:8,value:i,octal:a,start:e,end:FD}}():46===t?qD(CD.charCodeAt(FD+1))?ZD():JD():qD(t)?ZD():JD()}function tC(){var t;return FD=(t=BD).end,BD=KD(),FD=t.end,t}function eC(){var t;t=FD,BD=KD(),FD=t}function nC(t,e,n){var r=new TD("||"===t||"&&"===t?"LogicalExpression":"BinaryExpression");return r.operator=t,r.left=e,r.right=n,r}function rC(t,e){var n=new TD("CallExpression");return n.callee=t,n.arguments=e,n}function iC(t){var e=new TD("Identifier");return e.name=t,e}function aC(t){var e=new TD("Literal");return e.value=t.value,e.raw=CD.slice(t.start,t.end),t.regex&&("//"===e.raw&&(e.raw="/(?:)/"),e.regex=t.regex),e}function oC(t,e,n){var r=new TD("MemberExpression");return r.computed="["===t,r.object=e,r.property=n,r.computed||(n.member=!0),r}function uC(t,e,n){var r=new TD("Property");return r.key=e,r.value=n,r.kind=t,r}function sC(t,e){var n,r=Array.prototype.slice.call(arguments,2),i=e.replace(/%(\d)/g,(function(t,e){return RD(e<r.length,"Message reference must be in range"),r[e]}));throw(n=new Error(i)).index=FD,n.description=i,n}function lC(t){2===t.type&&sC(t,"Unexpected end of input"),6===t.type&&sC(t,"Unexpected number"),8===t.type&&sC(t,"Unexpected string"),3===t.type&&sC(t,"Unexpected identifier"),4===t.type&&sC(t,"Unexpected reserved word"),sC(t,"Unexpected token %0",t.value)}function cC(t){var e=tC();7===e.type&&e.value===t||lC(e)}function fC(t){return 7===BD.type&&BD.value===t}function hC(t){return 4===BD.type&&BD.value===t}function dC(){var t=[];for(FD=BD.start,cC("[");!fC("]");)fC(",")?(tC(),t.push(null)):(t.push(MC()),fC("]")||cC(","));return tC(),function(t){var e=new TD("ArrayExpression");return e.elements=t,e}(t)}function pC(){var t;return FD=BD.start,8===(t=tC()).type||6===t.type?(t.octal&&sC(t,"Octal literals are not allowed in strict mode."),aC(t)):iC(t.value)}function gC(){var t,e,n;return FD=BD.start,3===(t=BD).type?(n=pC(),cC(":"),uC("init",n,MC())):2!==t.type&&7!==t.type?(e=pC(),cC(":"),uC("init",e,MC())):void lC(t)}function mC(){var t,e,n=[],r={},i=String;for(FD=BD.start,cC("{");!fC("}");)e="$"+("Identifier"===(t=gC()).key.type?t.key.name:i(t.key.value)),Object.prototype.hasOwnProperty.call(r,e)?sC({},"Duplicate data property in object literal not allowed in strict mode"):r[e]=!0,n.push(t),fC("}")||cC(",");return cC("}"),function(t){var e=new TD("ObjectExpression");return e.properties=t,e}(n)}var vC={if:1};function yC(){var t,e,n;if(fC("("))return function(){var t;return cC("("),t=EC(),cC(")"),t}();if(fC("["))return dC();if(fC("{"))return mC();if(t=BD.type,FD=BD.start,3===t||vC[BD.value])n=iC(tC().value);else if(8===t||6===t)BD.octal&&sC(BD,"Octal literals are not allowed in strict mode."),n=aC(tC());else{if(4===t)throw new Error("Disabled.");1===t?((e=tC()).value="true"===e.value,n=aC(e)):5===t?((e=tC()).value=null,n=aC(e)):fC("/")||fC("/=")?(n=aC(QD()),eC()):lC(tC())}return n}function _C(){var t=[];if(cC("("),!fC(")"))for(;FD<SD&&(t.push(MC()),!fC(")"));)cC(",");return cC(")"),t}function xC(){return cC("."),FD=BD.start,function(t){return 3===t.type||4===t.type||1===t.type||5===t.type}(t=tC())||lC(t),iC(t.value);var t}function bC(){var t;return cC("["),t=EC(),cC("]"),t}function wC(){var t=function(){var t;for(t=yC();;)if(fC("."))t=oC(".",t,xC());else if(fC("("))t=rC(t,_C());else{if(!fC("["))break;t=oC("[",t,bC())}return t}();if(7===BD.type&&(fC("++")||fC("--")))throw new Error("Disabled.");return t}function kC(){var t,e;if(7!==BD.type&&4!==BD.type)e=wC();else{if(fC("++")||fC("--"))throw new Error("Disabled.");if(fC("+")||fC("-")||fC("~")||fC("!"))t=tC(),e=kC(),e=function(t,e){var n=new TD("UnaryExpression");return n.operator=t,n.argument=e,n.prefix=!0,n}(t.value,e);else{if(hC("delete")||hC("void")||hC("typeof"))throw new Error("Disabled.");e=wC()}}return e}function AC(t){var e=0;if(7!==t.type&&4!==t.type)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11}return e}function MC(){var t,e;return t=function(){var t,e,n,r,i,a,o,u,s,l;if(t=BD,s=kC(),0===(i=AC(r=BD)))return s;for(r.prec=i,tC(),e=[t,BD],a=[s,r,o=kC()];(i=AC(BD))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),u=a.pop().value,s=a.pop(),e.pop(),n=nC(u,s,o),a.push(n);(r=tC()).prec=i,a.push(r),e.push(BD),n=kC(),a.push(n)}for(n=a[l=a.length-1],e.pop();l>1;)e.pop(),n=nC(a[l-1].value,a[l-2],n),l-=2;return n}(),fC("?")&&(tC(),e=MC(),cC(":"),t=function(t,e,n){var r=new TD("ConditionalExpression");return r.test=t,r.consequent=e,r.alternate=n,r}(t,e,MC())),t}function EC(){var t=MC();if(fC(","))throw new Error("Disabled.");return t}var DC={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function CC(t){function e(e,n,r){return function(i){return function(e,n,r,i){var a=t(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+e+(i<0?"":0===i?"()":"("+n.slice(1).map(t).join(",")+")")}(e,i,n,r)}}var n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(e){e.length<3&&u("Missing arguments to clamp function."),e.length>3&&u("Too many arguments to clamp function.");var n=e.map(t);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:e("getDate",n,0),day:e("getDay",n,0),year:e("getFullYear",n,0),month:e("getMonth",n,0),hours:e("getHours",n,0),minutes:e("getMinutes",n,0),seconds:e("getSeconds",n,0),milliseconds:e("getMilliseconds",n,0),time:e("getTime",n,0),timezoneoffset:e("getTimezoneOffset",n,0),utcdate:e("getUTCDate",n,0),utcday:e("getUTCDay",n,0),utcyear:e("getUTCFullYear",n,0),utcmonth:e("getUTCMonth",n,0),utchours:e("getUTCHours",n,0),utcminutes:e("getUTCMinutes",n,0),utcseconds:e("getUTCSeconds",n,0),utcmilliseconds:e("getUTCMilliseconds",n,0),length:e("length",null,-1),join:e("join",null),indexof:e("indexOf",null),lastindexof:e("lastIndexOf",null),slice:e("slice",null),reverse:function(e){return"("+t(e[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:e("toUpperCase","String",0),lower:e("toLowerCase","String",0),substring:e("substring","String"),split:e("split","String"),replace:e("replace","String"),trim:e("trim","String",0),regexp:"RegExp",test:e("test","RegExp"),if:function(e){e.length<3&&u("Missing arguments to if function."),e.length>3&&u("Too many arguments to if function.");var n=e.map(t);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function FC(t,e,n,r){"Literal"!==e[0].type&&u("First argument to data functions must be a string literal.");const i=e[0].value,a=":"+i;if(!it(a,r))try{r[a]=n.getData(i).tuplesRef()}catch(t){}}function SC(t,e,n,r){if("Literal"===e[0].type)BC(n,r,e[0].value);else for(t in n.scales)BC(n,r,t)}function BC(t,e,n){const r="%"+n;if(!it(e,r))try{e[r]=t.scaleRef(n)}catch(t){}}function TC(t,e){let n;return Y(t)?t:pt(t)?(n=e.scales[t])&&n.value:void 0}function zC(t,e){return function(n,r,i){if(n){const e=TC(n,(i||this).context);return e&&e.path[t](r)}return e(r)}}const NC=zC("area",(function(t){return I_.reset(),R_(t,W_),2*I_})),OC=zC("bounds",(function(t){var e,n,r,i,a,o,u;if(ax=ix=-(nx=rx=1/0),cx=[],R_(t,Fx),n=cx.length){for(cx.sort(Ux),e=1,a=[r=cx[0]];e<n;++e)Lx(r,(i=cx[e])[0])||Lx(r,i[1])?(qx(r[0],i[1])>qx(r[0],r[1])&&(r[1]=i[1]),qx(i[0],r[1])>qx(r[0],r[1])&&(r[0]=i[0])):a.push(r=i);for(o=-1/0,e=0,r=a[n=a.length-1];e<=n;r=i,++e)i=a[e],(u=qx(r[1],i[0]))>o&&(o=u,nx=i[0],ix=r[1])}return cx=fx=null,nx===1/0||rx===1/0?[[NaN,NaN],[NaN,NaN]]:[[nx,rx],[ix,ax]]})),RC=zC("centroid",(function(t){hx=dx=px=gx=mx=vx=yx=_x=xx=bx=wx=0,R_(t,$x);var e=xx,n=bx,r=wx,i=e*e+n*n+r*r;return i<1e-12&&(e=vx,n=yx,r=_x,dx<1e-6&&(e=px,n=gx,r=mx),(i=e*e+n*n+r*r)<1e-12)?[NaN,NaN]:[y_(n,e)*p_,F_(r/E_(i))*p_]}));function qC(t,e,n){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(n)))}catch(e){t.warn(e)}return n[n.length-1]}function UC(t){const e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function LC(t){const e=Yd(t);return.2126*UC(e.r)+.7152*UC(e.g)+.0722*UC(e.b)}function $C(t,e){return t===e||t!=t&&e!=e||(_(t)?!(!_(e)||t.length!==e.length)&&function(t,e){for(let n=0,r=t.length;n<r;++n)if(!$C(t[n],e[n]))return!1;return!0}(t,e):!(!x(t)||!x(e))&&PC(t,e))}function PC(t,e){for(let n in t)if(!$C(t[n],e[n]))return!1;return!0}function jC(t){return e=>PC(t,e)}const IC=t=>t.data;function WC(t,e){const n=yD.call(e,t);return n.root&&n.root.lookup||{}}const HC=()=>"undefined"!=typeof window&&window||null;function YC(t,e){for(var n,r,i=e.fields,a=e.values,o=i.length,u=0;u<o;++u)if((r=i[u]).getter=l.getter||l(r.field),ft(n=r.getter(t))&&(n=E(n)),ft(a[u])&&(a[u]=E(a[u])),ft(a[u][0])&&(a[u]=a[u].map(E)),"E"===r.type){if(_(a[u])?a[u].indexOf(n)<0:n!==a[u])return!1}else if("R"===r.type){if(!lt(n,a[u]))return!1}else if("R-RE"===r.type){if(!lt(n,a[u],!0,!1))return!1}else if("R-E"===r.type){if(!lt(n,a[u],!1,!1))return!1}else if("R-LE"===r.type&&!lt(n,a[u],!1,!0))return!1;return!0}var VC={E_union:function(t,e){if(!t.length)return e;for(var n=0,r=e.length;n<r;++n)t.indexOf(e[n])<0&&t.push(e[n]);return t},E_intersect:function(t,e){return t.length?t.filter((function(t){return e.indexOf(t)>=0})):e},R_union:function(t,e){var n=E(e[0]),r=E(e[1]);return n>r&&(n=e[1],r=e[0]),t.length?(t[0]>n&&(t[0]=n),t[1]<r&&(t[1]=r),t):[n,r]},R_intersect:function(t,e){var n=E(e[0]),r=E(e[1]);return n>r&&(n=e[1],r=e[0]),t.length?r<t[0]||t[1]<n?[]:(t[0]<n&&(t[0]=n),t[1]>r&&(t[1]=r),t):[n,r]}};function GC(t,e,n,r){"Literal"!==e[0].type&&u("First argument to selection functions must be a string literal.");const i=e[0].value,a=":"+i;"intersect"!==(e.length>=2&&M(e).value)||it(r,"@unit")||(r["@unit"]=n.getData(i).indataRef(n,"unit")),it(r,a)||(r[a]=n.getData(i).tuplesRef())}const XC={random:function(){return t.random()},cumulativeNormal:Eo,cumulativeLogNormal:To,cumulativeUniform:Uo,densityNormal:Mo,densityLogNormal:Bo,densityUniform:qo,quantileNormal:Do,quantileLogNormal:zo,quantileUniform:Lo,sampleNormal:Ao,sampleLogNormal:So,sampleUniform:Ro,isArray:_,isBoolean:ct,isDate:ft,isDefined:function(t){return void 0!==t},isNumber:ht,isObject:x,isRegExp:dt,isString:pt,isTuple:Nt,isValid:function(t){return null!=t&&t==t},toBoolean:kt,toDate:Mt,toNumber:E,toString:Et,flush:ut,lerp:mt,merge:function(){var t=[].slice.call(arguments);return t.unshift({}),tt.apply(null,t)},pad:xt,peek:M,span:bt,inrange:lt,truncate:Ct,rgb:Yd,lab:op,hcl:dp,hsl:Kd,luminance:LC,contrast:function(t,e){const n=LC(t),r=LC(e);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:Ye,format:xD,utcFormat:wD,utcParse:AD,utcOffset:Pr,utcSequence:Wr,timeFormat:bD,timeParse:kD,timeOffset:$r,timeSequence:Ir,timeUnitSpecifier:In,monthFormat:function(t){return ED.call(this,t,1,"%B")},monthAbbrevFormat:function(t){return ED.call(this,t,1,"%b")},dayFormat:function(t){return ED.call(this,0,2+t,"%A")},dayAbbrevFormat:function(t){return ED.call(this,0,2+t,"%a")},quarter:j,utcquarter:I,week:mr,utcweek:wr,dayofyear:gr,utcdayofyear:br,warn:function(){return qC(this.context.dataflow,"warn",arguments)},info:function(){return qC(this.context.dataflow,"info",arguments)},debug:function(){return qC(this.context.dataflow,"debug",arguments)},extent:et,inScope:function(t){let e=this.context.group,n=!1;if(e)for(;t;){if(t===e){n=!0;break}t=t.mark.group}return n},intersect:function(t,e,n){if(!t)return[];const[r,i]=t,a=(new Uc).set(r[0],r[1],i[0],i[1]);return kv(n||this.context.dataflow.scenegraph().root,a,function(t){let e=null;if(t){const n=W(t.marktype),r=W(t.markname);e=t=>(!n.length||n.some(e=>t.marktype===e))&&(!r.length||r.some(e=>t.name===e))}return e}(e))},clampRange:H,pinchDistance:function(t){const e=t.touches,n=e[0].clientX-e[1].clientX,r=e[0].clientY-e[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(t){const e=t.touches;return Math.atan2(e[0].clientY-e[1].clientY,e[0].clientX-e[1].clientX)},screen:function(){const t=HC();return t?t.screen:{}},containerSize:function(){const t=this.context.dataflow,e=t.container&&t.container();return e?[e.clientWidth,e.clientHeight]:[void 0,void 0]},windowSize:function(){const t=HC();return t?[t.innerWidth,t.innerHeight]:[void 0,void 0]},bandspace:function(t,e,n){return vd(t||0,e||0,n||0)},setdata:function(t,e){const n=this.context.dataflow,r=this.context.data[t].input;return n.pulse(r,n.changeset().remove(g).insert(e)),1},pathShape:function(t){let e=null;return function(n){return n?uc(n,e=e||Jl(t)):t}},panLinear:z,panLog:N,panPow:O,panSymlog:R,zoomLinear:U,zoomLog:L,zoomPow:$,zoomSymlog:P,encode:function(t,e,n){if(t){const n=this.context.dataflow,r=t.mark.source;n.pulse(r,n.changeset().encode(t,e))}return void 0!==n?n:t},modify:function(t,e,n,r,i,a){let o,u,s=this.context.dataflow,l=this.context.data[t],c=l.input,f=l.changes,h=s.stamp();if(!1===s._trigger||!(c.value.length||e||r))return 0;if((!f||f.stamp<h)&&(l.changes=f=s.changeset(),f.stamp=h,s.runAfter((function(){l.modified=!0,s.pulse(c,f).run()}),!0,1)),n&&(o=!0===n?g:_(n)||Nt(n)?n:jC(n),f.remove(o)),e&&f.insert(e),r&&(o=jC(r),c.value.some(o)?f.remove(o):f.insert(r)),i)for(u in a)f.modify(i,u,a[u]);return 1}},JC=["view","item","group","xy","x","y"],ZC={};function QC(t,e,n){return 1===arguments.length?XC[t]:(XC[t]=e,n&&(ZC[t]=n),tF&&(tF.functions[t]="this."+t),this)}QC("bandwidth",(function(t,e){const n=TC(t,(e||this).context);return n&&n.bandwidth?n.bandwidth():0}),SC),QC("copy",(function(t,e){const n=TC(t,(e||this).context);return n?n.copy():void 0}),SC),QC("domain",(function(t,e){const n=TC(t,(e||this).context);return n?n.domain():[]}),SC),QC("range",(function(t,e){const n=TC(t,(e||this).context);return n&&n.range?n.range():[]}),SC),QC("invert",(function(t,e,n){const r=TC(t,(n||this).context);return r?_(e)?(r.invertRange||r.invert)(e):(r.invert||r.invertExtent)(e):void 0}),SC),QC("scale",(function(t,e,n){const r=TC(t,(n||this).context);return r?r(e):void 0}),SC),QC("gradient",(function(t,e,n,r,i){t=TC(t,(i||this).context);const a=Os(e,n);let o=t.domain(),u=o[0],s=M(o),l=h;return s-u?l=xm(t,u,s):t=(t.interpolator?um("sequential")().interpolator(t.interpolator()):um("linear")().interpolate(t.interpolate()).range(t.range())).domain([u=0,s=1]),t.ticks&&(o=t.ticks(+r||15),u!==o[0]&&o.unshift(u),s!==M(o)&&o.push(s)),o.forEach(e=>a.stop(l(e),t(e))),a}),SC),QC("geoArea",NC,SC),QC("geoBounds",OC,SC),QC("geoCentroid",RC,SC),QC("geoShape",(function(t,e,n){const r=TC(t,(n||this).context);return function(t){return r?r.path.context(t)(e):""}}),SC),QC("indata",(function(t,e,n){const r=this.context.data[t]["index:"+e],i=r?r.value.get(n):void 0;return i?i.count:i}),(function(t,e,n,r){"Literal"!==e[0].type&&u("First argument to indata must be a string literal."),"Literal"!==e[1].type&&u("Second argument to indata must be a string literal.");const i=e[0].value,a=e[1].value,o="@"+a;it(o,r)||(r[o]=n.getData(i).indataRef(n,a))})),QC("data",yD,FC),QC("treePath",(function(t,e,n){const r=WC(t,this),i=r[e],a=r[n];return i&&a?i.path(a).map(IC):void 0}),FC),QC("treeAncestors",(function(t,e){const n=WC(t,this)[e];return n?n.ancestors().map(IC):void 0}),FC),QC("vlSelectionTest",(function(t,e,n){for(var r,i,a,o,u,s=this.context.data[t],l=s?s.values.value:[],c=s?s["index:unit"]&&s["index:unit"].value:void 0,f="intersect"===n,h=l.length,d=0;d<h;++d)if(r=l[d],c&&f){if(-1===(a=(i=i||{})[o=r.unit]||0))continue;if(u=YC(e,r),i[o]=u?-1:++a,u&&1===c.size)return!0;if(!u&&a===c.get(o).count)return!1}else if(f^(u=YC(e,r)))return u;return h&&f}),GC),QC("vlSelectionResolve",(function(t,e,n){for(var r,i,a,o,u,s,l,c,f,h,d,p=this.context.data[t],g=p?p.values.value:[],m={},v={},y={},_=g.length,x=0;x<_;++x){for(o=(r=g[x]).unit,i=r.fields,a=r.values,h=0,d=i.length;h<d;++h)u=i[h],l=(s=m[u.field]||(m[u.field]={}))[o]||(s[o]=[]),y[u.field]=c=u.type.charAt(0),f=VC[c+"_union"],s[o]=f(l,W(a[h]));n&&(l=v[o]||(v[o]=[])).push(W(a).reduce((t,e,n)=>(t[i[n].field]=e,t),{}))}return e=e||"union",Object.keys(m).forEach((function(t){m[t]=Object.keys(m[t]).map(e=>m[t][e]).reduce((n,r)=>void 0===n?r:VC[y[t]+"_"+e](n,r))})),g=Object.keys(v),n&&g.length&&(m.vlMulti="union"===e?{or:g.reduce((t,e)=>(t.push.apply(t,v[e]),t),[])}:{and:g.map(t=>({or:v[t]}))}),m}),GC);const KC={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:t=>"_["+wt("$"+t)+"]",functions:function(t){const e=CC(t);JC.forEach(t=>e[t]="event.vega."+t);for(let t in XC)e[t]="this."+t;return tt(e,function(t,e,n){e.__bandwidth=t=>t&&t.bandwidth?t.bandwidth():0,n._bandwidth=SC,n._range=SC,n._scale=SC;const r=e=>"_["+("Literal"===e.type?wt("%"+e.value):wt("%")+"+"+t(e))+"]";return{_bandwidth:t=>`this.__bandwidth(${r(t[0])})`,_range:t=>r(t[0])+".range()",_scale:e=>`${r(e[0])}(${t(e[1])})`}}(t,XC,ZC)),e},constants:DC,visitors:ZC};var tF=function(t){var e=(t=t||{}).whitelist?Dt(t.whitelist):{},n=t.blacklist?Dt(t.blacklist):{},r=t.constants||DC,i=(t.functions||CC)(h),a=t.globalvar,o=t.fieldvar,s={},l={},c=0,f=Y(a)?a:function(t){return a+'["'+t+'"]'};function h(t){if(pt(t))return t;var e=d[t.type];return null==e&&u("Unsupported type: "+t.type),e(t)}var d={Literal:function(t){return t.raw},Identifier:function(t){var i=t.name;return c>0?i:it(n,i)?u("Illegal identifier: "+i):it(r,i)?r[i]:it(e,i)?i:(s[i]=1,f(i))},MemberExpression:function(t){var e=!t.computed,n=h(t.object);e&&(c+=1);var r=h(t.property);return n===o&&(l[function(t){var e=t&&t.length-1;return e&&('"'===t[0]&&'"'===t[e]||"'"===t[0]&&"'"===t[e])?t.slice(1,-1):t}(r)]=1),e&&(c-=1),n+(e?"."+r:"["+r+"]")},CallExpression:function(t){"Identifier"!==t.callee.type&&u("Illegal callee type: "+t.callee.type);var e=t.callee.name,n=t.arguments,r=it(i,e)&&i[e];return r||u("Unrecognized function: "+e),Y(r)?r(n):r+"("+n.map(h).join(",")+")"},ArrayExpression:function(t){return"["+t.elements.map(h).join(",")+"]"},BinaryExpression:function(t){return"("+h(t.left)+t.operator+h(t.right)+")"},UnaryExpression:function(t){return"("+t.operator+h(t.argument)+")"},ConditionalExpression:function(t){return"("+h(t.test)+"?"+h(t.consequent)+":"+h(t.alternate)+")"},LogicalExpression:function(t){return"("+h(t.left)+t.operator+h(t.right)+")"},ObjectExpression:function(t){return"{"+t.properties.map(h).join(",")+"}"},Property:function(t){c+=1;var e=h(t.key);return c-=1,e+":"+h(t.value)}};function p(t){var e={code:h(t),globals:Object.keys(s),fields:Object.keys(l)};return s={},l={},e}return p.functions=i,p.constants=r,p}(KC);function eF(t,e){var n,r,i={};try{n=function(t){FD=0,SD=(CD=t).length,BD=null,eC();var e=EC();if(2!==BD.type)throw new Error("Unexpect token after expression.");return e}(t=pt(t)?t:wt(t)+"")}catch(e){u("Expression parse error: "+t)}return n.visit(t=>{if("CallExpression"===t.type){var n=t.callee.name,r=KC.visitors[n];r&&r(n,t.arguments,e,i)}}),(r=tF(n)).globals.forEach(t=>{var n="$"+t;!it(i,n)&&e.getSignal(t)&&(i[n]=e.signalRef(t))}),{$expr:tt({code:r.code},e.options.ast?{ast:n}:null),$fields:r.fields,$params:i}}const nF=Dt(["rule"]),rF=Dt(["group","image","rect"]);function iF(t){return(t+"").toLowerCase()}function aF(t,e,n){";"!==n[n.length-1]&&(n="return("+n+");");var r=Function.apply(null,e.concat(n));return t&&t.functions?r.bind(t.functions):r}var oF={operator:(t,e)=>aF(t,["_"],e.code),parameter:(t,e)=>aF(t,["datum","_"],e.code),event:(t,e)=>aF(t,["event"],e.code),handler:(t,e)=>aF(t,["_","event"],`var datum=event.item&&event.item.datum;return ${e.code};`),encode:(t,e)=>{const{marktype:n,channels:r}=e;let i="var o=item,datum=o.datum,m=0,$;";for(const t in r){const e="o["+wt(t)+"]";i+=`$=${r[t].code};if(${e}!==$)${e}=$,m=1;`}return i+=function(t,e){let n="";return nF[e]||(t.x2&&(t.x?(rF[e]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),t.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),t.y2&&(t.y?(rF[e]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),t.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(r,n),i+="return m;",aF(t,["item","_"],i)},codegen:{get(t){const e=`[${t.map(wt).join("][")}]`,n=Function("_",`return _${e};`);return n.path=e,n},comparator(t,e){let n;const r=Function("a","b","var u, v; return "+t.map((t,r)=>{const i=e[r];let a,o;return t.path?(a="a"+t.path,o="b"+t.path):((n=n||{})["f"+r]=t,a=`this.f${r}(a)`,o=`this.f${r}(b)`),function(t,e,n,r){return`((u = ${t}) < (v = ${e}) || u == null) && v != null ? ${n}\n  : (u > v || v == null) && u != null ? ${r}\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}\n  : v !== v && u === u ? ${r} : `}(a,o,-i,i)}).join("")+"0;");return n?r.bind(n):r}}};function uF(t,e,n){if(!t||!x(t))return t;for(let r,i=0,a=sF.length;i<a;++i)if(r=sF[i],it(t,r.key))return r.parse(t,e,n);return t}var sF=[{key:"$ref",parse:function(t,e){return e.get(t.$ref)||u("Operator not defined: "+t.$ref)}},{key:"$key",parse:function(t,e){const n="k:"+t.$key+"_"+!!t.$flat;return e.fn[n]||(e.fn[n]=gt(t.$key,t.$flat,e.expr.codegen))}},{key:"$expr",parse:function(t,n,r){t.$params&&n.parseParameters(t.$params,r);const i="e:"+t.$expr.code+"_"+t.$name;return n.fn[i]||(n.fn[i]=e(n.parameterExpression(t.$expr),t.$fields,t.$name))}},{key:"$field",parse:function(t,e){if(!t.$field)return null;const n="f:"+t.$field+"_"+t.$name;return e.fn[n]||(e.fn[n]=l(t.$field,t.$name,e.expr.codegen))}},{key:"$encode",parse:function(t,n){const r=t.$encode,i={};for(const t in r){const a=r[t];i[t]=e(n.encodeExpression(a.$expr),a.$fields),i[t].output=a.$output}return i}},{key:"$compare",parse:function(t,e){const n="c:"+t.$compare+"_"+t.$order,r=W(t.$compare).map(t=>t&&t.$tupleid?Ot:t);return e.fn[n]||(e.fn[n]=V(r,t.$order,e.expr.codegen))}},{key:"$context",parse:function(t,e){return e}},{key:"$subflow",parse:function(t,e){const n=t.$subflow;return function(t,r,i){const a=e.fork().parse(n),o=a.get(n.operators[0].id),u=a.signals.parent;return u&&u.set(i),o.detachSubflow=()=>e.detach(a),o}}},{key:"$tupleid",parse:function(){return Ot}}];var lF={skip:!0};function cF(t,e,n,r){return new fF(t,e,n,r)}function fF(t,e,n,r){this.dataflow=t,this.transforms=e,this.events=t.events.bind(t),this.expr=r||oF,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function hF(t){this.dataflow=t.dataflow,this.transforms=t.transforms,this.events=t.events,this.expr=t.expr,this.signals=Object.create(t.signals),this.scales=Object.create(t.scales),this.nodes=Object.create(t.nodes),this.data=Object.create(t.data),this.fn=Object.create(t.fn),t.functions&&(this.functions=Object.create(t.functions),this.functions.context=this)}fF.prototype=hF.prototype={fork(){const t=new hF(this);return(this.subcontext||(this.subcontext=[])).push(t),t},detach(t){this.subcontext=this.subcontext.filter(e=>e!==t);const e=Object.keys(t.nodes);for(const n of e)t.nodes[n]._targets=null;for(const n of e)t.nodes[n].detach();t.nodes=null},get(t){return this.nodes[t]},set(t,e){return this.nodes[t]=e},add(t,e){const n=this,r=n.dataflow,i=t.value;if(n.set(t.id,e),function(t){return"collect"===iF(t)}(t.type)&&i&&(i.$ingest?r.ingest(e,i.$ingest,i.$format):i.$request?r.preload(e,i.$request,i.$format):r.pulse(e,r.changeset().insert(i))),t.root&&(n.root=e),t.parent){var a=n.get(t.parent.$ref);a?(r.connect(a,[e]),e.targets().add(a)):(n.unresolved=n.unresolved||[]).push(()=>{a=n.get(t.parent.$ref),r.connect(a,[e]),e.targets().add(a)})}if(t.signal&&(n.signals[t.signal]=e),t.scale&&(n.scales[t.scale]=e),t.data)for(const r in t.data){const i=n.data[r]||(n.data[r]={});t.data[r].forEach(t=>i[t]=e)}},resolve(){return(this.unresolved||[]).forEach(t=>t()),delete this.unresolved,this},operator(t,e){this.add(t,this.dataflow.add(t.value,e))},transform(t,e){this.add(t,this.dataflow.add(this.transforms[iF(e)]))},stream(t,e){this.set(t.id,e)},update(t,e,n,r,i){this.dataflow.on(e,n,r,i,t.options)},operatorExpression(t){return this.expr.operator(this,t)},parameterExpression(t){return this.expr.parameter(this,t)},eventExpression(t){return this.expr.event(this,t)},handlerExpression(t){return this.expr.handler(this,t)},encodeExpression(t){return this.expr.encode(this,t)},parse:function(t){const e=this,n=t.operators||[];return t.background&&(e.background=t.background),t.eventConfig&&(e.eventConfig=t.eventConfig),t.locale&&(e.locale=t.locale),n.forEach(t=>e.parseOperator(t)),n.forEach(t=>e.parseOperatorParameters(t)),(t.streams||[]).forEach(t=>e.parseStream(t)),(t.updates||[]).forEach(t=>e.parseUpdate(t)),e.resolve()},parseOperator:function(t){const e=this;!function(t){return"operator"===iF(t)}(t.type)&&t.type?e.transform(t,t.type):e.operator(t,t.update?e.operatorExpression(t.update):null)},parseOperatorParameters:function(t){const e=this;if(t.params){const n=e.get(t.id);n||u("Invalid operator id: "+t.id),e.dataflow.connect(n,n.parameters(e.parseParameters(t.params),t.react,t.initonly))}},parseParameters:function(t,e){e=e||{};const n=this;for(const r in t){const i=t[r];e[r]=_(i)?i.map(t=>uF(t,n,e)):uF(i,n,e)}return e},parseStream:function(t){var e,n=this,r=null!=t.filter?n.eventExpression(t.filter):void 0,i=null!=t.stream?n.get(t.stream):void 0;t.source?i=n.events(t.source,t.type,r):t.merge&&(i=(e=t.merge.map(t=>n.get(t)))[0].merge.apply(e[0],e.slice(1))),t.between&&(e=t.between.map(t=>n.get(t)),i=i.between(e[0],e[1])),t.filter&&(i=i.filter(r)),null!=t.throttle&&(i=i.throttle(+t.throttle)),null!=t.debounce&&(i=i.debounce(+t.debounce)),null==i&&u("Invalid stream definition: "+JSON.stringify(t)),t.consume&&i.consume(!0),n.stream(t,i)},parseUpdate:function(t){var e,n=x(n=t.source)?n.$ref:n,r=this.get(n),i=t.update,a=void 0;r||u("Source not defined: "+t.source),e=t.target&&t.target.$expr?this.eventExpression(t.target.$expr):this.get(t.target),i&&i.$expr&&(i.$params&&(a=this.parseParameters(i.$params)),i=this.handlerExpression(i.$expr)),this.update(t,r,e,i,a)},getState:function(t){var e=this,n={};if(t.signals){var r=n.signals={};Object.keys(e.signals).forEach(n=>{var i=e.signals[n];t.signals(n,i)&&(r[n]=i.value)})}if(t.data){var i=n.data={};Object.keys(e.data).forEach(n=>{var r=e.data[n];t.data(n,r)&&(i[n]=r.input.value)})}return e.subcontext&&!1!==t.recurse&&(n.subcontext=e.subcontext.map(e=>e.getState(t))),n},setState:function(t){var e=this,n=e.dataflow,r=t.data,i=t.signals;Object.keys(i||{}).forEach(t=>{n.update(e.signals[t],i[t],lF)}),Object.keys(r||{}).forEach(t=>{n.pulse(e.data[t].input,n.changeset().remove(g).insert(r[t]))}),(t.subcontext||[]).forEach((t,n)=>{var r=e.subcontext[n];r&&r.setState(t)})}};var dF={skip:!0};function pF(t,e){var n=t.autosize(),r=t.padding();return e-(n&&"padding"===n.contains?r.left+r.right:0)}function gF(t,e){var n=t.autosize(),r=t.padding();return e-(n&&"padding"===n.contains?r.top+r.bottom:0)}function mF(t,e){return e.modified&&_(e.input.value)&&t.indexOf("_:vega:_")}function vF(t,e){return!("parent"===t||e instanceof Za.proxy)}function yF(t,e,n,r){var i=t.element();i&&i.setAttribute("title",function(t){return null==t?"":_(t)?_F(t):x(t)&&!ft(t)?(e=t,Object.keys(e).map((function(t){var n=e[t];return t+": "+(_(n)?_F(n):xF(n))})).join("\n")):t+"";var e}(r))}function _F(t){return"["+t.map(xF).join(", ")+"]"}function xF(t){return _(t)?"[
]":x(t)&&!ft(t)?"{
}":t}function bF(t,e){const n=this;if(e=e||{},Ya.call(n),e.loader&&n.loader(e.loader),e.logger&&n.logger(e.logger),null!=e.logLevel&&n.logLevel(e.logLevel),e.locale||t.locale){const r=tt({},t.locale,e.locale);n.locale(Da(r.number,r.time))}n._el=null,n._elBind=null,n._renderType=e.renderer||xv.Canvas,n._scenegraph=new Rh;const r=n._scenegraph.root;n._renderer=null,n._tooltip=e.tooltip||yF,n._redraw=!0,n._handler=(new ad).scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(t){const e=tt({defaults:{}},t),n=(t,e)=>{e.forEach(e=>{_(t[e])&&(t[e]=Dt(t[e]))})};return n(e.defaults,["prevent","allow"]),n(e,["view","window","selector"]),e}(t.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(t,e,n){return cF(t,Za,XC,n).parse(e)}(n,t,e.expr);n._runtime=i,n._signals=i.signals,n._bind=(t.bindings||[]).map(t=>({state:null,param:tt({},t)})),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=pF(n,n._width),n._viewHeight=gF(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(t){var e=t._signals,n=e.width,r=e.height,i=e.padding;function a(){t._autosize=t._resize=1}t._resizeWidth=t.add(null,(function(e){t._width=e.size,t._viewWidth=pF(t,e.size),a()}),{size:n}),t._resizeHeight=t.add(null,(function(e){t._height=e.size,t._viewHeight=gF(t,e.size),a()}),{size:r});var o=t.add(null,a,{pad:i});t._resizeWidth.rank=n.rank+1,t._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}(n),function(t){t.add(null,e=>(t._background=e.bg,t._resize=1,e.bg),{bg:t._signals.background})}(n),function(t){const e=t._signals.cursor||(t._signals.cursor=t.add({user:"default",item:null}));t.on(t.events("view","mousemove"),e,(function(t,n){const r=e.value,i=r?pt(r)?r:r.user:"default",a=n.item&&n.item.cursor||null;return r&&i===r.user&&a==r.item?r:{user:i,item:a}})),t.add(null,(function(e){let n=e.cursor,r=this.value;return pt(n)||(r=n.item,n=n.user),YE(t,n&&"default"!==n?n:r||n),r}),{cursor:e})}(n),n.description(t.description),e.hover&&n.hover(),e.container&&n.initialize(e.container,e.bind)}var wF=st(bF,Ya);function kF(t,e){return it(t._signals,e)?t._signals[e]:u("Unrecognized signal name: "+wt(e))}function AF(t,e){const n=(t._targets||[]).filter(t=>t._update&&t._update.handler===e);return n.length?n[0]:null}function MF(t,e,n,r){var i=AF(n,r);return i||((i=dD(t,()=>r(e,n.value))).handler=r,t.on(n,null,i)),t}function EF(t,e,n){var r=AF(e,n);return r&&e._targets.remove(r),t}function DF(t){return x(t)?t:{type:t||"pad"}}wF.evaluate=async function(t,e,n){if(await Ya.prototype.evaluate.call(this,t,e),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,function(t){var e=ZE(t),n=XE(t),r=JE(t);t._renderer.background(t.background()),t._renderer.resize(n,r,e),t._handler.origin(e),t._resizeListeners.forEach((function(e){try{e(n,r)}catch(e){t.error(e)}}))}(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(t){this.error(t)}return n&&Bt(this,n),this},wF.dirty=function(t){this._redraw=!0,this._renderer&&this._renderer.dirty(t)},wF.description=function(t){if(arguments.length){const e=null!=t?t+"":null;return e!==this._desc&&HE(this._el,this._desc=e),this}return this._desc},wF.container=function(){return this._el},wF.scenegraph=function(){return this._scenegraph},wF.origin=function(){return this._origin.slice()},wF.signal=function(t,e,n){var r=kF(this,t);return 1===arguments.length?r.value:this.update(r,e,n)},wF.width=function(t){return arguments.length?this.signal("width",t):this.signal("width")},wF.height=function(t){return arguments.length?this.signal("height",t):this.signal("height")},wF.padding=function(t){return arguments.length?this.signal("padding",mD(t)):mD(this.signal("padding"))},wF.autosize=function(t){return arguments.length?this.signal("autosize",t):this.signal("autosize")},wF.background=function(t){return arguments.length?this.signal("background",t):this.signal("background")},wF.renderer=function(t){return arguments.length?(wv(t)||u("Unrecognized renderer type: "+t),t!==this._renderType&&(this._renderType=t,this._resetRenderer()),this):this._renderType},wF.tooltip=function(t){return arguments.length?(t!==this._tooltip&&(this._tooltip=t,this._resetRenderer()),this):this._tooltip},wF.loader=function(t){return arguments.length?(t!==this._loader&&(Ya.prototype.loader.call(this,t),this._resetRenderer()),this):this._loader},wF.resize=function(){return this._autosize=1,this.touch(kF(this,"autosize"))},wF._resetRenderer=function(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},wF._resizeView=function(t,e,n,r,i,a){this.runAfter((function(o){var u=0;o._autosize=0,o.width()!==n&&(u=1,o.signal("width",n,dF),o._resizeWidth.skip(!0)),o.height()!==r&&(u=1,o.signal("height",r,dF),o._resizeHeight.skip(!0)),o._viewWidth!==t&&(o._resize=1,o._viewWidth=t),o._viewHeight!==e&&(o._resize=1,o._viewHeight=e),o._origin[0]===i[0]&&o._origin[1]===i[1]||(o._resize=1,o._origin=i),u&&o.run("enter"),a&&o.runAfter(t=>t.resize())}),!1,1)},wF.addEventListener=function(t,e,n){var r=e;return n&&!1===n.trap||((r=dD(this,e)).raw=e),this._handler.on(t,r),this},wF.removeEventListener=function(t,e){for(var n,r,i=this._handler.handlers(t),a=i.length;--a>=0;)if(r=i[a].type,n=i[a].handler,t===r&&(e===n||e===n.raw)){this._handler.off(r,n);break}return this},wF.addResizeListener=function(t){var e=this._resizeListeners;return e.indexOf(t)<0&&e.push(t),this},wF.removeResizeListener=function(t){var e=this._resizeListeners,n=e.indexOf(t);return n>=0&&e.splice(n,1),this},wF.addSignalListener=function(t,e){return MF(this,t,kF(this,t),e)},wF.removeSignalListener=function(t,e){return EF(this,kF(this,t),e)},wF.addDataListener=function(t,e){return MF(this,t,VE(this,t).values,e)},wF.removeDataListener=function(t,e){return EF(this,VE(this,t).values,e)},wF.globalCursor=function(t){if(arguments.length){if(this._globalCursor!==!!t){const e=YE(this,null);this._globalCursor=!!t,e&&YE(this,e)}return this}return this._globalCursor},wF.preventDefault=function(t){return arguments.length?(this._preventDefault=t,this):this._preventDefault},wF.timer=function(t,e){this._timers.push(function(t,e,n){var r=new lA,i=e;return null==e?(r.restart(t,e,n),r):(e=+e,n=null==n?uA():+n,r.restart((function a(o){o+=i,r.restart(a,i+=e,n),t(o)}),e,n),r)}((function(e){t({timestamp:Date.now(),elapsed:e})}),e))},wF.events=function(t,e,n){var r,i=this,a=new Kt(n),o=function(n,r){i.runAsync(null,()=>{"view"===t&&function(t,e){var n=t._eventConfig.defaults,r=n.prevent,i=n.allow;return!1!==r&&!0!==i&&(!0===r||!1===i||(r?r[e]:i?!i[e]:t.preventDefault()))}(i,e)&&n.preventDefault(),a.receive(QE(i,n,r))})};if("timer"===t)tD(i,"timer",e)&&i.timer(o,e);else if("view"===t)tD(i,"view",e)&&i.addEventListener(e,o,KE);else if("window"===t?tD(i,"window",e)&&"undefined"!=typeof window&&(r=[window]):"undefined"!=typeof document&&tD(i,"selector",e)&&(r=document.querySelectorAll(t)),r){for(var u=0,s=r.length;u<s;++u)r[u].addEventListener(e,o);i._eventListeners.push({type:e,sources:r,handler:o})}else i.warn("Can not resolve event source: "+t);return a},wF.finalize=function(){var t,e,n,r=this._tooltip,i=this._timers,a=this._eventListeners;for(t=i.length;--t>=0;)i[t].stop();for(t=a.length;--t>=0;)for(e=(n=a[t]).sources.length;--e>=0;)n.sources[e].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},wF.hover=function(t,e){return e=[e||"update",(t=[t||"hover"])[0]],this.on(this.events("view","mouseover",eD),nD,rD(t)),this.on(this.events("view","mouseout",eD),nD,rD(e)),this},wF.data=function(t,e){return arguments.length<2?VE(this,t).values.value:GE.call(this,t,It().remove(g).insert(e))},wF.change=GE,wF.insert=function(t,e){return GE.call(this,t,It().insert(e))},wF.remove=function(t,e){return GE.call(this,t,It().remove(e))},wF.scale=function(t){var e=this._runtime.scales;return it(e,t)||u("Unrecognized scale or projection: "+t),e[t].value},wF.initialize=function(t,e){const n=this,r=n._renderType,i=n._eventConfig.bind,a=wv(r);t=n._el=t?pD(n,t):null,function(t){const e=t.container();e&&(e.setAttribute("role","graphics-document"),e.setAttribute("aria-roleDescription","visualization"),HE(e,t.description()))}(n),a||n.error("Unrecognized renderer type: "+r);const o=a.handler||ad,u=t?a.renderer:a.headless;return n._renderer=u?hD(n,n._renderer,t,u):null,n._handler=function(t,e,n,r){var i=new r(t.loader(),dD(t,t.tooltip())).scene(t.scenegraph().root).initialize(n,ZE(t),t);return e&&e.handlers().forEach((function(t){i.on(t.type,t.handler)})),i}(n,n._handler,t,o),n._redraw=!0,t&&"none"!==i&&(e=e?n._elBind=pD(n,e):t.appendChild(iD("form",{class:"vega-bindings"})),n._bind.forEach((function(t){t.param.element&&"container"!==i&&(t.element=pD(n,t.param.element))})),n._bind.forEach((function(t){aD(n,t.element||e,t)}))),n},wF.toImageURL=async function(t,e){t!==xv.Canvas&&t!==xv.SVG&&t!==xv.PNG&&u("Unrecognized image type: "+t);const n=await vD(this,t,e);return t===xv.SVG?function(t,e){var n=new Blob([t],{type:e});return window.URL.createObjectURL(n)}(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")},wF.toCanvas=async function(t,e){return(await vD(this,xv.Canvas,t,e)).canvas()},wF.toSVG=async function(t){return(await vD(this,xv.SVG,t)).svg()},wF.getState=function(t){return this._runtime.getState(t||{data:mF,signals:vF,recurse:!0})},wF.setState=function(t){return this.runAsync(null,e=>{e._trigger=!1,e._runtime.setState(t)},t=>{t._trigger=!0}),this};const CF=t=>+t||0;function FF(t){return x(t)?t.signal?t:{top:CF(t.top),bottom:CF(t.bottom),left:CF(t.left),right:CF(t.right)}:{top:e=CF(t),bottom:e,left:e,right:e};var e}const SF=t=>x(t)&&!_(t)?tt({},t):{value:t};function BF(t,e,n,r){return null!=n?(x(n)&&!_(n)?t.update[e]=n:t[r||"enter"][e]={value:n},1):0}function TF(t,e,n){for(const n in e)BF(t,n,e[n]);for(const e in n)BF(t,e,n[e],"update")}function zF(t,e,n){for(const r in e)n&&it(n,r)||(t[r]=tt(t[r]||{},e[r]));return t}function NF(t,e){return e&&(e.enter&&e.enter[t]||e.update&&e.update[t])}function OF(t,e,n){t[e]=n&&n.signal?{signal:n.signal}:{value:n}}const RF=t=>pt(t)?wt(t):t.signal?`(${t.signal})`:$F(t);function qF(t){if(null!=t.gradient)return function(t){const e=[t.start,t.stop,t.count].map(t=>null==t?null:wt(t));for(;e.length&&null==M(e);)e.pop();return e.unshift(RF(t.gradient)),`gradient(${e.join(",")})`}(t);let e=t.signal?`(${t.signal})`:t.color?function(t){return t.c?UF("hcl",t.h,t.c,t.l):t.h||t.s?UF("hsl",t.h,t.s,t.l):t.l||t.a?UF("lab",t.l,t.a,t.b):t.r||t.g||t.b?UF("rgb",t.r,t.g,t.b):null}(t.color):null!=t.field?$F(t.field):void 0!==t.value?wt(t.value):void 0;return null!=t.scale&&(e=function(t,e){const n=RF(t.scale);null!=t.range?e=`lerp(_range(${n}), ${+t.range})`:(void 0!==e&&(e=`_scale(${n}, ${e})`),t.band&&(e=(e?e+"+":"")+`_bandwidth(${n})`+(1==+t.band?"":"*"+LF(t.band)),t.extra&&(e=`(datum.extra ? _scale(${n}, datum.extra.value) : ${e})`)),null==e&&(e="0"));return e}(t,e)),void 0===e&&(e=null),null!=t.exponent&&(e=`pow(${e},${LF(t.exponent)})`),null!=t.mult&&(e+="*"+LF(t.mult)),null!=t.offset&&(e+="+"+LF(t.offset)),t.round&&(e=`round(${e})`),e}const UF=(t,e,n,r)=>`(${t}(${[e,n,r].map(qF).join(",")})+'')`;function LF(t){return x(t)?"("+qF(t)+")":t}function $F(t){return function t(e){let n,r,i;if(e.signal)n="datum",i=e.signal;else if(e.group||e.parent){for(r=Math.max(1,e.level||1),n="item";r-- >0;)n+=".mark.group";e.parent?(i=e.parent,n+=".datum"):i=e.group}else e.datum?(n="datum",i=e.datum):u("Invalid field reference: "+wt(e));e.signal||(i=pt(i)?s(i).map(wt).join("]["):t(i));return n+"["+i+"]"}(x(t)?t:{datum:t})}function PF(t,e,n,r,i,a){const o={};(a=a||{}).encoders={$encode:o},t=function(t,e,n,r,i){const a={},o={};let u,s,l,c;for(s in s="lineBreak","text"!==e||null==i[s]||NF(s,t)||OF(a,s,i[s]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c="frame"===n?i.group:"mark"===n?tt({},i.mark,i[e]):null,c)l=NF(s,t)||("fill"===s||"stroke"===s)&&(NF("fill",t)||NF("stroke",t)),l||OF(a,s,c[s]);for(s in W(r).forEach(e=>{const n=i.style&&i.style[e];for(const e in n)NF(e,t)||OF(a,e,n[e])}),t=tt({},t),a)c=a[s],c.signal?(u=u||{})[s]=c:o[s]=c;return t.enter=tt(o,t.enter),u&&(t.update=tt(u,t.update)),t}(t,e,n,r,i.config);for(const n in t)o[n]=jF(t[n],e,a,i);return a}function jF(t,e,n,r){const i={},a={};for(const e in t)null!=t[e]&&(i[e]=IF((o=t[e],_(o)?function(t){let e="";return t.forEach(t=>{const n=qF(t);e+=t.test?`(${t.test})?${n}:`:n}),":"===M(e)&&(e+="null"),e}(o):qF(o)),r,n,a));var o;return{$expr:{marktype:e,channels:i},$fields:Object.keys(a),$output:Object.keys(t)}}function IF(t,e,n,r){const i=eF(t,e);return i.$fields.forEach(t=>r[t]=1),tt(n,i.$params),i.$expr}var WF=["value","update","init","react","bind"];function HF(t,e){u(t+' for "outer" push: '+wt(e))}function YF(t,e){var n=t.name;if("outer"===t.push)e.signals[n]||HF("No prior signal definition",n),WF.forEach((function(e){void 0!==t[e]&&HF("Invalid property ",e)}));else{var r=e.addSignal(n,t.value);!1===t.react&&(r.react=!1),t.bind&&e.addBinding(n,t.bind)}}function VF(t,e,n,r){this.id=-1,this.type=t,this.value=e,this.params=n,r&&(this.parent=r)}function GF(t,e,n,r){return new VF(t,e,n,r)}function XF(t,e){return GF("operator",t,e)}function JF(t){var e={$ref:t.id};return t.id<0&&(t.refs=t.refs||[]).push(e),e}function ZF(t,e){return e?{$field:t,$name:e}:{$field:t}}var QF=ZF("key");function KF(t,e){return{$compare:t,$order:e}}function tS(t,e){return(t&&t.signal?"$"+t.signal:t||"")+(t&&e?"_":"")+(e&&e.signal?"$"+e.signal:e||"")}function eS(t){return t&&t.signal}function nS(t){if(eS(t))return!0;if(x(t))for(var e in t)if(nS(t[e]))return!0;return!1}function rS(t,e){return null!=t?t:e}function iS(t){return t&&t.signal||t}function aS(t,e){return(t.merge?oS:t.stream?uS:t.type?sS:u("Invalid stream specification: "+wt(t)))(t,e)}function oS(t,e){var n=lS({merge:t.merge.map(t=>aS(t,e))},t,e);return e.addStream(n).id}function uS(t,e){var n=lS({stream:aS(t.stream,e)},t,e);return e.addStream(n).id}function sS(t,e){var n,r;return"timer"===t.type?(n=e.event("timer",t.throttle),t={between:t.between,filter:t.filter}):n=e.event(function(t){return"scope"===t?"view":t||"view"}(t.source),t.type),r=lS({stream:n},t,e),1===Object.keys(r).length?n:e.addStream(r).id}function lS(t,e,n){var r=e.between;return r&&(2!==r.length&&u('Stream "between" parameter must have 2 entries: '+wt(e)),t.between=[aS(r[0],n),aS(r[1],n)]),r=e.filter?[].concat(e.filter):[],(e.marktype||e.markname||e.markrole)&&r.push(function(t,e,n){var r="event.item";return r+(t&&"*"!==t?"&&"+r+".mark.marktype==='"+t+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(e?"&&"+r+".mark.name==='"+e+"'":"")}(e.marktype,e.markname,e.markrole)),"scope"===e.source&&r.push("inScope(event.item)"),r.length&&(t.filter=eF("("+r.join(")&&(")+")",n).$expr),null!=(r=e.throttle)&&(t.throttle=+r),null!=(r=e.debounce)&&(t.debounce=+r),e.consume&&(t.consume=!0),t}var cS,fS,hS="view",dS=/[[\]{}]/,pS={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function gS(t,e,n,r,i){for(var a,o=0,u=t.length;e<u;++e){if(a=t[e],!o&&a===n)return e;i&&i.indexOf(a)>=0?--o:r&&r.indexOf(a)>=0&&++o}return e}function mS(t){for(var e=[],n=0,r=t.length,i=0;i<r;)i=gS(t,i,",","[{","]}"),e.push(t.substring(n,i).trim()),n=++i;if(0===e.length)throw"Empty event selector: "+t;return e}function vS(t){return"["===t[0]?function(t){var e,n,r=t.length,i=1;if((i=gS(t,i,"]","[","]"))===r)throw"Empty between selector: "+t;if(2!==(e=mS(t.substring(1,i))).length)throw"Between selector must have two elements: "+t;if(">"!==(t=t.slice(i+1).trim())[0])throw"Expected '>' after between selector: "+t;if(e=e.map(vS),(n=vS(t.slice(1).trim())).between)return{between:e,stream:n};n.between=e;return n}(t):function(t){var e,n,r={source:cS},i=[],a=[0,0],o=0,u=0,s=t.length,l=0;if("}"===t[s-1]){if(!((l=t.lastIndexOf("{"))>=0))throw"Unmatched right brace: "+t;try{a=function(t){var e=t.split(",");if(!t.length||e.length>2)throw t;return e.map((function(e){var n=+e;if(n!=n)throw t;return n}))}(t.substring(l+1,s-1))}catch(e){throw"Invalid throttle specification: "+t}t=t.slice(0,l).trim(),s=t.length,l=0}if(!s)throw t;"@"===t[0]&&(o=++l);(e=gS(t,l,":"))<s&&(i.push(t.substring(u,e).trim()),u=l=++e);if((l=gS(t,l,"["))===s)i.push(t.substring(u,s).trim());else if(i.push(t.substring(u,l).trim()),n=[],(u=++l)===s)throw"Unmatched left bracket: "+t;for(;l<s;){if((l=gS(t,l,"]"))===s)throw"Unmatched left bracket: "+t;if(n.push(t.substring(u,l).trim()),l<s-1&&"["!==t[++l])throw"Expected left bracket: "+t;u=++l}if(!(s=i.length)||dS.test(i[s-1]))throw"Invalid event selector: "+t;s>1?(r.type=i[1],o?r.markname=i[0].slice(1):!function(t){return fS[t]}(i[0])?r.source=i[0]:r.marktype=i[0]):r.type=i[0];"!"===r.type.slice(-1)&&(r.consume=!0,r.type=r.type.slice(0,-1));null!=n&&(r.filter=n);a[0]&&(r.throttle=a[0]);a[1]&&(r.debounce=a[1]);return r}(t)}const yS={code:"_.$value",ast:{type:"Identifier",value:"value"}};function _S(t,e,n){var r=t.events,i=t.update,a=t.encode,o=[],s={target:n};r||u("Signal update missing events specification."),pt(r)&&(r=function(t,e,n){return cS=e||hS,fS=n||pS,mS(t.trim()).map(vS)}(r,e.isSubscope()?"scope":"view")),r=W(r).filter(t=>t.signal||t.scale?(o.push(t),0):1),o.length>1&&(o=[xS(o)]),r.length&&o.push(r.length>1?{merge:r}:r[0]),null!=a&&(i&&u("Signal encode and update are mutually exclusive."),i="encode(item(),"+wt(a)+")"),s.update=pt(i)?eF(i,e):null!=i.expr?eF(i.expr,e):null!=i.value?i.value:null!=i.signal?{$expr:yS,$params:{$value:e.signalRef(i.signal)}}:u("Invalid signal update specification."),t.force&&(s.options={force:!0}),o.forEach((function(t){e.addUpdate(tt(function(t,e){return{source:t.signal?e.signalRef(t.signal):t.scale?e.scaleRef(t.scale):aS(t,e)}}(t,e),s))}))}function xS(t){return{signal:"["+t.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}const bS=t=>(e,n,r)=>GF(t,n,e||void 0,r);var wS=bS("aggregate"),kS=bS("axisticks"),AS=bS("bound"),MS=bS("collect"),ES=bS("compare"),DS=bS("datajoin"),CS=bS("encode"),FS=bS("expression"),SS=bS("facet"),BS=bS("field"),TS=bS("key"),zS=bS("legendentries"),NS=bS("load"),OS=bS("mark"),RS=bS("multiextent"),qS=bS("multivalues"),US=bS("overlap"),LS=bS("params"),$S=bS("prefacet"),PS=bS("projection"),jS=bS("proxy"),IS=bS("relay"),WS=bS("render"),HS=bS("scale"),YS=bS("sieve"),VS=bS("sortitems"),GS=bS("viewlayout"),XS=bS("values"),JS=0,ZS={min:"min",max:"max",count:"sum"};function QS(t,e){var n,r=e.getScale(t.name).params;for(n in r.domain=nB(t.domain,t,e),null!=t.range&&(r.range=function t(e,n,r){var i=e.range,a=n.config.range;if(i.signal)return n.signalRef(i.signal);if(pt(i)){if(a&&it(a,i))return e=tt({},e,{range:a[i]}),t(e,n,r);"width"===i?i=[0,{signal:"width"}]:"height"===i?i=fm(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:u("Unrecognized scale range value: "+wt(i))}else{if(i.scheme)return r.scheme=_(i.scheme)?tB(i.scheme,n):KS(i.scheme,n),i.extent&&(r.schemeExtent=tB(i.extent,n)),void(i.count&&(r.schemeCount=KS(i.count,n)));if(i.step)return void(r.rangeStep=KS(i.step,n));if(fm(e.type)&&!_(i))return nB(i,e,n);_(i)||u("Unsupported range type: "+wt(i))}return i.map(t=>(_(t)?tB:KS)(t,n))}(t,e,r)),null!=t.interpolate&&function(t,e){e.interpolate=KS(t.type||t),null!=t.gamma&&(e.interpolateGamma=KS(t.gamma))}(t.interpolate,r),null!=t.nice&&(r.nice=function(t){return x(t)?{interval:KS(t.interval),step:KS(t.step)}:KS(t)}(t.nice)),null!=t.bins&&(r.bins=function(t,e){return t.signal||_(t)?tB(t,e):e.objectProperty(t)}(t.bins,e)),t)it(r,n)||"name"===n||(r[n]=KS(t[n],e))}function KS(t,e){return x(t)?t.signal?e.signalRef(t.signal):u("Unsupported object: "+wt(t)):t}function tB(t,e){return t.signal?e.signalRef(t.signal):t.map(t=>KS(t,e))}function eB(t){u("Can not find data set: "+wt(t))}function nB(t,e,n){if(t)return t.signal?n.signalRef(t.signal):(_(t)?rB:t.fields?aB:iB)(t,e,n);null==e.domainMin&&null==e.domainMax||u("No scale domain defined for domainMin/domainMax to override.")}function rB(t,e,n){return t.map((function(t){return KS(t,n)}))}function iB(t,e,n){var r=n.getData(t.data);return r||eB(t.data),fm(e.type)?r.valuesRef(n,t.field,uB(t.sort,!1)):gm(e.type)?r.domainRef(n,t.field):r.extentRef(n,t.field)}function aB(t,e,n){var r=t.data,i=t.fields.reduce((function(t,e){return e=pt(e)?{data:r,field:e}:_(e)||e.signal?function(t,e){var n="_:vega:_"+JS++,r=MS({});if(_(t))r.value={$ingest:t};else if(t.signal){var i="setdata("+wt(n)+","+t.signal+")";r.params.input=e.signalRef(i)}return e.addDataPipeline(n,[r,YS({})]),{data:n,field:"data"}}(e,n):e,t.push(e),t}),[]);return(fm(e.type)?oB:gm(e.type)?sB:lB)(t,n,i)}function oB(t,e,n){var r,i,a,o,u,s=uB(t.sort,!0);return r=n.map((function(t){var n=e.getData(t.data);return n||eB(t.data),n.countsRef(e,t.field,s)})),i={groupby:QF,pulse:r},s&&(a=s.op||"count",u=s.field?tS(a,s.field):"count",i.ops=[ZS[a]],i.fields=[e.fieldRef(u)],i.as=[u]),a=e.add(wS(i)),o=e.add(MS({pulse:JF(a)})),u=e.add(XS({field:QF,sort:e.sortRef(s),pulse:JF(o)})),JF(u)}function uB(t,e){return t&&(t.field||t.op?t.field||"count"===t.op?e&&t.field&&t.op&&!ZS[t.op]&&u("Multiple domain scales can not be sorted using "+t.op):u("No field provided for sort aggregate op: "+t.op):x(t)?t.field="key":t={field:"key"}),t}function sB(t,e,n){var r=n.map((function(t){var n=e.getData(t.data);return n||eB(t.data),n.domainRef(e,t.field)}));return JF(e.add(qS({values:r})))}function lB(t,e,n){var r=n.map((function(t){var n=e.getData(t.data);return n||eB(t.data),n.extentRef(e,t.field)}));return JF(e.add(RS({extents:r})))}function cB(t,e,n){return _(t)?t.map((function(t){return cB(t,e,n)})):x(t)?t.signal?n.signalRef(t.signal):"fit"===e?t:u("Unsupported parameter object: "+wt(t)):t}const fB="value",hB=["size","shape","fill","stroke","strokeWidth","strokeDash","opacity"],dB={name:1,style:1,interactive:1},pB={value:0},gB={value:1};function mB(t){return t.type="group",t.interactive=t.interactive||!1,t}function vB(t,e){const n=(n,r)=>rS(t[n],rS(e[n],r));return n.isVertical=n=>"vertical"===rS(t.direction,e.direction||(n?e.symbolDirection:e.gradientDirection)),n.gradientLength=()=>rS(t.gradientLength,e.gradientLength||e.gradientWidth),n.gradientThickness=()=>rS(t.gradientThickness,e.gradientThickness||e.gradientHeight),n.entryColumns=()=>rS(t.columns,rS(e.columns,+n.isVertical(!0))),n}function yB(t,e){var n=e&&(e.update&&e.update[t]||e.enter&&e.enter[t]);return n&&n.signal?n:n?n.value:null}function _B(t,e,n){return`item.anchor === 'start' ? ${t} : item.anchor === 'end' ? ${e} : ${n}`}const xB=_B(wt("left"),wt("right"),wt("center"));function bB(t,e){return e?t?x(t)?Object.assign({},t,{offset:bB(t.offset,e)}):{value:t,offset:e}:e:t}function wB(t,e){return e?(t.name=e.name,t.style=e.style||t.style,t.interactive=!!e.interactive,t.encode=zF(t.encode,e,dB)):t.interactive=!1,t}function kB(t,e,n,r){var i,a,o,u,s,l,c=vB(t,n),f=c.isVertical(),h=c.gradientThickness(),d=c.gradientLength();return f?(o=[0,1],u=[0,0],s=h,l=d):(o=[0,0],u=[1,0],s=d,l=h),TF(i={enter:a={opacity:pB,x:pB,y:pB,width:SF(s),height:SF(l)},update:tt({},a,{opacity:gB,fill:{gradient:e,start:o,stop:u}}),exit:{opacity:pB}},{stroke:c("gradientStrokeColor"),strokeWidth:c("gradientStrokeWidth")},{opacity:c("gradientOpacity")}),wB({type:"rect",role:"legend-gradient",encode:i},r)}function AB(t,e,n,r,i){var a,o,u,s,l,c,f=vB(t,n),h=f.isVertical(),d=f.gradientThickness(),p=f.gradientLength(),g="";return h?(u="y",l="y2",s="x",c="width",g="1-"):(u="x",l="x2",s="y",c="height"),(o={opacity:pB,fill:{scale:e,field:fB}})[u]={signal:g+"datum.perc",mult:p},o[s]=pB,o[l]={signal:g+"datum.perc2",mult:p},o[c]=SF(d),TF(a={enter:o,update:tt({},o,{opacity:gB}),exit:{opacity:pB}},{stroke:f("gradientStrokeColor"),strokeWidth:f("gradientStrokeWidth")},{opacity:f("gradientOpacity")}),wB({type:"rect",role:"legend-band",key:fB,from:i,encode:a},r)}function MB(t,e,n,r){var i,a,o,u,s,l=vB(t,e),c=l.isVertical(),f=SF(l.gradientThickness()),h=l.gradientLength(),d=l("labelOverlap"),p="";return TF(i={enter:a={opacity:pB},update:o={opacity:gB,text:{field:"label"}},exit:{opacity:pB}},{fill:l("labelColor"),fillOpacity:l("labelOpacity"),font:l("labelFont"),fontSize:l("labelFontSize"),fontStyle:l("labelFontStyle"),fontWeight:l("labelFontWeight"),limit:rS(t.labelLimit,e.gradientLabelLimit)}),c?(a.align={value:"left"},a.baseline=o.baseline={signal:'datum.perc<=0?"bottom":datum.perc>=1?"top":"middle"'},u="y",s="x",p="1-"):(a.align=o.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},a.baseline={value:"top"},u="x",s="y"),a[u]=o[u]={signal:p+"datum.perc",mult:h},a[s]=o[s]=f,f.offset=rS(t.labelOffset,e.gradientLabelOffset)||0,d=d?{separation:l("labelSeparation"),method:d,order:"datum.index"}:void 0,wB({type:"text",role:"legend-label",style:"guide-label",key:fB,from:r,encode:i,overlap:d},n)}function EB(t,e,n,r,i){var a,o,u,s,l,c,f,h=vB(t,e),d=n.entries,p=!(!d||!d.interactive),g=d?d.name:void 0,m=h("clipHeight"),v=h("symbolOffset"),y={data:"value"},_={},x=`(${i}) ? datum.offset : datum.size`,b=m?SF(m):{field:"size"},w="datum.index",k=`max(1, ${i})`;b.mult=.5,_={enter:a={opacity:pB,x:{signal:x,mult:.5,offset:v},y:b},update:o={opacity:gB,x:a.x,y:a.y},exit:{opacity:pB}};var A=null,M=null;return t.fill||(A=e.symbolBaseFillColor,M=e.symbolBaseStrokeColor),TF(_,{fill:h("symbolFillColor",A),shape:h("symbolType"),size:h("symbolSize"),stroke:h("symbolStrokeColor",M),strokeDash:h("symbolDash"),strokeDashOffset:h("symbolDashOffset"),strokeWidth:h("symbolStrokeWidth")},{opacity:h("symbolOpacity")}),hB.forEach((function(e){t[e]&&(o[e]=a[e]={scale:t[e],field:fB})})),s=wB({type:"symbol",role:"legend-symbol",key:fB,from:y,clip:!!m||void 0,encode:_},n.symbols),(u=SF(v)).offset=h("labelOffset"),TF(_={enter:a={opacity:pB,x:{signal:x,offset:u},y:b},update:o={opacity:gB,text:{field:"label"},x:a.x,y:a.y},exit:{opacity:pB}},{align:h("labelAlign"),baseline:h("labelBaseline"),fill:h("labelColor"),fillOpacity:h("labelOpacity"),font:h("labelFont"),fontSize:h("labelFontSize"),fontStyle:h("labelFontStyle"),fontWeight:h("labelFontWeight"),limit:h("labelLimit")}),l=wB({type:"text",role:"legend-label",style:"guide-label",key:fB,from:y,encode:_},n.labels),_={enter:{noBound:{value:!m},width:pB,height:m?SF(m):pB,opacity:pB},exit:{opacity:pB},update:o={opacity:gB,row:{signal:null},column:{signal:null}}},h.isVertical(!0)?(c=`ceil(item.mark.items.length / ${k})`,o.row.signal=`${w}%${c}`,o.column.signal=`floor(${w} / ${c})`,f={field:["row",w]}):(o.row.signal=`floor(${w} / ${k})`,o.column.signal=`${w} % ${k}`,f={field:w}),o.column.signal=`(${i})?${o.column.signal}:${w}`,mB({role:"scope",from:r={facet:{data:r,name:"value",groupby:"index"}},encode:zF(_,d,dB),marks:[s,l],name:g,interactive:p,sort:f})}const DB='item.orient === "left"',CB='item.orient === "right"',FB=`(${DB} || ${CB})`,SB="datum.vgrad && "+FB,BB=_B('"top"','"bottom"','"middle"'),TB=`datum.vgrad && ${CB} ? (${_B('"right"','"left"','"center"')}) : (${FB} && !(datum.vgrad && ${DB})) ? "left" : ${xB}`,zB=`item._anchor || (${FB} ? "middle" : "start")`,NB=`${SB} ? (${DB} ? -90 : 90) : 0`,OB=`${FB} ? (datum.vgrad ? (${CB} ? "bottom" : "top") : ${BB}) : "top"`;function RB(t,e){var n;return x(t)&&(t.signal?n=t.signal:t.path?n="pathShape("+qB(t.path)+")":t.sphere&&(n="geoShape("+qB(t.sphere)+', {type: "Sphere"})')),n?e.signalRef(n):!!t}function qB(t){return x(t)&&t.signal?t.signal:wt(t)}function UB(t){var e=t.role||"";return e.indexOf("axis")&&e.indexOf("legend")&&e.indexOf("title")?"group"===t.type?"scope":e||"mark":e}function LB(t){return{marktype:t.type,name:t.name||void 0,role:t.role||UB(t),zindex:+t.zindex||void 0,aria:t.aria,description:t.description}}function $B(t,e){return t&&t.signal?e.signalRef(t.signal):!1!==t}function PB(t,e){var n=Qa(t.type);n||u("Unrecognized transform type: "+wt(t.type));var r=GF(n.type.toLowerCase(),null,jB(n,t,e));return t.signal&&e.addSignal(t.signal,e.proxy(r)),r.metadata=n.metadata||{},r}function jB(t,e,n){var r,i,a,o={};for(i=0,a=t.params.length;i<a;++i)o[(r=t.params[i]).name]=IB(r,e,n);return o}function IB(t,e,n){var r=t.type,i=e[t.name];return"index"===r?function(t,e,n){pt(e.from)||u('Lookup "from" parameter must be a string literal.');return n.getData(e.from).lookupRef(n,e.key)}(0,e,n):void 0!==i?"param"===r?function(t,e,n){var r=e[t.name];return t.array?(_(r)||u("Expected an array of sub-parameters. Instead: "+wt(r)),r.map((function(e){return HB(t,e,n)}))):HB(t,r,n)}(t,e,n):"projection"===r?n.projectionRef(e[t.name]):t.array&&!eS(i)?i.map((function(e){return WB(t,e,n)})):WB(t,i,n):void(t.required&&u("Missing required "+wt(e.type)+" parameter: "+wt(t.name)))}function WB(t,e,n){var r=t.type;if(eS(e))return YB(r)?u("Expression references can not be signals."):VB(r)?n.fieldRef(e):GB(r)?n.compareRef(e):n.signalRef(e.signal);var i,a=t.expr||VB(r);return a&&((i=e)&&i.expr)?n.exprRef(e.expr,e.as):a&&function(t){return t&&t.field}(e)?ZF(e.field,e.as):YB(r)?eF(e,n):function(t){return"data"===t}(r)?JF(n.getData(e).values):VB(r)?ZF(e):GB(r)?n.compareRef(e):e}function HB(t,e,n){var r,i,a,o,s;for(o=0,s=t.params.length;o<s;++o){for(a in(i=t.params[o]).key)if(i.key[a]!==e[a]){i=null;break}if(i)break}return i||u("Unsupported parameter: "+wt(e)),r=tt(jB(i,e,n),i.key),JF(n.add(LS(r)))}function YB(t){return"expr"===t}function VB(t){return"field"===t}function GB(t){return"compare"===t}function XB(t,e){return t.$ref?t:t.data&&t.data.$ref?t.data:JF(e.getData(t.data).output)}function JB(t,e,n,r,i){this.scope=t,this.input=e,this.output=n,this.values=r,this.aggregate=i,this.index={}}JB.fromEntries=function(t,e){var n=e.length,r=1,i=e[0],a=e[n-1],o=e[n-2],u=null;for(i&&"load"===i.type&&(i=e[1]),t.add(e[0]);r<n;++r)e[r].params.pulse=JF(e[r-1]),t.add(e[r]),"aggregate"===e[r].type&&(u=e[r]);return new JB(t,i,o,a,u)};var ZB=JB.prototype;function QB(t){return pt(t)?t:null}function KB(t,e,n){var r,i=tS(n.op,n.field);if(e.ops){for(var a=0,o=e.as.length;a<o;++a)if(e.as[a]===i)return}else e.ops=["count"],e.fields=[null],e.as=["count"];n.op&&(e.ops.push((r=n.op.signal)?t.signalRef(r):n.op),e.fields.push(t.fieldRef(n.field)),e.as.push(i))}function tT(t,e,n,r,i,a,o){var u,s,l=e[n]||(e[n]={}),c=function(t){return x(t)?("descending"===t.order?"-":"+")+tS(t.op,t.field):""}(a),f=QB(i);if(null!=f&&(t=e.scope,u=l[f+=c?"|"+c:""]),!u){var h=a?{field:QF,pulse:e.countsRef(t,i,a)}:{field:t.fieldRef(i),pulse:JF(e.output)};c&&(h.sort=t.sortRef(a)),s=t.add(GF(r,void 0,h)),o&&(e.index[i]=s),u=JF(s),null!=f&&(l[f]=u)}return u}function eT(t,e,n){var r,i=t.remove,a=t.insert,o=t.toggle,u=t.modify,s=t.values,l=e.add(XF());r=eF("if("+t.trigger+',modify("'+n+'",'+[a,i,o,u,s].map((function(t){return null==t?"null":t})).join(",")+"),0)",e),l.update=r.$expr,l.params=r.$params}function nT(t,e){var n,r,i,a,o,s,l,c,f,h,d,p,g,m,v=UB(t),y="group"===t.type,_=t.from&&t.from.facet,x=t.layout||"scope"===v||"frame"===v,b="mark"===v||x||_,w=t.overlap;i=function(t,e,n){var r,i,a,o,s;return t?(r=t.facet)&&(e||u("Only group marks can be faceted."),null!=r.field?o=s=XB(r,n):(t.data?s=JF(n.getData(t.data).aggregate):((a=PB(tt({type:"aggregate",groupby:W(r.groupby)},r.aggregate),n)).params.key=n.keyRef(r.groupby),a.params.pulse=XB(r,n),o=s=JF(n.add(a))),i=n.keyRef(r.groupby,!0))):o=JF(n.add(MS(null,[{}]))),o||(o=XB(t,n)),{key:i,pulse:o,parent:s}}(t.from,y,e),h=JF(r=e.add(DS({key:i.key||(t.key?ZF(t.key):void 0),pulse:i.pulse,clean:!y}))),r=a=e.add(MS({pulse:h})),r=e.add(OS({markdef:LB(t),interactive:$B(t.interactive,e),clip:RB(t.clip,e),context:{$context:!0},groups:e.lookup(),parent:e.signals.parent?e.signalRef("parent"):null,index:e.markpath(),pulse:JF(r)})),d=JF(r),(r=o=e.add(CS(PF(t.encode,t.type,v,t.style,e,{mod:!1,pulse:d})))).params.parent=e.encode(),t.transform&&t.transform.forEach((function(t){const n=PB(t,e),i=n.metadata;(i.generates||i.changes)&&u("Mark transforms should not generate new data."),i.nomod||(o.params.mod=!0),n.params.pulse=JF(r),e.add(r=n)})),t.sort&&(r=e.add(VS({sort:e.compareRef(t.sort),pulse:JF(r)}))),p=JF(r),(_||x)&&(g=JF(x=e.add(GS({layout:e.objectProperty(t.layout),legends:e.legends,mark:d,pulse:p})))),m=JF(s=e.add(AS({mark:d,pulse:g||p}))),y&&(b&&((n=e.operators).pop(),x&&n.pop()),e.pushState(p,g||m,h),_?function(t,e,n){var r,i,a,o,s=t.from.facet,l=s.name,c=XB(s,e);s.name||u("Facet must have a name: "+wt(s)),s.data||u("Facet must reference a data set: "+wt(s)),s.field?o=e.add($S({field:e.fieldRef(s.field),pulse:c})):s.groupby?o=e.add(SS({key:e.keyRef(s.groupby),group:JF(e.proxy(n.parent)),pulse:c})):u("Facet must specify groupby or field: "+wt(s)),i=(r=e.fork()).add(MS()),a=r.add(YS({pulse:JF(i)})),r.addData(l,new JB(r,i,i,a)),r.addSignal("parent",null),o.params.subflow={$subflow:r.parse(t).toRuntime()}}(t,e,i):b?function(t,e,n){var r=e.add($S({pulse:n.pulse})),i=e.fork();i.add(YS()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(t).toRuntime()}}(t,e,i):e.parse(t),e.popState(),b&&(x&&n.push(x),n.push(s))),w&&(m=function(t,e,n){var r,i=t.method,a=t.bound,o=t.separation,u={separation:eS(o)?n.signalRef(o.signal):o,method:eS(i)?n.signalRef(i.signal):i,pulse:e};t.order&&(u.sort=n.compareRef({field:t.order}));a&&(r=a.tolerance,u.boundTolerance=eS(r)?n.signalRef(r.signal):+r,u.boundScale=n.scaleRef(a.scale),u.boundOrient=a.orient);return JF(n.add(US(u)))}(w,m,e)),l=e.add(WS({pulse:m})),c=e.add(YS({pulse:JF(l)},void 0,e.parent())),null!=t.name&&(f=t.name,e.addData(f,new JB(e,a,l,c)),t.on&&t.on.forEach((function(t){(t.insert||t.remove||t.toggle)&&u("Marks only support modify triggers."),eT(t,e,f)})))}function rT(t,e){var n,r,i,a,o,s,l,c,f=e.config.legend,h=t.encode||{},d=h.legend||{},p=d.name||void 0,g=d.interactive,m=d.style,v=vB(t,f),y={},_=0;return hB.forEach(e=>t[e]?(y[e]=t[e],_=_||t[e]):0),_||u("Missing valid scale for legend."),o=function(t,e){var n=t.type||"symbol";t.type||1!==function(t){return hB.reduce((function(e,n){return e+(t[n]?1:0)}),0)}(t)||!t.fill&&!t.stroke||(n=cm(e)?"gradient":hm(e)?"discrete":"symbol");return"gradient"!==n?n:hm(e)?"discrete":"gradient"}(t,e.scaleType(_)),s={title:null!=t.title,scales:y,type:o,vgrad:"symbol"!==o&&v.isVertical()},l=JF(e.add(MS(null,[s]))),d=zF(function(t,e,n){var r={enter:{},update:{}};return TF(r,{orient:t("orient"),offset:t("offset"),padding:t("padding"),titlePadding:t("titlePadding"),cornerRadius:t("cornerRadius"),fill:t("fillColor"),stroke:t("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:t("legendX"),y:t("legendY"),format:e.format,formatType:e.formatType}),r}(v,t,f),d,dB),n={enter:{x:{value:0},y:{value:0}}},c=JF(e.add(zS(i={type:o,scale:e.scaleRef(_),count:e.objectProperty(v("tickCount")),limit:e.property(v("symbolLimit")),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)}))),"gradient"===o?(a=[kB(t,_,f,h.gradient),MB(t,f,h.labels,c)],i.count=i.count||e.signalRef(`max(2,2*floor((${iS(v.gradientLength())})/100))`)):"discrete"===o?a=[AB(t,_,f,h.gradient,c),MB(t,f,h.labels,c)]:(r=function(t,e){const n=vB(t,e);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(t,f),a=[EB(t,f,h,c,iS(r.columns))],i.size=function(t,e,n){var r=iS(iT("size",t,n)),i=iS(iT("strokeWidth",t,n)),a=iS(function(t,e,n){return yB("fontSize",t)||function(t,e,n){var r=e.config.style[n];return r&&r[t]}("fontSize",e,n)}(n[1].encode,e,"guide-label"));return eF(`max(ceil(sqrt(${r})+${i}),${a})`,e)}(t,e,a[0].marks)),a=[mB({role:"legend-entry",from:l,encode:n,marks:a,layout:r,interactive:g})],s.title&&a.push(function(t,e,n,r){var i,a=vB(t,e);return TF(i={enter:{opacity:pB},update:{opacity:gB,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:pB}},{orient:a("titleOrient"),_anchor:a("titleAnchor"),anchor:{signal:zB},angle:{signal:NB},align:{signal:TB},baseline:{signal:OB},text:t.title,fill:a("titleColor"),fillOpacity:a("titleOpacity"),font:a("titleFont"),fontSize:a("titleFontSize"),fontStyle:a("titleFontStyle"),fontWeight:a("titleFontWeight"),limit:a("titleLimit"),lineHeight:a("titleLineHeight")},{align:a("titleAlign"),baseline:a("titleBaseline")}),wB({type:"text",role:"legend-title",style:"guide-title",from:r,encode:i},n)}(t,f,h.title,l)),nT(mB({role:"legend",from:l,encode:d,marks:a,aria:v("aria"),description:v("description"),zindex:v("zindex"),name:p,interactive:g,style:m}),e)}function iT(t,e,n){return e[t]?`scale("${e[t]}",datum)`:yB(t,n[0].encode)}ZB.countsRef=function(t,e,n){var r,i,a,o=this.counts||(this.counts={}),u=QB(e);return null!=u&&(t=this.scope,r=o[u]),r?n&&n.field&&KB(t,r.agg.params,n):(a={groupby:t.fieldRef(e,"key"),pulse:JF(this.output)},n&&n.field&&KB(t,a,n),i=t.add(wS(a)),r=t.add(MS({pulse:JF(i)})),r={agg:i,ref:JF(r)},null!=u&&(o[u]=r)),r.ref},ZB.tuplesRef=function(){return JF(this.values)},ZB.extentRef=function(t,e){return tT(t,this,"extent","extent",e,!1)},ZB.domainRef=function(t,e){return tT(t,this,"domain","values",e,!1)},ZB.valuesRef=function(t,e,n){return tT(t,this,"vals","values",e,n||!0)},ZB.lookupRef=function(t,e){return tT(t,this,"lookup","tupleindex",e,!1)},ZB.indataRef=function(t,e){return tT(t,this,"indata","tupleindex",e,!0,!0)};function aT(t,e){var n,r,i=vB(t=pt(t)?{text:t}:t,e.config.title),a=t.encode||{},o=a.group||{},u=o.name||void 0,s=o.interactive,l=o.style,c=[];return n={},r=JF(e.add(MS(null,[n]))),c.push(function(t,e,n,r){var i={value:0},a=t.text,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return TF(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("color"),font:e("font"),fontSize:e("fontSize"),fontStyle:e("fontStyle"),fontWeight:e("fontWeight"),lineHeight:e("lineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),wB({type:"text",role:"title-text",style:"group-title",from:r,encode:o},n)}(t,i,function(t){const e=t.encode;return e&&e.title||tt({name:t.name,interactive:t.interactive,style:t.style},e)}(t),r)),t.subtitle&&c.push(function(t,e,n,r){var i={value:0},a=t.subtitle,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return TF(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("subtitleColor"),font:e("subtitleFont"),fontSize:e("subtitleFontSize"),fontStyle:e("subtitleFontStyle"),fontWeight:e("subtitleFontWeight"),lineHeight:e("subtitleLineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),wB({type:"text",role:"title-subtitle",style:"group-subtitle",from:r,encode:o},n)}(t,i,a.subtitle,r)),nT(mB({role:"title",from:r,encode:oT(i,o),marks:c,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:u,interactive:s,style:l}),e)}function oT(t,e){var n={enter:{},update:{}};return TF(n,{orient:t("orient"),anchor:t("anchor"),align:{signal:xB},angle:{signal:'item.orient==="left"?-90:item.orient==="right"?90:0'},limit:t("limit"),frame:t("frame"),offset:t("offset")||0,padding:t("subtitlePadding")}),zF(n,e,dB)}function uT(t,e){var n=[];t.transform&&t.transform.forEach((function(t){n.push(PB(t,e))})),t.on&&t.on.forEach((function(n){eT(n,e,t.name)})),e.addDataPipeline(t.name,function(t,e,n){var r,i,a,o,u,s=[],l=null,c=!1,f=!1;t.values?nS(t.values)||nS(t.format)?(s.push(lT(e,t)),s.push(l=sT())):s.push(l=sT({$ingest:t.values,$format:t.format})):t.url?nS(t.url)||nS(t.format)?(s.push(lT(e,t)),s.push(l=sT())):s.push(l=sT({$request:t.url,$format:t.format})):t.source&&(l=r=W(t.source).map((function(t){return JF(e.getData(t).output)})),s.push(null));for(i=0,a=n.length;i<a;++i)o=n[i],u=o.metadata,l||u.source||s.push(l=sT()),s.push(o),u.generates&&(f=!0),u.modifies&&!f&&(c=!0),u.source?l=o:u.changes&&(l=null);r&&(a=r.length-1,s[0]=IS({derive:c,pulse:a?r:r[0]}),(c||a)&&s.splice(1,0,sT()));l||s.push(sT());return s.push(YS({})),s}(t,e,n))}function sT(t){var e=MS({},t);return e.metadata={source:!0},e}function lT(t,e){return NS({url:e.url?t.property(e.url):void 0,async:e.async?t.property(e.async):void 0,values:e.values?t.property(e.values):void 0,format:t.objectProperty(e.format)})}const cT=t=>"bottom"===t||"top"===t,fT=(t,e,n)=>eS(t)?vT(t.signal,e,n):"left"===t||"top"===t?e:n,hT=(t,e,n)=>eS(t)?gT(t.signal,e,n):cT(t)?e:n,dT=(t,e,n)=>eS(t)?mT(t.signal,e,n):cT(t)?n:e,pT=(t,e,n)=>eS(t)?yT(t.signal,e,n):"top"===t?{value:e}:{value:n},gT=(t,e,n)=>xT(`${t} === 'top' || ${t} === 'bottom'`,e,n),mT=(t,e,n)=>xT(`${t} !== 'top' && ${t} !== 'bottom'`,e,n),vT=(t,e,n)=>wT(`${t} === 'left' || ${t} === 'top'`,e,n),yT=(t,e,n)=>wT(t+" === 'top'",e,n),_T=(t,e,n)=>wT(t+" === 'right'",e,n),xT=(t,e,n)=>(e=null!=e?SF(e):e,n=null!=n?SF(n):n,bT(e)&&bT(n)?{signal:`${t} ? (${e=e?e.signal||wt(e.value):null}) : (${n=n?n.signal||wt(n.value):null})`}:[tt({test:t},e)].concat(n||[])),bT=t=>null==t||1===Object.keys(t).length,wT=(t,e,n)=>({signal:`${t} ? (${AT(e)}) : (${AT(n)})`}),kT=(t,e,n,r,i)=>({signal:(null!=r?`${t} === 'left' ? (${AT(r)}) : `:"")+(null!=n?`${t} === 'bottom' ? (${AT(n)}) : `:"")+(null!=i?`${t} === 'right' ? (${AT(i)}) : `:"")+(null!=e?`${t} === 'top' ? (${AT(e)}) : `:"")+"(null)"}),AT=t=>eS(t)?t.signal:null==t?null:wt(t),MT=(t,e)=>{const n=t.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+e.signal}:t};function ET(t,e,n,r){let i;if(e&&it(e,t))return e[t];if(it(n,t))return n[t];if(t.startsWith("title")){switch(t){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=t[5].toLowerCase()+t.slice(6)}return r["guide-title"][i]}if(t.startsWith("label")){switch(t){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=t[5].toLowerCase()+t.slice(6)}return r["guide-label"][i]}return null}function DT(t){const e={};for(const n of t)if(n)for(const t in n)e[t]=1;return Object.keys(e)}function CT(t,e){return{scale:t.scale,range:e}}function FT(t,e,n,r,i){var a,o,u,s,l,c,f,h,d=vB(t,e),p=t.orient,g=t.gridScale,m=fT(p,1,-1),v=function(t,e){if(1===e);else if(x(t)){let n=t=tt({},t);for(;null!=n.mult;){if(!x(n.mult))return n.mult=eS(e)?{signal:`(${n.mult}) * (${e.signal})`}:n.mult*e,t;n=n.mult=tt({},n.mult)}n.mult=e}else t=eS(e)?{signal:`(${e.signal}) * (${t||0})`}:e*(t||0);return t}(t.offset,m);return TF(a={enter:o={opacity:pB},update:s={opacity:gB},exit:u={opacity:pB}},{stroke:d("gridColor"),strokeCap:d("gridCap"),strokeDash:d("gridDash"),strokeDashOffset:d("gridDashOffset"),strokeOpacity:d("gridOpacity"),strokeWidth:d("gridWidth")}),l={scale:t.scale,field:fB,band:i.band,extra:i.extra,offset:i.offset,round:d("tickRound")},h=hT(p,{signal:"height"},{signal:"width"}),c=g?{scale:g,range:0,mult:m,offset:v}:{value:0,offset:v},f=g?{scale:g,range:1,mult:m,offset:v}:tt(h,{mult:m,offset:v}),o.x=s.x=hT(p,l,c),o.y=s.y=dT(p,l,c),o.x2=s.x2=dT(p,f),o.y2=s.y2=hT(p,f),u.x=hT(p,l),u.y=dT(p,l),wB({type:"rule",role:"axis-grid",key:fB,from:r,encode:a},n)}function ST(t,e,n,r,i){return{signal:'flush(range("'+t+'"), scale("'+t+'", datum.value), '+e+","+n+","+r+","+i+")"}}function BT(t,e,n,r,i,a){var o,u,s,l,c,f,h,d,p,g,m=vB(t,e),v=t.orient,y=t.scale,_=fT(v,-1,1),x=iS(m("labelFlush")),b=iS(m("labelFlushOffset")),w=0===x||!!x,k=m("labelAlign"),A=m("labelBaseline");return(l=SF(i)).mult=_,l.offset=SF(m("labelPadding")||0),l.offset.mult=_,c={scale:y,field:fB,band:.5,offset:bB(a.offset,m("labelOffset"))},f=hT(v,w?ST(y,x,'"left"','"right"','"center"'):{value:"center"},((t,e,n)=>eS(t)?_T(t.signal,e,n):"right"===t?{value:e}:{value:n})(v,"left","right")),h=hT(v,pT(v,"bottom","top"),w?ST(y,x,'"top"','"bottom"','"middle"'):{value:"middle"}),g=ST(y,x,`-(${b})`,b,0),w=w&&b,TF(o={enter:u={opacity:pB,x:hT(v,c,l),y:dT(v,c,l)},update:s={opacity:gB,text:{field:"label"},x:u.x,y:u.y,align:f,baseline:h},exit:{opacity:pB,x:u.x,y:u.y}},{dx:!k&&w?hT(v,g):null,dy:!A&&w?dT(v,g):null}),TF(o,{angle:m("labelAngle"),fill:m("labelColor"),fillOpacity:m("labelOpacity"),font:m("labelFont"),fontSize:m("labelFontSize"),fontWeight:m("labelFontWeight"),fontStyle:m("labelFontStyle"),limit:m("labelLimit"),lineHeight:m("labelLineHeight")},{align:k,baseline:A}),d=m("labelBound"),p=(p=m("labelOverlap"))||d?{separation:m("labelSeparation"),method:p,order:"datum.index",bound:d?{scale:y,orient:v,tolerance:d}:null}:void 0,s.align!==f&&(s.align=MT(s.align,f)),s.baseline!==h&&(s.baseline=MT(s.baseline,h)),wB({type:"text",role:"axis-label",style:"guide-label",key:fB,from:r,encode:o,overlap:p},n)}function TT(t,e,n,r){var i,a,o,u,s=vB(t,e),l=t.orient,c=fT(l,-1,1);return i={enter:a={opacity:pB,anchor:SF(s("titleAnchor",null)),align:{signal:xB}},update:o=tt({},a,{opacity:gB,text:SF(t.title)}),exit:{opacity:pB}},u={signal:`lerp(range("${t.scale}"), ${_B(0,1,.5)})`},o.x=hT(l,u),o.y=dT(l,u),a.angle=hT(l,pB,((t,e)=>0===e?0:eS(t)?{signal:`(${t.signal}) * ${e}`}:{value:t*e})(c,90)),a.baseline=hT(l,pT(l,"bottom","top"),{value:"bottom"}),o.angle=a.angle,o.baseline=a.baseline,TF(i,{fill:s("titleColor"),fillOpacity:s("titleOpacity"),font:s("titleFont"),fontSize:s("titleFontSize"),fontStyle:s("titleFontStyle"),fontWeight:s("titleFontWeight"),limit:s("titleLimit"),lineHeight:s("titleLineHeight")},{align:s("titleAlign"),angle:s("titleAngle"),baseline:s("titleBaseline")}),function(t,e,n,r){const i=(t,e)=>null!=t?(n.update[e]=MT(SF(t),n.update[e]),!1):!NF(e,r),a=i(t("titleX"),"x"),o=i(t("titleY"),"y");n.enter.auto=o===a?SF(o):hT(e,SF(o),SF(a))}(s,l,i,n),i.update.align=MT(i.update.align,a.align),i.update.angle=MT(i.update.angle,a.angle),i.update.baseline=MT(i.update.baseline,a.baseline),wB({type:"text",role:"axis-title",style:"guide-title",from:r,encode:i},n)}function zT(t,e){var n,r,i,a,o,u=function(t,e){var n,r,i,a=e.config,o=a.style,u=a.axis,s="band"===e.scaleType(t.scale)&&a.axisBand,l=t.orient;if(eS(l)){const t=DT([a.axisX,a.axisY]),e=DT([a.axisTop,a.axisBottom,a.axisLeft,a.axisRight]);for(i of(n={},t))n[i]=hT(l,ET(i,a.axisX,u,o),ET(i,a.axisY,u,o));for(i of(r={},e))r[i]=kT(l.signal,ET(i,a.axisTop,u,o),ET(i,a.axisBottom,u,o),ET(i,a.axisLeft,u,o),ET(i,a.axisRight,u,o))}else n="top"===l||"bottom"===l?a.axisX:a.axisY,r=a["axis"+l[0].toUpperCase()+l.slice(1)];return n||r||s?tt({},u,n,r,s):u}(t,e),s=t.encode||{},l=s.axis||{},c=l.name||void 0,f=l.interactive,h=l.style,d=vB(t,u),p=function(t){let e,n,r=t("tickBand"),i=t("tickOffset");return r?r.signal?(e={signal:`(${r.signal}) === 'extent' ? 1 : 0.5`},n={signal:`(${r.signal}) === 'extent'`},x(i)||(i={signal:`(${r.signal}) === 'extent' ? 0 : ${i}`})):"extent"===r?(e=1,n=!0,i=0):(e=.5,n=!1):(e=t("bandPosition"),n=t("tickExtra")),{extra:n,band:e,offset:i}}(d);return n={scale:t.scale,ticks:!!d("ticks"),labels:!!d("labels"),grid:!!d("grid"),domain:!!d("domain"),title:null!=t.title},r=JF(e.add(MS({},[n]))),l=zF(function(t,e){var n={enter:{},update:{}};return TF(n,{orient:t("orient"),offset:t("offset")||0,position:rS(e.position,0),titlePadding:t("titlePadding"),minExtent:t("minExtent"),maxExtent:t("maxExtent"),range:{signal:`abs(span(range("${e.scale}")))`},translate:t("translate"),format:e.format,formatType:e.formatType}),n}(d,t),l,dB),i=JF(e.add(kS({scale:e.scaleRef(t.scale),extra:e.property(p.extra),count:e.objectProperty(t.tickCount),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)}))),o=[],n.grid&&o.push(FT(t,u,s.grid,i,p)),n.ticks&&(a=d("tickSize"),o.push(function(t,e,n,r,i,a){var o,u,s,l,c,f,h=vB(t,e),d=t.orient,p=fT(d,-1,1);return TF(o={enter:u={opacity:pB},update:l={opacity:gB},exit:s={opacity:pB}},{stroke:h("tickColor"),strokeCap:h("tickCap"),strokeDash:h("tickDash"),strokeDashOffset:h("tickDashOffset"),strokeOpacity:h("tickOpacity"),strokeWidth:h("tickWidth")}),(c=SF(i)).mult=p,f={scale:t.scale,field:fB,band:a.band,extra:a.extra,offset:a.offset,round:h("tickRound")},l.y=u.y=hT(d,pB,f),l.y2=u.y2=hT(d,c),s.x=hT(d,f),l.x=u.x=dT(d,pB,f),l.x2=u.x2=dT(d,c),s.y=dT(d,f),wB({type:"rule",role:"axis-tick",key:fB,from:r,encode:o},n)}(t,u,s.ticks,i,a,p))),n.labels&&(a=n.ticks?a:0,o.push(BT(t,u,s.labels,i,a,p))),n.domain&&o.push(function(t,e,n,r){var i,a,o,u=vB(t,e),s=t.orient;TF(i={enter:a={opacity:pB},update:o={opacity:gB},exit:{opacity:pB}},{stroke:u("domainColor"),strokeCap:u("domainCap"),strokeDash:u("domainDash"),strokeDashOffset:u("domainDashOffset"),strokeWidth:u("domainWidth"),strokeOpacity:u("domainOpacity")});const l=CT(t,0),c=CT(t,1);return a.x=o.x=hT(s,l,pB),a.x2=o.x2=hT(s,c),a.y=o.y=dT(s,l,pB),a.y2=o.y2=dT(s,c),wB({type:"rule",role:"axis-domain",from:r,encode:i},n)}(t,u,s.domain,r)),n.title&&o.push(TT(t,u,s.title,r)),nT(mB({role:"axis",from:r,encode:l,marks:o,aria:d("aria"),description:d("description"),zindex:d("zindex"),name:c,interactive:f,style:h}),e)}function NT(t,e,n){var r=W(t.signals),i=W(t.scales);return n||r.forEach(t=>YF(t,e)),W(t.projections).forEach(t=>function(t,e){var n=e.config.projection||{},r={};for(var i in t)"name"!==i&&(r[i]=cB(t[i],i,e));for(i in n)null==r[i]&&(r[i]=cB(n[i],i,e));e.addProjection(t.name,r)}(t,e)),i.forEach(t=>function(t,e){var n=t.type||"linear";sm(n)||u("Unrecognized scale type: "+wt(n)),e.addScale(t.name,{type:n,domain:void 0})}(t,e)),W(t.data).forEach(t=>uT(t,e)),i.forEach(t=>QS(t,e)),(n||r).forEach(t=>function(t,e){var n=e.getSignal(t.name),r=t.update;t.init&&(r?u("Signals can not include both init and update expressions."):(r=t.init,n.initonly=!0)),r&&(r=eF(r,e),n.update=r.$expr,n.params=r.$params),t.on&&t.on.forEach((function(t){_S(t,e,n.id)}))}(t,e)),W(t.axes).forEach(t=>zT(t,e)),W(t.marks).forEach(t=>nT(t,e)),W(t.legends).forEach(t=>rT(t,e)),t.title&&aT(t.title,e),e.parseLambdas(),e}function OT(t,e){const n=e.config,r=JF(e.root=e.add(XF())),i=function(t,e){const n=n=>rS(t[n],e[n]),r=[RT("background",n("background")),RT("autosize",DF(n("autosize"))),RT("padding",FF(n("padding"))),RT("width",n("width")||0),RT("height",n("height")||0)],i=r.reduce((t,e)=>(t[e.name]=e,t),{}),a={};return W(t.signals).forEach(t=>{it(i,t.name)?t=tt(i[t.name],t):r.push(t),a[t.name]=t}),W(e.signals).forEach(t=>{it(a,t.name)||it(i,t.name)||r.push(t)}),r}(t,n);i.forEach(t=>YF(t,e)),e.description=t.description||n.description,e.eventConfig=n.events,e.legends=e.objectProperty(n.legend&&n.legend.layout),e.locale=n.locale;const a=e.add(MS()),o=e.add(CS(PF((t=>zF({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},t))(t.encode),"group","frame",t.style,e,{pulse:JF(a)}))),u=e.add(GS({layout:e.objectProperty(t.layout),legends:e.legends,autosize:e.signalRef("autosize"),mark:r,pulse:JF(o)}));e.operators.pop(),e.pushState(JF(o),JF(u),null),NT(t,e,i),e.operators.push(u);let s=e.add(AS({mark:r,pulse:JF(u)}));return s=e.add(WS({pulse:JF(s)})),s=e.add(YS({pulse:JF(s)})),e.addData("root",new JB(e,a,a,s)),e}function RT(t,e){return e&&e.signal?{name:t,update:e.signal}:{name:t,value:e}}function qT(t,e){this.config=t||{},this.options=e||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function UT(t){this.config=t.config,this.options=t.options,this.legends=t.legends,this.field=Object.create(t.field),this.signals=Object.create(t.signals),this.lambdas=Object.create(t.lambdas),this.scales=Object.create(t.scales),this.events=Object.create(t.events),this.data=Object.create(t.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++t._nextsub[0],this._nextsub=t._nextsub,this._parent=t._parent.slice(),this._encode=t._encode.slice(),this._lookup=t._lookup.slice(),this._markpath=t._markpath}var LT=qT.prototype=UT.prototype;function $T(t){return(_(t)?PT:jT)(t)}function PT(t){for(var e,n="[",r=0,i=t.length;r<i;++r)n+=(r>0?",":"")+(x(e=t[r])?e.signal||$T(e):wt(e));return n+"]"}function jT(t){var e,n,r="{",i=0;for(e in t)n=t[e],r+=(++i>1?",":"")+wt(e)+":"+(x(n)?n.signal||$T(n):wt(n));return r+"}"}LT.parse=function(t){return NT(t,this)},LT.fork=function(){return new UT(this)},LT.isSubscope=function(){return this._subid>0},LT.toRuntime=function(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},LT.id=function(){return(this._subid?this._subid+":":0)+this._id++},LT.add=function(t){return this.operators.push(t),t.id=this.id(),t.refs&&(t.refs.forEach((function(e){e.$ref=t.id})),t.refs=null),t},LT.proxy=function(t){var e=t instanceof VF?JF(t):t;return this.add(jS({value:e}))},LT.addStream=function(t){return this.streams.push(t),t.id=this.id(),t},LT.addUpdate=function(t){return this.updates.push(t),t},LT.finish=function(){var t,e;for(t in this.root&&(this.root.root=!0),this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;function n(t,e,n){var r;t&&((r=t.data||(t.data={}))[e]||(r[e]=[])).push(n)}for(t in this.data)for(var r in n((e=this.data[t]).input,t,"input"),n(e.output,t,"output"),n(e.values,t,"values"),e.index)n(e.index[r],t,"index:"+r);return this},LT.pushState=function(t,e,n){this._encode.push(JF(this.add(YS({pulse:t})))),this._parent.push(e),this._lookup.push(n?JF(this.proxy(n)):null),this._markpath.push(-1)},LT.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},LT.parent=function(){return M(this._parent)},LT.encode=function(){return M(this._encode)},LT.lookup=function(){return M(this._lookup)},LT.markpath=function(){var t=this._markpath;return++t[t.length-1]},LT.fieldRef=function(t,e){if(pt(t))return ZF(t,e);t.signal||u("Unsupported field reference: "+wt(t));var n,r=t.signal,i=this.field[r];return i||(n={name:this.signalRef(r)},e&&(n.as=e),this.field[r]=i=JF(this.add(BS(n)))),i},LT.compareRef=function(t){function e(t){return eS(t)?(r=!0,n.signalRef(t.signal)):function(t){return t&&t.expr}(t)?(r=!0,n.exprRef(t.expr)):t}var n=this,r=!1,i=W(t.field).map(e),a=W(t.order).map(e);return r?JF(this.add(ES({fields:i,orders:a}))):KF(i,a)},LT.keyRef=function(t,e){var n=this.signals,r=!1;return t=W(t).map((function(t){return eS(t)?(r=!0,JF(n[t.signal])):t})),r?JF(this.add(TS({fields:t,flat:e}))):function(t,e){var n={$key:t};return e&&(n.$flat=!0),n}(t,e)},LT.sortRef=function(t){if(!t)return t;var e=tS(t.op,t.field),n=t.order||"ascending";return n.signal?JF(this.add(ES({fields:e,orders:this.signalRef(n.signal)}))):KF(e,n)},LT.event=function(t,e){var n=t+":"+e;if(!this.events[n]){var r=this.id();this.streams.push({id:r,source:t,type:e}),this.events[n]=r}return this.events[n]},LT.hasOwnSignal=function(t){return it(this.signals,t)},LT.addSignal=function(t,e){this.hasOwnSignal(t)&&u("Duplicate signal name: "+wt(t));var n=e instanceof VF?e:this.add(XF(e));return this.signals[t]=n},LT.getSignal=function(t){return this.signals[t]||u("Unrecognized signal name: "+wt(t)),this.signals[t]},LT.signalRef=function(t){return this.signals[t]?JF(this.signals[t]):(it(this.lambdas,t)||(this.lambdas[t]=this.add(XF(null))),JF(this.lambdas[t]))},LT.parseLambdas=function(){for(var t=Object.keys(this.lambdas),e=0,n=t.length;e<n;++e){var r=t[e],i=eF(r,this),a=this.lambdas[r];a.params=i.$params,a.update=i.$expr}},LT.property=function(t){return t&&t.signal?this.signalRef(t.signal):t},LT.objectProperty=function(t){return t&&x(t)?this.signalRef(t.signal||$T(t)):t},LT.exprRef=function(t,e){var n={expr:eF(t,this)};return e&&(n.expr.$name=e),JF(this.add(FS(n)))},LT.addBinding=function(t,e){this.bindings||u("Nested signals do not support binding: "+wt(t)),this.bindings.push(tt({signal:t},e))},LT.addScaleProj=function(t,e){it(this.scales,t)&&u("Duplicate scale or projection name: "+wt(t)),this.scales[t]=this.add(e)},LT.addScale=function(t,e){this.addScaleProj(t,HS(e))},LT.addProjection=function(t,e){this.addScaleProj(t,PS(e))},LT.getScale=function(t){return this.scales[t]||u("Unrecognized scale name: "+wt(t)),this.scales[t]},LT.projectionRef=LT.scaleRef=function(t){return JF(this.getScale(t))},LT.projectionType=LT.scaleType=function(t){return this.getScale(t).params.type},LT.addData=function(t,e){return it(this.data,t)&&u("Duplicate data set name: "+wt(t)),this.data[t]=e},LT.getData=function(t){return this.data[t]||u("Undefined data set name: "+wt(t)),this.data[t]},LT.addDataPipeline=function(t,e){return it(this.data,t)&&u("Duplicate data set name: "+wt(t)),this.addData(t,JB.fromEntries(this,e))},tt(Za,Ms,fy,Ly,Sk,DA,WM,XM,bE,NE,WE),t.Bounds=Uc,t.CanvasHandler=ad,t.CanvasRenderer=fd,t.DATE=Nn,t.DAY=On,t.DAYOFYEAR="dayofyear",t.Dataflow=Ya,t.Debug=4,t.Error=1,t.EventStream=Kt,t.Gradient=Os,t.GroupItem=Pc,t.HOURS=Rn,t.Handler=Hh,t.Info=3,t.Item=$c,t.MILLISECONDS="milliseconds",t.MINUTES=qn,t.MONTH=Tn,t.Marks=Fh,t.MultiPulse=$a,t.None=0,t.Operator=Xt,t.Parameters=Ht,t.Pulse=Oa,t.QUARTER=Bn,t.RenderType=xv,t.Renderer=Gh,t.ResourceLoader=Wc,t.SECONDS=Un,t.SVGHandler=pd,t.SVGRenderer=nv,t.SVGStringRenderer=mv,t.Scenegraph=Rh,t.TIME_UNITS=Ln,t.Transform=Xa,t.View=bF,t.WEEK=zn,t.Warn=2,t.YEAR=Sn,t.accessor=e,t.accessorFields=r,t.accessorName=n,t.array=W,t.bandwidthNRD=vo,t.bin=yo,t.bootstrapCI=_o,t.boundClip=Cv,t.boundContext=Kc,t.boundItem=Sh,t.boundMark=Th,t.boundStroke=Gc,t.changeset=It,t.clampRange=H,t.closeTag=Qm,t.compare=V,t.constant=Q,t.cumulativeLogNormal=To,t.cumulativeNormal=Eo,t.cumulativeUniform=Uo,t.dayofyear=gr,t.debounce=K,t.defaultLocale=Ca,t.definition=Qa,t.densityLogNormal=Bo,t.densityNormal=Mo,t.densityUniform=qo,t.domChild=Ph,t.domClear=jh,t.domCreate=Lh,t.domFind=$h,t.dotbin=xo,t.error=u,t.expressionFunction=QC,t.extend=tt,t.extent=et,t.extentIndex=nt,t.falsy=m,t.fastmap=ot,t.field=l,t.flush=ut,t.font=kh,t.fontFamily=wh,t.fontSize=vh,t.format=qe,t.formatLocale=Fn,t.formats=Ue,t.hasOwnProperty=it,t.id=f,t.identity=h,t.inferType=pe,t.inferTypes=ge,t.ingest=qt,t.inherits=st,t.inrange=lt,t.interpolate=bm,t.interpolateColors=ym,t.interpolateRange=vm,t.intersect=kv,t.intersectBoxLine=gf,t.intersectPath=ff,t.intersectPoint=hf,t.intersectRule=pf,t.isArray=_,t.isBoolean=ct,t.isDate=ft,t.isFunction=Y,t.isNumber=ht,t.isObject=x,t.isRegExp=dt,t.isString=pt,t.isTuple=Nt,t.key=gt,t.lerp=mt,t.lineHeight=yh,t.loader=Sa,t.locale=Da,t.logger=y,t.lruCache=vt,t.merge=yt,t.mergeConfig=w,t.multiLineOffset=xh,t.one=p,t.openTag=Zm,t.pad=xt,t.panLinear=z,t.panLog=N,t.panPow=O,t.panSymlog=R,t.parse=function(t,e,n){return x(t)||u("Input Vega specification must be an object."),OT(t,new qT(e=w({description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},trail:{fill:"#4c78a8",size:2},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}},e,t.config),n)).toRuntime()},t.pathCurves=Vl,t.pathEqual=Sv,t.pathParse=Jl,t.pathRectangle=xc,t.pathRender=uc,t.pathSymbols=fc,t.pathTrail=bc,t.peek=M,t.point=Wh,t.projection=yk,t.quantileLogNormal=zo,t.quantileNormal=Do,t.quantileUniform=Lo,t.quantiles=go,t.quantizeInterpolator=_m,t.quarter=j,t.quartiles=mo,t.randomInteger=function(e,n){null==n&&(n=e,e=0);var r,i,a,o={};return o.min=function(t){return arguments.length?(a=i-(r=t||0),o):r},o.max=function(t){return arguments.length?(a=(i=t||0)-r,o):i},o.sample=function(){return r+Math.floor(a*t.random())},o.pdf=function(t){return t===Math.floor(t)&&t>=r&&t<i?1/a:0},o.cdf=function(t){var e=Math.floor(t);return e<r?0:e>=i?1:(e-r+1)/a},o.icdf=function(t){return t>=0&&t<=1?r-1+Math.floor(t*a):NaN},o.min(e).max(n)},t.randomKDE=Fo,t.randomLCG=function(t){return function(){return(t=(1103515245*t+12345)%2147483647)/2147483647}},t.randomLogNormal=No,t.randomMixture=Oo,t.randomNormal=Co,t.randomUniform=$o,t.read=Fa,t.regressionExp=Vo,t.regressionLinear=Ho,t.regressionLoess=Qo,t.regressionLog=Yo,t.regressionPoly=Jo,t.regressionPow=Go,t.regressionQuad=Xo,t.renderModule=wv,t.repeat=_t,t.resetDefaultLocale=function(){return Dn(),ka(),Ca()},t.resetSVGClipId=Rc,t.resetSVGDefIds=function(){Rc(),Bs=0},t.responseType=Le,t.runtimeContext=cF,t.sampleCurve=nu,t.sampleLogNormal=So,t.sampleNormal=Ao,t.sampleUniform=Ro,t.scale=um,t.sceneEqual=Fv,t.sceneFromJSON=Oh,t.scenePickVisit=Ef,t.sceneToJSON=Nh,t.sceneVisit=Mf,t.sceneZOrder=Af,t.scheme=Mm,t.setRandom=function(e){t.random=e},t.span=bt,t.splitAccessPath=s,t.stringValue=wt,t.textMetrics=fh,t.timeBin=Kr,t.timeFloor=Br,t.timeFormatLocale=Ma,t.timeInterval=qr,t.timeOffset=$r,t.timeSequence=Ir,t.timeUnitSpecifier=In,t.timeUnits=Pn,t.toBoolean=kt,t.toDate=Mt,t.toNumber=E,t.toSet=Dt,t.toString=Et,t.transform=Ka,t.transforms=Za,t.truncate=Ct,t.truthy=g,t.tupleid=Ot,t.typeParsers=fe,t.utcFloor=Nr,t.utcInterval=Ur,t.utcOffset=Pr,t.utcSequence=Wr,t.utcdayofyear=br,t.utcquarter=I,t.utcweek=wr,t.version="5.13.0",t.visitArray=Ft,t.week=mr,t.writeConfig=k,t.zero=d,t.zoomLinear=U,t.zoomLog=L,t.zoomPow=$,t.zoomSymlog=P,Object.defineProperty(t,"__esModule",{value:!0})}));
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).vegaLite={})}(this,(function(e){"use strict";function t(e,t,n){return e.fields=t||[],e.fname=n,e}function n(e){return 1===e.length?i(e[0]):r(e)}const i=e=>function(t){return t[e]},r=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function o(e){throw Error(e)}function s(e){var t,n,i,r=[],s=null,a=0,u=e.length,l="";function c(){r.push(l+e.substring(t,n)),l="",t=n+1}for(e+="",t=n=0;n<u;++n)if("\\"===(i=e[n]))l+=e.substring(t,n),l+=e.substring(++n,++n),t=n;else if(i===s)c(),s=null,a=-1;else{if(s)continue;t===a&&'"'===i||t===a&&"'"===i?(t=n+1,s=i):"."!==i||a?"["===i?(n>t&&c(),a=t=n+1):"]"===i&&(a||o("Access path missing open bracket: "+e),a>0&&c(),a=0,t=n+1):n>t?c():t=n+1}return a&&o("Access path missing closing bracket: "+e),s&&o("Access path missing closing quote: "+e),n>t&&(n++,c()),r}var a=[],u=(function(e,i,r){const o=s(e);e=1===o.length?o[0]:e,t((r&&r.get||n)(o),[e],i||e)}("id"),t((function(e){return e}),a,"identity"));t((function(){return 0}),a,"zero"),t((function(){return 1}),a,"one"),t((function(){return!0}),a,"true"),t((function(){return!1}),a,"false");function l(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}var c=Array.isArray;function f(e){return e===Object(e)}const d=e=>"__proto__"!==e;function g(...e){return e.reduce((e,t)=>{for(var n in t)if("signals"===n)e.signals=m(e.signals,t.signals);else{var i="legend"===n?{layout:1}:"style"===n||null;p(e,n,t[n],i)}return e},{})}function p(e,t,n,i){var r,o;if(d(t))if(f(n)&&!c(n))for(r in o=f(e[t])?e[t]:e[t]={},n)i&&(!0===i||i[r])?p(o,r,n[r]):d(r)&&(o[r]=n[r]);else e[t]=n}function m(e,t){if(null==e)return t;const n={},i=[];function r(e){n[e.name]||(n[e.name]=1,i.push(e))}return t.forEach(r),e.forEach(r),i}function h(e){return null!=e?c(e)?e:[e]:[]}const b=Object.prototype.hasOwnProperty;function v(e,t){return b.call(e,t)}function y(e){return"boolean"==typeof e}function x(e){return"number"==typeof e}function O(e){return"string"==typeof e}function w(e){return c(e)?"["+e.map(w)+"]":f(e)||O(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function j(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.
    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.
    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function A(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var D=function(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}((function(e){var t=function(){function e(e,t){return null!=t&&e instanceof t}var t,n,i;try{t=Map}catch(e){t=function(){}}try{n=Set}catch(e){n=function(){}}try{i=Promise}catch(e){i=function(){}}function r(o,a,u,l,c){"object"==typeof a&&(u=a.depth,l=a.prototype,c=a.includeNonEnumerable,a=a.circular);var f=[],d=[],g="undefined"!=typeof Buffer;return void 0===a&&(a=!0),void 0===u&&(u=1/0),function o(u,p){if(null===u)return null;if(0===p)return u;var m,h;if("object"!=typeof u)return u;if(e(u,t))m=new t;else if(e(u,n))m=new n;else if(e(u,i))m=new i((function(e,t){u.then((function(t){e(o(t,p-1))}),(function(e){t(o(e,p-1))}))}));else if(r.__isArray(u))m=[];else if(r.__isRegExp(u))m=new RegExp(u.source,s(u)),u.lastIndex&&(m.lastIndex=u.lastIndex);else if(r.__isDate(u))m=new Date(u.getTime());else{if(g&&Buffer.isBuffer(u))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(u.length):new Buffer(u.length),u.copy(m),m;e(u,Error)?m=Object.create(u):void 0===l?(h=Object.getPrototypeOf(u),m=Object.create(h)):(m=Object.create(l),h=l)}if(a){var b=f.indexOf(u);if(-1!=b)return d[b];f.push(u),d.push(m)}for(var v in e(u,t)&&u.forEach((function(e,t){var n=o(t,p-1),i=o(e,p-1);m.set(n,i)})),e(u,n)&&u.forEach((function(e){var t=o(e,p-1);m.add(t)})),u){var y;h&&(y=Object.getOwnPropertyDescriptor(h,v)),y&&null==y.set||(m[v]=o(u[v],p-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(u);for(v=0;v<x.length;v++){var O=x[v];(!(j=Object.getOwnPropertyDescriptor(u,O))||j.enumerable||c)&&(m[O]=o(u[O],p-1),j.enumerable||Object.defineProperty(m,O,{enumerable:!1}))}}if(c){var w=Object.getOwnPropertyNames(u);for(v=0;v<w.length;v++){var j,A=w[v];(j=Object.getOwnPropertyDescriptor(u,A))&&j.enumerable||(m[A]=o(u[A],p-1),Object.defineProperty(m,A,{enumerable:!1}))}}return m}(o,u)}function o(e){return Object.prototype.toString.call(e)}function s(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return r.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},r.__objToStr=o,r.__isDate=function(e){return"object"==typeof e&&"[object Date]"===o(e)},r.__isArray=function(e){return"object"==typeof e&&"[object Array]"===o(e)},r.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===o(e)},r.__getRegExpFlags=s,r}();e.exports&&(e.exports=t)})),F=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,i="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&(n=t.cmp,function(e){return function(t,i){var r={key:t,value:e[t]},o={key:i,value:e[i]};return n(r,o)}}),o=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,s;if(Array.isArray(t)){for(s="[",n=0;n<t.length;n++)n&&(s+=","),s+=e(t[n])||"null";return s+"]"}if(null===t)return"null";if(-1!==o.indexOf(t)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=o.push(t)-1,u=Object.keys(t).sort(r&&r(t));for(s="",n=0;n<u.length;n++){var l=u[n],c=e(t[l]);c&&(s&&(s+=","),s+=JSON.stringify(l)+":"+c)}return o.splice(a,1),"{"+s+"}"}}(e)};function k(e){return!!e.or}function C(e){return!!e.and}function E(e){return!!e.not}function S(e,t){return E(e)?{not:S(e.not,t)}:C(e)?{and:e.and.map(e=>S(e,t))}:k(e)?{or:e.or.map(e=>S(e,t))}:t(e)}const $=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var i,r,o;if(Array.isArray(t)){if((i=t.length)!=n.length)return!1;for(r=i;0!=r--;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((i=(o=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(r=i;0!=r--;)if(!Object.prototype.hasOwnProperty.call(n,o[r]))return!1;for(r=i;0!=r--;){var s=o[r];if(!e(t[s],n[s]))return!1}return!0}return t!=t&&n!=n},B=D;function _(e,t){const n={};for(const i of t)v(e,i)&&(n[i]=e[i]);return n}function z(e,t){const n=Object.assign({},e);for(const e of t)delete n[e];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>F(e)).join(",")})`};const P=F;function N(e){if(x(e))return e;const t=O(e)?e:F(e);if(t.length<250)return t;let n=0;for(let e=0;e<t.length;e++){n=(n<<5)-n+t.charCodeAt(e),n&=n}return n}function L(e){return!1===e||null===e}function M(e,t){return e.indexOf(t)>-1}function T(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function q(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function R(e,t){for(const n of V(t))p(e,n,t[n],!0)}function U(e,t){const n=[],i={};let r;for(const o of e)r=t(o),r in i||(i[r]=1,n.push(o));return n}function W(e,t){for(const n of e)if(t.has(n))return!0;return!1}function I(e){const t=new Set;for(const n of e){const e=s(n).map((e,t)=>0===t?e:`[${e}]`),i=e.map((t,n)=>e.slice(0,n+1).join(""));for(const e of i)t.add(e)}return t}function H(e,t){return void 0===e||void 0===t||W(I(e),I(t))}function G(e){return 0===V(e).length}const V=Object.keys,J=Object.values;function Y(e){const t=[];for(const n in e)v(e,n)&&t.push({key:n,value:e[n]});return t}function X(e){return!0===e||!1===e}function Q(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function K(e,t){return E(e)?"!("+K(e.not,t)+")":C(e)?"("+e.and.map(e=>K(e,t)).join(") && (")+")":k(e)?"("+e.or.map(e=>K(e,t)).join(") || (")+")":t(e)}function Z(e,t){if(0===t.length)return!0;const n=t.shift();return n in e&&Z(e[n],t)&&delete e[n],G(e)}function ee(e){return e.charAt(0).toUpperCase()+e.substr(1)}function te(e,t="datum"){const n=s(e),i=[];for(let e=1;e<=n.length;e++){const r=`[${n.slice(0,e).map(w).join("][")}]`;i.push(`${t}${r}`)}return i.join(" && ")}function ne(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function ie(e){return""+s(e).map(ne).join("\\.")}function re(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function oe(e){return""+s(e).join(".")}function se(e){return e?s(e).length:0}function ae(...e){for(const t of e)if(void 0!==t)return t}let ue=42;function le(e){if(void 0!==e)return(e%360+360)%360}function ce(e){return!!x(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const fe={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function de(e){return e&&e.condition}const ge=["domain","grid","labels","ticks","title"],pe={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},me={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},he=Object.assign(Object.assign({},me),{style:1,labelExpr:1,encoding:1});function be(e){return!!he[e]}const ve={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},ye=ve.arc,xe=ve.area,Oe=ve.bar,we=ve.image,je=ve.line,Ae=ve.point,De=ve.rect,Fe=ve.rule,ke=ve.text,Ce=ve.tick,Ee=ve.trail,Se=ve.circle,$e=ve.square,Be=ve.geoshape;function _e(e){return M(["line","area","trail"],e)}function ze(e){return M(["rect","bar","image","arc"],e)}const Pe=V(ve);function Ne(e){return e.type}j(Pe);const Le=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],Me=V({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),Te={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},qe={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},Re={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function Ue(e){return"mark"in e}class We{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return!!Ue(e)&&(Ne(t=e.mark)?t.type:t)===this.name;var t}}const Ie={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},He={count:1,min:1,max:1};function Ge(e){return!!e&&!!e.argmin}function Ve(e){return!!e&&!!e.argmax}function Je(e){return O(e)&&!!Ie[e]}const Ye=["count","valid","missing","distinct"];function Xe(e){return O(e)&&M(Ye,e)}const Qe=["count","sum","distinct","valid","missing"],Ke=j(["mean","average","median","q1","q3","min","max"]),Ze="row",et="column",tt="x",nt="y",it="x2",rt="y2",ot="radius",st="theta",at="theta2",ut="color",lt="fill",ct="stroke",ft="shape",dt="size",gt={theta:1,theta2:1,radius:1,radius2:1};function pt(e){return e in gt}const mt={longitude:1,longitude2:1,latitude:1,latitude2:1};const ht=V(mt),bt=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),gt),mt),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function vt(e){return e===ut||e===lt||e===ct}const yt={row:1,column:1,facet:1},xt=V(yt),Ot=Object.assign(Object.assign({},bt),yt),wt=V(Ot),jt=A(Ot,["order","detail","tooltip"]),At=A(jt,["row","column","facet"]);function Dt(e){return!!Ot[e]}const Ft=[it,rt,"latitude2","longitude2",at,"radius2"];function kt(e){return Ct(e)!==e}function Ct(e){switch(e){case it:return tt;case rt:return nt;case"latitude2":return"latitude";case"longitude2":return"longitude";case at:return st;case"radius2":return ot}return e}function Et(e){if(pt(e))switch(e){case st:return"startAngle";case at:return"endAngle";case ot:return"outerRadius";case"radius2":return"innerRadius"}return e}function St(e){switch(e){case tt:return it;case nt:return rt;case"latitude":return"latitude2";case"longitude":return"longitude2";case st:return at;case ot:return"radius2"}}function $t(e){switch(e){case tt:case it:return"width";case nt:case rt:return"height"}}const Bt=A(bt,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),_t=V(Bt),zt={x:1,y:1},Pt=V(zt);function Nt(e){return e in zt}const Lt={theta:1,radius:1},Mt=V(Lt);function Tt(e){return"width"===e?tt:nt}const qt=A(Bt,["text","tooltip","href","url","description","detail","key","order"]),Rt=V(qt);const Ut=Object.assign(Object.assign(Object.assign({},zt),Lt),qt),Wt=V(Ut);function It(e){return!!Ut[e]}function Ht(e,t){return function(e){switch(e){case ut:case lt:case ct:case"description":case"detail":case"key":case"tooltip":case"href":case"order":case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeWidth":case"facet":case Ze:case et:return Gt;case tt:case nt:case"latitude":case"longitude":return Vt;case it:case rt:case"latitude2":case"longitude2":return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case dt:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case"strokeDash":return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case ft:return{point:"always",geoshape:"always"};case"text":return{text:"always"};case"angle":return{point:"always",square:"always",text:"always"};case"url":return{image:"always"};case st:case ot:return{text:"always",arc:"always"};case at:case"radius2":return{arc:"always"}}}(e)[t]}const Gt={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},Vt=A(Gt,["geoshape"]);function Jt(e){switch(e){case tt:case nt:case st:case ot:case dt:case"angle":case"strokeWidth":case"opacity":case"fillOpacity":case"strokeOpacity":case it:case rt:case at:case"radius2":return;case"facet":case Ze:case et:case ft:case"strokeDash":case"text":case"tooltip":case"href":case"url":case"description":return"discrete";case ut:case lt:case ct:return"flexible";case"latitude":case"longitude":case"latitude2":case"longitude2":case"detail":case"key":case"order":return}}function Yt(e){return y(e)&&(e=ro(e,void 0)),"bin"+V(e).map(t=>Zt(e[t])?Q(`_${t}_${Object.entries(e[t])}`):Q(`_${t}_${e[t]}`)).join("")}function Xt(e){return!0===e||Kt(e)&&!e.binned}function Qt(e){return"binned"===e||Kt(e)&&!0===e.binned}function Kt(e){return f(e)}function Zt(e){return null==e?void 0:e.selection}function en(e){switch(e){case Ze:case et:case dt:case ut:case lt:case ct:case"strokeWidth":case"opacity":case"fillOpacity":case"strokeOpacity":case ft:return 6;case"strokeDash":return 4;default:return 10}}function tn(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}function nn(e){return("width"==e?"Width":"Height")+' "container" only works for single views and layered views.'}function rn(e){return`${"width"==e?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==e?"x":"y"}".`}function on(e){return e?`Dropping "fit-${e}" because spec has discrete ${$t(e)}.`:'Dropping "fit" because spec has discrete size.'}function sn(e){return`Unknown field for ${e}. Cannot calculate view size.`}function an(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function un(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function ln(e){return`Selection not supported for ${e} yet.`}function cn(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}function fn(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function dn(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function gn(e){return`Invalid field type "${e}".`}function pn(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function mn(e,t){return`Dropping ${P(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function hn(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?" when "+n:""}.`}function bn(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function vn(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${"ordinal"===t?"order":"magnitude"}.`}function yn(e){return`Using unaggregated domain with raw field has no effect (${P(e)}).`}function xn(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function On(e){return`Unaggregated domain is currently unsupported for log scale (${P(e)}).`}function wn(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function jn(e){return`The step for "${e}" is dropped because the ${"width"===e?"x":"y"} is continuous.`}const An="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function Dn(e,t){return`Invalid ${e}: ${P(t)}.`}function Fn(e){return`1D error band does not support ${e}.`}function kn(e){return`Channel ${e} is required for "binned" bin.`}const Cn=(Sn=2||0,{level:function(e){return arguments.length?(Sn=+e,this):Sn},error:function(){return Sn>=1&&l(En||"error","ERROR",arguments),this},warn:function(){return Sn>=2&&l(En||"warn","WARN",arguments),this},info:function(){return Sn>=3&&l(En||"log","INFO",arguments),this},debug:function(){return Sn>=4&&l(En||"log","DEBUG",arguments),this}});var En,Sn;let $n=Cn;function Bn(...e){$n.warn(...e)}function _n(e){if(e&&f(e))for(const t of Rn)if(t in e)return!0;return!1}const zn=["january","february","march","april","may","june","july","august","september","october","november","december"],Pn=zn.map(e=>e.substr(0,3)),Nn=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Ln=Nn.map(e=>e.substr(0,3));function Mn(e,t){const n=[];if(t&&void 0!==e.day&&V(e).length>1&&(Bn(function(e){return`Dropping day from datetime ${P(e)} as day cannot be combined with other units.`}(e)),delete(e=B(e)).day),void 0!==e.year?n.push(e.year):n.push(2012),void 0!==e.month){const i=t?function(e){if(ce(e)&&(e=+e),x(e))return e-1;{const t=e.toLowerCase(),n=zn.indexOf(t);if(-1!==n)return n;const i=t.substr(0,3),r=Pn.indexOf(i);if(-1!==r)return r;throw new Error(Dn("month",e))}}(e.month):e.month;n.push(i)}else if(void 0!==e.quarter){const i=t?function(e){if(ce(e)&&(e=+e),x(e))return e>4&&Bn(Dn("quarter",e)),e-1;throw new Error(Dn("quarter",e))}(e.quarter):e.quarter;n.push(x(i)?3*i:i+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){const i=t?function(e){if(ce(e)&&(e=+e),x(e))return e%7;{const t=e.toLowerCase(),n=Nn.indexOf(t);if(-1!==n)return n;const i=t.substr(0,3),r=Ln.indexOf(i);if(-1!==r)return r;throw new Error(Dn("day",e))}}(e.day):e.day;n.push(x(i)?i+1:i+"+1")}else n.push(1);for(const t of["hours","minutes","seconds","milliseconds"]){const i=e[t];n.push(void 0===i?0:i)}return n}function Tn(e){const t=Mn(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}const qn={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Rn=V(qn);function Un(e){return e.startsWith("utc")}const Wn={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function In(e){const t=[];for(const n of Rn)Hn(e,n)&&t.push(n);return t}function Hn(e,t){const n=e.indexOf(t);return!(n<0)&&(!(n>0&&"seconds"===t&&"i"===e.charAt(n-1))&&(!(e.length>n+3&&"day"===t&&"o"===e.charAt(n+3))&&!(n>0&&"year"===t&&"f"===e.charAt(n-1))))}function Gn(e,t,{end:n}={end:!1}){const i=te(t),r=Un(e)?"utc":"";let o;const s={};for(const t of Rn)Hn(e,t)&&(s[t]="quarter"===(a=t)?`(${r}quarter(${i})-1)`:`${r}${a}(${i})`,o=t);var a;return n&&(s[o]+="+1"),function(e){const t=Mn(e,!1).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}(s)}function Vn(e){if(!e)return;const t=In(e);return`timeUnitSpecifier(${F(t)}, ${F(Wn)})`}function Jn(e){if(!e)return;let t;return O(e)?t={unit:e}:f(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),Un(t.unit)&&(t.utc=!0,t.unit=t.unit.substr(3)),t}function Yn(e){return e&&!!e.signal}function Xn(e){return!!e.step}function Qn(e){return!c(e)&&("field"in e&&"data"in e)}const Kn=V({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),Zn={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},ei=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function ti(e){return e&&!!e.field&&void 0!==e.equal}function ni(e){return e&&!!e.field&&void 0!==e.lt}function ii(e){return e&&!!e.field&&void 0!==e.lte}function ri(e){return e&&!!e.field&&void 0!==e.gt}function oi(e){return e&&!!e.field&&void 0!==e.gte}function si(e){if(e&&e.field){if(c(e.range)&&2===e.range.length)return!0;if(Yn(e.range))return!0}return!1}function ai(e){return e&&!!e.field&&(c(e.oneOf)||c(e.in))}function ui(e){return ai(e)||ti(e)||si(e)||ni(e)||ri(e)||ii(e)||oi(e)}function li(e,t){return ao(e,{timeUnit:t,wrapTime:!0})}function ci(e,t=!0){var n;const{field:i}=e,r=null===(n=Jn(e.timeUnit))||void 0===n?void 0:n.unit,o=r?"time("+Gn(r,i)+")":Wr(e,{expr:"datum"});if(ti(e))return o+"==="+li(e.equal,r);if(ni(e)){return`${o}<${li(e.lt,r)}`}if(ri(e)){return`${o}>${li(e.gt,r)}`}if(ii(e)){return`${o}<=${li(e.lte,r)}`}if(oi(e)){return`${o}>=${li(e.gte,r)}`}if(ai(e))return`indexof([${function(e,t){return e.map(e=>li(e,t))}(e.oneOf,r).join(",")}], ${o}) !== -1`;if(function(e){return e&&!!e.field&&void 0!==e.valid}(e))return fi(o,e.valid);if(si(e)){const{range:n}=e,i=Yn(n)?{signal:n.signal+"[0]"}:n[0],s=Yn(n)?{signal:n.signal+"[1]"}:n[1];if(null!==i&&null!==s&&t)return"inrange("+o+", ["+li(i,r)+", "+li(s,r)+"])";const a=[];return null!==i&&a.push(`${o} >= ${li(i,r)}`),null!==s&&a.push(`${o} <= ${li(s,r)}`),a.length>0?a.join(" && "):"true"}throw new Error("Invalid field predicate: "+JSON.stringify(e))}function fi(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function di(e){var t;return ui(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:null===(t=Jn(e.timeUnit))||void 0===t?void 0:t.unit}):e}const gi="quantitative",pi="ordinal",mi="temporal",hi="nominal",bi="geojson";const vi="linear",yi="log",xi="pow",Oi="sqrt",wi="symlog",ji="time",Ai="utc",Di="quantile",Fi="quantize",ki="threshold",Ci="point",Ei="band",Si={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function $i(e,t){const n=Si[e],i=Si[t];return n===i||"ordinal-position"===n&&"time"===i||"ordinal-position"===i&&"time"===n}const Bi={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function _i(e){return Bi[e]}const zi=["linear","log","pow","sqrt","symlog","time","utc"],Pi=j(zi),Ni=j(["linear","log","pow","sqrt","symlog"]);const Li=j(["quantile","quantize","threshold"]),Mi=j(zi.concat(["quantile","quantize","threshold","sequential","identity"])),Ti=j(["ordinal","bin-ordinal","point","band"]);function qi(e){return e in Ti}function Ri(e){return e in Mi}function Ui(e){return e in Pi}function Wi(e){return e in Li}function Ii(e){return null==e?void 0:e.selection}const Hi=A({type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},["type","domain","range","rangeMax","rangeMin","scheme"]),Gi=V(Hi);function Vi(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!M(["point","band","identity"],e);case"bins":return!M(["point","band","identity","ordinal"],e);case"round":return Ui(e)||"band"===e||"point"===e;case"padding":case"rangeMin":case"rangeMax":return Ui(e)||M(["point","band"],e);case"paddingOuter":case"align":return M(["point","band"],e);case"paddingInner":return"band"===e;case"domainMax":case"domainMid":case"domainMin":case"clamp":return Ui(e);case"nice":return Ui(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return Ri(e)&&!M(["log","time","utc","threshold","quantile"],e)}}function Ji(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return vt(e)?void 0:`Cannot use the scale property "${e}" with non-color channel.`;case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function Yi(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:o}=e,s=tr(e);return Sr(n)&&!Xe(n.aggregate)&&r&&Ui(r.get("type"))&&!1===r.get("zero")?Xi({fieldDef:n,channel:t,markDef:i,ref:s,config:o}):s}function Xi({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){if(_e(n.type))return i;return null===bo("invalid",n,r)?i:[Qi(e,t),i]}function Qi(e,t){const n=Ki(e,!0),i="y"===Ct(t)?{field:{group:"height"}}:{value:0};return Object.assign({test:n},i)}function Ki(e,t=!0){return fi(O(e)?e:Wr(e,{expr:"datum"}),!t)}function Zi(e,t,n,i){const r={};if(t&&(r.scale=t),Br(e)){const{datum:t}=e;_n(t)?r.signal=Tn(t):Yn(t)?r.signal=t.signal:r.value=t}else r.field=Wr(e,n);if(i){const{offset:e,band:t}=i;e&&(r.offset=e),t&&(r.band=t)}return r}function er({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,band:o=.5}){const s=0<o&&o<1?"datum":void 0,a=Wr(t,{expr:s,suffix:r}),u=void 0!==n?Wr(n,{expr:s}):Wr(t,{suffix:"end",expr:s}),l={};if(0===o||1===o){l.scale=e;const t=0===o?a:u;l.field=t}else{const t=`${o} * ${a} + ${1-o} * ${u}`;l.signal=`scale("${e}", ${t})`}return i&&(l.offset=i),l}function tr({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:o,scale:s,stack:a,offset:u,defaultRef:l,band:c}){var f;if(t){if(Pr(t)){if(Nr(t)){c=null!=c?c:Dr({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:a,config:r,isMidPoint:!0});const{bin:s,timeUnit:l,type:f}=t;if(Xt(s)||c&&l&&f===mi)return a&&a.impute?Zi(t,o,{binSuffix:"mid"},{offset:u}):c?er({scaleName:o,fieldOrDatumDef:t,band:c,offset:u}):Zi(t,o,lo(t,e)?{binSuffix:"range"}:{},{offset:u});if(Qt(s)){if(Sr(n))return er({scaleName:o,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:u});Bn(kn(e===tt?it:rt))}}const l=null==s?void 0:s.get("type");return Zi(t,o,qi(l)?{binSuffix:"range"}:{},{offset:u,band:"band"===l?null!==(f=null!=c?c:t.band)&&void 0!==f?f:.5:void 0})}if(Lr(t)){const n=t.value,i=u?{offset:u}:{};return Object.assign(Object.assign({},nr(e,n)),i)}}return function(e){return"function"==typeof e}(l)&&(l=l()),l?Object.assign(Object.assign({},l),u?{offset:u}:{}):l}function nr(e,t){return M(["x","x2"],e)&&"width"===t?{field:{group:"width"}}:M(["y","y2"],e)&&"height"===t?{field:{group:"height"}}:go(t)}function ir(e){return e&&"number"!==e&&"time"!==e}function rr(e,t,n){return`${e}(${t}${n?", "+JSON.stringify(n):""})`}function or({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:o}){var s,a;if(ir(n))return ar({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:o});const u=sr(e,i,r);if(so(e)){const n=function(e,t,n,i,r){return!t||n?(n=O(n)?n:i,`${r?"utc":"time"}Format(${e}, '${n}')`):function(e,t,n){if(!e)return;const i=Vn(e);return`${n||Un(e)?"utc":"time"}Format(${t}, ${i})`}(t,e,r)}(u,Sr(e)?null===(s=Jn(e.timeUnit))||void 0===s?void 0:s.unit:void 0,t,o.timeFormat,Mr(e)&&(null===(a=e.scale)||void 0===a?void 0:a.type)===Ai);return n?{signal:n}:void 0}if(t=cr($r(e),t,o),Sr(e)&&Xt(e.bin)){return{signal:gr(u,Wr(e,{expr:i,binSuffix:"end"}),t,n,o)}}return t||"quantitative"===$r(e)?{signal:""+fr(u,t)}:{signal:`isValid(${u}) ? ${u} : ""+${u}`}}function sr(e,t,n){return Sr(e)?n?`${Wr(e,{expr:t,suffix:"end"})}-${Wr(e,{expr:t,suffix:"start"})}`:Wr(e,{expr:t}):function(e){const{datum:t}=e;return _n(t)?Tn(t):""+JSON.stringify(t)}(e)}function ar({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:o,field:s}){if(s=null!=s?s:sr(e,i,r),Sr(e)&&Xt(e.bin)){return{signal:gr(s,Wr(e,{expr:i,binSuffix:"end"}),t,n,o)}}return{signal:rr(n,s,t)}}function ur(e,t,n,i,r,o){var s;if(!ir(i)){if(so(e)){return function(e,t,n,i){if(e)return e;if(t)return{signal:Vn(t)};return i?void 0:n.timeFormat}(n,Sr(e)?null===(s=Jn(e.timeUnit))||void 0===s?void 0:s.unit:void 0,r,o)}return cr(t,n,r)}}function lr(e,t,n){return e&&(Yn(e)||"number"===e||"time"===e)?e:so(t)&&"time"!==n&&"utc"!==n?"time":void 0}function cr(e,t,n){return O(t)?t:e===gi?n.numberFormat:void 0}function fr(e,t){return`format(${e}, "${t||""}")`}function dr(e,t,n,i){var r;return ir(n)?rr(n,e,t):fr(e,null!==(r=O(t)?t:void 0)&&void 0!==r?r:i.numberFormat)}function gr(e,t,n,i,r){const o=dr(e,n,i,r),s=dr(t,n,i,r);return`${fi(e,!1)} ? "null" : ${o} + " 
 " + ${s}`}const pr="min",mr={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function hr(e){return e in mr}function br(e){return!!e&&!!e.encoding}function vr(e){return!(!e||"count"!==e.op&&!e.field)}function yr(e){return!!e&&c(e)}function xr(e){return"row"in e||"column"in e}function Or(e){return!!e&&"header"in e}function wr(e){return"facet"in e}function jr(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function Ar(e){return"sort"in e}function Dr({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:r,config:o,isMidPoint:s}){if(Pr(t)&&void 0!==t.band)return t.band;if(Sr(t)){const{timeUnit:e,bin:r}=t;if(e&&!n)return s?vo("timeUnitBandPosition",i,o):ze(i.type)?vo("timeUnitBand",i,o):0;if(Xt(r))return ze(i.type)&&!s?1:.5}return(null==r?void 0:r.fieldChannel)===e&&s?.5:void 0}function Fr(e,t,n,i,r,o){return!!(Xt(t.bin)||t.timeUnit&&Nr(t)&&"temporal"===t.type)&&!!Dr({channel:e,fieldDef:t,fieldDef2:n,stack:i,markDef:r,config:o})}function kr(e){return!!e&&"condition"in e}function Cr(e){const t=e&&e.condition;return!!t&&!c(t)&&Sr(t)}function Er(e){const t=e&&e.condition;return!!t&&!c(t)&&Pr(t)}function Sr(e){return!(!e||!e.field&&"count"!==e.aggregate)}function $r(e){return e&&e.type}function Br(e){return!!e&&"datum"in e}function _r(e){return Nr(e)&&Hr(e)||zr(e)}function zr(e){return Br(e)&&x(e.datum)}function Pr(e){return Sr(e)||Br(e)}function Nr(e){return!!e&&("field"in e||"count"===e.aggregate)&&"type"in e}function Lr(e){return e&&"value"in e&&"value"in e}function Mr(e){return!!e&&("scale"in e||"sort"in e)}function Tr(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function qr(e){return!!e&&"legend"in e}function Rr(e){return!!e&&("format"in e||"formatType"in e)}function Ur(e){return z(e,["legend","axis","header","scale"])}function Wr(e,t={}){var n,i,r;let o=e.field;const a=t.prefix;let u=t.suffix,l="";if(function(e){return"count"===e.aggregate}(e))o=function(e){return 0===e.indexOf("__")}(c="count")?c:"__"+c;else{let s;if(!t.nofn)if(function(e){return"op"in e}(e))s=e.op;else{const{bin:a,aggregate:c,timeUnit:f}=e;Xt(a)?(s=Yt(a),u=(null!==(n=t.binSuffix)&&void 0!==n?n:"")+(null!==(i=t.suffix)&&void 0!==i?i:"")):c?Ve(c)?(l=`["${o}"]`,o="argmax_"+c.argmax):Ge(c)?(l=`["${o}"]`,o="argmin_"+c.argmin):s=String(c):f&&(s=function(e){const t=Jn(e),{utc:n}=t,i=A(t,["utc"]);return i.unit?(n?"utc":"")+V(i).map(e=>Q(`${"unit"===e?"":`_${e}_`}${i[e]}`)).join(""):(n?"utc":"")+"timeunit"+V(i).map(e=>Q(`_${e}_${i[e]}`)).join("")}(f),u=(!M(["range","mid"],t.binSuffix)&&t.binSuffix||"")+(null!==(r=t.suffix)&&void 0!==r?r:""))}s&&(o=o?`${s}_${o}`:s)}var c;return u&&(o=`${o}_${u}`),a&&(o=`${a}_${o}`),t.forAs?oe(o):t.expr?function(e,t="datum"){return`${t}[${w(s(e).join("."))}]`}(o,t.expr)+l:ie(o)+l}function Ir(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return Sr(e)&&!!e.bin;case"temporal":return!1}throw new Error(gn(e.type))}function Hr(e){return!Ir(e)}const Gr=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(Ve(t))return`${r} for argmax(${t.argmax})`;if(Ge(t))return`${r} for argmin(${t.argmin})`;const o=Jn(i),s=t||(null==o?void 0:o.unit)||(null==o?void 0:o.maxbins)&&"timeunit"||Xt(n)&&"bin";return s?s.toUpperCase()+"("+r+")":r}(e);default:return function(e,t){var n;const{field:i,bin:r,timeUnit:o,aggregate:s}=e;if("count"===s)return t.countTitle;if(Xt(r))return i+" (binned)";if(o){const e=null===(n=Jn(o))||void 0===n?void 0:n.unit;if(e)return`${i} (${In(e).join("-")})`}else if(s)return Ve(s)?`${i} for max ${s.argmax}`:Ge(s)?`${i} for min ${s.argmin}`:`${ee(s)} of ${i}`;return i}(e,t)}};let Vr=Gr;function Jr(e){Vr=e}function Yr(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,o;const s=null===(r=Xr(e))||void 0===r?void 0:r.title;if(!Sr(e))return s;const a=e,u=i?Qr(a,t):void 0;return n?ae(s,a.title,u):null!==(o=null!=s?s:a.title)&&void 0!==o?o:u}function Xr(e){return Tr(e)&&e.axis?e.axis:qr(e)&&e.legend?e.legend:Or(e)&&e.header?e.header:void 0}function Qr(e,t){return Vr(e,t)}function Kr(e){var t;if(Rr(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}{const n=null!==(t=Xr(e))&&void 0!==t?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function Zr(e){return Sr(e)?e:Cr(e)?e.condition:void 0}function eo(e){return Pr(e)?e:Er(e)?e.condition:void 0}function to(e,t,n,i={}){if(O(e)||x(e)||y(e)){return Bn(function(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${P(n)}}.`}(t,O(e)?"string":x(e)?"number":"boolean",e)),{value:e}}return Pr(e)?no(e,t,n,i):Er(e)?Object.assign(Object.assign({},e),{condition:no(e.condition,t,n,i)}):e}function no(e,t,n,i){if(Rr(e)){const{format:r,formatType:o}=e,s=A(e,["format","formatType"]);if(ir(o)&&!n.customFormatTypes)return Bn(dn(t)),no(s,t,n,i)}else{const r=Tr(e)?"axis":qr(e)?"legend":Or(e)?"header":null;if(r&&e[r]){const o=e[r],{format:s,formatType:a}=o,u=A(o,["format","formatType"]);if(ir(a)&&!n.customFormatTypes)return Bn(dn(t)),no(Object.assign(Object.assign({},e),{[r]:u}),t,n,i)}}return Sr(e)?io(e,t,i):function(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=x(n)?"quantitative":O(n)?"nominal":_n(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}(e)}function io(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:o,field:s}=e,a=Object.assign({},e);if(n||!i||Je(i)||Ve(i)||Ge(i)||(Bn(function(e){return`Invalid aggregation operator "${e}".`}(i)),delete a.aggregate),r&&(a.timeUnit=Jn(r)),s&&(a.field=""+s),Xt(o)&&(a.bin=ro(o,t)),Qt(o)&&!Nt(t)&&Bn(function(e){return`Channel ${e} should not be used with "binned" bin.`}(t)),Nr(a)){const{type:e}=a,t=function(e){if(e)switch(e=e.toLowerCase()){case"q":case gi:return"quantitative";case"t":case mi:return"temporal";case"o":case pi:return"ordinal";case"n":case hi:return"nominal";case bi:return"geojson"}}(e);e!==t&&(a.type=t),"quantitative"!==e&&Xe(i)&&(Bn(function(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}(e,i)),a.type="quantitative")}else if(!kt(t)){const e=function(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal"}if(Ar(e)&&c(e.sort))return"ordinal";const{aggregate:i,bin:r,timeUnit:o}=e;if(o)return"temporal";if(r||i&&!Ve(i)&&!Ge(i))return"quantitative";if(Mr(e)&&(null===(n=e.scale)||void 0===n?void 0:n.type))switch(Si[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}(a,t);a.type=e}if(Nr(a)){const{compatible:e,warning:n}=function(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Ze:case et:case"facet":return Hr(e)?{compatible:!1,warning:bn(t)}:oo;case tt:case nt:case ut:case lt:case ct:case"text":case"detail":case"key":case"tooltip":case"href":case"url":case"angle":case st:case ot:case"description":return oo;case"longitude":case"longitude2":case"latitude":case"latitude2":return n!==gi?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:oo;case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeWidth":case dt:case at:case"radius2":case it:case rt:return"nominal"!==n||e.sort?oo:{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`};case"strokeDash":return M(["ordinal","nominal"],e.type)?oo:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case ft:return M(["ordinal","nominal","geojson"],e.type)?oo:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case"order":return"nominal"!==e.type||"sort"in e?oo:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(a,t)||{};!1===e&&Bn(n)}if(Ar(a)&&O(a.sort)){const{sort:e}=a;if(hr(e))return Object.assign(Object.assign({},a),{sort:{encoding:e}});const t=e.substr(1);if("-"===e.charAt(0)&&hr(t))return Object.assign(Object.assign({},a),{sort:{encoding:t,order:"descending"}})}if(Or(a)){const{header:e}=a,{orient:t}=e,n=A(e,["orient"]);if(t)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},n),{labelOrient:e.labelOrient||t,titleOrient:e.titleOrient||t})})}return a}function ro(e,t){return y(e)?{maxbins:en(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:en(t)})}const oo={compatible:!0};function so(e){const{formatType:t}=Kr(e);return"time"===t||!t&&((n=e)&&("temporal"===n.type||Sr(n)&&!!n.timeUnit));var n}function ao(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var o;const s=t&&(null===(o=Jn(t))||void 0===o?void 0:o.unit);let a,u=s||"temporal"===n;return Yn(e)?a=e.signal:_n(e)?(u=!0,a=Tn(e)):(O(e)||x(e))&&u&&(a=`datetime(${JSON.stringify(e)})`,function(e){return!!qn[e]}(s)&&(x(e)&&e<1e4||O(e)&&isNaN(Date.parse(e)))&&(a=Tn({[s]:e}))),a?i&&u?`time(${a})`:a:r?void 0:JSON.stringify(e)}function uo(e,t){const{type:n}=e;return t.map(t=>{const i=ao(t,{timeUnit:Sr(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==i?{signal:i}:t})}function lo(e,t){return Xt(e.bin)?It(t)&&M(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function co(e){const{anchor:t,frame:n,offset:i,orient:r,color:o,subtitleColor:s,subtitleFont:a,subtitleFontSize:u,subtitleFontStyle:l,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:d}=e,g=A(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},g),o?{fill:o}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),h=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},s?{subtitleColor:s}:{}),a?{subtitleFont:a}:{}),u?{subtitleFontSize:u}:{}),l?{subtitleFontStyle:l}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{});return{titleMarkConfig:p,subtitleMarkConfig:_(p,["align","baseline","dx","dy","limit"]),nonMark:m,subtitle:h}}function fo(e){return O(e)||c(e)&&O(e[0])}function go(e){return Yn(e)?e:void 0!==e?{value:e}:void 0}function po(e){return Yn(e)?e.signal:w(e.value)}function mo(e){return Yn(e)?e.signal:null==e?null:w(e)}function ho(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}function bo(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:o}=i;return r&&void 0!==t[r]?t[r]:void 0!==t[e]?t[e]:!o||r&&r!==e?vo(e,t,n,i):void 0}function vo(e,t,n,{vgChannel:i}={}){return ae(i?yo(e,t,n.style):void 0,yo(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function yo(e,t,n){return xo(e,ho(t),n)}function xo(e,t,n){let i;t=h(t);for(const r of t){const t=n[r];t&&void 0!==t[e]&&(i=t[e])}return i}function Oo(e,t){return h(e).reduce((e,n)=>{var i;return e.field.push(Wr(n,t)),e.order.push(null!==(i=n.sort)&&void 0!==i?i:"ascending"),e},{field:[],order:[]})}function wo(e,t){const n=[...e];return t.forEach(e=>{for(const t of n)if($(t,e))return;n.push(e)}),n}function jo(e,t){return $(e,t)||!t?e:e?[...h(e),...h(t)].join(", "):t}function Ao(e,t){const n=e.value,i=t.value;if(null==n||null===i)return{explicit:e.explicit,value:null};if((fo(n)||Yn(n))&&(fo(i)||Yn(i)))return{explicit:e.explicit,value:jo(n,i)};if(fo(n)||Yn(n))return{explicit:e.explicit,value:n};if(fo(i)||Yn(i))return{explicit:e.explicit,value:i};if(!(fo(n)||Yn(n)||fo(i)||Yn(i)))return{explicit:e.explicit,value:wo(n,i)};throw new Error("It should never reach here")}function Do(e,t){const n=e&&e[t];return!!n&&(c(n)?T(n,e=>!!e.field):Sr(n)||Cr(n))}function Fo(e){return T(wt,t=>{if(Do(e,t)){const n=e[t];if(c(n))return T(n,e=>!!e.aggregate);{const e=Zr(n);return e&&!!e.aggregate}}return!1})}function ko(e,t){const n=[],i=[],r=[],o=[],s={};return So(e,(a,u)=>{if(Sr(a)){const{field:l,aggregate:c,bin:f,timeUnit:d}=a,g=A(a,["field","aggregate","bin","timeUnit"]);if(c||d||f){const e=Xr(a),p=e&&e.title;let m=Wr(a,{forAs:!0});const h=Object.assign(Object.assign(Object.assign({},p?[]:{title:Yr(a,t,{allowDisabling:!0})}),g),{field:m});if(c){let e;if(Ve(c)?(e="argmax",m=Wr({op:"argmax",field:c.argmax},{forAs:!0}),h.field=`${m}.${l}`):Ge(c)?(e="argmin",m=Wr({op:"argmin",field:c.argmin},{forAs:!0}),h.field=`${m}.${l}`):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(e=c),e){const t={op:e,as:m};l&&(t.field=l),o.push(t)}}else if(n.push(m),Nr(a)&&Xt(f)){if(i.push({bin:f,field:l,as:m}),n.push(Wr(a,{binSuffix:"end"})),lo(a,u)&&n.push(Wr(a,{binSuffix:"range"})),Nt(u)){const e={field:m+"_end"};s[u+"2"]=e}h.bin="binned",kt(u)||(h.type=gi)}else if(d){r.push({timeUnit:d,field:l,as:m});const e=Nr(a)&&a.type!==mi&&"time";e&&("text"===u||"tooltip"===u?h.formatType=e:!function(e){return!!Bt[e]}(u)?Nt(u)&&(h.axis=Object.assign({formatType:e},h.axis)):h.legend=Object.assign({formatType:e},h.legend))}s[u]=h}else n.push(l),s[u]=e[u]}else s[u]=e[u]}),{bins:i,timeUnits:r,aggregate:o,groupby:n,encoding:s}}function Co(e,t,n,i){return V(e).reduce((r,o)=>{if(!Dt(o))return Bn(function(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}(o)),r;const s=e[o];if("angle"!==o||"arc"!==t||e.theta||(Bn("Arc marks uses theta channel rather than angle, replacing angle with theta."),o=st),!function(e,t,n){const i=Ht(t,n);if(!i)return!1;if("binned"===i){const n=e[t===it?tt:nt];return!!(Sr(n)&&Sr(e[t])&&Qt(n.bin))}return!0}(e,o,t))return Bn(hn(o,t)),r;if(o===dt&&"line"===t){const t=Zr(e[o]);if(null==t?void 0:t.aggregate)return Bn("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),r}if(o===ut&&(n?"fill"in e:"stroke"in e))return Bn(pn("encoding",{fill:"fill"in e,stroke:"stroke"in e})),r;if("detail"===o||"order"===o&&!c(s)&&!Lr(s)||"tooltip"===o&&c(s))s&&(r[o]=h(s).reduce((e,t)=>(Sr(t)?e.push(io(t,o)):Bn(mn(t,o)),e),[]));else{if("tooltip"===o&&null===s)r[o]=null;else if(!(Sr(s)||Br(s)||Lr(s)||kr(s)||Yn(s)))return Bn(mn(s,o)),r;r[o]=to(s,o,i)}return r},{})}function Eo(e,t){return V(e).reduce((n,i)=>{const r=to(e[i],i,t,{compositeMark:!0});return n[i]=r,n},{})}function So(e,t,n){if(e)for(const i of V(e)){const r=e[i];if(c(r))for(const e of r)t.call(n,e,i);else t.call(n,r,i)}}function $o(e,t,n,i){return e?V(e).reduce((n,r)=>{const o=e[r];return c(o)?o.reduce((e,n)=>t.call(i,e,n,r),n):t.call(i,n,o,r)},n):n}function Bo(e,t){return V(t).reduce((n,i)=>{switch(i){case tt:case nt:case"href":case"description":case"url":case it:case rt:case st:case at:case ot:case"radius2":case"latitude":case"longitude":case"latitude2":case"longitude2":case"text":case ft:case"angle":case"tooltip":return n;case"order":if("line"===e||"trail"===e)return n;case"detail":case"key":{const e=t[i];if(c(e)||Sr(e))for(const t of h(e))t.aggregate||n.push(Wr(t,{}));return n}case dt:if("trail"===e)return n;case ut:case lt:case ct:case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeDash":case"strokeWidth":{const e=Zr(t[i]);return e&&!e.aggregate&&n.push(Wr(e,{})),n}}},[])}function _o(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};return{tooltip:[...e.map(({fieldPrefix:e,titlePrefix:n})=>{const r=i?" of "+zo(t):"";return{field:e+t.field,type:t.type,title:Yn(n)?{signal:n+`"${escape(r)}"`}:n+r}}),...U(function(e){const t=[];for(const n of V(e))if(Do(e,n)){const i=h(e[n]);for(const e of i)Sr(e)?t.push(e):Cr(e)&&t.push(e.condition)}return t}(n).map(Ur),N)]}}function zo(e){const{title:t,field:n}=e;return ae(t,n)}function Po(e,t,n,i,r){const{scale:o,axis:s}=n;return({partName:a,mark:u,positionPrefix:l,endPositionPrefix:c,extraEncoding:f={}})=>{const d=zo(n);return No(e,a,r,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:l+"_"+n.field,type:n.type},void 0!==d?{title:d}:{}),void 0!==o?{scale:o}:{}),void 0!==s?{axis:s}:{})},O(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),i),f)})}}function No(e,t,n,i){const{clip:r,color:o,opacity:s}=e,a=e.type;return e[t]||void 0===e[t]&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),r?{clip:r}:{}),o?{color:o}:{}),s?{opacity:s}:{}),Ne(i.mark)?i.mark:{type:i.mark}),{style:`${a}-${t}`}),y(e[t])?{}:e[t])})]:[]}function Lo(e,t,n){const{encoding:i}=e,r="vertical"===t?"y":"x",o=i[r],s=i[r+"2"],a=i[r+"Error"],u=i[r+"Error2"];return{continuousAxisChannelDef:Mo(o,n),continuousAxisChannelDef2:Mo(s,n),continuousAxisChannelDefError:Mo(a,n),continuousAxisChannelDefError2:Mo(u,n),continuousAxis:r}}function Mo(e,t){if(e&&e.aggregate){const{aggregate:n}=e,i=A(e,["aggregate"]);return n!==t&&Bn(function(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}(n,t)),i}return e}function To(e,t){const{mark:n,encoding:i}=e,{x:r,y:o}=i;if(Ne(n)&&n.orient)return n.orient;if(_r(r)){if(_r(o)){const e=Sr(r)&&r.aggregate,n=Sr(o)&&o.aggregate;if(e||n!==t){if(n||e!==t){if(e===t&&n===t)throw new Error("Both x and y cannot have aggregate");return so(o)&&!so(r)?"horizontal":"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(_r(o))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}const qo=new We("boxplot",Uo);function Ro(e){return x(e)?"tukey":e}function Uo(e,{config:t}){var n,i;e=Object.assign(Object.assign({},e),{encoding:Eo(e.encoding,t)});const{mark:r,encoding:o,selection:s,projection:a}=e,u=A(e,["mark","encoding","selection","projection"]),l=Ne(r)?r:{type:r};s&&Bn(ln("boxplot"));const d=null!==(n=l.extent)&&void 0!==n?n:t.boxplot.extent,g=bo("size",l,t),p=Ro(d),{bins:m,timeUnits:h,transform:b,continuousAxisChannelDef:v,continuousAxis:y,groupby:x,aggregate:O,encodingWithoutContinuousAxis:w,ticksOrient:j,boxOrient:D,customTooltipWithoutAggregatedField:F}=function(e,t,n){const i=To(e,"boxplot"),{continuousAxisChannelDef:r,continuousAxis:o}=Lo(e,i,"boxplot"),s=r.field,a=Ro(t),u=[...Wo(s),{op:"median",field:s,as:"mid_box_"+s},{op:"min",field:s,as:("min-max"===a?"lower_whisker_":"min_")+s},{op:"max",field:s,as:("min-max"===a?"upper_whisker_":"max_")+s}],l="min-max"===a||"tukey"===a?[]:[{calculate:`datum["upper_box_${s}"] - datum["lower_box_${s}"]`,as:"iqr_"+s},{calculate:`min(datum["upper_box_${s}"] + datum["iqr_${s}"] * ${t}, datum["max_${s}"])`,as:"upper_whisker_"+s},{calculate:`max(datum["lower_box_${s}"] - datum["iqr_${s}"] * ${t}, datum["min_${s}"])`,as:"lower_whisker_"+s}],f=e.encoding,d=o,g=(f[d],A(f,["symbol"==typeof d?d:d+""])),{customTooltipWithoutAggregatedField:p,filteredEncoding:m}=function(e){const{tooltip:t}=e,n=A(e,["tooltip"]);if(!t)return{filteredEncoding:n};let i,r;if(c(t)){for(const e of t)e.aggregate?(i||(i=[]),i.push(e)):(r||(r=[]),r.push(e));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return c(r)&&1===r.length&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}(g),{bins:h,timeUnits:b,aggregate:v,groupby:y,encoding:x}=ko(m,n),O="vertical"===i?"horizontal":"vertical",w=i,j=[...h,...b,{aggregate:[...v,...u],groupby:y},...l];return{bins:h,timeUnits:b,transform:j,groupby:y,aggregate:v,continuousAxisChannelDef:r,continuousAxis:o,encodingWithoutContinuousAxis:x,ticksOrient:O,boxOrient:w,customTooltipWithoutAggregatedField:p}}(e,d,t),{color:k,size:C}=w,E=A(w,["color","size"]),S=e=>Po(l,y,v,e,t.boxplot),$=S(E),B=S(w),_=S(Object.assign(Object.assign({},E),C?{size:C}:{})),P=_o([{fieldPrefix:"min-max"===p?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===p?"lower_whisker_":"min_",titlePrefix:"Min"}],v,w),N={type:"tick",color:"black",opacity:1,orient:j,invalid:null,aria:!1},L="min-max"===p?P:_o([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],v,w),M=[...$({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:L}),...$({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:L}),...$({partName:"ticks",mark:N,positionPrefix:"lower_whisker",extraEncoding:L}),...$({partName:"ticks",mark:N,positionPrefix:"upper_whisker",extraEncoding:L})],T=[..."tukey"!==p?M:[],...B({partName:"box",mark:Object.assign(Object.assign({type:"bar"},g?{size:g}:{}),{orient:D,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:P}),..._({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},f(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),g?{size:g}:{}),{orient:j,aria:!1}),positionPrefix:"mid_box",extraEncoding:P})];if("min-max"===p)return Object.assign(Object.assign({},u),{transform:(null!==(i=u.transform)&&void 0!==i?i:[]).concat(b),layer:T});const q=`datum["lower_box_${v.field}"]`,R=`datum["upper_box_${v.field}"]`,U=`(${R} - ${q})`,W=`${q} - ${d} * ${U}`,I=`${R} + ${d} * ${U}`,H=`datum["${v.field}"]`,V={joinaggregate:Wo(v.field),groupby:x},J={transform:[{filter:`(${W} <= ${H}) && (${H} <= ${I})`},{aggregate:[{op:"min",field:v.field,as:"lower_whisker_"+v.field},{op:"max",field:v.field,as:"upper_whisker_"+v.field},{op:"min",field:"lower_box_"+v.field,as:"lower_box_"+v.field},{op:"max",field:"upper_box_"+v.field,as:"upper_box_"+v.field},...O],groupby:x}],layer:M},Y=A(E,["tooltip"]),{scale:X,axis:Q}=v,K=zo(v),Z=z(Q,["title"]),ee=No(l,"outliers",t.boxplot,{transform:[{filter:`(${H} < ${W}) || (${H} > ${I})`}],mark:"point",encoding:Object.assign(Object.assign({[y]:Object.assign(Object.assign(Object.assign({field:v.field,type:v.type},void 0!==K?{title:K}:{}),void 0!==X?{scale:X}:{}),G(Z)?{}:{axis:Z})},Y),F?{tooltip:F}:{})})[0];let te;const ne=[...m,...h,V];return ee?te={transform:ne,layer:[ee,J]}:(te=J,te.transform.unshift(...ne)),Object.assign(Object.assign({},u),{layer:[te,{transform:b,layer:T}]})}function Wo(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}const Io=new We("errorbar",Ho);function Ho(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:Eo(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:o,ticksOrient:s,markDef:a,outerSpec:u,tooltipEncoding:l}=Vo(e,"errorbar",t);delete o.size;const c=Po(a,r,i,o,t.errorbar),f=a.thickness,d=a.size,g=Object.assign(Object.assign({type:"tick",orient:s,aria:!1},void 0!==f?{thickness:f}:{}),void 0!==d?{size:d}:{}),p=[...c({partName:"ticks",mark:g,positionPrefix:"lower",extraEncoding:l}),...c({partName:"ticks",mark:g,positionPrefix:"upper",extraEncoding:l}),...c({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},void 0!==f?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function Go(e,t){const{encoding:n}=e;if(function(e){return(Pr(e.x)||Pr(e.y))&&!Pr(e.x2)&&!Pr(e.y2)&&!Pr(e.xError)&&!Pr(e.xError2)&&!Pr(e.yError)&&!Pr(e.yError2)}(n))return{orient:To(e,t),inputType:"raw"};const i=function(e){return Pr(e.x2)||Pr(e.y2)}(n),r=function(e){return Pr(e.xError)||Pr(e.xError2)||Pr(e.yError)||Pr(e.yError2)}(n),o=n.x,s=n.y;if(i){if(r)throw new Error(t+" cannot be both type aggregated-upper-lower and aggregated-error");const e=n.x2,i=n.y2;if(Pr(e)&&Pr(i))throw new Error(t+" cannot have both x2 and y2");if(Pr(e)){if(_r(o))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error("Both x and x2 have to be quantitative in "+t)}if(Pr(i)){if(_r(s))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error("Both y and y2 have to be quantitative in "+t)}throw new Error("No ranged axis")}{const e=n.xError,i=n.xError2,r=n.yError,a=n.yError2;if(Pr(i)&&!Pr(e))throw new Error(t+" cannot have xError2 without xError");if(Pr(a)&&!Pr(r))throw new Error(t+" cannot have yError2 without yError");if(Pr(e)&&Pr(r))throw new Error(t+" cannot have both xError and yError with both are quantiative");if(Pr(e)){if(_r(o))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(Pr(r)){if(_r(s))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function Vo(e,t,n){var i;const{mark:r,encoding:o,selection:s,projection:a}=e,u=A(e,["mark","encoding","selection","projection"]),l=Ne(r)?r:{type:r};s&&Bn(ln(t));const{orient:c,inputType:f}=Go(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:g,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:h}=Lo(e,c,t),{errorBarSpecificAggregate:b,postAggregateCalculates:v,tooltipSummary:y,tooltipTitleWithFieldName:x}=function(e,t,n,i,r,o,s,a){let u=[],l=[];const c=t.field;let f,d=!1;if("raw"===o){const t=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":a.errorbar.center,n=e.extent?e.extent:"mean"===t?"stderr":"iqr";if("median"===t!=("iqr"===n)&&Bn(function(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}(t,n,s)),"stderr"===n||"stdev"===n)u=[{op:n,field:c,as:"extent_"+c},{op:t,field:c,as:"center_"+c}],l=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:ee(t)},{fieldPrefix:"upper_",titlePrefix:Jo(t,n,"+")},{fieldPrefix:"lower_",titlePrefix:Jo(t,n,"-")}],d=!0;else{let e,t,i;"ci"===n?(e="mean",t="ci0",i="ci1"):(e="median",t="q1",i="q3"),u=[{op:t,field:c,as:"lower_"+c},{op:i,field:c,as:"upper_"+c},{op:e,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:Yr({field:c,aggregate:i,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:Yr({field:c,aggregate:t,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:Yr({field:c,aggregate:e,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&Bn((g=e.center,`${(p=e.extent)?"extent ":""}${p&&g?"and ":""}${g?"center ":""}${p&&g?"are ":"is "}not needed when data are aggregated.`)),"aggregated-upper-lower"===o?(f=[],l=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):"aggregated-error"===o&&(f=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:"upper_"+c}],r?l.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:"lower_"+c}):l.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:"lower_"+c}));for(const e of l)f.push({fieldPrefix:e.as.substring(0,6),titlePrefix:re(re(e.calculate,'datum["',""),'"]',"")})}var g,p;return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:d}}(l,d,g,p,m,f,t,n),O=o,w=h,j=(O[w],"x"===h?"x2":"y2"),D=(O[j],"x"===h?"xError":"yError"),F=(O[D],"x"===h?"xError2":"yError2"),k=(O[F],A(O,["symbol"==typeof w?w:w+"","symbol"==typeof j?j:j+"","symbol"==typeof D?D:D+"","symbol"==typeof F?F:F+""])),{bins:C,timeUnits:E,aggregate:S,groupby:$,encoding:B}=ko(k,n),_=[...S,...b],z="raw"!==f?[]:$,P=_o(y,d,B,x);return{transform:[...null!==(i=u.transform)&&void 0!==i?i:[],...C,...E,...0===_.length?[]:[{aggregate:_,groupby:z}],...v],groupby:z,continuousAxisChannelDef:d,continuousAxis:h,encodingWithoutContinuousAxis:B,ticksOrient:"vertical"===c?"horizontal":"vertical",markDef:l,outerSpec:u,tooltipEncoding:P}}function Jo(e,t,n){return ee(e)+" "+n+" "+t}const Yo=new We("errorband",Xo);function Xo(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:Eo(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:o,markDef:s,outerSpec:a,tooltipEncoding:u}=Vo(e,"errorband",t),l=s,c=Po(l,r,i,o,t.errorband),f=void 0!==e.encoding.x&&void 0!==e.encoding.y;let d={type:f?"area":"rect"},g={type:f?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),g=Object.assign(Object.assign(Object.assign({},g),p),{aria:!1})):l.interpolate?Bn(Fn("interpolate")):l.tension&&Bn(Fn("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:g,positionPrefix:"lower",extraEncoding:u}),...c({partName:"borders",mark:g,positionPrefix:"upper",extraEncoding:u})]})}const Qo={};function Ko(e,t,n){const i=new We(e,t);Qo[e]={normalizer:i,parts:n}}Ko("boxplot",Uo,["box","median","outliers","rule","ticks"]),Ko("errorbar",Ho,["ticks","rule"]),Ko("errorband",Xo,["band","borders"]);const Zo=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],es=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],ts={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},ns={single:{on:"click",fields:["_vgsid_"],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:["_vgsid_"],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function is(e){return!(!e||"legend"!==e&&!e.legend)}function rs(e){return is(e)&&f(e)}function os(e){return"concat"in e}function ss(e){return"vconcat"in e}function as(e){return"hconcat"in e}function us(e){return f(e)&&void 0!==e.step}function ls(e){return e.view||e.width||e.height}const cs=V({align:1,bounds:1,center:1,columns:1,spacing:1});function fs(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e["width"===t?"continuousWidth":"continuousHeight"]}function ds(e,t){const n=gs(e,t);return us(n)?n.step:ps}function gs(e,t){var n;return ae(null!==(n=e[t])&&void 0!==n?n:e["width"===t?"discreteWidth":"discreteHeight"],{step:e.step})}const ps=20,ms={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:ps},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:qe,circle:{},geoshape:{},image:{},line:{},point:{},rect:Re,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:ns,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},hs=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],bs={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},vs={blue:hs[0],orange:hs[1],red:hs[2],teal:hs[3],green:hs[4],yellow:hs[5],purple:hs[6],pink:hs[7],brown:hs[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function ys(e={}){const{color:t,font:n,fontSize:i}=e,r=A(e,["color","font","fontSize"]);return g({},ms,n?function(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}(n):{},t?function(e={}){return{signals:[{name:"color",value:f(e)?Object.assign(Object.assign({},vs),e):vs}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},i?function(e){return{signals:[{name:"fontSize",value:f(e)?Object.assign(Object.assign({},bs),e):bs}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(i):{},r||{})}const xs=["view",...Pe],Os=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],ws=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function js(e){e=B(e);for(const t of Os)delete e[t];if(e.axis)for(const t in e.axis)de(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of Zo)delete e.legend[t];if(e.mark){for(const t of Me)delete e.mark[t];e.mark.tooltip&&f(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of xs){for(const n of Me)delete e[t][n];const n=ws[t];if(n)for(const i of n)delete e[t][i];As(e,t)}for(const t of V(Qo))delete e[t];!function(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=co(e.title);G(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t));G(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n));G(i)?delete e.title:e.title=i}(e);for(const t in e)f(e[t])&&G(e[t])&&delete e[t];return G(e)?void 0:e}function As(e,t,n,i){const r=i?e[t][i]:e[t];"view"===t&&(n="cell");const o=Object.assign(Object.assign({},r),e.style[null!=n?n:t]);G(o)||(e.style[null!=n?n:t]=o),i||delete e[t]}function Ds(e){return"layer"in e}const Fs={zero:1,center:1,normalize:1};const ks=new Set([ye,Oe,xe,Fe,Ae,Se,$e,je,ke,Ce]),Cs=new Set([Oe,xe,ye]);function Es(e,t){var n,i;const r="x"===t?"y":"radius",o=e[t],s=e[r];if(Sr(o)&&Sr(s))if("quantitative"===$r(o)&&"quantitative"===$r(s)){if(o.stack)return t;if(s.stack)return r;const e=Sr(o)&&!!o.aggregate;if(e!==(Sr(s)&&!!s.aggregate))return e?t:r;{const e=null===(n=o.scale)||void 0===n?void 0:n.type,a=null===(i=s.scale)||void 0===i?void 0:i.type;if(e&&"linear"!==e)return r;if(a&&"linear"!==a)return t}}else{if("quantitative"===$r(o))return t;if("quantitative"===$r(s))return r}else{if("quantitative"===$r(o))return t;if("quantitative"===$r(s))return r}}function Ss(e,t,n={}){const i=Ne(e)?e.type:e;if(!ks.has(i))return null;const r=Es(t,"x")||Es(t,"theta");if(!r)return null;const o=t[r],s=Sr(o)?Wr(o,{}):void 0;let a=function(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(r),u=t[a],l=Sr(u)?Wr(u,{}):void 0;l===s&&(l=void 0,u=void 0,a=void 0);const c=_t.reduce((e,n)=>{if("tooltip"!==n&&Do(t,n)){const i=t[n];for(const t of h(i)){const i=Zr(t);if(i.aggregate)continue;const r=Wr(i,{});r&&r===l||e.push({channel:n,fieldDef:i})}}return e},[]);let f;if(void 0!==o.stack?f=y(o.stack)?o.stack?"zero":null:o.stack:c.length>0&&Cs.has(i)&&(f="zero"),!f||!(f in Fs))return null;var d;if(Fo(t)&&0===c.length)return null;if(o.scale&&o.scale.type&&o.scale.type!==vi){if(n.disallowNonLinearStack)return null;Bn(function(e){return`Cannot stack non-linear scale (${e}).`}(o.scale.type))}return Pr(t[St(r)])?(void 0!==o.stack&&Bn(`Cannot stack "${d=r}" if there is already "${d}2".`),null):(Sr(o)&&o.aggregate&&!M(Qe,o.aggregate)&&Bn(`Stacking is applied even though the aggregate function is non-summative ("${o.aggregate}").`),{groupbyChannel:u?a:void 0,groupbyField:l,fieldChannel:r,impute:null!==o.impute&&_e(i),stackBy:c,offset:f})}function $s(e){const t=A(e,["point","line"]);return V(t).length>1?t:t.type}function Bs(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:z(e[t],["point","line"])}));return e}function _s(e,t={},n){return"transparent"===e.point?{opacity:0}:e.point?f(e.point)?e.point:{}:void 0!==e.point?null:t.point||n.shape?f(t.point)?t.point:{}:void 0}function zs(e,t={}){return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:void 0}class Ps{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(Ue(e)){const{mark:n,encoding:i}=e,r=Ne(n)?n:{type:n};switch(r.type){case"line":case"rule":case"trail":return!!_s(r,t[r.type],i);case"area":return!!_s(r,t[r.type],i)||!!zs(r,t[r.type])}}return!1}run(e,t,n){const{config:i}=t,{selection:r,projection:o,mark:s,encoding:a}=e,u=A(e,["selection","projection","mark","encoding"]),l=Eo(a,i),c=Ne(s)?s:{type:s},f=_s(c,i[c.type],l),d="area"===c.type&&zs(c,i[c.type]),g=[Object.assign(Object.assign({},r?{selection:r}:{}),{mark:$s(Object.assign(Object.assign({},"area"===c.type&&void 0===c.opacity&&void 0===c.fillOpacity?{opacity:.7}:{}),c)),encoding:z(l,["shape"])})],p=Ss(c,l);let m=l;if(p){const{fieldChannel:e,offset:t}=p;m=Object.assign(Object.assign({},l),{[e]:Object.assign(Object.assign({},l[e]),t?{stack:t}:{})})}return d&&g.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},_(c,["clip","interpolate","tension","tooltip"])),d),encoding:m})),f&&g.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},_(c,["clip","tooltip"])),f),encoding:m})),n(Object.assign(Object.assign({},u),{layer:g}),Object.assign(Object.assign({},t),{config:Bs(i)}))}}class Ns{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(Ue(e)&&e.encoding)for(const n of Pt){const i=e.encoding[n];if(i&&Pr(i)&&(null===(t=null==i?void 0:i.scale)||void 0===t?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let i=Object.assign({},e.encoding);for(const e of Pt){const r=$t(e),o=i[e];if(o&&Pr(o)&&(null===(t=null==o?void 0:o.scale)||void 0===t?void 0:t.rangeStep)){const{scale:t}=o,s=A(o,["scale"]),a=A(t,["rangeStep"]);n[r]={step:t.rangeStep},Bn('Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.'),i=Object.assign(Object.assign({},i),{[e]:Object.assign(Object.assign({},s),G(a)?{}:{scale:a})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:i})}}function Ls(e,t){return t?xr(e)?Ws(e,t):qs(e,t):e}function Ms(e,t){return t?Ws(e,t):e}function Ts(e,t,n){const i=t[e];return function(e){return e&&!O(e)&&"repeat"in e}(i)?i.repeat in n?Object.assign(Object.assign({},t),{[e]:n[i.repeat]}):void Bn(function(e){return`Unknown repeated value "${e}".`}(i.repeat)):t}function qs(e,t){if(void 0!==(e=Ts("field",e,t))){if(null===e)return null;if(Ar(e)&&vr(e.sort)){const n=Ts("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function Rs(e,t){if(Sr(e))return qs(e,t);{const n=Ts("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function Us(e,t){if(!Pr(e)){if(Er(e)){const n=Rs(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});return A(e,["condition"])}return e}{const n=Rs(e,t);if(n)return n;if(kr(e))return{condition:e.condition}}}function Ws(e,t){const n={};for(const i in e)if(v(e,i)){const r=e[i];if(c(r))n[i]=r.map(e=>Us(e,t)).filter(e=>e);else{const e=Us(r,t);void 0!==e&&(n[i]=e)}}return n}class Is{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(Ue(e)){const{encoding:t,mark:n}=e;if("line"===n)for(const e of Ft){const n=t[Ct(e)];if(t[e]&&(Sr(n)&&!Qt(n.bin)||Br(n)))return!0}}return!1}run(e,t,n){const{encoding:i}=e;var r,o;return Bn((r=!!i.x2,o=!!i.y2,`Line mark is for continuous lines and thus cannot be used with ${r&&o?"x2 and y2":r?"x2":"y2"}. We will use the rule mark (line segments) instead.`)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}function Hs({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...V(e),...V(t)]);for(const o of r){const r=t[o],s=e[o];if(Pr(r)){const e=Object.assign(Object.assign({},s),r);i[o]=e}else Er(r)?i[o]=Object.assign(Object.assign({},r),{condition:Object.assign(Object.assign({},s),r.condition)}):r||null===r?i[o]=r:(n||Lr(s)||Yn(s)||Pr(s)||c(s))&&(i[o]=s)}}else i=t;return!i||G(i)?void 0:i}function Gs(e){const{parentProjection:t,projection:n}=e;return t&&n&&Bn(function(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${P(t)} is overridden by a child projection ${P(n)}.`}({parentProjection:t,projection:n})),null!=n?n:t}function Vs(e,t){void 0===t&&(t=ys(e.config));const n=function(e,t={}){return Js.map(e,{config:t})}(e,t),{width:i,height:r}=e,o=function(e,t,n){let{width:i,height:r}=t;const o=Ue(e)||Ds(e),s={};o?"container"==i&&"container"==r?(s.type="fit",s.contains="padding"):"container"==i?(s.type="fit-x",s.contains="padding"):"container"==r&&(s.type="fit-y",s.contains="padding"):("container"==i&&(Bn(nn("width")),i=void 0),"container"==r&&(Bn(nn("height")),r=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},s),n?Ys(n.autosize):{}),Ys(e.autosize));"fit"!==a.type||o||(Bn('Autosize "fit" only works for single views and layered views.'),a.type="pad");"container"==i&&"fit"!=a.type&&"fit-x"!=a.type&&Bn(rn("width"));"container"==r&&"fit"!=a.type&&"fit-y"!=a.type&&Bn(rn("height"));if($(a,{type:"pad"}))return;return a}(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),o?{autosize:o}:{})}const Js=new class extends class{map(e,t){return wr(e)?this.mapFacet(e,t):function(e){return"repeat"in e}(e)?this.mapRepeat(e,t):as(e)?this.mapHConcat(e,t):ss(e)?this.mapVConcat(e,t):os(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(Ds(e))return this.mapLayer(e,t);if(Ue(e))return this.mapUnit(e,t);throw new Error(tn(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map(e=>this.mapLayerOrUnit(e,t))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map(e=>this.map(e,t))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map(e=>this.map(e,t))})}mapConcat(e,t){const{concat:n}=e,i=A(e,["concat"]);return Object.assign(Object.assign({},i),{concat:n.map(e=>this.map(e,t))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[qo,Io,Yo,new Ps,new Is,new Ns]}map(e,t){if(Ue(e)){const n=Do(e.encoding,Ze),i=Do(e.encoding,et),r=Do(e.encoding,"facet");if(n||i||r)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:i}=t,r=Ms(e.encoding,t.repeater),o=Object.assign(Object.assign({},e),r?{encoding:r}:{});if(n||i)return this.mapUnitWithParentEncodingOrProjection(o,t);const s=this.mapLayerOrUnit.bind(this);for(const e of this.nonFacetUnitNormalizers)if(e.hasMatchingType(o,t.config))return e.run(o,t,s);return o}mapRepeat(e,t){return function(e){return!c(e.repeat)&&e.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:i}=e,r=A(e,["repeat","spec"]),{row:o,column:s,layer:a}=n,{repeater:u={},repeaterPrefix:l=""}=t;return o||s?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),s?{column:s}:{}),spec:{repeat:{layer:a},spec:i}}),t):Object.assign(Object.assign({},r),{layer:a.map(e=>{const n=Object.assign(Object.assign({},u),{layer:e}),r=(i.name||"")+l+"child__layer_"+Q(e),o=this.mapLayerOrUnit(i,Object.assign(Object.assign({},t),{repeater:n,repeaterPrefix:r}));return o.name=r,o})})}mapNonLayerRepeat(e,t){var n;const{repeat:i,spec:r,data:o}=e,s=A(e,["repeat","spec","data"]);!c(i)&&e.columns&&(e=z(e,["columns"]),Bn(cn("repeat")));const a=[],{repeater:u={},repeaterPrefix:l=""}=t,f=!c(i)&&i.row||[u?u.row:null],d=!c(i)&&i.column||[u?u.column:null],g=c(i)&&i||[u?u.repeat:null];for(const e of g)for(const n of f)for(const o of d){const s={repeat:e,row:n,column:o,layer:u.layer},f=(r.name||"")+l+"child__"+(c(i)?""+Q(e):(i.row?"row_"+Q(n):"")+(i.column?"column_"+Q(o):"")),d=this.map(r,Object.assign(Object.assign({},t),{repeater:s,repeaterPrefix:f}));d.name=f,a.push(z(d,["data"]))}const p=c(i)?e.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:null!==(n=r.data)&&void 0!==n?n:o,align:"all"},s),{columns:p,concat:a})}mapFacet(e,t){const{facet:n}=e;return xr(n)&&e.columns&&(e=z(e,["columns"]),Bn(cn("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:i}=e,{parentEncoding:r,parentProjection:o,config:s}=t,a=Gs({parentProjection:o,projection:i}),u=Hs({parentEncoding:r,encoding:Ms(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),a?{projection:a}:{}),u?{encoding:u}:{}),{config:s})}mapFacetedUnit(e,t){const n=e.encoding,{row:i,column:r,facet:o}=n,s=A(n,["row","column","facet"]),{mark:a,width:u,projection:l,height:c,view:f,selection:d,encoding:g}=e,p=A(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:m,layout:h}=this.getFacetMappingAndLayout({row:i,column:r,facet:o},t),b=Ms(s,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),h),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},u?{width:u}:{}),c?{height:c}:{}),f?{view:f}:{}),l?{projection:l}:{}),{mark:a,encoding:b}),d?{selection:d}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:i,column:r,facet:o}=e;if(i||r){o&&Bn(`Facet encoding dropped as ${(s=[...i?[Ze]:[],...r?[et]:[]]).join(" and ")} ${s.length>1?"are":"is"} also specified.`);const t={},a={};for(const i of[Ze,et]){const r=e[i];if(r){const e=A(r,["align","center","spacing","columns"]);t[i]=e;for(const e of["align","center","spacing"])void 0!==r[e]&&(a[e]=null!==(n=a[e])&&void 0!==n?n:{},a[e][i]=r[e])}}return{facetMapping:t,layout:a}}{const{align:e,center:n,spacing:i,columns:r}=o;return{facetMapping:Ls(A(o,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},e?{align:e}:{}),n?{center:n}:{}),i?{spacing:i}:{}),r?{columns:r}:{})}}var s}mapLayer(e,t){var{parentEncoding:n,parentProjection:i}=t,r=A(t,["parentEncoding","parentProjection"]);const{encoding:o,projection:s}=e,a=A(e,["encoding","projection"]),u=Object.assign(Object.assign({},r),{parentEncoding:Hs({parentEncoding:n,encoding:o,layer:!0}),parentProjection:Gs({parentProjection:i,projection:s})});return super.mapLayer(a,u)}};function Ys(e){return O(e)?{type:e}:null!=e?e:{}}const Xs=["background","padding"];function Qs(e){return Xs.reduce((t,n)=>(e&&void 0!==e[n]&&(t[n]=e[n]),t),{})}class Ks{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new Ks(B(this.explicit),B(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return ae(this.explicit[e],this.implicit[e])}getWithExplicit(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){void 0!==t[e]&&this.set(e,t[e],!0)}copyAll(e){for(const t of V(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function Zs(e){return{explicit:!0,value:e}}function ea(e){return{explicit:!1,value:e}}function ta(e){return(t,n,i,r)=>{const o=e(t.value,n.value);return o>0?t:o<0?n:na(t,n,i,r)}}function na(e,t,n,i){return e.explicit&&t.explicit&&Bn(function(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${P(n)} and ${P(i)}). Using ${P(n)}.`}(n,i,e.value,t.value)),e}function ia(e,t,n,i,r=na){return void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:$(e.value,t.value)?e:r(e,t,n,i)}class ra extends Ks{constructor(e={},t={},n=!1){super(e,t),this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function oa(e){return"url"in e}function sa(e){return"values"in e}function aa(e){return"name"in e&&!oa(e)&&!sa(e)&&!ua(e)}function ua(e){return e&&(la(e)||ca(e)||fa(e))}function la(e){return"sequence"in e}function ca(e){return"sphere"in e}function fa(e){return"graticule"in e}var da;function ga(e){return"filter"in e}function pa(e){return"lookup"in e}function ma(e){return"pivot"in e}function ha(e){return"density"in e}function ba(e){return"quantile"in e}function va(e){return"regression"in e}function ya(e){return"loess"in e}function xa(e){return"sample"in e}function Oa(e){return"window"in e}function wa(e){return"joinaggregate"in e}function ja(e){return"flatten"in e}function Aa(e){return"calculate"in e}function Da(e){return"bin"in e}function Fa(e){return"impute"in e}function ka(e){return"timeUnit"in e}function Ca(e){return"aggregate"in e}function Ea(e){return"stack"in e}function Sa(e){return"fold"in e}function $a(e,t,n){return Ba=t||za,_a=n||Na,Ma(e.trim()).map(Ta)}!function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"}(da||(da={}));var Ba,_a,za="view",Pa=/[[\]{}]/,Na={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function La(e,t,n,i,r){for(var o,s=0,a=e.length;t<a;++t){if(o=e[t],!s&&o===n)return t;r&&r.indexOf(o)>=0?--s:i&&i.indexOf(o)>=0&&++s}return t}function Ma(e){for(var t=[],n=0,i=e.length,r=0;r<i;)r=La(e,r,",","[{","]}"),t.push(e.substring(n,r).trim()),n=++r;if(0===t.length)throw"Empty event selector: "+e;return t}function Ta(e){return"["===e[0]?function(e){var t,n,i=e.length,r=1;if((r=La(e,r,"]","[","]"))===i)throw"Empty between selector: "+e;if(2!==(t=Ma(e.substring(1,r))).length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(r+1).trim())[0])throw"Expected '>' after between selector: "+e;if(t=t.map(Ta),(n=Ta(e.slice(1).trim())).between)return{between:t,stream:n};n.between=t;return n}(e):function(e){var t,n,i={source:Ba},r=[],o=[0,0],s=0,a=0,u=e.length,l=0;if("}"===e[u-1]){if(!((l=e.lastIndexOf("{"))>=0))throw"Unmatched right brace: "+e;try{o=function(e){var t=e.split(",");if(!e.length||t.length>2)throw e;return t.map((function(t){var n=+t;if(n!=n)throw e;return n}))}(e.substring(l+1,u-1))}catch(t){throw"Invalid throttle specification: "+e}e=e.slice(0,l).trim(),u=e.length,l=0}if(!u)throw e;"@"===e[0]&&(s=++l);(t=La(e,l,":"))<u&&(r.push(e.substring(a,t).trim()),a=l=++t);if((l=La(e,l,"["))===u)r.push(e.substring(a,u).trim());else if(r.push(e.substring(a,l).trim()),n=[],(a=++l)===u)throw"Unmatched left bracket: "+e;for(;l<u;){if((l=La(e,l,"]"))===u)throw"Unmatched left bracket: "+e;if(n.push(e.substring(a,l).trim()),l<u-1&&"["!==e[++l])throw"Expected left bracket: "+e;a=++l}if(!(u=r.length)||Pa.test(r[u-1]))throw"Invalid event selector: "+e;u>1?(i.type=r[1],s?i.markname=r[0].slice(1):(c=r[0],_a[c]?i.marktype=r[0]:i.source=r[0])):i.type=r[0];var c;"!"===i.type.slice(-1)&&(i.consume=!0,i.type=i.type.slice(0,-1));null!=n&&(i.filter=n);o[0]&&(i.throttle=o[0]);o[1]&&(i.debounce=o[1]);return i}(e)}function qa(e,t,n,i){const r=kr(t)&&t.condition,o=i(t);if(r){return{[n]:[...h(r).map(t=>{const n=i(t),r=function(e){return e.selection}(t)?Xl(e,t.selection):Kl(e,t.test);return Object.assign({test:r},n)}),...void 0!==o?[o]:[]]}}return void 0!==o?{[n]:o}:{}}function Ra(e,t="text"){const n=e.encoding[t];return qa(e,n,t,t=>Ua(t,e.config))}function Ua(e,t,n="datum"){if(e){if(Lr(e))return go(e.value);if(Pr(e)){const{format:i,formatType:r}=Kr(e);return or({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}}function Wa(e,t={}){const{encoding:n,markDef:i,config:r,stack:o}=e,s=n.tooltip;if(c(s))return{tooltip:Ha({tooltip:s},o,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return qa(e,s,"tooltip",e=>{const s=Ua(e,r,a);if(s)return s;if(null===e)return;let u=bo("tooltip",i,r);return!0===u&&(u={content:"encoding"}),O(u)?{value:u}:f(u)?Yn(u)?u:"encoding"===u.content?Ha(n,o,r,t):{signal:a}:void 0})}}function Ia(e,t,n,{reactiveGeom:i}={}){const r={},o=i?"datum.datum":"datum",s=[];function a(i,a){const u=Ct(a),l=Nr(i)?i:Object.assign(Object.assign({},i),{type:e[u].type}),c=h(l.title||Qr(l,n)).join(", ");let f;if(Nt(a)){const i="x"===a?"x2":"y2",s=Zr(e[i]);if(Qt(l.bin)&&s){const e=Wr(l,{expr:o}),t=Wr(s,{expr:o}),{format:a,formatType:u}=Kr(l);f=gr(e,t,a,u,n),r[i]=!0}else if(t&&t.fieldChannel===a&&"normalize"===t.offset){const{format:e,formatType:t}=Kr(l);f=or({fieldOrDatumDef:l,format:e,formatType:t,expr:o,config:n,normalizeStack:!0}).signal}}f=null!=f?f:Ua(l,n,o).signal,s.push({channel:a,key:c,value:f})}So(e,(e,t)=>{Sr(e)?a(e,t):Cr(e)&&a(e.condition,t)});const u={};for(const{channel:e,key:t,value:n}of s)r[e]||u[t]||(u[t]=n);return u}function Ha(e,t,n,{reactiveGeom:i}={}){const r=Y(Ia(e,t,n,{reactiveGeom:i})).map(({key:e,value:t})=>`"${e}": ${t}`);return r.length>0?{signal:`{${r.join(", ")}}`}:void 0}function Ga(e){const{markDef:t,config:n}=e,i=bo("aria",t,n);return!1===i?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),function(e){const{mark:t,markDef:n,config:i}=e;if(!1===i.aria)return{};const r=bo("ariaRoleDescription",n,i);if(null!=r)return{ariaRoleDescription:{value:r}};return t in Zn?{}:{ariaRoleDescription:{value:t}}}(e)),function(e){const{encoding:t,markDef:n,config:i,stack:r}=e,o=t.description;if(o)return qa(e,o,"description",t=>Ua(t,e.config));const s=bo("description",n,i);if(null!=s)return{description:go(s)};if(!1===i.aria)return{};const a=Ia(t,r,i);if(G(a))return;return{description:{signal:Y(a).map(({key:e,value:t},n)=>`"${n>0?"; ":""}${e}: " + (${t})`).join(" + ")}}}(e))}function Va(e,t,n={}){const{markDef:i,encoding:r,config:o}=t,{vgChannel:s}=n;let{defaultRef:a,defaultValue:u}=n;void 0===a&&(u=null!=u?u:bo(e,i,o,{vgChannel:s,ignoreVgConfig:!0}),void 0!==u&&(a=go(u)));const l=r[e];return qa(t,l,null!=s?s:e,n=>tr({channel:e,channelDef:n,markDef:i,config:o,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function Ja(e,t={filled:void 0}){var n,i,r,o;const{markDef:s,encoding:a,config:u}=e,{type:l}=s,c=null!==(n=t.filled)&&void 0!==n?n:bo("filled",s,u),f=M(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,d=null!==(r=null!==(i=bo(!0===c?"color":void 0,s,u,{vgChannel:"fill"}))&&void 0!==i?i:u.mark[!0===c&&"color"])&&void 0!==r?r:f,g=null!==(o=bo(!1===c?"color":void 0,s,u,{vgChannel:"stroke"}))&&void 0!==o?o:u.mark[!1===c&&"color"],p=c?"fill":"stroke",m=Object.assign(Object.assign({},d?{fill:go(d)}:{}),g?{stroke:go(g)}:{});return s.color&&(c?s.fill:s.stroke)&&Bn(pn("property",{fill:"fill"in s,stroke:"stroke"in s})),Object.assign(Object.assign(Object.assign(Object.assign({},m),Va("color",e,{vgChannel:p,defaultValue:c?d:g})),Va("fill",e,{defaultValue:a.fill?d:void 0})),Va("stroke",e,{defaultValue:a.stroke?g:void 0}))}function Ya(e,t){const n=t[function(e){switch(e){case tt:return"xOffset";case nt:return"yOffset";case it:return"x2Offset";case rt:return"y2Offset";case st:return"thetaOffset";case ot:return"radiusOffset";case at:return"theta2Offset";case"radius2":return"radius2Offset"}}(e)];if(n)return n}function Xa(e,t,{defaultPos:n,vgChannel:i,isMidPoint:r}){const{encoding:o,markDef:s,config:a,stack:u}=t,l=o[e],c=o[St(e)],f=t.scaleName(e),d=t.getScaleComponent(e),g=Ya(e,s),p=Qa({model:t,defaultPos:n,channel:e,scaleName:f,scale:d}),m=!l&&Nt(e)&&(o.latitude||o.longitude)?{field:t.getName(e)}:function(e){const{channel:t,channelDef:n,isMidPoint:i,scaleName:r,stack:o,offset:s,markDef:a,config:u}=e;if(Pr(n)&&o&&t===o.fieldChannel){if(Sr(n)){const e=Dr({channel:t,fieldDef:n,isMidPoint:i,markDef:a,stack:o,config:u});if(void 0!==e)return er({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",band:e,offset:s})}return Zi(n,r,{suffix:"end"},{offset:s})}return Yi(e)}({channel:e,channelDef:l,channel2Def:c,markDef:s,config:a,isMidPoint:r,scaleName:f,scale:d,stack:u,offset:g,defaultRef:p});return m?{[i||e]:m}:void 0}function Qa({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:o,config:s}=e;return()=>{const a=Ct(n),u=Et(n),l=bo(n,o,s,{vgChannel:u});if(void 0!==l)return nr(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const e=r.get("type");if(M([yi,ji,Ai],e));else if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}if("zeroOrMin"===t)return"y"===a?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const t=e[$t(n)];return Object.assign(Object.assign({},t),{mult:.5})}}}}const Ka={left:"x",center:"xc",right:"x2"},Za={top:"y",middle:"yc",bottom:"y2"};function eu(e,t,n,i="middle"){if("radius"===e||"theta"===e)return Et(e);const r=bo("x"===e?"align":"baseline",t,n);return"x"===e?Ka[r||("top"===i?"left":"center")]:Za[r||i]}function tu(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?nu(e,t,{defaultPos:n,defaultPos2:i}):Xa(e,t,{defaultPos:n})}function nu(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:o}=t,s=St(e),a=$t(e),u=function(e,t,n){const{encoding:i,mark:r,markDef:o,stack:s,config:a}=e,u=Ct(n),l=$t(n),c=Et(n),f=i[u],d=e.scaleName(u),g=e.getScaleComponent(u),p=Ya(n in i||n in o?n:u,e.markDef);if(!f&&("x2"===n||"y2"===n)&&(i.latitude||i.longitude))return{[c]:{field:e.getName(n)}};const m=function({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:o,scale:s,stack:a,offset:u,defaultRef:l}){if(Pr(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0))return Zi(t,o,{suffix:"start"},{offset:u});return Yi({channel:e,channelDef:n,scaleName:o,scale:s,stack:a,markDef:i,config:r,offset:u,defaultRef:l})}({channel:n,channelDef:f,channel2Def:i[n],markDef:o,config:a,scaleName:d,scale:g,stack:s,offset:p,defaultRef:void 0});if(void 0!==m)return{[c]:m};return iu(n,o)||iu(n,{[n]:yo(n,o,a.style),[l]:yo(l,o,a.style)})||iu(n,a[r])||iu(n,a.mark)||{[c]:Qa({model:e,defaultPos:t,channel:n,scaleName:d,scale:g})()}}(t,i,s),l=u[a]?eu(e,r,o):Et(e);return Object.assign(Object.assign({},Xa(e,t,{defaultPos:n,vgChannel:l})),u)}function iu(e,t){const n=$t(e),i=Et(e);return void 0!==t[i]?{[i]:nr(e,t[i])}:void 0!==t[e]?{[i]:nr(e,t[e])}:t[n]?{[n]:nr(e,t[n])}:void 0}function ru(e,t,n){var i,r,o,s;const{config:a,encoding:u,markDef:l,stack:f}=e,d=St(t),g=$t(t),p=u[t],m=u[d],h=e.getScaleComponent(t),b=h?h.get("type"):void 0,v=e.scaleName(t),y=l.orient,x=null!==(r=null!==(i=u[g])&&void 0!==i?i:u.size)&&void 0!==r?r:bo("size",l,a,{vgChannel:g}),O="bar"===n&&("x"===t?"vertical"===y:"horizontal"===y);if(Sr(p)&&(Xt(p.bin)||Qt(p.bin)||p.timeUnit&&!m)&&!x&&!qi(b)){const n=Dr({channel:t,fieldDef:p,stack:f,markDef:l,config:a}),i=null===(o=e.component.axes[t])||void 0===o?void 0:o[0];return function({fieldDef:e,fieldDef2:t,channel:n,band:i,scaleName:r,markDef:o,spacing:s=0,axisTranslate:a,reverse:u,config:l}){const c=St(n),f=Et(n),d=Et(c),g=Ya(n,o);if(Xt(e.bin)||e.timeUnit)return{[d]:au({channel:n,fieldDef:e,scaleName:r,markDef:o,band:(1-i)/2,offset:su(c,s,u,a,g),config:l}),[f]:au({channel:n,fieldDef:e,scaleName:r,markDef:o,band:1-(1-i)/2,offset:su(n,s,u,a,g),config:l})};if(Qt(e.bin)){const i=Zi(e,r,{},{offset:su(c,s,u,a,g)});if(Sr(t))return{[d]:i,[f]:Zi(t,r,{},{offset:su(n,s,u,a,g)})};if(Kt(e.bin)&&e.bin.step)return{[d]:i,[f]:{signal:`scale("${r}", ${Wr(e,{expr:"datum"})} + ${e.bin.step})`,offset:su(n,s,u,a,g)}}}return void Bn(kn(c))}({fieldDef:p,fieldDef2:m,channel:t,markDef:l,scaleName:v,band:n,axisTranslate:null!==(s=null==i?void 0:i.get("translate"))&&void 0!==s?s:.5,spacing:Nt(t)?bo("binSpacing",l,a):void 0,reverse:h.get("reverse"),config:a})}return(Pr(p)&&qi(b)||O)&&!m?function(e,t,n,i){var r;const{markDef:o,encoding:s,config:a,stack:u}=i,l=o.orient,f=i.scaleName(n),d=i.getScaleComponent(n),g=$t(n),p=St(n),m="horizontal"===l&&"y"===n||"vertical"===l&&"x"===n,h=bo(m?"size":g,o,a,{vgChannel:g});let b;(s.size||void 0!==h)&&(m?b=Va("size",i,{vgChannel:g,defaultValue:h}):Bn(function(e){return`Cannot apply size to non-oriented mark "${e}".`}(o.type)));const v=null!==(r=Pr(t)?Dr({channel:n,fieldDef:t,markDef:o,stack:u,config:a}):void 0)&&void 0!==r?r:1;b=b||{[g]:ou(e,g,f,d,a,v)};const y="band"!==(null==d?void 0:d.get("type"))||!("band"in b[g]),x=eu(n,o,a,y?"middle":"top"),O=Ya(n,o),w=Yi({channel:n,channelDef:t,markDef:o,config:a,scaleName:f,scale:d,stack:u,offset:O,defaultRef:Qa({model:i,defaultPos:"mid",channel:n,scaleName:f,scale:d}),band:y?.5:(1-v)/2});if(g)return Object.assign({[x]:w},b);{const e=Et(p),t=b[g],n=O?Object.assign(Object.assign({},t),{offset:O}):t;return{[x]:w,[e]:c(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:n})]:Object.assign(Object.assign({},w),{offset:n})}}}(n,p,t,e):nu(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function ou(e,t,n,i,r,o){if(i){const t=i.get("type");if("point"===t||"band"===t){if(void 0!==r[e].discreteBandSize)return{value:r[e].discreteBandSize};if(t===Ci){const e=i.get("range");return Xn(e)&&x(e.step)?{value:e.step-2}:{value:ps-2}}return{scale:n,band:o}}return{value:r[e].continuousBandSize}}const s=ds(r.view,t),a=ae(r[e].discreteBandSize,s-2);return void 0!==a?{value:a}:void 0}function su(e,t,n,i,r){if(pt(e))return 0;const o="x"===e||"y2"===e?-t/2:t/2;if(Yn(n)||Yn(r)||Yn(i)){const e=mo(n),t=mo(r),s=mo(i);return{signal:(s?s+" + ":"")+(e?`(${e} ? -1 : 1) * `:"")+(t?`(${t} + ${o})`:o)}}return r=r||0,i+(n?-r-o:+r+o)}function au({channel:e,fieldDef:t,scaleName:n,markDef:i,band:r,offset:o,config:s}){return Xi({fieldDef:t,channel:e,markDef:i,ref:er({scaleName:n,fieldOrDatumDef:t,band:r,offset:o}),config:s})}const uu=new Set(["aria"]);function lu(e,t){const{fill:n,stroke:i}="include"===t.color?Ja(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(e,t){return Kn.reduce((n,i)=>(uu.has(i)||void 0===e[i]||"ignore"===t[i]||(n[i]=go(e[i])),n),{})}(e.markDef,t)),cu(e,"fill",n)),cu(e,"stroke",i)),Va("opacity",e)),Va("fillOpacity",e)),Va("strokeOpacity",e)),Va("strokeWidth",e)),Va("strokeDash",e)),function(e){const{encoding:t,mark:n}=e,i=t.order;return!_e(n)&&Lr(i)?qa(e,i,"zindex",e=>e):{}}(e)),Wa(e)),Ra(e,"href")),Ga(e))}function cu(e,t,n){const{config:i,mark:r,markDef:o}=e;if("hide"===bo("invalid",o,i)&&n&&!_e(r)){const i=function(e,{invalid:t=!1,channels:n}){const i=n.reduce((t,n)=>{const i=e.getScaleComponent(n);if(i){const r=i.get("type"),o=e.vgField(n,{expr:"datum"});o&&Ri(r)&&(t[o]=!0)}return t},{}),r=V(i);if(r.length>0){const e=t?"||":"&&";return r.map(e=>Ki(e,t)).join(` ${e} `)}return}(e,{invalid:!0,channels:Wt});if(i)return{[t]:[{test:i,value:null},...h(n)]}}return n?{[t]:n}:{}}function fu(e){const{config:t,markDef:n}=e;if(bo("invalid",n,t)){const t=function(e,{invalid:t=!1,channels:n}){const i=n.reduce((t,n)=>{const i=e.getScaleComponent(n);if(i){const r=i.get("type"),o=e.vgField(n,{expr:"datum"});o&&Ri(r)&&(t[o]=!0)}return t},{}),r=V(i);if(r.length>0){const e=t?"||":"&&";return r.map(e=>Ki(e,t)).join(` ${e} `)}return}(e,{channels:Pt});if(t)return{defined:{signal:t}}}return{}}function du(e,t){if(void 0!==t)return{[e]:go(t)}}const gu={has:e=>"interval"!==e.type&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName("voronoi")},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,o=e.mark;if(_e(o))return Bn(`The "nearest" transform is not supported for ${o} marks.`),n;const s={name:e.getName("voronoi"),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},Wa(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,u=!1;return n.forEach((t,n)=>{var i;const r=null!==(i=t.name)&&void 0!==i?i:"";r===e.component.mark[0].name?a=n:r.indexOf("voronoi")>=0&&(u=!0)}),u||n.splice(a+1,0,s),n}};class pu{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){this._children.indexOf(e)>-1?Bn("Attempt to add the same child twice."):void 0!==t?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const t of this._children)t.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class mu extends pu{constructor(e,t,n,i){super(e,t),this.type=n,this.refCounts=i,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash="Output "+function(e){const t=++ue;return e?String(e)+t:t}()),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}class hu extends pu{constructor(e,t){super(e),this.formula=t}clone(){return new hu(null,B(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((e,n,i)=>{const{field:r,timeUnit:o}=n,s=Dd(t)?t.encoding[St(i)]:void 0,a=Dd(t)&&Fr(i,n,s,t.stack,t.markDef,t.config);if(o){const t=Wr(n,{forAs:!0});e[N({as:t,field:r,timeUnit:o})]=Object.assign({as:t,field:r,timeUnit:o},a?{band:!0}:{})}return e},{});return G(n)?null:new hu(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:i}=n,r=A(n,["timeUnit"]),o=Jn(i),s=Object.assign(Object.assign({},r),{timeUnit:o});return new hu(e,{[N(s)]:s})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)this.formula[t]&&!e.formula[t].band||(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(J(this.formula).map(e=>e.as))}dependentFields(){return new Set(J(this.formula).map(e=>e.field))}hash(){return"TimeUnit "+N(this.formula)}assemble(){const e=[];for(const t of J(this.formula)){const{field:n,as:i,timeUnit:r}=t,o=Jn(r),{unit:s,utc:a}=o,u=A(o,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:ie(n),type:"timeunit"},s?{units:In(s)}:{}),a?{timezone:"utc"}:{}),u),{as:[i,i+"_end"]}))}return e}}class bu{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const vu={has:e=>"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!is(e.bind),parse:(e,t,n,i)=>{i.on||delete t.events,i.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,o=t.bind,s=t.init&&t.init[0],a=gu.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((e,r)=>{var u,l;const c=Q(`${i}_${e.field}`);n.filter(e=>e.name===c).length||n.unshift(Object.assign(Object.assign({name:c},s?{init:Bu(s[r])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${w(e.field)}] : null`}]:[],bind:null!==(l=null!==(u=o[e.field])&&void 0!==u?u:o[e.channel])&&void 0!==l?l:o}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,o=n.filter(e=>e.name===i+Uu)[0],s=i+"_tuple_fields",a=r.items.map(e=>Q(`${i}_${e.field}`)),u=a.map(e=>e+" !== null").join(" && ");return a.length&&(o.update=`${u} ? {fields: ${s}, values: [${a.join(", ")}]} : null`),delete o.value,delete o.on,n}},yu={has:e=>"multi"===e.type&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Uu,i=t.name+"_toggle";return`${i} ? null : ${n}, `+("global"===t.resolve?i+" ? null : true, ":`${i} ? null : {unit: ${Vu(e)}}, `)+`${i} ? ${n} : null`}},xu={has:e=>void 0!==e.clear&&!1!==e.clear,parse:(e,t,n)=>{n.clear&&(t.clear=O(n.clear)?$a(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(vu.has(t))for(const e of t.project.items){const i=n.findIndex(n=>n.name===Q(`${t.name}_${e.field}`));-1!==i&&n[i].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(e,i){-1!==e&&n[e].on&&n[e].on.push({events:t.clear,update:i})}if("interval"===t.type)for(const e of t.project.items){const t=n.findIndex(t=>t.name===e.signals.visual);if(i(t,"[0, 0]"),-1===t){i(n.findIndex(t=>t.name===e.signals.data),"null")}}else{let e=n.findIndex(e=>e.name===t.name+Uu);i(e,"null"),yu.has(t)&&(e=n.findIndex(e=>e.name===t.name+"_toggle"),i(e,"false"))}return n}},Ou={has:e=>"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind,parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!It(r))continue;const o=e.getScaleComponent(r),s=o?o.get("type"):void 0;if(!o||!Ri(s)){Bn("Scale bindings are currently only supported for scales with unbinned, continuous domains.");continue}const a={selection:t.name,field:i.field};o.set("selectionExtent",a,!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(e=>0===n.filter(t=>t.name===e.signals.data).length);if(!e.parent||ju(e)||0===i.length)return n;const r=n.filter(e=>e.name===t.name)[0];let o=r.update;if(o.indexOf(Iu)>=0)r.update=`{${i.map(e=>`${w(e.field)}: ${e.signals.data}`).join(", ")}}`;else{for(const e of i){const t=`${w(e.field)}: ${e.signals.data}`;o.indexOf(t)<0&&(o=`${o.substring(0,o.length-1)}, ${t}}`)}r.update=o}return n.concat(i.map(e=>({name:e.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!ju(e))for(const e of t.scales){const t=n.filter(t=>t.name===e.signals.data)[0];t.push="outer",delete t.value,delete t.update}return n}};function wu(e,t){return`domain(${w(e.scaleName(t))})`}function ju(e){var t;return e.parent&&Cd(e.parent)&&(null!==(t=!e.parent.parent)&&void 0!==t?t:ju(e.parent.parent))}const Au={has:e=>{const t="global"===e.resolve&&e.bind&&is(e.bind),n=1===e.project.items.length&&"_vgsid_"!==e.project.items[0].field;return t&&!n&&Bn("Legend bindings are only supported for selections over an individual field or encoding channel."),t&&n},parse:(e,t,n,i)=>{var r;if(i.on||delete t.events,i.clear||delete t.clear,i.on||i.clear){const e='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of t.events)n.filter=h(null!==(r=n.filter)&&void 0!==r?r:[]),n.filter.indexOf(e)<0&&n.filter.push(e)}const o=rs(t.bind)?t.bind.legend:"click",s=O(o)?$a(o,"view"):h(o);t.bind={legend:{merge:s}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=rs(t.bind)&&t.bind.legend,o=e=>t=>{const n=B(t);return n.markname=e,n};for(const e of t.project.items){if(!e.hasLegend)continue;const s=Q(e.field)+"_legend",a=`${i}_${s}`;if(0===n.filter(e=>e.name===a).length){const e=r.merge.map(o(s+"_symbols")).concat(r.merge.map(o(s+"_labels"))).concat(r.merge.map(o(s+"_entries")));n.unshift(Object.assign(Object.assign({name:a},t.init?{}:{value:null}),{on:[{events:e,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:"!event.item || !datum ? null : "+a,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,o=n.find(e=>e.name===i+Uu),s=i+"_tuple_fields",a=r.items.filter(e=>e.hasLegend).map(e=>Q(`${i}_${Q(e.field)}_legend`)),u=`${a.map(e=>e+" !== null").join(" && ")} ? {fields: ${s}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?o.on.push({events:a.map(e=>({signal:e})),update:u}):a.length>0&&(o.update=u,delete o.value,delete o.on);const l=n.find(e=>e.name===i+"_toggle"),c=rs(t.bind)&&t.bind.legend;return l&&(t.events?l.on.push(Object.assign(Object.assign({},l.on[0]),{events:c})):l.on[0].events=c),n}};const Du="_translate_delta",Fu={has:e=>"interval"===e.type&&e.translate,signals:(e,t,n)=>{const i=t.name,r=Ou.has(t),o=i+"_translate_anchor",{x:s,y:a}=t.project.hasChannel;let u=$a(t.translate,"scope");return r||(u=u.map(e=>(e.between[0].markname=i+Pu,e))),n.push({name:o,value:{},on:[{events:u.map(e=>e.between[0]),update:"{x: x(unit), y: y(unit)"+(void 0!==s?", extent_x: "+(r?wu(e,tt):`slice(${s.signals.visual})`):"")+(void 0!==a?", extent_y: "+(r?wu(e,nt):`slice(${a.signals.visual})`):"")+"}"}]},{name:i+Du,value:{},on:[{events:u,update:`{x: ${o}.x - x(unit), y: ${o}.y - y(unit)}`}]}),void 0!==s&&ku(e,t,s,"width",n),void 0!==a&&ku(e,t,a,"height",n),n}};function ku(e,t,n,i,r){var o;const s=t.name,a=s+"_translate_anchor",u=s+Du,l=n.channel,c=Ou.has(t),f=r.filter(e=>e.name===n.signals[c?"data":"visual"])[0],d=e.getSizeSignalRef(i).signal,g=e.getScaleComponent(l),p=g.get("type"),m=`${a}.extent_${l}`,h=`${c?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear"}(${m}, ${`${c&&l===tt?"-":""}${u}.${l} / `+(c?""+d:`span(${m})`)}`+(c&&"pow"===p?", "+(null!==(o=g.get("exponent"))&&void 0!==o?o:1):"")+")";f.on.push({events:{signal:u},update:c?h:`clampRange(${h}, 0, ${d})`})}const Cu={has:e=>"interval"===e.type&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=Ou.has(t),o=i+"_zoom_delta",{x:s,y:a}=t.project.hasChannel,u=w(e.scaleName(tt)),l=w(e.scaleName(nt));let c=$a(t.zoom,"scope");return r||(c=c.map(e=>(e.markname=i+Pu,e))),n.push({name:i+"_zoom_anchor",on:[{events:c,update:r?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(e=>!!e).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:o,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==s&&Eu(e,t,s,"width",n),void 0!==a&&Eu(e,t,a,"height",n),n}};function Eu(e,t,n,i,r){var o;const s=t.name,a=n.channel,u=Ou.has(t),l=r.filter(e=>e.name===n.signals[u?"data":"visual"])[0],c=e.getSizeSignalRef(i).signal,f=e.getScaleComponent(a),d=f.get("type"),g=u?wu(e,a):l.name,p=s+"_zoom_delta",m=`${u?"log"===d?"zoomLog":"pow"===d?"zoomPow":"zoomLinear":"zoomLinear"}(${g}, ${`${s}_zoom_anchor.${a}`}, ${p}`+(u&&"pow"===d?", "+(null!==(o=f.get("exponent"))&&void 0!==o?o:1):"")+")";l.on.push({events:{signal:p},update:u?m:`clampRange(${m}, 0, ${c})`})}const Su=[{has:()=>!0,parse:(e,t,n)=>{var i,r,o;const s=t.name,a=null!==(i=t.project)&&void 0!==i?i:t.project=new bu,u={},l={},c=new Set,f=(e,t)=>{const n="visual"===t?e.channel:e.field;let i=Q(`${s}_${n}`);for(let e=1;c.has(i);e++)i=Q(`${s}_${n}_${e}`);return c.add(i),{[t]:i}};if(!n.fields&&!n.encodings){const t=e.config.selection[n.type];if(n.init)for(const e of h(n.init))for(const i of V(e))At[i]?(n.encodings||(n.encodings=[])).push(i):"interval"===n.type?(Bn('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=t.encodings):(n.fields||(n.fields=[])).push(i);else n.encodings=t.encodings,n.fields=t.fields}for(const e of null!==(r=n.fields)&&void 0!==r?r:[]){const t={type:"E",field:e};t.signals=Object.assign({},f(t,"data")),a.items.push(t),a.hasField[e]=t}for(const i of null!==(o=n.encodings)&&void 0!==o?o:[]){const n=e.fieldDef(i);if(n){let r=n.field;if(n.aggregate){Bn(un(i,n.aggregate));continue}if(!r){Bn(an(i));continue}if(n.timeUnit){r=e.vgField(i);const t={timeUnit:n.timeUnit,as:r,field:n.field};l[N(t)]=t}if(!u[r]){let o="E";if("interval"===t.type){Ri(e.getScaleComponent(i).get("type"))&&(o="R")}else n.bin&&(o="R-RE");const s={field:r,channel:i,type:o};s.signals=Object.assign(Object.assign({},f(s,"data")),f(s,"visual")),a.items.push(u[r]=s),a.hasField[r]=a.hasChannel[i]=u[r]}}else Bn(an(i))}if(n.init){const e=e=>a.items.map(t=>void 0!==e[t.channel]?e[t.channel]:e[t.field]);if("interval"===n.type)t.init=e(n.init);else{const i=h(n.init);t.init=i.map(e)}}G(l)||(a.timeUnit=new hu(null,l))},signals:(e,t,n)=>{const i=t.name+"_tuple_fields";return n.filter(e=>e.name===i).length>0?n:n.concat({name:i,value:t.project.items.map(e=>{const t=A(e,["signals","hasLegend"]);return t.field=ie(t.field),t})})}},yu,Ou,Au,Fu,Cu,vu,gu,xu];function $u(e,t){for(const n of Su)n.has(e)&&t(n)}function Bu(e,t=!0,n=u){if(c(e)){const i=e.map(e=>Bu(e,t,n));return t?`[${i.join(", ")}]`:i}return _n(e)?n(t?Tn(e):function(e){const t=Mn(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}(e)):t?n(JSON.stringify(e)):e}function _u(e,t){return Gu(e,(n,i)=>{t=i.marks?i.marks(e,n,t):t,$u(n,i=>{i.marks&&(t=i.marks(e,n,t))})}),t}function zu(e){return e.map(e=>(e.on&&!e.on.length&&delete e.on,e))}const Pu="_brush",Nu={signals:(e,t)=>{const n=t.name,i=n+"_tuple_fields",r=Ou.has(t),o=[],s=[],a=[];if(t.translate&&!r){const e="!event.item || event.item.mark.name !== "+w(n+Pu);Lu(t,(t,n)=>{var i;const r=h(null!==(i=n.between[0].filter)&&void 0!==i?i:n.between[0].filter=[]);return r.indexOf(e)<0&&r.push(e),t})}t.project.items.forEach((n,i)=>{const r=n.channel;if(r!==tt&&r!==nt)return void Bn("Interval selections only support x and y encoding channels.");const u=t.init?t.init[i]:null,l=function(e,t,n,i){const r=n.channel,o=n.signals.visual,s=n.signals.data,a=Ou.has(t),u=w(e.scaleName(r)),l=e.getScaleComponent(r),c=l?l.get("type"):void 0,f=e=>`scale(${u}, ${e})`,d=e.getSizeSignalRef(r===tt?"width":"height").signal,g=r+"(unit)",p=Lu(t,(e,t)=>[...e,{events:t.between[0],update:`[${g}, ${g}]`},{events:t,update:`[${o}[0], clamp(${g}, 0, ${d})]`}]);return p.push({events:{signal:t.name+"_scale_trigger"},update:Ri(c)?`[${f(s+"[0]")}, ${f(s+"[1]")}]`:"[0, 0]"}),a?[{name:s,on:[]}]:[Object.assign(Object.assign({name:o},i?{init:Bu(i,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:s},i?{init:Bu(i)}:{}),{on:[{events:{signal:o},update:`${o}[0] === ${o}[1] ? null : invert(${u}, ${o})`}]})]}(e,t,n,u),c=n.signals.data,f=n.signals.visual,d=w(e.scaleName(r)),g=Ri(e.getScaleComponent(r).get("type"))?"+":"";o.push(...l),s.push(c),a.push({scaleName:e.scaleName(r),expr:`(!isArray(${c}) || (${g}invert(${d}, ${f})[0] === ${g}${c}[0] && ${g}invert(${d}, ${f})[1] === ${g}${c}[1]))`})}),r||o.push({name:n+"_scale_trigger",value:{},on:[{events:a.map(e=>({scale:e.scaleName})),update:a.map(e=>e.expr).join(" && ")+` ? ${n+"_scale_trigger"} : {}`}]});const u=t.init,l=`unit: ${Vu(e)}, fields: ${i}, values`;return o.concat(Object.assign(Object.assign({name:n+Uu},u?{init:`{${l}: ${Bu(u)}}`}:{}),{on:[{events:[{signal:s.join(" || ")}],update:s.join(" && ")+` ? {${l}: [${s}]} : null`}]}))},modifyExpr:(e,t)=>t.name+Uu+", "+("global"===t.resolve?"true":`{unit: ${Vu(e)}}`),marks:(e,t,n)=>{const i=t.name,{x:r,y:o}=t.project.hasChannel,s=r&&r.signals.visual,a=o&&o.signals.visual,u=`data(${w(t.name+Ru)})`;if(Ou.has(t))return n;const l={x:void 0!==r?{signal:s+"[0]"}:{value:0},y:void 0!==o?{signal:a+"[0]"}:{value:0},x2:void 0!==r?{signal:s+"[1]"}:{field:{group:"width"}},y2:void 0!==o?{signal:a+"[1]"}:{field:{group:"height"}}};if("global"===t.resolve)for(const t of V(l))l[t]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${Vu(e)}`},l[t]),{value:0}];const c=t.mark,{fill:f,fillOpacity:d,cursor:g}=c,p=A(c,["fill","fillOpacity","cursor"]),m=V(p).reduce((e,t)=>(e[t]=[{test:[void 0!==r&&`${s}[0] !== ${s}[1]`,void 0!==o&&`${a}[0] !== ${a}[1]`].filter(e=>e).join(" && "),value:p[t]},{value:null}],e),{});return[{name:i+Pu+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:l}},...n,{name:i+Pu,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},g?{cursor:{value:g}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),m)}}]}};function Lu(e,t){return e.events.reduce((e,n)=>n.between?t(e,n):(Bn(n+" is not an ordered event stream for interval selections."),e),[])}function Mu(e,t){const n=t.name,i=n+"_tuple_fields",r=t.project,o="(item().isVoronoi ? datum.datum : datum)",s=r.items.map(t=>{const n=e.fieldDef(t.channel);return n&&n.bin?`[${o}[${w(e.vgField(t.channel,{}))}], ${o}[${w(e.vgField(t.channel,{binSuffix:"end"}))}]]`:`${o}[${w(t.field)}]`}).join(", "),a=`unit: ${Vu(e)}, fields: ${i}, values`,u=t.events;return[{name:n+Uu,on:u?[{events:u,update:`datum && item().mark.marktype !== 'group' ? {${a}: [${s}]} : null`,force:!0}]:[]}]}const Tu={signals:Mu,modifyExpr:(e,t)=>t.name+Uu+", "+("global"===t.resolve?"null":`{unit: ${Vu(e)}}`)},qu={signals:Mu,modifyExpr:(e,t)=>t.name+Uu+", "+("global"===t.resolve?"true":`{unit: ${Vu(e)}}`)},Ru="_store",Uu="_tuple",Wu="_modify",Iu="vlSelectionResolve",Hu={single:qu,multi:Tu,interval:Nu};function Gu(e,t){const n=e.component.selection;if(n)for(const e of J(n)){if(!0===t(e,Hu[e.type]))break}}function Vu(e,{escape:t}={escape:!0}){let n=t?w(e.name):e.name;const i=function(e){let t=e.parent;for(;t&&!Fd(t);)t=t.parent;return t}(e);if(i){const{facet:e}=i;for(const t of xt)e[t]&&(n+=` + '__facet_${t}_' + (facet[${w(i.vgField(t))}])`)}return n}function Ju(e){let t=!1;return Gu(e,e=>{t=t||e.project.items.some(e=>"_vgsid_"===e.field)}),t}var Yu,Xu,Qu,Ku,Zu;function el(e){this.type=e}el.prototype.visit=function(e){var t,n,i;if(e(this))return 1;for(n=0,i=(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case"CallExpression":var t=e.arguments.slice();return t.unshift(e.callee),t;case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this)).length;n<i;++n)if(t[n].visit(e))return 1};(Yu={})[1]="Boolean",Yu[2]="<end>",Yu[3]="Identifier",Yu[4]="Keyword",Yu[5]="Null",Yu[6]="Numeric",Yu[7]="Punctuator",Yu[8]="String",Yu[9]="RegularExpression";var tl=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),nl=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function il(e,t){if(!e)throw new Error("ASSERT: "+t)}function rl(e){return e>=48&&e<=57}function ol(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function sl(e){return"01234567".indexOf(e)>=0}function al(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function ul(e){return 10===e||13===e||8232===e||8233===e}function ll(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&tl.test(String.fromCharCode(e))}function cl(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&nl.test(String.fromCharCode(e))}var fl={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function dl(){for(var e;Qu<Ku&&(al(e=Xu.charCodeAt(Qu))||ul(e));)++Qu}function gl(e){var t,n,i,r=0;for(n="u"===e?4:2,t=0;t<n;++t)Qu<Ku&&ol(Xu[Qu])?(i=Xu[Qu++],r=16*r+"0123456789abcdef".indexOf(i.toLowerCase())):El({},"Unexpected token %0","ILLEGAL");return String.fromCharCode(r)}function pl(){var e,t,n,i;for(t=0,"}"===(e=Xu[Qu])&&El({},"Unexpected token %0","ILLEGAL");Qu<Ku&&ol(e=Xu[Qu++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&El({},"Unexpected token %0","ILLEGAL"),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),i=56320+(t-65536&1023),String.fromCharCode(n,i))}function ml(){var e,t;for(e=Xu.charCodeAt(Qu++),t=String.fromCharCode(e),92===e&&(117!==Xu.charCodeAt(Qu)&&El({},"Unexpected token %0","ILLEGAL"),++Qu,(e=gl("u"))&&"\\"!==e&&ll(e.charCodeAt(0))||El({},"Unexpected token %0","ILLEGAL"),t=e);Qu<Ku&&cl(e=Xu.charCodeAt(Qu));)++Qu,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==Xu.charCodeAt(Qu)&&El({},"Unexpected token %0","ILLEGAL"),++Qu,(e=gl("u"))&&"\\"!==e&&cl(e.charCodeAt(0))||El({},"Unexpected token %0","ILLEGAL"),t+=e);return t}function hl(){var e,t;return e=Qu,{type:1===(t=92===Xu.charCodeAt(Qu)?ml():function(){var e,t;for(e=Qu++;Qu<Ku;){if(92===(t=Xu.charCodeAt(Qu)))return Qu=e,ml();if(!cl(t))break;++Qu}return Xu.slice(e,Qu)}()).length?3:fl.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:Qu}}function bl(){var e,t,n,i,r=Qu,o=Xu.charCodeAt(Qu),s=Xu[Qu];switch(o){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Qu,{type:7,value:String.fromCharCode(o),start:r,end:Qu};default:if(61===(e=Xu.charCodeAt(Qu+1)))switch(o){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Qu+=2,{type:7,value:String.fromCharCode(o)+String.fromCharCode(e),start:r,end:Qu};case 33:case 61:return Qu+=2,61===Xu.charCodeAt(Qu)&&++Qu,{type:7,value:Xu.slice(r,Qu),start:r,end:Qu}}}return">>>="===(i=Xu.substr(Qu,4))?{type:7,value:i,start:r,end:Qu+=4}:">>>"===(n=i.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:r,end:Qu+=3}:s===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(s)>=0||"=>"===t?{type:7,value:t,start:r,end:Qu+=2}:"<>=!+-*%&|^/".indexOf(s)>=0?{type:7,value:s,start:r,end:++Qu}:void El({},"Unexpected token %0","ILLEGAL")}function vl(){var e,t,n;if(il(rl((n=Xu[Qu]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=Qu,e="","."!==n){if(e=Xu[Qu++],n=Xu[Qu],"0"===e){if("x"===n||"X"===n)return++Qu,function(e){for(var t="";Qu<Ku&&ol(Xu[Qu]);)t+=Xu[Qu++];return 0===t.length&&El({},"Unexpected token %0","ILLEGAL"),ll(Xu.charCodeAt(Qu))&&El({},"Unexpected token %0","ILLEGAL"),{type:6,value:parseInt("0x"+t,16),start:e,end:Qu}}(t);if(sl(n))return function(e){for(var t="0"+Xu[Qu++];Qu<Ku&&sl(Xu[Qu]);)t+=Xu[Qu++];return(ll(Xu.charCodeAt(Qu))||rl(Xu.charCodeAt(Qu)))&&El({},"Unexpected token %0","ILLEGAL"),{type:6,value:parseInt(t,8),octal:!0,start:e,end:Qu}}(t);n&&rl(n.charCodeAt(0))&&El({},"Unexpected token %0","ILLEGAL")}for(;rl(Xu.charCodeAt(Qu));)e+=Xu[Qu++];n=Xu[Qu]}if("."===n){for(e+=Xu[Qu++];rl(Xu.charCodeAt(Qu));)e+=Xu[Qu++];n=Xu[Qu]}if("e"===n||"E"===n)if(e+=Xu[Qu++],"+"!==(n=Xu[Qu])&&"-"!==n||(e+=Xu[Qu++]),rl(Xu.charCodeAt(Qu)))for(;rl(Xu.charCodeAt(Qu));)e+=Xu[Qu++];else El({},"Unexpected token %0","ILLEGAL");return ll(Xu.charCodeAt(Qu))&&El({},"Unexpected token %0","ILLEGAL"),{type:6,value:parseFloat(e),start:t,end:Qu}}function yl(){var e,t,n,i;return Zu=null,dl(),e=Qu,t=function(){var e,t,n,i;for(il("/"===(e=Xu[Qu]),"Regular expression literal must start with a slash"),t=Xu[Qu++],n=!1,i=!1;Qu<Ku;)if(t+=e=Xu[Qu++],"\\"===e)ul((e=Xu[Qu++]).charCodeAt(0))&&El({},"Invalid regular expression: missing /"),t+=e;else if(ul(e.charCodeAt(0)))El({},"Invalid regular expression: missing /");else if(n)"]"===e&&(n=!1);else{if("/"===e){i=!0;break}"["===e&&(n=!0)}return i||El({},"Invalid regular expression: missing /"),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";Qu<Ku&&cl((e=Xu[Qu]).charCodeAt(0));)++Qu,"\\"===e&&Qu<Ku?El({},"Unexpected token %0","ILLEGAL"):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&El({},"Invalid regular expression",n),{value:n,literal:t}}(),i=function(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(e,t){if(parseInt(t,16)<=1114111)return"x";El({},"Invalid regular expression")})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){El({},"Invalid regular expression")}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:Qu}}function xl(){var e;return dl(),Qu>=Ku?{type:2,start:Qu,end:Qu}:ll(e=Xu.charCodeAt(Qu))?hl():40===e||41===e||59===e?bl():39===e||34===e?function(){var e,t,n,i,r="",o=!1;for(il("'"===(e=Xu[Qu])||'"'===e,"String literal must starts with a quote"),t=Qu,++Qu;Qu<Ku;){if((n=Xu[Qu++])===e){e="";break}if("\\"===n)if((n=Xu[Qu++])&&ul(n.charCodeAt(0)))"\r"===n&&"\n"===Xu[Qu]&&++Qu;else switch(n){case"u":case"x":"{"===Xu[Qu]?(++Qu,r+=pl()):r+=gl(n);break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"b":r+="\b";break;case"f":r+="\f";break;case"v":r+="\v";break;default:sl(n)?(0!==(i="01234567".indexOf(n))&&(o=!0),Qu<Ku&&sl(Xu[Qu])&&(o=!0,i=8*i+"01234567".indexOf(Xu[Qu++]),"0123".indexOf(n)>=0&&Qu<Ku&&sl(Xu[Qu])&&(i=8*i+"01234567".indexOf(Xu[Qu++]))),r+=String.fromCharCode(i)):r+=n}else{if(ul(n.charCodeAt(0)))break;r+=n}}return""!==e&&El({},"Unexpected token %0","ILLEGAL"),{type:8,value:r,octal:o,start:t,end:Qu}}():46===e?rl(Xu.charCodeAt(Qu+1))?vl():bl():rl(e)?vl():bl()}function Ol(){var e;return Qu=(e=Zu).end,Zu=xl(),Qu=e.end,e}function wl(){var e;e=Qu,Zu=xl(),Qu=e}function jl(e,t,n){var i=new el("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return i.operator=e,i.left=t,i.right=n,i}function Al(e,t){var n=new el("CallExpression");return n.callee=e,n.arguments=t,n}function Dl(e){var t=new el("Identifier");return t.name=e,t}function Fl(e){var t=new el("Literal");return t.value=e.value,t.raw=Xu.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function kl(e,t,n){var i=new el("MemberExpression");return i.computed="["===e,i.object=t,i.property=n,i.computed||(n.member=!0),i}function Cl(e,t,n){var i=new el("Property");return i.key=t,i.value=n,i.kind=e,i}function El(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,(function(e,t){return il(t<i.length,"Message reference must be in range"),i[t]}));throw(n=new Error(r)).index=Qu,n.description=r,n}function Sl(e){2===e.type&&El(e,"Unexpected end of input"),6===e.type&&El(e,"Unexpected number"),8===e.type&&El(e,"Unexpected string"),3===e.type&&El(e,"Unexpected identifier"),4===e.type&&El(e,"Unexpected reserved word"),El(e,"Unexpected token %0",e.value)}function $l(e){var t=Ol();7===t.type&&t.value===e||Sl(t)}function Bl(e){return 7===Zu.type&&Zu.value===e}function _l(e){return 4===Zu.type&&Zu.value===e}function zl(){var e=[];for(Qu=Zu.start,$l("[");!Bl("]");)Bl(",")?(Ol(),e.push(null)):(e.push(Gl()),Bl("]")||$l(","));return Ol(),function(e){var t=new el("ArrayExpression");return t.elements=e,t}(e)}function Pl(){var e;return Qu=Zu.start,8===(e=Ol()).type||6===e.type?(e.octal&&El(e,"Octal literals are not allowed in strict mode."),Fl(e)):Dl(e.value)}function Nl(){var e,t,n;return Qu=Zu.start,3===(e=Zu).type?(n=Pl(),$l(":"),Cl("init",n,Gl())):2!==e.type&&7!==e.type?(t=Pl(),$l(":"),Cl("init",t,Gl())):void Sl(e)}function Ll(){var e,t,n=[],i={},r=String;for(Qu=Zu.start,$l("{");!Bl("}");)t="$"+("Identifier"===(e=Nl()).key.type?e.key.name:r(e.key.value)),Object.prototype.hasOwnProperty.call(i,t)?El({},"Duplicate data property in object literal not allowed in strict mode"):i[t]=!0,n.push(e),Bl("}")||$l(",");return $l("}"),function(e){var t=new el("ObjectExpression");return t.properties=e,t}(n)}var Ml={if:1};function Tl(){var e,t,n;if(Bl("("))return function(){var e;return $l("("),e=Vl(),$l(")"),e}();if(Bl("["))return zl();if(Bl("{"))return Ll();if(e=Zu.type,Qu=Zu.start,3===e||Ml[Zu.value])n=Dl(Ol().value);else if(8===e||6===e)Zu.octal&&El(Zu,"Octal literals are not allowed in strict mode."),n=Fl(Ol());else{if(4===e)throw new Error("Disabled.");1===e?((t=Ol()).value="true"===t.value,n=Fl(t)):5===e?((t=Ol()).value=null,n=Fl(t)):Bl("/")||Bl("/=")?(n=Fl(yl()),wl()):Sl(Ol())}return n}function ql(){var e=[];if($l("("),!Bl(")"))for(;Qu<Ku&&(e.push(Gl()),!Bl(")"));)$l(",");return $l(")"),e}function Rl(){return $l("."),Qu=Zu.start,function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e=Ol())||Sl(e),Dl(e.value);var e}function Ul(){var e;return $l("["),e=Vl(),$l("]"),e}function Wl(){var e=function(){var e;for(e=Tl();;)if(Bl("."))e=kl(".",e,Rl());else if(Bl("("))e=Al(e,ql());else{if(!Bl("["))break;e=kl("[",e,Ul())}return e}();if(7===Zu.type&&(Bl("++")||Bl("--")))throw new Error("Disabled.");return e}function Il(){var e,t,n,i,r;if(7!==Zu.type&&4!==Zu.type)t=Wl();else{if(Bl("++")||Bl("--"))throw new Error("Disabled.");if(Bl("+")||Bl("-")||Bl("~")||Bl("!"))e=Ol(),t=Il(),n=e.value,i=t,(r=new el("UnaryExpression")).operator=n,r.argument=i,r.prefix=!0,t=r;else{if(_l("delete")||_l("void")||_l("typeof"))throw new Error("Disabled.");t=Wl()}}return t}function Hl(e){var t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Gl(){var e,t;return e=function(){var e,t,n,i,r,o,s,a,u,l;if(e=Zu,u=Il(),0===(r=Hl(i=Zu)))return u;for(i.prec=r,Ol(),t=[e,Zu],o=[u,i,s=Il()];(r=Hl(Zu))>0;){for(;o.length>2&&r<=o[o.length-2].prec;)s=o.pop(),a=o.pop().value,u=o.pop(),t.pop(),n=jl(a,u,s),o.push(n);(i=Ol()).prec=r,o.push(i),t.push(Zu),n=Il(),o.push(n)}for(n=o[l=o.length-1],t.pop();l>1;)t.pop(),n=jl(o[l-1].value,o[l-2],n),l-=2;return n}(),Bl("?")&&(Ol(),t=Gl(),$l(":"),e=function(e,t,n){var i=new el("ConditionalExpression");return i.test=e,i.consequent=t,i.alternate=n,i}(e,t,Gl())),e}function Vl(){var e=Gl();if(Bl(","))throw new Error("Disabled.");return e}function Jl(e){const t=function(e){Qu=0,Ku=(Xu=e).length,Zu=null,wl();var t=Vl();if(2!==Zu.type)throw new Error("Unexpect token after expression.");return t}(e),n=new Set;return t.visit(e=>{"MemberExpression"===e.type&&function e(t){return"MemberExpression"===t.object.type?e(t.object):"datum"===t.object.name}(e)&&n.add(function e(t){const n=[];return"Identifier"===t.type?[t.name]:"Literal"===t.type?[t.value]:("MemberExpression"===t.type&&(n.push(...e(t.object)),n.push(...e(t.property))),n)}(e).slice(1).join("."))}),n}class Yl extends pu{constructor(e,t,n){super(e),this.model=t,this.filter=n,this.expr=Kl(this.model,this.filter,this),this._dependentFields=Jl(this.expr)}clone(){return new Yl(null,this.model,B(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return"Filter "+this.expr}}function Xl(e,t,n,i="datum"){const r=[];const o=K(t,(function(t){const o=Q(t),s=e.getSelectionComponent(o,t),a=w(o+Ru);if(s.project.timeUnit){const t=null!=n?n:e.component.data.raw,i=s.project.timeUnit.clone();t.parent?i.insertAsParentOf(t):t.parent=i}return"none"!==s.empty&&r.push(a),`vlSelectionTest(${a}, ${i}`+("global"===s.resolve?")":`, ${w(s.resolve)})`)}));return(r.length?"!("+r.map(e=>`length(data(${e}))`).join(" || ")+") || ":"")+`(${o})`}function Ql(e,t){const n=t.encoding;let i=t.field;if(n||i){if(n&&!i){const r=e.project.items.filter(e=>e.channel===n);!r.length||r.length>1?(i=e.project.items[0].field,Bn((r.length?"Multiple ":"No ")+`matching ${w(n)} encoding found for selection ${w(t.selection)}. `+`Using "field": ${w(i)}.`)):i=r[0].field}}else i=e.project.items[0].field,e.project.items.length>1&&Bn(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${w(i)}.`);return`${e.name}[${w(i)}]`}function Kl(e,t,n){return K(t,t=>O(t)?t:function(e){return null==e?void 0:e.selection}(t)?Xl(e,t.selection,n):ci(t))}function Zl(e,t,n,i){var r,o,s;e.encode=null!==(r=e.encode)&&void 0!==r?r:{},e.encode[t]=null!==(o=e.encode[t])&&void 0!==o?o:{},e.encode[t].update=null!==(s=e.encode[t].update)&&void 0!==s?s:{},e.encode[t].update[n]=i}function ec(e,t,n,i={header:!1}){var r,o;const s=e.combine(),{disable:a,orient:u,scale:l,labelExpr:f,title:d,zindex:g}=s,p=A(s,["disable","orient","scale","labelExpr","title","zindex"]);if(!a){for(const e in p){const n=pe[e],i=p[e];if(n&&n!==t&&"both"!==n)delete p[e];else if(de(i)){const{condition:t}=i,n=A(i,["condition"]),r=h(t),o=fe[e];if(o){const{vgProp:t,part:i}=o;Zl(p,i,t,[...r.map(e=>{const{test:t}=e,n=A(e,["test"]);return Object.assign({test:Kl(null,t)},n)}),n]),delete p[e]}else if(null===o){const t={signal:r.map(e=>{const{test:t}=e,n=A(e,["test"]);return`${Kl(null,t)} ? ${po(n)} : `}).join("")+po(n)};p[e]=t}}else if(Yn(i)){const t=fe[e];if(t){const{vgProp:n,part:r}=t;Zl(p,r,n,i),delete p[e]}}}if("grid"===t){if(!p.grid)return;if(p.encode){const{grid:e}=p.encode;p.encode=Object.assign({},e?{grid:e}:{}),G(p.encode)&&delete p.encode}return Object.assign(Object.assign({scale:l,orient:u},p),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:ae(g,0)})}{if(!i.header&&e.mainExtracted)return;if(void 0!==f){let e=f;(null===(o=null===(r=p.encode)||void 0===r?void 0:r.labels)||void 0===o?void 0:o.update)&&Yn(p.encode.labels.update.text)&&(e=re(f,"datum.label",p.encode.labels.update.text.signal)),Zl(p,"labels","text",{signal:e})}if(null===p.labelAlign&&delete p.labelAlign,p.encode){for(const t of ge)e.hasAxisPart(t)||delete p.encode[t];G(p.encode)&&delete p.encode}const t=function(e,t){if(e)return c(e)&&!fo(e)?e.map(e=>Qr(e,t)).join(", "):e}(d,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:u,grid:!1},t?{title:t}:{}),p),!1===n.aria?{aria:!1}:{}),{zindex:ae(g,0)})}}}function tc(e){const{axes:t}=e.component,n=[];for(const i of Pt)if(t[i])for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const t="x"===i?"height":"width",r=e.getSizeSignalRef(t).signal;t!==r&&n.push({name:t,update:r})}return n}const nc={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},ic={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},rc=V(nc),oc=V(ic);function sc(e,t,n,i){return Object.assign.apply(null,[{},...e.map(e=>{if("axisOrient"===e){const e="x"===n?"bottom":"left",r=t["x"===n?"axisBottom":"axisLeft"]||{},o=t["x"===n?"axisTop":"axisRight"]||{},s=new Set([...V(r),...V(o)]),a={};for(const t of s.values())a[t]={signal:`${i.signal} === "${e}" ? ${mo(r[t])} : ${mo(o[t])}`};return a}return t[e]})])}function ac(e,t,n,i){const r="band"===t?["axisDiscrete","axisBand"]:"point"===t?["axisDiscrete","axisPoint"]:t in Ni?["axisQuantitative"]:"time"===t||"utc"===t?["axisTemporal"]:[];const o="x"===e?"axisX":"axisY",s=Yn(n)?"axisOrient":"axis"+ee(n),a=[...r,...r.map(e=>o+e.substr(4))],u=["axis",s,o];return{vlOnlyAxisConfig:sc(a,i,e,n),vgAxisConfig:sc(u,i,e,n),axisConfigStyle:uc([...u,...a],i)}}function uc(e,t){var n;const i=[{}];for(const r of e){let e=null===(n=t[r])||void 0===n?void 0:n.style;if(e){e=h(e);for(const n of e)i.push(t.style[n])}}return Object.assign.apply(null,i)}function lc(e,t,n,i={}){var r;const o=xo(e,n,t);if(void 0!==o)return{configFrom:"style",configValue:o};for(const t of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(r=i[t])||void 0===r?void 0:r[e]))return{configFrom:t,configValue:i[t][e]};return{}}const cc={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return ur(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return lr(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return(!Sr(e)||!Qt(e.bin))&&(null!==(i=t.grid)&&void 0!==i?i:function(e,t){return!qi(e)&&Sr(t)&&!Xt(null==t?void 0:t.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(e,t){const n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n);return}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||gc(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||dc(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return null!==(i=e.labelFlush)&&void 0!==i?i:function(e,t){if("x"===t&&M(["quantitative","temporal"],e))return!0;return}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return null!==(i=e.labelOverlap)&&void 0!==i?i:function(e,t,n,i){if(n&&!f(i)||"nominal"!==e&&"ordinal"!==e)return"log"!==t||"greedy";return}(t.type,n,Sr(t)&&!!t.timeUnit,Sr(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var o;const s="x"===e?"width":"y"===e?"height":void 0,a=s?t.getSizeSignalRef(s):void 0;return null!==(o=n.tickCount)&&void 0!==o?o:function({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!qi(t)&&"log"!==t){if(Sr(e)){if(Xt(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&M(["month","hours","day","quarter"],null===(r=Jn(e.timeUnit))||void 0===r?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}({fieldOrDatumDef:i,scaleType:r,size:a,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(void 0!==e.title)return e.title;const i=pc(t,n);if(void 0!==i)return i;const r=t.typedFieldDef(n),o="x"===n?"x2":"y2",s=t.fieldDef(o);return wo(r?[jr(r)]:[],Sr(s)?[jr(s)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(e,t){const n=e.values;if(c(n))return uo(t,n);if(Yn(n))return n;return}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return null!==(i=e.zindex)&&void 0!==i?i:function(e,t){if("rect"===e&&Ir(t))return 1;return 0}(n,t)}};function fc(e){return`(((${e.signal} % 360) + 360) % 360)`}function dc(e,t,n,i){if(void 0!==e){if("x"===n){if(Yn(e)){const n=fc(e);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${Yn(t)?`(${t.signal} === "top")`:"top"===t} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(Yn(t)){const n=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${n} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==("top"===t)?"bottom":"top"}if(Yn(e)){const n=fc(e);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${Yn(t)?`(${t.signal} === "left")`:"left"===t} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(Yn(t)){const n=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${n} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==("left"===t)?"top":"bottom"}}function gc(e,t,n){if(void 0===e)return;const i="x"===n,r=i?0:90,o=i?"bottom":"left";if(Yn(e)){const n=fc(e);return{signal:`(${r?"("+n+" + 90)":n} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${n} && ${n} < ${180+r}) === ${Yn(t)?`(${t.signal} === "${o}")`:t===o} ? "left" : "right"`}}if((e+r)%180==0)return i?null:"center";if(Yn(t)){const n=r<e&&e<180+r?"===":"!==";return{signal:`${t.signal} ${n} "${o}"`+' ? "left" : "right"'}}return(r<e&&e<180+r)==(t===o)?"left":"right"}function pc(e,t){const n="x"===t?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),o=i?i.title:void 0,s=r?r.title:void 0;return o&&s?jo(o,s):o||(s||(void 0!==o?o:void 0!==s?s:void 0))}class mc extends pu{constructor(e,t){super(e),this.transform=t,this._dependentFields=Jl(this.transform.calculate)}clone(){return new mc(null,B(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef((t,n)=>{if(Mr(t)&&yr(t.sort)){const{field:i,timeUnit:r}=t,o=t.sort,s=o.map((e,t)=>`${ci({field:i,timeUnit:r,equal:e})} ? ${t} : `).join("")+o.length;e=new mc(e,{calculate:s,as:hc(t,n,{forAs:!0})})}}),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return"Calculate "+N(this.transform)}}function hc(e,t,n){return Wr(e,Object.assign({prefix:t,suffix:"sort_index"},null!=n?n:{}))}function bc(e,t){return M(["top","bottom"],t)?"column":M(["left","right"],t)||"row"===e?"row":"column"}function vc(e,t,n,i){const r="row"===i?n.headerRow:"column"===i?n.headerColumn:n.headerFacet;return ae(((null==t?void 0:t.header)||{})[e],r[e],n.header[e])}function yc(e,t,n,i){const r={};for(const o of e){const e=vc(o,t,n,i);void 0!==e&&(r[o]=e)}return r}const xc=["row","column"],Oc=["header","footer"];function wc(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:o,titleAngle:s,titleOrient:a}=yc(["titleAnchor","titleAngle","titleOrient"],r,i,t),u=bc(t,a),l=le(s);return{name:t+"-title",type:"group",role:u+"-title",title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===t?{orient:"left"}:{}),{style:"guide-title"}),Ac(l,u)),jc(u,l,o)),$c(i,r,t,rc,nc))}}function jc(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=gc(t,"row"===e?"left":"top","row"===e?"y":"x");return i?{align:i}:{}}function Ac(e,t){const n=dc(e,"row"===t?"left":"top","row"===t?"y":"x",!0);return n?{baseline:n}:{}}function Dc(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of Oc)if(n[r])for(const o of n[r]){const s=Cc(e,t,r,n,o);null!=s&&i.push(s)}return i}function Fc(e,t){var n;const{sort:i}=e;return vr(i)?{field:Wr(i,{expr:"datum"}),order:null!==(n=i.order)&&void 0!==n?n:"ascending"}:c(i)?{field:hc(e,t,{expr:"datum"}),order:"ascending"}:{field:Wr(e,{expr:"datum"}),order:null!=i?i:"ascending"}}function kc(e,t,n){const{format:i,formatType:r,labelAngle:o,labelAnchor:s,labelOrient:a,labelExpr:u}=yc(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),l=or({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,c=bc(t,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:u?re(re(u,"datum.label",l),"datum.value",Wr(e,{expr:"parent"})):l}},"row"===t?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),Ac(o,c)),jc(c,o,s)),$c(n,e,t,oc,ic))}function Cc(e,t,n,i,r){if(r){let o=null;const{facetFieldDef:s}=i,a=e.config?e.config:void 0;if(s&&r.labels){const{labelOrient:e}=yc(["labelOrient"],s,a,t);("row"===t&&!M(["top","bottom"],e)||"column"===t&&!M(["left","right"],e))&&(o=kc(s,t,a))}const u=Fd(e)&&!xr(e.facet),l=r.axes,c=(null==l?void 0:l.length)>0;if(o||c){const a="row"===t?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:Fc(s,t)}:{}),c&&u?{from:{data:e.getName("facet_domain_"+t)}}:{}),o?{title:o}:{}),r.sizeSignal?{encode:{update:{[a]:r.sizeSignal}}}:{}),c?{axes:l}:{})}}return null}const Ec={column:{start:0,end:1},row:{start:1,end:0}};function Sc(e,t){return Ec[t][e]}function $c(e,t,n,i,r){const o={};for(const s of i){if(!r[s])continue;const i=vc(s,t,e,n);void 0!==i&&(o[r[s]]=i)}return o}function Bc(e){return[..._c(e,"width"),..._c(e,"height"),..._c(e,"childWidth"),..._c(e,"childHeight")]}function _c(e,t){const n="width"===t?"x":"y",i=e.component.layoutSize.get(t);if(!i||"merged"===i)return[];const r=e.getSizeSignalRef(t).signal;if("step"===i){const t=e.getScaleComponent(n);if(t){const i=t.get("type"),o=t.get("range");if(qi(i)&&Xn(o)){const i=e.scaleName(n);if(Fd(e.parent)){if("independent"===e.parent.component.resolve.scale[n])return[zc(i,o)]}return[zc(i,o),{name:r,update:Pc(i,t,`domain('${i}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==i){const t=r.endsWith("width"),n=t?"containerSize()[0]":"containerSize()[1]",i=`isFinite(${n}) ? ${n} : ${fs(e.config.view,t?"width":"height")}`;return[{name:r,init:i,on:[{update:i,events:"window:resize"}]}]}return[{name:r,value:i}]}function zc(e,t){return{name:e+"_step",value:t.step}}function Pc(e,t,n){const i=t.get("type"),r=t.get("padding"),o=ae(t.get("paddingOuter"),r);let s=t.get("paddingInner");return s="band"===i?void 0!==s?s:r:1,`bandspace(${n}, ${s}, ${o}) * ${e}_step`}function Nc(e){return"childWidth"===e?"width":"childHeight"===e?"height":e}function Lc(e,t){return V(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),qa(t,r,i,e=>Yn(e)?e:{value:e.value}))},{})}function Mc(e,t){if(Cd(t)||Fd(t))return"shared";if(kd(t))return Nt(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function Tc(e,t){const n=e.scale[t],i=Nt(t)?"axis":"legend";return"independent"===n?("shared"===e[i][t]&&Bn(function(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}(t)),"independent"):e[i][t]||"shared"}const qc=Object.assign(Object.assign({},{aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1}),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),Rc=V(qc);class Uc extends Ks{}const Wc={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:o}){var s,a,u,l,f,d,g,p;if("symbol"!==o)return;const{markDef:m,encoding:h,config:b,mark:v}=n,y=m.filled&&"trail"!==v;let x=Object.assign(Object.assign({},function(e,t,n){for(const i of n){const n=vo(i,t.markDef,t.config);void 0!==n&&(e[i]=go(n))}return e}({},n,Le)),Ja(n,{filled:y}));const O=null!==(s=r.get("symbolOpacity"))&&void 0!==s?s:b.legend.symbolOpacity,w=null!==(a=r.get("symbolFillColor"))&&void 0!==a?a:b.legend.symbolFillColor,j=null!==(u=r.get("symbolStrokeColor"))&&void 0!==u?u:b.legend.symbolStrokeColor,A=void 0===O?null!==(l=Ic(h.opacity))&&void 0!==l?l:m.opacity:void 0;if(x.fill)if("fill"===i||y&&i===ut)delete x.fill;else if(x.fill.field)w?delete x.fill:(x.fill=go(null!==(f=b.legend.symbolBaseFillColor)&&void 0!==f?f:"black"),x.fillOpacity=go(null!=A?A:1));else if(c(x.fill)){const e=null!==(p=null!==(g=Hc(null!==(d=h.fill)&&void 0!==d?d:h.color))&&void 0!==g?g:m.fill)&&void 0!==p?p:y&&m.color;e&&(x.fill=go(e))}if(x.stroke)if("stroke"===i||!y&&i===ut)delete x.stroke;else if(x.stroke.field||j)delete x.stroke;else if(c(x.stroke)){const e=ae(Hc(h.stroke||h.color),m.stroke,y?m.color:void 0);e&&(x.stroke={value:e})}if("opacity"!==i){const e=Sr(t)&&Vc(n,r,t);e?x.opacity=[Object.assign({test:e},go(null!=A?A:1)),go(b.legend.unselectedOpacity)]:A&&(x.opacity=go(A))}return x=Object.assign(Object.assign({},x),e),G(x)?void 0:x},gradient:function(e,{model:t,legendType:n,legendCmpt:i}){var r;if("gradient"!==n)return;const{config:o,markDef:s,encoding:a}=t;let u={};const l=void 0===(null!==(r=i.get("gradientOpacity"))&&void 0!==r?r:o.legend.gradientOpacity)?Ic(a.opacity)||s.opacity:void 0;l&&(u.opacity=go(l));return u=Object.assign(Object.assign({},u),e),G(u)?void 0:u},labels:function(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const o=n.legend(i)||{},s=n.config,a=Sr(t)?Vc(n,r,t):void 0,u=a?[{test:a,value:1},{value:s.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=o,f=ir(c)?ar({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:c,config:s}):void 0,d=Object.assign(Object.assign(Object.assign({},u?{opacity:u}:{}),f?{text:f}:{}),e);return G(d)?void 0:d},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function Ic(e){return Gc(e,(e,t)=>Math.max(e,t.value))}function Hc(e){return Gc(e,(e,t)=>ae(e,t.value))}function Gc(e,t){return function(e){const t=e&&e.condition;return!!t&&(c(t)||Lr(t))}(e)?h(e.condition).reduce(t,e.value):Lr(e)?e.value:void 0}function Vc(e,t,n){const i=t.get("selections");if(!(null==i?void 0:i.length))return;const r=w(n.field);return i.map(e=>`(!length(data(${w(Q(e)+Ru)})) || (${e}[${r}] && indexof(${e}[${r}], datum.value) >= 0))`).join(" || ")}const Jc={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return ur(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return lr(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return null!==(n=null!==(t=i.gradientLength)&&void 0!==t?t:r.gradientLength)&&void 0!==n?n:function({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:o,gradientHorizontalMinLength:s,gradientVerticalMaxLength:a,gradientVerticalMinLength:u}=e;if(Ui(r))return"horizontal"===n?"top"===i||"bottom"===i?Qc(t,"width",s,o):s:Qc(t,"height",u,a);return}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return null!==(r=null!==(i=e.labelOverlap)&&void 0!==i?i:t.labelOverlap)&&void 0!==r?r:function(e){if(M(["quantile","threshold","log"],e))return"greedy";return}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return null!==(r=e.symbolType)&&void 0!==r?r:function(e,t,n,i){var r;if("shape"!==t){const e=null!==(r=Hc(n))&&void 0!==r?r:i;if(e)return e}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>Yr(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(vt(n)&&Ui(t)){if("gradient"===e)return}else if("symbol"===e)return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(e,t){const n=e.values;if(c(n))return uo(t,n);if(Yn(n))return n;return}(t,e)};function Yc(e){const{legend:t}=e;return ae(t.type,function({channel:e,timeUnit:t,scaleType:n}){if(vt(e)){if(M(["quarter","month","day"],t))return"symbol";if(Ui(n))return"gradient"}return"symbol"}(e))}function Xc({legendConfig:e,legendType:t,orient:n,legend:i}){var r,o;return null!==(o=null!==(r=i.direction)&&void 0!==r?r:e[t?"gradientDirection":"symbolDirection"])&&void 0!==o?o:function(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===t?"horizontal":void 0}}(n,t)}function Qc(e,t,n,i){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${i})`}}function Kc(e){const t=Dd(e)?function(e){const{encoding:t}=e,n={};for(const i of[ut,...es]){const r=eo(t[i]);r&&e.getScaleComponent(i)&&(i===ft&&Sr(r)&&r.type===bi||(n[i]=ef(e,i)))}return n}(e):function(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){Kc(i);for(const r of V(i.component.legends))n.legend[r]=Tc(e.component.resolve,r),"shared"===n.legend[r]&&(t[r]=tf(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of V(t))for(const t of e.children)t.component.legends[i]&&"shared"===n.legend[i]&&delete t.component.legends[i];return t}(e);return e.component.legends=t,t}function Zc(e,t,n,i){switch(t){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===t&&e===(null==i?void 0:i.title))return!0}return e===(n||{})[t]}function ef(e,t){var n,i,r;let o=e.legend(t);const{markDef:s,encoding:a,config:u}=e,l=u.legend,c=new Uc({},function(e,t){const n=e.scaleName(t);if("trail"===e.mark){if("color"===t)return{stroke:n};if("size"===t)return{strokeWidth:n}}return"color"===t?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}(e,t));!function(e,t,n){var i;const r=null===(i=e.fieldDef(t))||void 0===i?void 0:i.field;Gu(e,e=>{var i,o;const s=null!==(i=e.project.hasField[r])&&void 0!==i?i:e.project.hasChannel[t];if(s&&Au.has(e)){const t=null!==(o=n.get("selections"))&&void 0!==o?o:[];t.push(e.name),n.set("selections",t,!1),s.hasLegend=!0}})}(e,t,c);const f=void 0!==o?!o:l.disable;if(c.set("disable",f,void 0!==o),f)return c;o=o||{};const d=e.getScaleComponent(t).get("type"),g=eo(a[t]),p=Sr(g)?null===(n=Jn(g.timeUnit))||void 0===n?void 0:n.unit:void 0,m=o.orient||u.legend.orient||"right",h=Yc({legend:o,channel:t,timeUnit:p,scaleType:d}),b={legend:o,channel:t,model:e,markDef:s,encoding:a,fieldOrDatumDef:g,legendConfig:l,config:u,scaleType:d,orient:m,legendType:h,direction:Xc({legend:o,legendType:h,orient:m,legendConfig:l})};for(const n of Rc){if("gradient"===h&&n.startsWith("symbol")||"symbol"===h&&n.startsWith("gradient"))continue;const i=n in Jc?Jc[n](b):o[n];if(void 0!==i){const r=Zc(i,n,o,e.fieldDef(t));(r||void 0===u.legend[n])&&c.set(n,i,r)}}const v=null!==(i=null==o?void 0:o.encoding)&&void 0!==i?i:{},y=c.get("selections"),x={},O={fieldOrDatumDef:g,model:e,channel:t,legendCmpt:c,legendType:h};for(const t of["labels","legend","title","symbols","gradient","entries"]){const n=Lc(null!==(r=v[t])&&void 0!==r?r:{},e),i=t in Wc?Wc[t](n,O):n;void 0===i||G(i)||(x[t]=Object.assign(Object.assign(Object.assign({},(null==y?void 0:y.length)&&Sr(g)?{name:`${Q(g.field)}_legend_${t}`}:{}),(null==y?void 0:y.length)?{interactive:!!y}:{}),{update:i}))}return G(x)||c.set("encode",x,!!(null==o?void 0:o.encoding)),c}function tf(e,t){var n,i,r,o;if(!e)return t.clone();const s=e.getWithExplicit("orient"),a=t.getWithExplicit("orient");if(s.explicit&&a.explicit&&s.value!==a.value)return;let u=!1;for(const n of Rc){const i=ia(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",(e,t)=>{switch(n){case"symbolType":return nf(e,t);case"title":return Ao(e,t);case"type":return u=!0,ea("symbol")}return na(e,t,n,"legend")});e.setWithExplicit(n,i)}return u&&((null===(i=null===(n=e.implicit)||void 0===n?void 0:n.encode)||void 0===i?void 0:i.gradient)&&Z(e.implicit,["encode","gradient"]),(null===(o=null===(r=e.explicit)||void 0===r?void 0:r.encode)||void 0===o?void 0:o.gradient)&&Z(e.explicit,["encode","gradient"])),e}function nf(e,t){return"circle"===t.value?t:e}function rf(e,t,n,i){var r,o,s;e.encode=null!==(r=e.encode)&&void 0!==r?r:{},e.encode[t]=null!==(o=e.encode[t])&&void 0!==o?o:{},e.encode[t].update=null!==(s=e.encode[t].update)&&void 0!==s?s:{},e.encode[t].update[n]=i}function of(e){const t=e.component.legends,n={};for(const i of V(t)){const r=e.getScaleComponent(i),o=P(r.get("domains"));if(n[o])for(const e of n[o]){tf(e,t[i])||n[o].push(t[i])}else n[o]=[t[i].clone()]}return J(n).flat().map(t=>function(e,t){var n,i,r;const o=e.combine(),{disable:s,labelExpr:a,selections:u}=o,l=A(o,["disable","labelExpr","selections"]);if(s)return;!1===t.aria&&null==l.aria&&(l.aria=!1);if(null===(n=l.encode)||void 0===n?void 0:n.symbols){const e=l.encode.symbols.update;!e.fill||"transparent"===e.fill.value||e.stroke||l.stroke||(e.stroke={value:"transparent"});for(const t of es)l[t]&&delete e[t]}l.title||delete l.title;if(void 0!==a){let e=a;(null===(r=null===(i=l.encode)||void 0===i?void 0:i.labels)||void 0===r?void 0:r.update)&&Yn(l.encode.labels.update.text)&&(e=re(a,"datum.label",l.encode.labels.update.text.signal)),rf(l,"labels","text",{signal:e})}for(const e in l){const t=l[e];if(Yn(t)){const n=ts[e];if(n){const{vgProp:i,part:r}=n;rf(l,r,i,t),delete l[e]}}}return l}(t,e.config)).filter(e=>void 0!==e)}function sf(e){return Cd(e)||kd(e)?function(e){return e.children.reduce((e,t)=>e.concat(t.assembleProjections()),af(e))}(e):af(e)}function af(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(e=>e.signal).join(", ")}]`},o=t.data.reduce((t,n)=>{const i=Yn(n)?n.signal:`data('${e.lookupDataSource(n)}')`;return M(t,i)||t.push(i),t},[]);if(o.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:o.length>1?`[${o.join(", ")}]`:o[0]}},n)]}return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const uf=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class lf extends Ks{constructor(e,t,n,i){super(Object.assign({},t),{name:e}),this.specifiedProjection=t,this.size=n,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function cf(e){e.component.projection=Dd(e)?function(e){var t;if(e.hasProjection){const n=e.specifiedProjection,i=!(n&&(null!=n.scale||null!=n.translate)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,o=i?function(e){const t=[],{encoding:n}=e;for(const i of[["longitude","latitude"],["longitude2","latitude2"]])(eo(n[i[0]])||eo(n[i[1]]))&&t.push({signal:e.getName("geojson_"+t.length)});e.channelHasField(ft)&&e.typedFieldDef(ft).type===bi&&t.push({signal:e.getName("geojson_"+t.length)});0===t.length&&t.push(e.requestDataName(da.Main));return t}(e):void 0;return new lf(e.projectionName(!0),Object.assign(Object.assign({},null!==(t=e.config.projection)&&void 0!==t?t:{}),null!=n?n:{}),r,o)}return}(e):function(e){if(0===e.children.length)return;let t;for(const t of e.children)cf(t);const n=q(e.children,e=>{const n=e.component.projection;if(n){if(t){const e=function(e,t){const n=q(uf,n=>!v(e.explicit,n)&&!v(t.explicit,n)||!(!v(e.explicit,n)||!v(t.explicit,n)||P(e.get(n))!==P(t.get(n))));if(P(e.size)===P(t.size)){if(n)return e;if(P(e.explicit)===P({}))return t;if(P(t.explicit)===P({}))return e}return null}(t,n);return e&&(t=e),!!e}return t=n,!0}return!0});if(t&&n){const n=e.projectionName(!0),i=new lf(n,t.specifiedProjection,t.size,B(t.data));for(const t of e.children){const e=t.component.projection;e&&(e.isFit&&i.data.push(...t.component.projection.data),t.renameProjection(e.get("name"),n),e.merged=!0)}return i}return}(e)}function ff(e,t){return`${Yt(e)}_${t}`}function df(e,t,n){var i;const r=ff(null!==(i=ro(n,void 0))&&void 0!==i?i:{},t);return e.getName(r+"_bins")}function gf(e,t,n){let i,r;i=function(e){return"as"in e}(e)?O(e.as)?[e.as,e.as+"_end"]:[e.as[0],e.as[1]]:[Wr(e,{forAs:!0}),Wr(e,{binSuffix:"end",forAs:!0})];const o=Object.assign({},ro(t,void 0)),s=ff(o,e.field),{signal:a,extentSignal:u}=function(e,t){return{signal:e.getName(t+"_bins"),extentSignal:e.getName(t+"_extent")}}(n,s);if(Zt(o.extent)){const e=o.extent,t=e.selection;r=Ql(n.getSelectionComponent(Q(t),t),e),delete o.extent}return{key:s,binComponent:Object.assign(Object.assign(Object.assign({bin:o,field:e.field,as:[i]},a?{signal:a}:{}),u?{extentSignal:u}:{}),r?{span:r}:{})}}class pf extends pu{constructor(e,t){super(e),this.bins=t}clone(){return new pf(null,B(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((e,n,i)=>{if(Nr(n)&&Xt(n.bin)){const{key:r,binComponent:o}=gf(n,n.bin,t);e[r]=Object.assign(Object.assign(Object.assign({},o),e[r]),function(e,t,n,i){var r,o;if(lo(t,n)){const s=Dd(e)&&null!==(o=null!==(r=e.axis(n))&&void 0!==r?r:e.legend(n))&&void 0!==o?o:{},a=Wr(t,{expr:"datum"}),u=Wr(t,{expr:"datum",binSuffix:"end"});return{formulaAs:Wr(t,{binSuffix:"range",forAs:!0}),formula:gr(a,u,s.format,s.formatType,i)}}return{}}(t,n,i,t.config))}return e},{});return G(n)?null:new pf(e,n)}static makeFromTransform(e,t,n){const{key:i,binComponent:r}=gf(t,t.bin,n);return new pf(e,{[i]:r})}merge(e,t){for(const n of V(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=U([...this.bins[n].as,...e.bins[n].as],N)):this.bins[n]=e.bins[n];for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(J(this.bins).map(e=>e.as).flat(2))}dependentFields(){return new Set(J(this.bins).map(e=>e.field))}hash(){return"Bin "+N(this.bins)}assemble(){return J(this.bins).flatMap(e=>{const t=[],[n,...i]=e.as,r=e.bin,{extent:o}=r,s=A(r,["extent"]),a=Object.assign(Object.assign(Object.assign({type:"bin",field:ie(e.field),as:n,signal:e.signal},Zt(o)?{extent:null}:{extent:o}),e.span?{span:{signal:`span(${e.span})`}}:{}),s);!o&&e.extentSignal&&(t.push({type:"extent",field:ie(e.field),signal:e.extentSignal}),a.extent={signal:e.extentSignal}),t.push(a);for(const e of i)for(let i=0;i<2;i++)t.push({type:"formula",expr:Wr({field:n[i]},{expr:"datum"}),as:e[i]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t})}}class mf extends pu{constructor(e){let t;if(super(null),ua(e=null!=e?e:{name:"source"})||(t=e.format?Object.assign({},z(e.format,["parse"])):{}),sa(e))this._data={values:e.values};else if(oa(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];M(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else ca(e)?this._data={values:[{type:"Sphere"}]}:(aa(e)||ua(e))&&(this._data={});this._generator=ua(e),e.name&&(this._name=e.name),t&&!G(t)&&(this._data.format=t)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}class hf extends pu{constructor(e,t){super(e),this.params=t}clone(){return new hf(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return"Graticule "+N(this.params)}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class bf extends pu{constructor(e,t){super(e),this.params=t}clone(){return new bf(null,this.params)}dependentFields(){return new Set}producedFields(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}hash(){return"Hash "+N(this.params)}assemble(){return Object.assign({type:"sequence"},this.params)}}function vf(e){return e instanceof mf||e instanceof hf||e instanceof bf}class yf{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class xf extends yf{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:e,mutatedFlag:t}){e&&this.setContinue(),t&&this.setMutated()}reset(){}optimizeNextFromLeaves(e){if(vf(e))return!1;const t=e.parent,{continueFlag:n}=this.run(e);return n&&this.optimizeNextFromLeaves(t),this.mutatedFlag}}class Of extends yf{}function wf(e,t,n,i){const r=Dd(i)?i.encoding[St(t)]:void 0;if(Nr(n)&&Dd(i)&&Fr(t,n,r,i.stack,i.markDef,i.config))e.add(Wr(n,{})),e.add(Wr(n,{suffix:"end"})),n.bin&&lo(n,t)&&e.add(Wr(n,{binSuffix:"range"}));else if(t in mt){const n=function(e){switch(e){case"latitude":return"y";case"latitude2":return"y2";case"longitude":return"x";case"longitude2":return"x2"}}(t);e.add(i.getName(n))}else e.add(Wr(n));return e}class jf extends pu{constructor(e,t,n){super(e),this.dimensions=t,this.measures=n}clone(){return new jf(null,new Set(this.dimensions),B(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef(e=>{e.aggregate&&(n=!0)});const i={},r=new Set;return n?(t.forEachFieldDef((e,n)=>{var o,s,a,u;const{aggregate:l,field:c}=e;if(l)if("count"===l)i["*"]=null!==(o=i["*"])&&void 0!==o?o:{},i["*"].count=new Set([Wr(e,{forAs:!0})]);else{if(Ge(l)||Ve(l)){const e=Ge(l)?"argmin":"argmax",t=l[e];i[t]=null!==(s=i[t])&&void 0!==s?s:{},i[t][e]=new Set([Wr({op:e,field:t},{forAs:!0})])}else i[c]=null!==(a=i[c])&&void 0!==a?a:{},i[c][l]=new Set([Wr(e,{forAs:!0})]);It(n)&&"unaggregated"===t.scaleDomain(n)&&(i[c]=null!==(u=i[c])&&void 0!==u?u:{},i[c].min=new Set([Wr({field:c,aggregate:"min"},{forAs:!0})]),i[c].max=new Set([Wr({field:c,aggregate:"max"},{forAs:!0})]))}else wf(r,n,e,t)}),r.size+V(i).length===0?null:new jf(e,r,i)):null}static makeFromTransform(e,t){var n,i,r;const o=new Set,s={};for(const e of t.aggregate){const{op:t,field:r,as:o}=e;t&&("count"===t?(s["*"]=null!==(n=s["*"])&&void 0!==n?n:{},s["*"].count=new Set([o||Wr(e,{forAs:!0})])):(s[r]=null!==(i=s[r])&&void 0!==i?i:{},s[r][t]=new Set([o||Wr(e,{forAs:!0})])))}for(const e of null!==(r=t.groupby)&&void 0!==r?r:[])o.add(e);return o.size+V(s).length===0?null:new jf(e,o,s)}merge(e){return function(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}(this.dimensions,e.dimensions)?(function(e,t){var n;for(const i of V(t)){const r=t[i];for(const t of V(r))i in e?e[i][t]=new Set([...null!==(n=e[i][t])&&void 0!==n?n:[],...r[t]]):e[i]={[t]:r[t]}}}(this.measures,e.measures),!0):(function(...e){$n.debug(...e)}("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...V(this.measures)])}producedFields(){const e=new Set;for(const t of V(this.measures))for(const n of V(this.measures[t])){const i=this.measures[t][n];0===i.size?e.add(`${n}_${t}`):i.forEach(e.add,e)}return e}hash(){return"Aggregate "+N({dimensions:this.dimensions,measures:this.measures})}assemble(){const e=[],t=[],n=[];for(const i of V(this.measures))for(const r of V(this.measures[i]))for(const o of this.measures[i][r])n.push(o),e.push(r),t.push("*"===i?null:ie(i));return{type:"aggregate",groupby:[...this.dimensions].map(ie),ops:e,fields:t,as:n}}}class Af extends pu{constructor(e,t,n,i){super(e),this.model=t,this.name=n,this.data=i;for(const e of xt){const n=t.facet[e];if(n){const{bin:i,sort:r}=n;this[e]=Object.assign({name:t.getName(e+"_domain"),fields:[Wr(n),...Xt(i)?[Wr(n,{binSuffix:"end"})]:[]]},vr(r)?{sortField:r}:c(r)?{sortIndexField:hc(n,e)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of xt)this[t]&&(e+=` ${t.charAt(0)}:${N(this[t])}`);return e}get fields(){var e;const t=[];for(const n of xt)(null===(e=this[n])||void 0===e?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of xt)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of Pt){const n=this.childModel.component.scales[t];if(n&&!n.merged){const i=n.get("type"),r=n.get("range");if(qi(i)&&Xn(r)){const n=ad(ud(this.childModel,t));n?e[t]=n:Bn(sn(t))}}}return e}assembleRowColumnHeaderData(e,t,n){const i={row:"y",column:"x"}[e],r=[],o=[],s=[];n&&n[i]&&(t?(r.push("distinct_"+n[i]),o.push("max")):(r.push(n[i]),o.push("distinct")),s.push("distinct_"+n[i]));const{sortField:a,sortIndexField:u}=this[e];if(a){const{op:e=pr,field:t}=a;r.push(t),o.push(e),s.push(Wr(a,{forAs:!0}))}else u&&(r.push(u),o.push("max"),s.push(u));return{name:this[e].name,source:null!=t?t:this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},r.length?{fields:r,ops:o,as:s}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:i}=this.model.layout,{layoutHeaders:r}=this.model.component,o=[],s={};for(const e of xc){for(const i of Oc){const o=null!==(t=r[e]&&r[e][i])&&void 0!==t?t:[];for(const t of o)if((null===(n=t.axes)||void 0===n?void 0:n.length)>0){s[e]=!0;break}}if(s[e]){const t=`length(data("${this.facet.name}"))`,n="row"===e?i?{signal:`ceil(${t} / ${i})`}:1:i?{signal:`min(${t}, ${i})`}:{signal:t};o.push({name:`${this.facet.name}_${e}`,transform:[{type:"sequence",start:0,stop:n}]})}}const{row:a,column:u}=s;return(a||u)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,e)),o}assemble(){var e,t;const n=[];let i=null;const r=this.getChildIndependentFieldsWithStep(),{column:o,row:s,facet:a}=this;if(o&&s&&(r.x||r.y)){i=`cross_${this.column.name}_${this.row.name}`;const o=[].concat(null!==(e=r.x)&&void 0!==e?e:[],null!==(t=r.y)&&void 0!==t?t:[]),s=o.map(()=>"distinct");n.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:o,ops:s}]})}for(const e of[et,Ze])this[e]&&n.push(this.assembleRowColumnHeaderData(e,i,r));if(a){const e=this.assembleFacetHeaderData(r);e&&n.push(...e)}return n}}function Df(e){return"'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]?e.slice(1,-1):e}function Ff(e){const t={};return function e(t,n){if(E(t))e(t.not,n);else if(C(t))for(const i of t.and)e(i,n);else if(k(t))for(const i of t.or)e(i,n);else n(t)}(e.filter,e=>{var n;if(ui(e)){let i=null;ti(e)?i=e.equal:si(e)?i=e.range[0]:ai(e)&&(i=(null!==(n=e.oneOf)&&void 0!==n?n:e.in)[0]),i&&(_n(i)?t[e.field]="date":x(i)?t[e.field]="number":O(i)&&(t[e.field]="string")),e.timeUnit&&(t[e.field]="date")}}),t}function kf(e){const t={};function n(e){var n;so(e)?t[e.field]="date":"quantitative"===e.type&&(O(n=e.aggregate)&&M(["min","max"],n))?t[e.field]="number":se(e.field)>1?e.field in t||(t[e.field]="flatten"):Mr(e)&&vr(e.sort)&&se(e.sort.field)>1&&(e.sort.field in t||(t[e.sort.field]="flatten"))}if((Dd(e)||Fd(e))&&e.forEachFieldDef((t,i)=>{if(Nr(t))n(t);else{const r=Ct(i),o=e.fieldDef(r);n(Object.assign(Object.assign({},t),{type:o.type}))}}),Dd(e)){const{mark:n,markDef:i,encoding:r}=e;if(_e(n)&&!e.encoding.order){const e=r["horizontal"===i.orient?"y":"x"];Sr(e)&&"quantitative"===e.type&&!(e.field in t)&&(t[e.field]="number")}}return t}class Cf extends pu{constructor(e,t){super(e),this._parse=t}clone(){return new Cf(null,B(this._parse))}hash(){return"Parse "+N(this._parse)}static makeExplicit(e,t,n){let i={};const r=t.data;return!ua(r)&&r&&r.format&&r.format.parse&&(i=r.format.parse),this.makeWithAncestors(e,i,{},n)}static makeWithAncestors(e,t,n,i){for(const e of V(n)){const t=i.getWithExplicit(e);void 0!==t.value&&(t.explicit||t.value===n[e]||"derived"===t.value||"flatten"===n[e]?delete n[e]:Bn(fn(e,n[e],t.value)))}for(const e of V(t)){const n=i.get(e);void 0!==n&&(n===t[e]?delete t[e]:Bn(fn(e,t[e],n)))}const r=new Ks(t,n);i.copyAll(r);const o={};for(const e of V(r.combine())){const t=r.get(e);null!==t&&(o[e]=t)}return 0===V(o).length||i.parseNothing?null:new Cf(e,o)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of V(this._parse)){const n=this._parse[t];1===se(t)&&(e[t]=n)}return e}producedFields(){return new Set(V(this._parse))}dependentFields(){return new Set(V(this._parse))}assembleTransforms(e=!1){return V(this._parse).filter(t=>!e||se(t)>1).map(e=>{const t=function(e,t){const n=te(e);if("number"===t)return`toNumber(${n})`;if("boolean"===t)return`toBoolean(${n})`;if("string"===t)return`toString(${n})`;if("date"===t)return`toDate(${n})`;if("flatten"===t)return n;if(0===t.indexOf("date:")){return`timeParse(${n},'${Df(t.slice(5,t.length))}')`}if(0===t.indexOf("utc:")){return`utcParse(${n},'${Df(t.slice(4,t.length))}')`}return Bn(`Unrecognized parse "${t}".`),null}(e,this._parse[e]);if(!t)return null;return{type:"formula",expr:t,as:oe(e)}}).filter(e=>null!==e)}}class Ef extends pu{clone(){return new Ef(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set(["_vgsid_"])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:"_vgsid_"}}}class Sf extends pu{constructor(e,t){super(e),this.transform=t}clone(){return new Sf(null,B(this.transform))}addDimensions(e){this.transform.groupby=U(this.transform.groupby.concat(e),e=>e)}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map(e=>e.field).filter(e=>void 0!==e).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:Wr(e)}hash(){return"JoinAggregateTransform "+N(this.transform)}assemble(){const e=[],t=[],n=[];for(const i of this.transform.joinaggregate)t.push(i.op),n.push(this.getDefaultName(i)),e.push(void 0===i.field?null:i.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},void 0!==i?{groupby:i}:{})}}class $f extends pu{constructor(e,t){super(e),this._stack=t}clone(){return new $f(null,B(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:i,as:r,offset:o="zero"}=t,s=[],a=[];if(void 0!==t.sort)for(const e of t.sort)s.push(e.field),a.push(ae(e.order,"ascending"));const u={field:s,order:a};let l;return l=function(e){return c(e)&&e.every(e=>O(e))&&e.length>1}(r)?r:O(r)?[r,r+"_end"]:[t.stack+"_start",t.stack+"_end"],new $f(e,{stackField:n,groupby:i,offset:o,sort:u,facetby:[],as:l})}static makeFromEncoding(e,t){const n=t.stack,{encoding:i}=t;if(!n)return null;const{groupbyChannel:r,fieldChannel:o,offset:s,impute:a}=n;let u;if(r){u=Zr(i[r])}const l=function(e){return e.stack.stackBy.reduce((e,t)=>{const n=Wr(t.fieldDef);return n&&e.push(n),e},[])}(t),f=t.encoding.order;let d;return d=c(f)||Sr(f)?Oo(f):l.reduce((e,t)=>(e.field.push(t),e.order.push("y"===o?"descending":"ascending"),e),{field:[],order:[]}),new $f(e,{dimensionFieldDef:u,stackField:t.vgField(o),facetby:[],stackby:l,sort:d,offset:s,impute:a,as:[t.vgField(o,{suffix:"start",forAs:!0}),t.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return"Stack "+N(this._stack)}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[Wr(e,{binSuffix:"mid"})]:[Wr(e,{}),Wr(e,{binSuffix:"end"})]:[Wr(e)]:null!=n?n:[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:i,stackby:r,sort:o,offset:s,impute:a,as:u}=this._stack;if(a&&n){const{band:o=.5,bin:s}=n;s&&e.push({type:"formula",expr:o+"*"+Wr(n,{expr:"datum"})+`+${1-o}*`+Wr(n,{expr:"datum",binSuffix:"end"}),as:Wr(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:i,groupby:[...r,...t],key:Wr(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:i,sort:o,as:u,offset:s}),e}}class Bf extends pu{constructor(e,t){super(e),this.transform=t}clone(){return new Bf(null,B(this.transform))}addDimensions(e){this.transform.groupby=U(this.transform.groupby.concat(e),e=>e)}dependentFields(){var e,t;const n=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(n.add,n),(null!==(t=this.transform.sort)&&void 0!==t?t:[]).forEach(e=>n.add(e.field)),this.transform.window.map(e=>e.field).filter(e=>void 0!==e).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:Wr(e)}hash(){return"WindowTransform "+N(this.transform)}assemble(){var e;const t=[],n=[],i=[],r=[];for(const e of this.transform.window)n.push(e.op),i.push(this.getDefaultName(e)),r.push(void 0===e.param?null:e.param),t.push(void 0===e.field?null:e.field);const o=this.transform.frame,s=this.transform.groupby;if(o&&null===o[0]&&null===o[1]&&n.every(e=>Je(e)))return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},void 0!==s?{groupby:s}:{});const a=[],u=[];if(void 0!==this.transform.sort)for(const t of this.transform.sort)a.push(t.field),u.push(null!==(e=t.order)&&void 0!==e?e:"ascending");const l={field:a,order:u},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:r,as:i,ops:n,fields:t,sort:l},void 0!==c?{ignorePeers:c}:{}),void 0!==s?{groupby:s}:{}),void 0!==o?{frame:o}:{})}}class _f extends xf{run(e){const t=e.parent;if(e instanceof Cf){if(vf(t))return this.flags;if(t.numChildren()>1)return this.setContinue(),this.flags;if(t instanceof Cf)this.setMutated(),t.merge(e);else{if(H(t.producedFields(),e.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),e.swapWithParent()}}return this.setContinue(),this.flags}}class zf extends Of{mergeNodes(e,t){const n=t.shift();for(const i of t)e.removeChild(i),i.parent=n,i.remove()}run(e){const t=e.children.map(e=>e.hash()),n={};for(let i=0;i<t.length;i++)void 0===n[t[i]]?n[t[i]]=[e.children[i]]:n[t[i]].push(e.children[i]);for(const t of V(n))n[t].length>1&&(this.setMutated(),this.mergeNodes(e,n[t]));for(const t of e.children)this.run(t);return this.mutatedFlag}}class Pf extends xf{run(e){return e instanceof mu||e.numChildren()>0||e instanceof Af||(this.setMutated(),e.remove()),this.flags}}class Nf extends xf{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(e){if(this.setContinue(),e instanceof hu){const t=e.producedFields();W(t,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...t]),this.prev=e}return this.flags}reset(){this.fields.clear()}}class Lf extends xf{run(e){this.setContinue();const t=e.parent.children.filter(e=>e instanceof hu),n=t.pop();for(const e of t)this.setMutated(),n.merge(e);return this.flags}}function Mf(e){if(e instanceof Af)if(1!==e.numChildren()||e.children[0]instanceof mu){const n=e.model.component.data.main;!function e(t){if(t instanceof mu&&t.type===da.Main&&1===t.numChildren()){const n=t.children[0];n instanceof Af||(n.swapWithParent(),e(t))}}(n);const i=(t=e,function e(n){if(!(n instanceof Af)){const i=n.clone();if(i instanceof mu){const e=Hf+i.getSource();i.setSource(e),t.model.component.data.outputNodes[e]=i}else(i instanceof jf||i instanceof $f||i instanceof Bf||i instanceof Sf)&&i.addDimensions(t.fields);for(const t of n.children.flatMap(e))t.parent=i;return[i]}return n.children.flatMap(e)}),r=e.children.map(i).flat();for(const e of r)e.parent=n}else{const t=e.children[0];(t instanceof jf||t instanceof $f||t instanceof Bf||t instanceof Sf)&&t.addDimensions(e.fields),t.swapWithParent(),Mf(e)}else e.children.map(Mf);var t}class Tf extends Of{constructor(){super()}run(e){e instanceof mu&&!e.isRequired()&&(this.setMutated(),e.remove());for(const t of e.children)this.run(t);return this.mutatedFlag}}class qf extends Of{constructor(e){super(),this.requiresSelectionId=e&&Ju(e)}run(e){e instanceof Ef&&(this.requiresSelectionId&&(vf(e.parent)||e.parent instanceof jf||e.parent instanceof Cf)||(this.setMutated(),e.remove()));for(const t of e.children)this.run(t);return this.mutatedFlag}}class Rf extends xf{run(e){const t=e.parent,n=[...t.children],i=t.children.filter(e=>e instanceof Cf);if(t.numChildren()>1&&i.length>=1){const e={},r=new Set;for(const t of i){const n=t.parse;for(const t of V(n))t in e?e[t]!==n[t]&&r.add(t):e[t]=n[t]}for(const t of r)delete e[t];if(!G(e)){this.setMutated();const i=new Cf(t,e);for(const r of n){if(r instanceof Cf)for(const t of V(e))delete r.parse[t];t.removeChild(r),r.parent=i,r instanceof Cf&&0===V(r.parse).length&&r.remove()}}}return this.setContinue(),this.flags}}class Uf extends xf{run(e){const t=e.parent,n=t.children.filter(e=>e instanceof jf),i={};for(const e of n){const t=N(e.groupBy);t in i||(i[t]=[]),i[t].push(e)}for(const e of V(i)){const n=i[e];if(n.length>1){const e=n.pop();for(const i of n)e.merge(i)&&(t.removeChild(i),i.parent=e,i.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class Wf extends xf{constructor(e){super(),this.model=e}run(e){const t=e.parent,n=!(vf(t)||t instanceof Yl||t instanceof Cf||t instanceof Ef),i=[],r=[];for(const e of t.children)e instanceof pf&&(n&&!H(t.producedFields(),e.dependentFields())?i.push(e):r.push(e));if(i.length>0){const e=i.pop();for(const t of i)e.merge(t,this.model.renameSignal.bind(this.model));this.setMutated(),t instanceof pf?t.merge(e,this.model.renameSignal.bind(this.model)):e.swapWithParent()}if(r.length>1){const e=r.pop();for(const t of r)e.merge(t,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class If extends xf{run(e){const t=e.parent,n=[...t.children];if(!T(n,e=>e instanceof mu)||t.numChildren()<=1)return this.setContinue(),this.flags;const i=[];let r;for(const e of n)if(e instanceof mu){let n=e;for(;1===n.numChildren();){const[e]=n.children;if(!(e instanceof mu))break;n=e}i.push(...n.children),r?(t.removeChild(e),e.parent=r.parent,r.parent.removeChild(r),r.parent=n,this.setMutated()):r=n}else i.push(e);if(i.length){this.setMutated();for(const e of i)e.parent.removeChild(e),e.parent=r}return this.setContinue(),this.flags}}const Hf="scale_";function Gf(e){for(const t of e){for(const e of t.children)if(e.parent!==t)return!1;if(!Gf(t.children))return!1}return!0}function Vf(e){const t=[];function n(e){if(0===e.numChildren())t.push(e);else for(const t of e.children)n(t)}for(const t of e)n(t);return t}function Jf(e){return e}function Yf(e,t){return t.map(t=>{if(e instanceof xf){const n=e.optimizeNextFromLeaves(t);return e.reset(),n}return e.run(t)}).some(Jf)}function Xf(e,t,n){let i=e.sources;const r=new Set;return r.add(Yf(new Tf,i)),r.add(Yf(new qf(t),i)),i=i.filter(e=>e.numChildren()>0),r.add(Yf(new Pf,Vf(i))),i=i.filter(e=>e.numChildren()>0),n||(r.add(Yf(new _f,Vf(i))),r.add(Yf(new Wf(t),Vf(i))),r.add(Yf(new Nf,Vf(i))),r.add(Yf(new Rf,Vf(i))),r.add(Yf(new Uf,Vf(i))),r.add(Yf(new Lf,Vf(i))),r.add(Yf(new zf,i)),r.add(Yf(new If,Vf(i)))),e.sources=i,r.has(!0)}class Qf{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new Qf(()=>e(t))}}function Kf(e){Dd(e)?function(e){const t=e.component.scales;for(const n of V(t)){const i=Zf(e,n);if(t[n].setWithExplicit("domains",i),id(e,n),e.component.data.isFaceted){let t=e;for(;!Fd(t)&&t.parent;)t=t.parent;if("shared"===t.component.resolve.scale[n])for(const e of i.value)Qn(e)&&(e.data=Hf+e.data.replace(Hf,""))}}}(e):function(e){for(const t of e.children)Kf(t);const t=e.component.scales;for(const n of V(t)){let i,r=null;for(const t of e.children){const e=t.component.scales[n];if(e){i=void 0===i?e.getWithExplicit("domains"):ia(i,e.getWithExplicit("domains"),"domains","scale",od);const t=e.get("selectionExtent");r&&t&&r.selection!==t.selection&&Bn("The same selection must be used to override scale domains in a layered view."),r=t}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}(e)}function Zf(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=function(e,t,n,i){if("unaggregated"===e){const{valid:e,reason:i}=rd(t,n);if(!e)return void Bn(i)}else if(void 0===e&&i.useUnaggregatedDomain){const{valid:e}=rd(t,n);if(e)return"unaggregated"}return e}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),"x"===t&&eo(i.x2)?eo(i.x)?ia(td(n,r,e,"x"),td(n,r,e,"x2"),"domain","scale",od):td(n,r,e,"x2"):"y"===t&&eo(i.y2)?eo(i.y)?ia(td(n,r,e,"y"),td(n,r,e,"y2"),"domain","scale",od):td(n,r,e,"y2"):td(n,r,e,t)}function ed(e,t,n){var i;const r=null===(i=Jn(n))||void 0===i?void 0:i.unit;return"temporal"===t||r?function(e,t,n){return e.map(e=>({signal:`{data: ${ao(e,{timeUnit:n,type:t})}}`}))}(e,t,r):[e]}function td(e,t,n,i){const{encoding:r}=n,o=eo(r[i]),{type:s}=o,a=o.timeUnit;if(function(e){return e&&e.unionWith}(t)){const r=td(e,void 0,n,i),o=ed(t.unionWith,s,a);return Zs([...r.value,...o])}if(Yn(t))return Zs([t]);if(t&&"unaggregated"!==t&&!Ii(t))return Zs(ed(t,s,a));const u=n.stack;if(u&&i===u.fieldChannel){if("normalize"===u.offset)return ea([[0,1]]);const e=n.requestDataName(da.Main);return ea([{data:e,field:n.vgField(i,{suffix:"start"})},{data:e,field:n.vgField(i,{suffix:"end"})}])}const l=It(i)&&Sr(o)?function(e,t,n){if(!qi(n))return;const i=e.fieldDef(t),r=i.sort;if(yr(r))return{op:"min",field:hc(i,t),order:"ascending"};const{stack:o}=e,s=o?[...o.groupbyField?[o.groupbyField]:[],...o.stackBy.map(e=>e.fieldDef.field)]:void 0;if(vr(r)){const e=o&&!M(s,r.field);return nd(r,e)}if(br(r)){const{encoding:t,order:n}=r,i=e.fieldDef(t),{aggregate:a,field:u}=i,l=o&&!M(s,u);if(Ge(a)||Ve(a))return nd({field:Wr(i),order:n},l);if(Je(a)||!a)return nd({op:a,field:u,order:n},l)}else{if("descending"===r)return{op:"min",field:e.vgField(t),order:"descending"};if(M(["ascending",void 0],r))return!0}return}(n,i,e):void 0;if(Br(o)){return ea(ed([o.datum],s,a))}const c=o;if("unaggregated"===t){const e=n.requestDataName(da.Main),{field:t}=o;return ea([{data:e,field:Wr({field:t,aggregate:"min"})},{data:e,field:Wr({field:t,aggregate:"max"})}])}if(Xt(c.bin)){if(qi(e))return ea("bin-ordinal"===e?[]:[{data:X(l)?n.requestDataName(da.Main):n.requestDataName(da.Raw),field:n.vgField(i,lo(c,i)?{binSuffix:"range"}:{}),sort:!0!==l&&f(l)?l:{field:n.vgField(i,{}),op:"min"}}]);{const{bin:e}=c;if(Xt(e)){const t=df(n,c.field,e);return ea([new Qf(()=>{const e=n.getSignalName(t);return`[${e}.start, ${e}.stop]`})])}return ea([{data:n.requestDataName(da.Main),field:n.vgField(i,{})}])}}if(c.timeUnit&&M(["time","utc"],e)&&Fr(i,c,Dd(n)?n.encoding[St(i)]:void 0,n.stack,n.markDef,n.config)){const e=n.requestDataName(da.Main);return ea([{data:e,field:n.vgField(i)},{data:e,field:n.vgField(i,{suffix:"end"})}])}return ea(l?[{data:X(l)?n.requestDataName(da.Main):n.requestDataName(da.Raw),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(da.Main),field:n.vgField(i)}])}function nd(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:null!=n?n:t?"sum":pr},i?{field:ie(i)}:{}),r?{order:r}:{})}function id(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,o=null===(n=e.fieldDef(t))||void 0===n?void 0:n.bin,s=Ii(r)&&r,a=Kt(o)&&Zt(o.extent)&&o.extent;(s||a)&&i.set("selectionExtent",null!=s?s:a,!0)}function rd(e,t){const{aggregate:n,type:i}=e;return n?O(n)&&!Ke[n]?{valid:!1,reason:xn(n)}:"quantitative"===i&&"log"===t?{valid:!1,reason:On(e)}:{valid:!0}:{valid:!1,reason:yn(e)}}function od(e,t,n,i){return e.explicit&&t.explicit&&Bn(function(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${P(n)} and ${P(i)}). Using the union of the two domains.`}(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function sd(e){const t=U(e.map(e=>{if(Qn(e)){return A(e,["sort"])}return e}),N),n=U(e.map(e=>{if(Qn(e)){const t=e.sort;return void 0===t||X(t)||("op"in t&&"count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}}).filter(e=>void 0!==e),N);if(0===t.length)return;if(1===t.length){const t=e[0];if(Qn(t)&&n.length>0){let e=n[0];if(n.length>1)Bn(An),e=!0;else if(f(e)&&"field"in e){const n=e.field;t.field===n&&(e=!e.order||{order:e.order})}return Object.assign(Object.assign({},t),{sort:e})}return t}const i=U(n.map(e=>X(e)||!("op"in e)||e.op in He?e:(Bn(function(e){return`Dropping sort property ${P(e)} as unioned domains only support boolean or op "count", "min", and "max".`}(e)),!0)),N);let r;1===i.length?r=i[0]:i.length>1&&(Bn(An),r=!0);const o=U(e.map(e=>Qn(e)?e.data:null),e=>e);if(1===o.length&&null!==o[0]){return Object.assign({data:o[0],fields:t.map(e=>e.field)},r?{sort:r}:{})}return Object.assign({fields:t},r?{sort:r}:{})}function ad(e){if(Qn(e)&&O(e.field))return e.field;if(function(e){return!c(e)&&("fields"in e&&!("data"in e))}(e)){let t;for(const n of e.fields)if(Qn(n)&&O(n.field))if(t){if(t!==n.field)return Bn("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),t}else t=n.field;return Bn("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),t}if(function(e){return!c(e)&&("fields"in e&&"data"in e)}(e)){Bn("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const t=e.fields[0];return O(t)?t:void 0}}function ud(e,t){return sd(e.component.scales[t].get("domains").map(t=>(Qn(t)&&(t.data=e.lookupDataSource(t.data)),t)))}function ld(e){return V(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:o,type:s,selectionExtent:a,domains:u,range:l,reverse:c}=r,d=A(r,["name","type","selectionExtent","domains","range","reverse"]),g=function(e,t,n,i){if(Nt(n)){if(Xn(e))return{step:{signal:t+"_step"}}}else if(f(e)&&Qn(e))return Object.assign(Object.assign({},e),{data:i.lookupDataSource(e.data)});return e}(r.range,o,n,e);let p;a&&(p=function(e,t){const n=t.selection;return{signal:Ql(e.getSelectionComponent(n,Q(n)),t)}}(e,a));const m=ud(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:o,type:s},m?{domain:m}:{}),p?{domainRaw:p}:{}),{range:g}),void 0!==c?{reverse:c}:{}),d)),t},[])}class cd extends Ks{constructor(e,t){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||T(this.get("domains"),e=>c(e)&&2===e.length&&e[0]<=0&&e[1]>=0)}}const fd=["range","scheme"];function dd(e){return"x"===e?"width":"y"===e?"height":void 0}function gd(e,t){const n=e.fieldDef(t);if(n&&n.bin&&Xt(n.bin)){const i=df(e,n.field,n.bin),r=dd(t),o=e.getName(r);return new Qf(()=>{const t=e.getSignalName(i),n=`(${t}.stop - ${t}.start) / ${t}.step`;return`${e.getSignalName(o)} / (${n})`})}}function pd(e,t){const n=t.specifiedScales[e],{size:i}=t,r=t.getScaleComponent(e).get("type");for(const i of fd)if(void 0!==n[i]){const o=Vi(r,i),s=Ji(e,i);if(o)if(s)Bn(s);else switch(i){case"range":{const i=n.range;if(c(i)){if(Nt(e))return Zs(i.map(e=>{if("width"===e||"height"===e){const n=t.getName(e),i=t.getSignalName.bind(t);return Qf.fromName(i,n)}return e}))}else if(f(i))return Zs({data:t.requestDataName(da.Main),field:i.field,sort:{op:"min",field:t.vgField(e)}});return Zs(i)}case"scheme":return Zs(md(n[i]))}else Bn(wn(r,i,e))}if(e===tt||e===nt){const t=e===tt?"width":"height",n=i[t];if(us(n)){if(qi(r))return Zs({step:n.step});Bn(jn(t))}}const{rangeMin:o,rangeMax:s}=n,a=function(e,t){const{size:n,config:i,mark:r,encoding:o}=t,s=t.getSignalName.bind(t),{type:a}=eo(o[e]),u=t.getScaleComponent(e).get("type"),{domain:l,domainMid:f}=t.specifiedScales[e];switch(e){case tt:case nt:{if(M(["point","band"],u))if(e!==tt||n.width){if(e===nt&&!n.height){const e=gs(i.view,"height");if(us(e))return e}}else{const e=gs(i.view,"width");if(us(e))return e}const r=dd(e),o=t.getName(r);return e===nt&&Ri(u)?[Qf.fromName(s,o),0]:[0,Qf.fromName(s,o)]}case dt:{const o=t.component.scales[e].get("zero"),s=function e(t,n,i){if(n)return Yn(n)?{signal:`${n.signal} ? 0 : ${e(t,!1,i)}`}:0;switch(t){case"bar":case"tick":return i.scale.minBandSize;case"line":case"trail":case"rule":return i.scale.minStrokeWidth;case"text":return i.scale.minFontSize;case"point":case"square":case"circle":return i.scale.minSize}throw new Error(hn("size",t))}(r,o,i),a=function(e,t,n,i){const r={x:gd(n,"x"),y:gd(n,"y")};switch(e){case"bar":case"tick":{if(void 0!==i.scale.maxBandSize)return i.scale.maxBandSize;const e=hd(t,r,i.view);return x(e)?e-1:new Qf(()=>e.signal+" - 1")}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const e=hd(t,r,i.view);return x(e)?Math.pow(.95*e,2):new Qf(()=>`pow(0.95 * ${e.signal}, 2)`)}}throw new Error(hn("size",e))}(r,n,t,i);return Wi(u)?function(e,t,n){const i=()=>{const i=mo(t),r=mo(e),o=`(${i} - ${r}) / (${n} - 1)`;return`sequence(${r}, ${i} + ${o}, ${o})`};return Yn(t)?new Qf(i):{signal:i()}}(s,a,function(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return void 0!==n&&c(n)?n.length+1:(Bn(function(e){return`Domain for ${e} is required for threshold scale.`}(i)),3)}}(u,i,l,e)):[s,a]}case st:return[0,2*Math.PI];case"angle":return[0,360];case ot:return[0,new Qf(()=>`min(${t.getSignalName("width")},${t.getSignalName("height")})/2`)];case"strokeWidth":return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case"strokeDash":return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case ft:return"symbol";case ut:case lt:case ct:return"ordinal"===u?"nominal"===a?"category":"ordinal":void 0!==f?"diverging":"rect"===r||"geoshape"===r?"heatmap":"ramp";case"opacity":case"fillOpacity":case"strokeOpacity":return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+e)}(e,t);return(void 0!==o||void 0!==s)&&Vi(r,"rangeMin")&&c(a)&&2===a.length?Zs([null!=o?o:a[0],null!=s?s:a[1]]):ea(a)}function md(e){return function(e){return!O(e)&&!!e.name}(e)?Object.assign({scheme:e.name},z(e,["name"])):{scheme:e}}function hd(e,t,n){const i=us(e.width)?e.width.step:ds(n,"width"),r=us(e.height)?e.height.step:ds(n,"height");return t.x||t.y?new Qf(()=>`min(${[t.x?t.x.signal:i,t.y?t.y.signal:r].join(", ")})`):Math.min(i,r)}function bd(e,t){Dd(e)?function(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:o,specifiedScales:s}=e;for(const a of V(n)){const u=s[a],l=n[a],c=e.getScaleComponent(a),f=eo(r[a]),d=u[t],g=c.get("type"),p=c.get("padding"),m=c.get("paddingInner"),h=Vi(g,t),b=Ji(a,t);if(void 0!==d&&(h?b&&Bn(b):Bn(wn(g,t,a))),h&&void 0===b)if(void 0!==d){const e=f.timeUnit,n=f.type;switch(t){case"domainMax":case"domainMin":_n(u[t])||"temporal"===n||e?l.set(t,{signal:ao(u[t],{type:n,timeUnit:e})},!0):l.set(t,u[t],!0);break;default:l.copyKeyFromObject(t,u)}}else{const n=t in vd?vd[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:g,scalePadding:p,scalePaddingInner:m,domain:u.domain,markDef:o,config:i}):i.scale[t];void 0!==n&&l.set(t,n,!1)}}}(e,t):xd(e,t)}const vd={bins:({model:e,fieldOrDatumDef:t})=>Sr(t)?function(e,t){const n=t.bin;if(Xt(n)){const i=df(e,t.field,n);return new Qf(()=>e.getSignalName(i))}if(Qt(n)&&Kt(n)&&void 0!==n.step)return{step:n.step};return}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(e,t){if(M([ut,lt,ct],e)&&"nominal"!==t)return"hcl";return}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(e,t,n){var i;if((null===(i=Zr(n))||void 0===i?void 0:i.bin)||M([ji,Ai],e))return;return t in zt||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>function(e,t,n,i,r,o){if(e in zt){if(Ui(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:t,orient:s}=r;if("bar"===t&&(!Sr(i)||!i.bin&&!i.timeUnit)&&("vertical"===s&&"x"===e||"horizontal"===s&&"y"===e))return o.continuousBandSize}if(t===Ci)return n.pointPadding}return}(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:i})=>function(e,t,n,i){if(void 0!==e)return;if(t in zt){const{bandPaddingInner:e,barBandPaddingInner:t,rectBandPaddingInner:r}=i;return ae(e,"bar"===n?t:r)}return}(e,t,n.type,i.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:i,scalePaddingInner:r,config:o})=>function(e,t,n,i,r,o){if(void 0!==e)return;if(t in zt&&n===Ei){const{bandPaddingOuter:e}=o;return ae(e,Yn(r)?{signal:r.signal+"/2"}:r/2)}return}(e,t,n,i.type,r,o.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>function(e,t,n,i){if("x"===n&&void 0!==i.xReverse)return Ri(e)&&"descending"===t?Yn(i.xReverse)?{signal:"!"+i.xReverse.signal}:!i.xReverse:i.xReverse;if(Ri(e)&&"descending"===t)return!0;return}(t,Sr(e)?e.sort:void 0,n,i.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>function(e,t,n,i,r){if(n&&"unaggregated"!==n&&Ri(r)){if(c(n)){const e=n[0],t=n[n.length-1];if(e<=0&&t>=0)return!0}return!1}if("size"===e&&"quantitative"===t.type&&!Wi(r))return!0;if((!Sr(t)||!t.bin)&&M([...Pt,...Mt],e)){const{orient:t,type:n}=i;return!M(["bar","area","line","trail"],n)||!("horizontal"===t&&"y"===e||"vertical"===t&&"x"===e)}return!1}(e,t,n,i,r)};function yd(e){Dd(e)?function(e){const t=e.component.scales;for(const n of Wt){const i=t[n];if(!i)continue;const r=pd(n,e);i.setWithExplicit("range",r)}}(e):xd(e,"range")}function xd(e,t){const n=e.component.scales;for(const n of e.children)"range"===t?yd(n):bd(n,t);for(const i of V(n)){let r;for(const n of e.children){const e=n.component.scales[i];if(e){r=ia(r,e.getWithExplicit(t),t,"scale",ta((e,n)=>{switch(t){case"range":return e.step&&n.step?e.step-n.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function Od(e,t,n,i){const r=function(e,t,n){var i;switch(t.type){case"nominal":case"ordinal":if(vt(e)||"discrete"===Jt(e))return"shape"===e&&"ordinal"===t.type&&Bn(vn(e,"ordinal")),"ordinal";if(e in zt){if(M(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&e in Lt)return"band";return void 0!==t.band||Tr(t)&&(null===(i=t.axis)||void 0===i?void 0:i.tickBand)?"band":"point";case"temporal":return vt(e)?"time":"discrete"===Jt(e)?(Bn(vn(e,"temporal")),"ordinal"):Sr(t)&&t.timeUnit&&Jn(t.timeUnit).utc?"utc":"time";case"quantitative":return vt(e)?Sr(t)&&Xt(t.bin)?"bin-ordinal":"linear":"discrete"===Jt(e)?(Bn(vn(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(gn(t.type))}(t,n,i),{type:o}=e;return It(t)?void 0!==o?function(e,t){if(!It(e))return!1;switch(e){case tt:case nt:case st:case ot:return Ui(t)||M(["band","point"],t);case dt:case"strokeWidth":case"opacity":case"fillOpacity":case"strokeOpacity":case"angle":return Ui(t)||Wi(t)||M(["band","point","ordinal"],t);case ut:case lt:case ct:return"band"!==t;case"strokeDash":return"ordinal"===t||Wi(t);case ft:return"ordinal"===t}}(t,o)?Sr(n)&&(s=o,a=n.type,!(M([pi,hi],a)?void 0===s||qi(s):a===mi?M([ji,Ai,void 0],s):a!==gi||M([yi,xi,Oi,wi,Di,Fi,ki,vi,void 0],s)))?(Bn(function(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}(o,r)),r):o:(Bn(function(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}(t,o,r)),r):r:null;var s,a}function wd(e){Dd(e)?e.component.scales=function(e){const{encoding:t,mark:n}=e;return Wt.reduce((i,r)=>{const o=eo(t[r]);if(o&&n===Be&&r===ft&&o.type===bi)return i;let s=o&&o.scale;if(o&&null!==s&&!1!==s){s=null!=s?s:{};const t=Od(s,r,o,n);i[r]=new cd(e.scaleName(r+"",!0),{value:t,explicit:s.type===t})}return i},{})}(e):e.component.scales=function(e){var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const n of e.children){wd(n);for(const o of V(n.component.scales))if(r.scale[o]=null!==(t=r.scale[o])&&void 0!==t?t:Mc(o,e),"shared"===r.scale[o]){const e=i[o],t=n.component.scales[o].getWithExplicit("type");e?$i(e.value,t.value)?i[o]=ia(e,t,"type","scale",jd):(r.scale[o]="independent",delete i[o]):i[o]=t}}for(const t of V(i)){const r=e.scaleName(t,!0),o=i[t];n[t]=new cd(r,o);for(const n of e.children){const e=n.component.scales[t];e&&(n.renameScale(e.get("name"),r),e.merged=!0)}}return n}(e)}const jd=ta((e,t)=>_i(e)-_i(t));class Ad{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return void 0!==this.nameMap[e]}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function Dd(e){return"unit"===(null==e?void 0:e.type)}function Fd(e){return"facet"===(null==e?void 0:e.type)}function kd(e){return"concat"===(null==e?void 0:e.type)}function Cd(e){return"layer"===(null==e?void 0:e.type)}class Ed{constructor(e,t,n,i,r,o,s){var a,u;this.type=t,this.parent=n,this.config=r,this.view=s,this.children=[],this.correctDataNames=e=>(e.from&&e.from.data&&(e.from.data=this.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=this.lookupDataSource(e.from.facet.data)),e),this.parent=n,this.config=r,this.name=null!==(a=e.name)&&void 0!==a?a:i,this.title=fo(e.title)?{text:e.title}:e.title,this.scaleNameMap=n?n.scaleNameMap:new Ad,this.projectionNameMap=n?n.projectionNameMap:new Ad,this.signalNameMap=n?n.signalNameMap:new Ad,this.data=e.data,this.description=e.description,this.transforms=(null!==(u=e.transform)&&void 0!==u?u:[]).map(e=>ga(e)?{filter:S(e.filter,di)}:e),this.layout="layer"===t||"unit"===t?{}:function(e,t,n){var i,r;const o=n[t],s={},{spacing:a,columns:u}=o;void 0!==a&&(s.spacing=a),void 0!==u&&(wr(e)&&!xr(e.facet)||os(e))&&(s.columns=u),ss(e)&&(s.columns=1);for(const t of cs)if(void 0!==e[t])if("spacing"===t){const n=e[t];s[t]=x(n)?n:{row:null!==(i=n.row)&&void 0!==i?i:a,column:null!==(r=n.column)&&void 0!==r?r:a}}else s[t]=e[t];return s}(e,t,r),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:wr(e)||n&&n.component.data.isFaceted&&void 0===e.data},layoutSize:new Ks,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?B(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(e,{ignoreRange:t}={}){wd(e),Kf(e);for(const t of Gi)bd(e,t);t||yd(e)}(this)}parseProjection(){cf(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Kc(this)}assembleGroupStyle(){var e,t;if("unit"===this.type||"layer"===this.type)return null!==(t=null===(e=this.view)||void 0===e?void 0:e.style)&&void 0!==t?t:"cell"}assembleEncodeFromView(e){const t=A(e,["style"]),n={};for(const e of V(t)){const i=t[e];void 0!==i&&(n[e]=go(i))}return n}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),e||(this.description&&(t.description=go(this.description)),"unit"!==this.type&&"layer"!==this.type)?G(t)?void 0:t:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=t?t:{})}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=A(e,["spacing"]),{component:i,config:r}=this,o=function(e,t){const n={};for(const i of xt){const r=e[i];if(null==r?void 0:r.facetFieldDef){const{titleAnchor:e,titleOrient:o}=yc(["titleAnchor","titleOrient"],r.facetFieldDef,t,i),s=bc(i,o),a=Sc(e,s);void 0!==a&&(n[s]=a)}}return G(n)?void 0:n}(i.layoutHeaders,r);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of xt)e[n].title&&t.push(wc(this,n));for(const e of xc)t=t.concat(Dc(this,e));return t}assembleAxes(){return function(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(e=>ec(e,"grid",t)),...i.map(e=>ec(e,"grid",t)),...n.map(e=>ec(e,"main",t)),...i.map(e=>ec(e,"main",t))].filter(e=>e)}(this.component.axes,this.config)}assembleLegends(){return of(this)}assembleProjections(){return sf(this)}assembleTitle(){var e,t,n;const i=null!==(e=this.title)&&void 0!==e?e:{},{encoding:r}=i,o=A(i,["encoding"]),s=Object.assign(Object.assign(Object.assign({},co(this.config.title).nonMark),o),r?{encode:{update:r}}:{});if(s.text)return M(["unit","layer"],this.type)?M(["middle",void 0],s.anchor)&&(s.frame=null!==(t=s.frame)&&void 0!==t?t:"group"):s.anchor=null!==(n=s.anchor)&&void 0!==n?n:"start",G(s)?void 0:s}assembleGroup(e=[]){const t={};(e=e.concat(this.assembleSignals())).length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||Fd(this.parent)?function e(t){return Cd(t)||kd(t)?t.children.reduce((t,n)=>t.concat(e(n)),ld(t)):ld(t)}(this):[];i.length>0&&(t.scales=i);const r=this.assembleAxes();r.length>0&&(t.axes=r);const o=this.assembleLegends();return o.length>0&&(t.legends=o),t}getName(e){return Q((this.name?this.name+"_":"")+e)}getDataName(e){return this.getName(da[e].toLowerCase())}requestDataName(e){const t=this.getDataName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t}getSizeSignalRef(e){if(Fd(this.parent)){const t=Tt(Nc(e)),n=this.component.scales[t];if(n&&!n.merged){const e=n.get("type"),i=n.get("range");if(qi(e)&&Xn(i)){const e=n.get("name"),i=ad(ud(this,t));if(i){return{signal:Pc(e,n,Wr({aggregate:"distinct",field:i},{expr:"datum"}))}}return Bn(sn(t)),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):Dt(e)&&It(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(`Cannot find a selection named "${t}".`);return n}hasAxisOrientSignalRef(){var e,t;return(null===(e=this.component.axes.x)||void 0===e?void 0:e.some(e=>e.hasOrientSignalRef()))||(null===(t=this.component.axes.y)||void 0===t?void 0:t.some(e=>e.hasOrientSignalRef()))}}class Sd extends Ed{vgField(e,t={}){const n=this.fieldDef(e);if(n)return Wr(n,t)}reduceFieldDef(e,t){return $o(this.getMapping(),(t,n,i)=>{const r=Zr(n);return r?e(t,r,i):t},t)}forEachFieldDef(e,t){So(this.getMapping(),(t,n)=>{const i=Zr(t);i&&e(i,n)},t)}}class $d extends pu{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=B(t);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:"value",null!==(r=o[1])&&void 0!==r?r:"density"]}clone(){return new $d(null,B(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"DensityTransform "+N(this.transform)}assemble(){const e=this.transform,{density:t}=e,n=A(e,["density"]);return Object.assign({type:"kde",field:t},n)}}class Bd extends pu{constructor(e,t){super(e),this.filter=t}clone(){return new Bd(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:i,markDef:r}=t;if("filter"!==bo("invalid",r,n))return null;const o=t.reduceFieldDef((e,n,r)=>{const o=It(r)&&t.getScaleComponent(r);if(o){Ri(o.get("type"))&&"count"!==n.aggregate&&!_e(i)&&(e[n.field]=n)}return e},{});return V(o).length?new Bd(e,o):null}dependentFields(){return new Set(V(this.filter))}producedFields(){return new Set}hash(){return"FilterInvalid "+N(this.filter)}assemble(){const e=V(this.filter).reduce((e,t)=>{const n=this.filter[t],i=Wr(n,{expr:"datum"});return null!==n&&("temporal"===n.type?e.push(`(isDate(${i}) || (isValid(${i}) && isFinite(+${i})))`):"quantitative"===n.type&&(e.push(`isValid(${i})`),e.push(`isFinite(+${i})`))),e},[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class _d extends pu{constructor(e,t){super(e),this.transform=t,this.transform=B(t);const{flatten:n,as:i=[]}=this.transform;this.transform.as=n.map((e,t)=>{var n;return null!==(n=i[t])&&void 0!==n?n:e})}clone(){return new _d(this.parent,B(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return"FlattenTransform "+N(this.transform)}assemble(){const{flatten:e,as:t}=this.transform;return{type:"flatten",fields:e,as:t}}}class zd extends pu{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=B(t);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:"key",null!==(r=o[1])&&void 0!==r?r:"value"]}clone(){return new zd(null,B(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return"FoldTransform "+N(this.transform)}assemble(){const{fold:e,as:t}=this.transform;return{type:"fold",fields:e,as:t}}}class Pd extends pu{constructor(e,t,n,i){super(e),this.fields=t,this.geojson=n,this.signal=i}clone(){return new Pd(null,B(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const i of[["longitude","latitude"],["longitude2","latitude2"]]){const r=i.map(e=>{const n=eo(t.encoding[e]);return Sr(n)?n.field:Br(n)?{expr:""+n.datum}:Lr(n)?{expr:""+n.value}:void 0});(r[0]||r[1])&&(e=new Pd(e,r,null,t.getName("geojson_"+n++)))}if(t.channelHasField(ft)){const i=t.typedFieldDef(ft);i.type===bi&&(e=new Pd(e,null,i.field,t.getName("geojson_"+n++)))}return e}dependentFields(){var e;const t=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(O);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${N(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class Nd extends pu{constructor(e,t,n,i){super(e),this.projection=t,this.fields=n,this.as=i}clone(){return new Nd(null,this.projection,B(this.fields),B(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[["longitude","latitude"],["longitude2","latitude2"]]){const i=n.map(e=>{const n=eo(t.encoding[e]);return Sr(n)?n.field:Br(n)?{expr:""+n.datum}:Lr(n)?{expr:""+n.value}:void 0}),r="longitude2"===n[0]?"2":"";(i[0]||i[1])&&(e=new Nd(e,t.projectionName(),i,[t.getName("x"+r),t.getName("y"+r)]))}return e}dependentFields(){return new Set(this.fields.filter(O))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${N(this.fields)} ${N(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Ld extends pu{constructor(e,t){super(e),this.transform=t}clone(){return new Ld(null,B(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:i}=e;return{signal:`sequence(${[t,n,...i?[i]:[]].join(",")})`}}static makeFromTransform(e,t){return new Ld(e,t)}static makeFromEncoding(e,t){const n=t.encoding,i=n.x,r=n.y;if(Sr(i)&&Sr(r)){const o=i.impute?i:r.impute?r:void 0;if(void 0===o)return;const s=i.impute?r:r.impute?i:void 0,{method:a,value:u,frame:l,keyvals:c}=o.impute,f=Bo(t.mark,n);return new Ld(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:s.field},a?{method:a}:{}),void 0!==u?{value:u}:{}),l?{frame:l}:{}),void 0!==c?{keyvals:c}:{}),f.length?{groupby:f}:{}))}return null}hash(){return"Impute "+N(this.transform)}assemble(){const{impute:e,key:t,keyvals:n,method:i,groupby:r,value:o,frame:s=[null,null]}=this.transform,a=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:(u=n,void 0!==(null==u?void 0:u.stop)?this.processSequence(n):n)}:{}),{method:"value"}),r?{groupby:r}:{}),{value:i&&"value"!==i?null:o});var u;if(i&&"value"!==i){return[a,Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[i],fields:[e],frame:s,ignorePeers:!1},r?{groupby:r}:{}),{type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e}]}return[a]}}class Md extends pu{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=B(t);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:t.on,null!==(r=o[1])&&void 0!==r?r:t.loess]}clone(){return new Md(null,B(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"LoessTransform "+N(this.transform)}assemble(){const e=this.transform,{loess:t,on:n}=e,i=A(e,["loess","on"]);return Object.assign({type:"loess",x:n,y:t},i)}}class Td extends pu{constructor(e,t,n){super(e),this.transform=t,this.secondary=n}clone(){return new Td(null,B(this.transform),this.secondary)}static make(e,t,n,i){const r=t.component.data.sources,{from:o}=n;let s=null;if(function(e){return"data"in e}(o)){let e=eg(o.data,r);e||(e=new mf(o.data),r.push(e));const n=t.getName("lookup_"+i);s=new mu(e,n,da.Lookup,t.component.data.outputNodeRefCounts),t.component.data.outputNodes[n]=s}else if(function(e){return"selection"in e}(o)){const e=o.selection;if(n=Object.assign({as:e},n),s=t.getSelectionComponent(Q(e),e).materialized,!s)throw new Error(`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`)}return new Td(e,n,s.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?h(this.transform.as):this.transform.from.fields)}hash(){return"Lookup "+N({transform:this.transform,secondary:this.secondary})}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:h(this.transform.as)}:{});else{let t=this.transform.as;O(t)||(Bn('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}class qd extends pu{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=B(t);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:"prob",null!==(r=o[1])&&void 0!==r?r:"value"]}clone(){return new qd(null,B(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"QuantileTransform "+N(this.transform)}assemble(){const e=this.transform,{quantile:t}=e,n=A(e,["quantile"]);return Object.assign({type:"quantile",field:t},n)}}class Rd extends pu{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=B(t);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=o[0])&&void 0!==i?i:t.on,null!==(r=o[1])&&void 0!==r?r:t.regression]}clone(){return new Rd(null,B(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"RegressionTransform "+N(this.transform)}assemble(){const e=this.transform,{regression:t,on:n}=e,i=A(e,["regression","on"]);return Object.assign({type:"regression",x:n,y:t},i)}}class Ud extends pu{constructor(e,t){super(e),this.transform=t}clone(){return new Ud(null,B(this.transform))}addDimensions(e){var t;this.transform.groupby=U((null!==(t=this.transform.groupby)&&void 0!==t?t:[]).concat(e),e=>e)}producedFields(){}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}hash(){return"PivotTransform "+N(this.transform)}assemble(){const{pivot:e,value:t,groupby:n,limit:i,op:r}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},void 0!==i?{limit:i}:{}),void 0!==r?{op:r}:{}),void 0!==n?{groupby:n}:{})}}class Wd extends pu{constructor(e,t){super(e),this.transform=t}clone(){return new Wd(null,B(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return"SampleTransform "+N(this.transform)}assemble(){return{type:"sample",size:this.transform.sample}}}function Id(e){let t=0;return function n(i,r){var o;if(i instanceof mf&&!i.isGenerator&&!oa(i.data)){e.push(r);r={name:null,source:r.name,transform:[]}}if(i instanceof Cf&&(i.parent instanceof mf&&!r.source?(r.format=Object.assign(Object.assign({},null!==(o=r.format)&&void 0!==o?o:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Af){r.name||(r.name="data_"+t++),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source;for(const t of i.assemble())e.push(t)}else{if((i instanceof hf||i instanceof bf||i instanceof Bd||i instanceof Yl||i instanceof mc||i instanceof Nd||i instanceof Pd||i instanceof jf||i instanceof Td||i instanceof Bf||i instanceof Sf||i instanceof zd||i instanceof _d||i instanceof $d||i instanceof Md||i instanceof qd||i instanceof Rd||i instanceof Ef||i instanceof Wd||i instanceof Ud)&&r.transform.push(i.assemble()),(i instanceof pf||i instanceof hu||i instanceof Ld||i instanceof $f)&&r.transform.push(...i.assemble()),i instanceof mu)if(r.source&&0===r.transform.length)i.setSource(r.source);else if(i.parent instanceof mu)i.setSource(r.name);else if(r.name||(r.name="data_"+t++),i.setSource(r.name),1===i.numChildren()){e.push(r);r={name:null,source:r.name,transform:[]}}switch(i.numChildren()){case 0:i instanceof mu&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name="data_"+t++);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const e of i.children){n(e,{name:null,source:o,transform:[]})}break}}}}}function Hd(e){return"top"===e||"left"===e||Yn(e)?"header":"footer"}function Gd(e,t){var n;const{facet:i,config:r,child:o,component:s}=e;if(e.channelHasField(t)){const a=i[t],u=vc("title",null,r,t);let l=Yr(a,r,{allowDisabling:!0,includeDefault:void 0===u||!!u});o.component.layoutHeaders[t].title&&(l=c(l)?l.join(", "):l,l+=" / "+o.component.layoutHeaders[t].title,o.component.layoutHeaders[t].title=null);const f=vc("labelOrient",a,r,t),d=ae((null!==(n=a.header)&&void 0!==n?n:{}).labels,r.header.labels,!0),g=M(["bottom","right"],f)?"footer":"header";s.layoutHeaders[t]={title:l,facetFieldDef:a,[g]:"facet"===t?[]:[Vd(e,t,d)]}}}function Vd(e,t,n){const i="row"===t?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function Jd(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:o}=e.component;if(o.axis[t]=Tc(o,t),"shared"===o.axis[t]){const o="x"===t?"column":"row",s=r[o];for(const r of i.component.axes[t]){const t=Hd(r.get("orient"));s[t]=null!==(n=s[t])&&void 0!==n?n:[Vd(e,o,!1)];const i=ec(r,"main",e.config,{header:!0});i&&s[t][0].axes.push(i),r.mainExtracted=!0}}}}function Yd(e){for(const t of e.children)t.parseLayoutSize()}function Xd(e,t){const n=Nc(t),i=Tt(n),r=e.component.resolve,o=e.component.layoutSize;let s;for(const t of e.children){const e=t.component.layoutSize.getWithExplicit(n),o=r.scale[i];if("independent"===o&&"step"===e.value){s=void 0;break}if(s){if("independent"===o&&s.value!==e.value){s=void 0;break}s=ia(s,e,n,"")}else s=e}if(s){for(const i of e.children)e.renameSignal(i.getName(n),e.getName(t)),i.component.layoutSize.set(n,"merged",!1);o.setWithExplicit(t,s)}else o.setWithExplicit(t,{explicit:!1,value:void 0})}function Qd(e,t){const n="width"===t?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const e=r.get("type"),n=r.get("range");if(qi(e)){const e=gs(i.view,t);return Xn(n)||us(e)?"step":e}return fs(i.view,t)}if(e.hasProjection||"arc"===e.mark)return fs(i.view,t);{const e=gs(i.view,t);return us(e)?e.step:e}}function Kd(e,t,n){return Wr(t,Object.assign({suffix:"by_"+Wr(e)},null!=n?n:{}))}class Zd extends Sd{constructor(e,t,n,i){super(e,"facet",t,n,i,e.resolve),this.child=Og(e.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(e.facet,i)}initFacet(e,t){return xr(e)?$o(e,(e,n,i)=>M([Ze,et],i)?void 0===n.field?(Bn(mn(n,i)),e):(e[i]=to(n,i,t),e):(Bn(hn(i,"facet")),e),{}):{facet:to(e,"facet",t)}}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=ng(this),this.child.parseData()}parseLayoutSize(){Yd(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(e){for(const t of xt)Gd(e,t);Jd(e,"x"),Jd(e,"y")}(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const i={};for(const r of xt)for(const o of Oc){const s=this.component.layoutHeaders[r],a=s[o],{facetFieldDef:u}=s;if(u){const t=vc("titleOrient",u,this.config,r);if(M(["right","bottom"],t)){const n=bc(r,t);i.titleAnchor=null!==(e=i.titleAnchor)&&void 0!==e?e:{},i.titleAnchor[n]="end"}}if(null==a?void 0:a[0]){const e="row"===r?"height":"width",a="header"===o?"headerBand":"footerBand";"facet"===r||this.child.component.layoutSize.get(e)||(i[a]=null!==(t=i[a])&&void 0!==t?t:{},i[a][r]=.5),s.title&&(i.offset=null!==(n=i.offset)&&void 0!==n?n:{},i.offset["row"===r?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let i="all";return(t||"independent"!==this.component.resolve.scale.x)&&(e||"independent"!==this.component.resolve.scale.y)||(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof Zd)){return{signal:`length(data('${this.getName("column_domain")}'))`}}}assembleGroup(e){return this.parent&&this.parent instanceof Zd?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:Wr(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof Zd){if(this.child.channelHasField("column")){const i=Wr(this.child.facet.column);e.push(i),t.push("distinct"),n.push("distinct_"+i)}}else for(const i of Pt){const r=this.child.component.scales[i];if(r&&!r.merged){const o=r.get("type"),s=r.get("range");if(qi(o)&&Xn(s)){const r=ad(ud(this.child,i));r?(e.push(r),t.push("distinct"),n.push("distinct_"+r)):Bn(sn(i))}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:i}=this.facet,{fields:r,ops:o,as:s}=this.getCardinalityAggregateForChild(),a=[];for(const e of xt){const t=this.facet[e];if(t){a.push(Wr(t));const{bin:u,sort:l}=t;if(Xt(u)&&a.push(Wr(t,{binSuffix:"end"})),vr(l)){const{field:e,op:a=pr}=l,u=Kd(t,l);n&&i?(r.push(u),o.push("max"),s.push(u)):(r.push(e),o.push(a),s.push(u))}else if(c(l)){const n=hc(t,e);r.push(n),o.push("max"),s.push(n)}}}const u=!!n&&!!i;return Object.assign({name:e,data:t,groupby:a},u||r.length>0?{aggregate:Object.assign(Object.assign({},u?{cross:u}:{}),r.length?{fields:r,ops:o,as:s}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?vr(n.sort)?[Kd(n,n.sort,{expr:"datum"})]:c(n.sort)?[hc(n,e,{expr:"datum"})]:[Wr(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:e}=n;return[(vr(e)?e.order:!c(e)&&e)||"ascending"]}return[]}assembleLabelTitle(){const{facet:e,config:t}=this;if(e.facet)return kc(e.facet,"facet",t);const n={row:["top","bottom"],column:["left","right"]};for(const i of xc)if(e[i]){const r=vc("labelOrient",e[i],t,i);if(M(n[i],r))return kc(e[i],i,t)}}assembleMarks(){const{child:e}=this,t=function(e){const t=[],n=Id(t);for(const t of e.children)n(t,{source:e.name,name:null,transform:[]});return t}(this.component.data.facetRoot),n=e.assembleGroupEncodeEntry(!1),i=this.assembleLabelTitle()||e.assembleTitle(),r=e.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},i?{title:i}:{}),r?{style:r}:{}),{from:{facet:this.assembleFacet()},sort:{field:xt.map(e=>this.facetSortFields(e)).flat(),order:xt.map(e=>this.facetSortOrder(e)).flat()}}),t.length>0?{data:t}:{}),n?{encode:{update:n}}:{}),e.assembleGroup(function(e,t){if(e.component.selection&&V(e.component.selection).length){const n=w(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:$a("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return zu(t)}(this,[])))]}getMapping(){return this.facet}}function eg(e,t){var n,i,r,o,s,a,u,l,c,f;for(const d of t){const t=d.data;if((!e.name||!d.hasName()||e.name===d.dataName)&&!((null===(n=e.format)||void 0===n?void 0:n.mesh)&&(null===(i=t.format)||void 0===i?void 0:i.feature)||((null===(r=e.format)||void 0===r?void 0:r.feature)||(null===(o=t.format)||void 0===o?void 0:o.feature))&&(null===(s=e.format)||void 0===s?void 0:s.feature)!==(null===(a=t.format)||void 0===a?void 0:a.feature)||((null===(u=e.format)||void 0===u?void 0:u.mesh)||(null===(l=t.format)||void 0===l?void 0:l.mesh))&&(null===(c=e.format)||void 0===c?void 0:c.mesh)!==(null===(f=t.format)||void 0===f?void 0:f.mesh)))if(sa(e)&&sa(t)){if($(e.values,t.values))return d}else if(oa(e)&&oa(t)){if(e.url===t.url)return d}else if(aa(e)&&e.name===d.dataName)return d}return null}function tg(e,t){if(e.data||!e.parent){if(null===e.data){const e=new mf({values:[]});return t.push(e),e}const n=eg(e.data,t);if(n)return ua(e.data)||(n.data.format=function(e,...t){for(const n of t)R(e,null!=n?n:{});return e}({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const n=new mf(e.data);return t.push(n),n}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function ng(e){var t,n,i,r,o,s,a,u,l,c;let f=tg(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:g}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new ra,m=e.data;ua(m)?(la(m)?f=new bf(f,m.sequence):fa(m)&&(f=new hf(f,m.graticule)),p.parseNothing=!0):null===(null===(t=null==m?void 0:m.format)||void 0===t?void 0:t.parse)&&(p.parseNothing=!0),f=null!==(n=Cf.makeExplicit(f,e,p))&&void 0!==n?n:f,f=new Ef(f);const h=e.parent&&Cd(e.parent);(Dd(e)||Fd(e))&&h&&(f=null!==(i=pf.makeFromEncoding(f,e))&&void 0!==i?i:f),e.transforms.length>0&&(f=function(e,t,n){var i,r;let o=0;for(const s of t.transforms){let a,u=void 0;if(Aa(s))a=e=new mc(e,s),u="derived";else if(ga(s)){const r=Ff(s);a=e=null!==(i=Cf.makeWithAncestors(e,{},r,n))&&void 0!==i?i:e,e=new Yl(e,t,s.filter)}else if(Da(s))a=e=pf.makeFromTransform(e,s,t),u="number";else if(ka(s)){u="date";void 0===n.getWithExplicit(s.field).value&&(e=new Cf(e,{[s.field]:u}),n.set(s.field,u,!1)),a=e=hu.makeFromTransform(e,s)}else if(Ca(s))a=e=jf.makeFromTransform(e,s),u="number",Ju(t)&&(e=new Ef(e));else if(pa(s))a=e=Td.make(e,t,s,o++),u="derived";else if(Oa(s))a=e=new Bf(e,s),u="number";else if(wa(s))a=e=new Sf(e,s),u="number";else if(Ea(s))a=e=$f.makeFromTransform(e,s),u="derived";else if(Sa(s))a=e=new zd(e,s),u="derived";else if(ja(s))a=e=new _d(e,s),u="derived";else if(ma(s))a=e=new Ud(e,s),u="derived";else if(xa(s))e=new Wd(e,s);else if(Fa(s))a=e=Ld.makeFromTransform(e,s),u="derived";else if(ha(s))a=e=new $d(e,s),u="derived";else if(ba(s))a=e=new qd(e,s),u="derived";else if(va(s))a=e=new Rd(e,s),u="derived";else{if(!ya(s)){Bn(`Ignoring an invalid transform: ${P(s)}.`);continue}a=e=new Md(e,s),u="derived"}if(a&&void 0!==u)for(const e of null!==(r=a.producedFields())&&void 0!==r?r:[])n.set(e,u,!1)}return e}(f,e,p));const b=function(e){const t={};if(Dd(e)&&e.component.selection)for(const n of V(e.component.selection)){const i=e.component.selection[n];for(const e of i.project.items)!e.channel&&se(e.field)>1&&(t[e.field]="flatten")}return t}(e),v=kf(e);f=null!==(r=Cf.makeWithAncestors(f,{},Object.assign(Object.assign({},b),v),p))&&void 0!==r?r:f,Dd(e)&&(f=Pd.parseAll(f,e),f=Nd.parseAll(f,e)),(Dd(e)||Fd(e))&&(h||(f=null!==(o=pf.makeFromEncoding(f,e))&&void 0!==o?o:f),f=null!==(s=hu.makeFromEncoding(f,e))&&void 0!==s?s:f,f=mc.parseAllForSortIndex(f,e));const y=e.getDataName(da.Raw),x=new mu(f,y,da.Raw,g);if(d[y]=x,f=x,Dd(e)){const t=jf.makeFromEncoding(f,e);t&&(f=t,Ju(e)&&(f=new Ef(f))),f=null!==(a=Ld.makeFromEncoding(f,e))&&void 0!==a?a:f,f=null!==(u=$f.makeFromEncoding(f,e))&&void 0!==u?u:f}Dd(e)&&(f=null!==(l=Bd.make(f,e))&&void 0!==l?l:f);const O=e.getDataName(da.Main),w=new mu(f,O,da.Main,g);d[O]=w,f=w,Dd(e)&&function(e,t){Gu(e,n=>{const i=n.name,r=e.getName("lookup_"+i);e.component.data.outputNodes[r]=n.materialized=new mu(new Yl(t,e,{selection:i}),r,da.Lookup,e.component.data.outputNodeRefCounts)})}(e,w);let j=null;if(Fd(e)){const t=e.getName("facet");f=null!==(c=function(e,t){const{row:n,column:i}=t;if(n&&i){let t=null;for(const r of[n,i])if(vr(r.sort)){const{field:n,op:i=pr}=r.sort;e=t=new Sf(e,{joinaggregate:[{op:i,field:n,as:Kd(r,r.sort,{forAs:!0})}],groupby:[Wr(r)]})}return t}return null}(f,e.facet))&&void 0!==c?c:f,j=new Af(f,e,t,w.getSource()),d[t]=j}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:g,raw:x,main:w,facetRoot:j,ancestorParse:p})}class ig extends Ed{constructor(e,t,n,i){var r,o,s,a;super(e,"concat",t,n,i,e.resolve),"shared"!==(null===(o=null===(r=e.resolve)||void 0===r?void 0:r.axis)||void 0===o?void 0:o.x)&&"shared"!==(null===(a=null===(s=e.resolve)||void 0===s?void 0:s.axis)||void 0===a?void 0:a.y)||Bn("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(e).map((e,t)=>Og(e,this,this.getName("concat_"+t),void 0,i))}parseData(){this.component.data=ng(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of V(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return ss(e)?e.vconcat:as(e)?e.hconcat:e.concat}parseLayoutSize(){!function(e){Yd(e);const t=1===e.layout.columns?"width":"childWidth",n=void 0===e.layout.columns?"height":"childHeight";Xd(e,t),Xd(e,n)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce((e,t)=>t.assembleSelectionTopLevelSignals(e),e)}assembleSignals(){return this.children.forEach(e=>e.assembleSignals()),[]}assembleLayoutSignals(){const e=Bc(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce((e,t)=>t.assembleSelectionData(e),e)}assembleMarks(){return this.children.map(e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),i=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),i?{encode:{update:i}}:{}),e.assembleGroup())})}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},null!=e?{columns:e}:{}),{bounds:"full",align:"each"})}}const rg=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},me),{labelExpr:1,encode:1}),og=V(rg);class sg extends Ks{constructor(e={},t={},n=!1){super(),this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new sg(B(this.explicit),B(this.implicit),this.mainExtracted)}hasAxisPart(e){return"axis"===e||("grid"===e||"title"===e?!!this.get(e):!(!1===(t=this.get(e))||null===t));var t}hasOrientSignalRef(){return Yn(this.explicit.orient)}}const ag={bottom:"top",top:"bottom",left:"right",right:"left"};function ug(e,t){if(!e)return t.map(e=>e.clone());{if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const n=e[i],r=t[i];if(!!n!=!!r)return;if(n&&r){const t=n.getWithExplicit("orient"),o=r.getWithExplicit("orient");if(t.explicit&&o.explicit&&t.value!==o.value)return;e[i]=lg(n,r)}}}return e}function lg(e,t){for(const n of og){const i=ia(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(e,t)=>{switch(n){case"title":return Ao(e,t);case"gridScale":return{explicit:e.explicit,value:ae(e.value,t.value)}}return na(e,t,n,"axis")});e.setWithExplicit(n,i)}return e}function cg(e,t,n,i,r){if("disable"===t)return void 0!==n;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(Yn(n.labelAngle)?n.labelAngle:le(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===pc(i,r))return!0}return e===n[t]}const fg=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function dg(e,t){var n,i,r;let o=t.axis(e);const s=new sg,a=eo(t.encoding[e]),{mark:u,config:l}=t,c=(null==o?void 0:o.orient)||(null===(n=l["x"===e?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(i=l.axis)||void 0===i?void 0:i.orient)||function(e){return"x"===e?"bottom":"left"}(e),f=t.getScaleComponent(e).get("type"),d=ac(e,f,c,t.config),g=void 0!==o?!o:lc("disable",l.style,null==o?void 0:o.style,d).configValue;if(s.set("disable",g,void 0!==o),g)return s;o=o||{};const p=function(e,t,n,i,r){const o=null==t?void 0:t.labelAngle;if(void 0!==o)return Yn(o)?o:le(o);{const{configValue:o}=lc("labelAngle",i,null==t?void 0:t.style,r);return void 0!==o?le(o):n!==tt||!M([hi,pi],e.type)||Sr(e)&&e.timeUnit?void 0:270}}(a,o,e,l.style,d),m={fieldOrDatumDef:a,axis:o,channel:e,model:t,scaleType:f,orient:c,labelAngle:p,mark:u,config:l};for(const n of og){const i=n in cc?cc[n](m):be(n)?o[n]:void 0,r=void 0!==i,a=cg(i,n,o,t,e);if(r&&a)s.set(n,i,a);else{const{configValue:e,configFrom:t}=be(n)&&"values"!==n?lc(n,l.style,o.style,d):{},u=void 0!==e;r&&!u?s.set(n,i,a):("vgAxisConfig"!==t||fg.has(n)&&u||de(e)||Yn(e))&&s.set(n,e,!1)}}const h=null!==(r=o.encoding)&&void 0!==r?r:{},b=ge.reduce((n,i)=>{var r;if(!s.hasAxisPart(i))return n;const o=Lc(null!==(r=h[i])&&void 0!==r?r:{},t),a="labels"===i?function(e,t,n){var i;const{encoding:r,config:o}=e,s=null!==(i=eo(r[t]))&&void 0!==i?i:eo(r[St(t)]),a=e.axis(t)||{},{format:u,formatType:l}=a;return ir(l)?Object.assign({text:ar({fieldOrDatumDef:s,field:"datum.value",format:u,formatType:l,config:o})},n):n}(t,e,o):o;return void 0===a||G(a)||(n[i]={update:a}),n},{});return G(b)||s.set("encode",b,!!o.encoding||void 0!==o.labelAngle),s}function gg(e,t,n){const i=bo("orient",e,n);if(e.orient=function(e,t,n){switch(e){case Ae:case Se:case $e:case ke:case De:case we:return}const{x:i,y:r,x2:o,y2:s}=t;switch(e){case Oe:if(Sr(i)&&(Qt(i.bin)||Sr(r)&&r.aggregate&&!i.aggregate))return"vertical";if(Sr(r)&&(Qt(r.bin)||Sr(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(s||o){if(n)return n;if(!o&&(Sr(i)&&i.type===gi&&!Xt(i.bin)||zr(i)))return"horizontal";if(!s&&(Sr(r)&&r.type===gi&&!Xt(r.bin)||zr(r)))return"vertical"}case Fe:if(o&&(!Sr(i)||!Qt(i.bin))&&s&&(!Sr(r)||!Qt(r.bin)))return;case xe:if(s)return Sr(r)&&Qt(r.bin)?"horizontal":"vertical";if(o)return Sr(i)&&Qt(i.bin)?"vertical":"horizontal";if(e===Fe){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case je:case Ce:{const t=_r(i),o=_r(r);if(t&&!o)return"tick"!==e?"horizontal":"vertical";if(!t&&o)return"tick"!==e?"vertical":"horizontal";if(t&&o){const t=i,o=r,s=t.type===mi,a=o.type===mi;return s&&!a?"tick"!==e?"vertical":"horizontal":!s&&a?"tick"!==e?"horizontal":"vertical":!t.aggregate&&o.aggregate?"tick"!==e?"vertical":"horizontal":t.aggregate&&!o.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(e.type,t,i),void 0!==i&&i!==e.orient&&Bn(`Specified orient "${e.orient}" overridden with "${i}".`),"bar"===e.type&&e.orient){const i=bo("cornerRadiusEnd",e,n);if(void 0!==i){const n="horizontal"===e.orient&&t.x2||"vertical"===e.orient&&t.y2?["cornerRadius"]:Te[e.orient];for(const t of n)e[t]=i;void 0!==e.cornerRadiusEnd&&delete e.cornerRadiusEnd}}void 0===bo("opacity",e,n)&&(e.opacity=function(e,t){if(M([Ae,Ce,Se,$e],e)&&!Fo(t))return.7;return}(e.type,t));return void 0===bo("cursor",e,n)&&(e.cursor=function(e,t,n){if(t.href||e.href||bo("href",e,n))return"pointer";return e.cursor}(e,t,n)),e}function pg(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},lu(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Xa("x",e,{defaultPos:"mid"})),Xa("y",e,{defaultPos:"mid"})),Va("size",e)),Va("angle",e)),function(e,t,n){if(n)return{shape:{value:n}};return Va("shape",e)}(e,0,t))}function mg(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,o="horizontal"===r?"width":"height",s=e.getScaleComponent("horizontal"===r?"x":"y"),a=null!==(t=bo("size",i,n,{vgChannel:o}))&&void 0!==t?t:n.tick.bandSize;if(void 0!==a)return a;{const e=s?s.get("range"):void 0;if(e&&Xn(e)&&x(e.step))return 3*e.step/4;return 3*ds(n.view,o)/4}}const hg={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},lu(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Xa("x",e,{defaultPos:"mid"})),Xa("y",e,{defaultPos:"mid"})),ru(e,"radius","arc")),ru(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},lu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),tu("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient})),tu("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient})),fu(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},lu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ru(e,"x","bar")),ru(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>pg(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},lu(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&Sr(n)&&n.type===bi?{field:Wr(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},lu(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),ru(e,"x","image")),ru(e,"y","image")),Ra(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},lu(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Xa("x",e,{defaultPos:"mid"})),Xa("y",e,{defaultPos:"mid"})),Va("size",e,{vgChannel:"strokeWidth"})),fu(e))},point:{vgMark:"symbol",encodeEntry:e=>pg(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},lu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ru(e,"x","rect")),ru(e,"y","rect"))},rule:{vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},lu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),tu("x",e,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),tu("y",e,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),Va("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:e=>pg(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},lu(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),Xa("x",e,{defaultPos:"mid"})),Xa("y",e,{defaultPos:"mid"})),Ra(e)),Va("size",e,{vgChannel:"fontSize"})),Va("angle",e)),du("align",function(e,t,n){if(void 0===bo("align",e,n))return"center";return}(e.markDef,0,t))),du("baseline",function(e,t,n){if(void 0===bo("baseline",e,n))return"middle";return}(e.markDef,0,t))),Xa("radius",e,{defaultPos:null,isMidPoint:!0})),Xa("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r="horizontal"===i?"width":"height",o="horizontal"===i?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},lu(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Xa("x",e,{defaultPos:"mid",vgChannel:"xc"})),Xa("y",e,{defaultPos:"mid",vgChannel:"yc"})),Va("size",e,{defaultValue:mg(e),vgChannel:r})),{[o]:go(bo("thickness",n,t))})}},trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},lu(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Xa("x",e,{defaultPos:"mid"})),Xa("y",e,{defaultPos:"mid"})),Va("size",e)),fu(e))}};function bg(e){if(M([je,xe,Ee],e.mark)){const t=Bo(e.mark,e.encoding);if(t.length>0)return function(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:"faceted_path_"+e.requestDataName(da.Main),data:e.requestDataName(da.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:vg(e,{fromPrefix:"faceted_path_"})}]}(e,t)}else if(M([Oe],e.mark)){const t=ei.some(t=>bo(t,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return function(e){const[t]=vg(e,{fromPrefix:"stack_group_"}),n=e.scaleName(e.stack.fieldChannel),i=(t={})=>e.vgField(e.stack.fieldChannel,t),r=(e,t)=>`${e}(${[i({prefix:"min",suffix:"start",expr:t}),i({prefix:"max",suffix:"start",expr:t}),i({prefix:"min",suffix:"end",expr:t}),i({prefix:"max",suffix:"end",expr:t})].map(e=>`scale('${n}',${e})`).join(",")})`;let o,s;"x"===e.stack.fieldChannel?(o=Object.assign(Object.assign({},_(t.encode.update,["y","yc","y2","height",...ei])),{x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}}),s={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},z(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(o=Object.assign(Object.assign({},_(t.encode.update,["x","xc","x2","width"])),{y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}}),s={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},z(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const n of ei){const i=vo(n,e.markDef,e.config);t.encode.update[n]?(o[n]=t.encode.update[n],delete t.encode.update[n]):i&&(o[n]=go(i)),i&&(t.encode.update[n]={value:0})}const a=e.fieldDef(e.stack.groupbyChannel),u=Wr(a)?[Wr(a)]:[];((null==a?void 0:a.bin)||(null==a?void 0:a.timeUnit))&&u.push(Wr(a,{binSuffix:"end"}));o=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((n,i)=>{if(t.encode.update[i])return Object.assign(Object.assign({},n),{[i]:t.encode.update[i]});{const t=vo(i,e.markDef,e.config);return void 0!==t?Object.assign(Object.assign({},n),{[i]:go(t)}):n}},o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0});return[{type:"group",from:{facet:{data:e.requestDataName(da.Main),name:"stack_group_"+e.requestDataName(da.Main),groupby:u,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:s},marks:[t]}]}]}(e)}return vg(e)}function vg(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:o}=e,s=ae(i.clip,function(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(e),function(e){const t=e.component.projection;return!(!t||t.isFit)||void 0}(e)),a=ho(i),u=r.key,l=function(e){const{encoding:t,stack:n,mark:i,markDef:r,config:o}=e,s=t.order;if(!(!c(s)&&Lr(s)&&L(s.value)||!s&&L(bo("order",r,o)))){if((c(s)||Sr(s))&&!n)return Oo(s,{expr:"datum"});if(_e(i)){const n="horizontal"===r.orient?"y":"x",i=t[n];if(Sr(i)){const t=i.sort;if(c(t))return{field:Wr(i,{prefix:n,suffix:"sort_index",expr:"datum"})};if(vr(t))return{field:Wr({aggregate:Fo(e.encoding)?t.op:void 0,field:t.field},{expr:"datum"})};if(br(t)){return{field:Wr(e.fieldDef(t.encoding),{expr:"datum"}),order:t.order}}return null===t?void 0:{field:Wr(i,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}}else;}}(e),f=function(e){if(!e.component.selection)return null;const t=V(e.component.selection).length;let n=t,i=e.parent;for(;i&&0===n;)n=V(i.component.selection).length,i=i.parent;return n?{interactive:t>0}:null}(e),d=bo("aria",i,o),g=hg[n].postEncodingTransform?hg[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:hg[n].vgMark},s?{clip:!0}:{}),a?{style:a}:{}),u?{key:u.field}:{}),l?{sort:l}:{}),f||{}),!1===d?{aria:d}:{}),{from:{data:t.fromPrefix+e.requestDataName(da.Main)},encode:{update:hg[n].encodeEntry(e)}}),g?{transform:g}:{})]}class yg extends Sd{constructor(e,t,n,i={},r){super(e,"unit",t,n,r,void 0,ls(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const o=Ne(e.mark)?Object.assign({},e.mark):{type:e.mark},s=o.type;void 0===o.filled&&(o.filled=function(e,t,{graticule:n}){if(n)return!1;const i=vo("filled",e,t),r=e.type;return ae(i,r!==Ae&&r!==je&&r!==Fe)}(o,r,{graticule:e.data&&fa(e.data)}));const a=this.encoding=Co(e.encoding||{},s,o.filled,r);this.markDef=gg(o,a,r),this.size=function({encoding:e,size:t}){for(const n of Pt){const i=$t(n);us(t[i])&&_r(e[n])&&(delete t[i],Bn(jn(i)))}return t}({encoding:a,size:ls(e)?Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):i}),this.stack=Ss(s,a),this.specifiedScales=this.initScales(s,a),this.specifiedAxes=this.initAxes(a),this.specifiedLegends=this.initLegend(a),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===Be,n=e&&ht.some(t=>Pr(e[t]));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return Wt.reduce((e,n)=>{var i;const r=eo(t[n]);return r&&(e[n]=null!==(i=r.scale)&&void 0!==i?i:{}),e},{})}initAxes(e){return Pt.reduce((t,n)=>{const i=e[n];if(Pr(i)||n===tt&&Pr(e.x2)||n===nt&&Pr(e.y2)){const e=Pr(i)?i.axis:void 0;t[n]=e?Object.assign({},e):e}return t},{})}initLegend(e){return Rt.reduce((t,n)=>{const i=eo(e[n]);if(i&&function(e){switch(e){case ut:case lt:case ct:case dt:case ft:case"opacity":case"strokeWidth":case"strokeDash":return!0;case"fillOpacity":case"strokeOpacity":case"angle":return!1}}(n)){const e=i.legend;t[n]=e?Object.assign({},e):e}return t},{})}parseData(){this.component.data=ng(this)}parseLayoutSize(){!function(e){const{size:t,component:n}=e;for(const i of Pt){const r=$t(i);if(t[r]){const e=t[r];n.layoutSize.set(r,us(e)?"step":e,!0)}else{const t=Qd(e,r);n.layoutSize.set(r,t,!1)}}}(this)}parseSelections(){this.component.selection=function(e,t){var n;const i={},r=e.config.selection;for(const o of V(null!=t?t:{})){const s=B(t[o]),a=A(r[s.type],["fields","encodings"]);for(const e in a)"encodings"===e&&s.fields||"fields"===e&&s.encodings||("mark"===e&&(s[e]=Object.assign(Object.assign({},a[e]),s[e])),void 0!==s[e]&&!0!==s[e]||(s[e]=null!==(n=a[e])&&void 0!==n?n:s[e]));const u=Q(o),l=i[u]=Object.assign(Object.assign({},s),{name:u,events:O(s.on)?$a(s.on,"scope"):B(s.on)});$u(l,n=>{n.has(l)&&n.parse&&n.parse(e,l,s,t[o])})}return i}(this,this.selection)}parseMarkGroup(){this.component.mark=bg(this)}parseAxesAndHeaders(){var e;this.component.axes=(e=this,Pt.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[dg(n,e)]),t),{}))}assembleSelectionTopLevelSignals(e){return function(e,t){let n=!1;if(Gu(e,(i,r)=>{const o=i.name,s=w(o+Ru);if(0===t.filter(e=>e.name===o).length){const e="global"===i.resolve?"union":i.resolve,n="multi"===i.type?", true)":")";t.push({name:i.name,update:`${Iu}(${s}, ${w(e)}${n}`})}n=!0,r.topLevelSignals&&(t=r.topLevelSignals(e,i,t)),$u(i,n=>{n.topLevelSignals&&(t=n.topLevelSignals(e,i,t))})}),n){0===t.filter(e=>"unit"===e.name).length&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return zu(t)}(this,e)}assembleSignals(){return[...tc(this),...(e=this,t=[],Gu(e,(n,i)=>{const r=n.name;let o=i.modifyExpr(e,n);t.push(...i.signals(e,n)),$u(n,i=>{i.signals&&(t=i.signals(e,n,t)),i.modifyExpr&&(o=i.modifyExpr(e,n,o))}),t.push({name:r+Wu,on:[{events:{signal:n.name+Uu},update:`modify(${w(n.name+Ru)}, ${o})`}]})}),zu(t))];var e,t}assembleSelectionData(e){return function(e,t){const n=[...t];return Gu(e,t=>{const i={name:t.name+Ru};if(t.init){const n=t.project.items.map(e=>A(e,["signals"])),r=t.init.map(e=>Bu(e,!1));i.values="interval"===t.type?[{unit:Vu(e,{escape:!1}),fields:n,values:r}]:r.map(t=>({unit:Vu(e,{escape:!1}),fields:n,values:t}))}n.filter(e=>e.name===t.name+Ru).length||n.push(i)}),n}(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return Bc(this)}assembleMarks(){var e;let t=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&Cd(this.parent)||(t=_u(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return Do(this.encoding,e)}fieldDef(e){return Zr(this.encoding[e])}typedFieldDef(e){const t=this.fieldDef(e);return Nr(t)?t:null}}class xg extends Ed{constructor(e,t,n,i,r){super(e,"layer",t,n,r,e.resolve,e.view);const o=Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map((e,t)=>{if(Ds(e))return new xg(e,this,this.getName("layer_"+t),o,r);if(Ue(e))return new yg(e,this,this.getName("layer_"+t),o,r);throw new Error(tn(e))})}parseData(){this.component.data=ng(this);for(const e of this.children)e.parseData()}parseLayoutSize(){var e;Yd(e=this),Xd(e,"width"),Xd(e,"height")}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of V(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){!function(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const t of e.children){t.parseAxesAndHeaders();for(const r of V(t.component.axes))i.axis[r]=Tc(e.component.resolve,r),"shared"===i.axis[r]&&(n[r]=ug(n[r],t.component.axes[r]),n[r]||(i.axis[r]="independent",delete n[r]))}for(const o of Pt){for(const s of e.children)if(s.component.axes[o]){if("independent"===i.axis[o]){n[o]=(null!==(t=n[o])&&void 0!==t?t:[]).concat(s.component.axes[o]);for(const e of s.component.axes[o]){const{value:t,explicit:n}=e.getWithExplicit("orient");if(!Yn(t)){if(r[t]>0&&!n){const n=ag[t];r[t]>r[n]&&e.set("orient",n,!1)}r[t]++}}}delete s.component.axes[o]}if("independent"===i.axis[o]&&n[o]&&n[o].length>1)for(const e of n[o])e.get("grid")&&!e.explicit.grid&&(e.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce((e,t)=>t.assembleSelectionTopLevelSignals(e),e)}assembleSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleSignals()),tc(this))}assembleLayoutSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleLayoutSignals()),Bc(this))}assembleSelectionData(e){return this.children.reduce((e,t)=>t.assembleSelectionData(e),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return function(e,t){for(const n of e.children)Dd(n)&&(t=_u(n,t));return t}(this,this.children.flatMap(e=>e.assembleMarks()))}assembleLegends(){return this.children.reduce((e,t)=>e.concat(t.assembleLegends()),of(this))}}function Og(e,t,n,i,r){if(wr(e))return new Zd(e,t,n,r);if(Ds(e))return new xg(e,t,n,i,r);if(Ue(e))return new yg(e,t,n,i,r);if(function(e){return ss(e)||as(e)||os(e)}(e))return new ig(e,t,n,r);throw new Error(tn(e))}e.compile=function(e,t={}){var n;t.logger&&(n=t.logger,$n=n),t.fieldTitle&&Jr(t.fieldTitle);try{const n=ys(g(t.config,e.config)),i=Vs(e,n),r=Og(i,null,"",void 0,n);r.parse(),function(e,t){Gf(e.sources);let n=0,i=0;for(let i=0;i<5&&Xf(e,t,!0);i++)n++;e.sources.map(Mf);for(let n=0;n<5&&Xf(e,t,!1);n++)i++;Gf(e.sources),5===Math.max(n,i)&&Bn("Maximum optimization runs(5) reached.")}(r.component.data,r);return{spec:function(e,t,n={},i){const r=e.config?js(e.config):void 0,o=[].concat(e.assembleSelectionData([]),function(e,t){var n,i;const r=[],o=Id(r);let s=0;for(const t of e.sources){t.hasName()||(t.dataName="source_"+s++);const e=t.assemble();o(t,e)}for(const e of r)0===e.transform.length&&delete e.transform;let a=0;for(const[e,t]of r.entries())0!==(null!==(n=t.transform)&&void 0!==n?n:[]).length||t.source||r.splice(a++,0,r.splice(e,1)[0]);for(const t of r)for(const n of null!==(i=t.transform)&&void 0!==i?i:[])"lookup"===n.type&&(n.from=e.outputNodes[n.from].getSource());for(const e of r)e.name in t&&(e.values=t[e.name]);return r}(e.component.data,n)),s=e.assembleProjections(),a=e.assembleTitle(),u=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();return c=c.filter(e=>"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1)),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),t),a?{title:a}:{}),u?{style:u}:{}),l?{encode:{update:l}}:{}),{data:o}),s.length>0?{projections:s}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([])])),r?{config:r}:{}),i?{usermeta:i}:{})}(r,function(e,t,n,i){const r=i.component.layoutSize.get("width"),o=i.component.layoutSize.get("height");void 0===t?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):O(t)&&(t={type:t});if(r&&o&&(s=t.type,"fit"===s||"fit-x"===s||"fit-y"===s))if("step"===r&&"step"===o)Bn(on()),t.type="pad";else if("step"===r||"step"===o){const e="step"===r?"width":"height";Bn(on(Tt(e)));const n="width"===e?"height":"width";t.type=function(e){return e?"fit-"+Tt(e):"fit"}(n)}var s;return Object.assign(Object.assign(Object.assign({},1===V(t).length&&t.type?"pad"===t.type?{}:{autosize:t.type}:{autosize:t}),Qs(n)),Qs(e))}(e,i.autosize,n,r),e.datasets,e.usermeta),normalized:i}}finally{t.logger&&($n=Cn),t.fieldTitle&&Jr(Gr)}},e.normalize=Vs,e.version="4.14.1",Object.defineProperty(e,"__esModule",{value:!0})}));
// Determine the mode ('vega' | 'vega-lite' | 'vega-dataflow' | 'cc-precompiled') for a spec object
function getSpecMode(spec) {
  if (spec["$schema"]) {
    // If there is a schema, check the schema url
    var vlPrefix = "https://vega.github.io/schema/vega-lite/";
    var mode = spec["$schema"].startsWith(vlPrefix) ? "vega-lite" : "vega";
    return mode;
  } else {
    // Check if the spec is a Vega dataflow (output of vega.parse)
    if ('dataflow' in spec) {
      return 'cc-precompiled';
    }
    if ('operators' in spec) {
      return 'vega-dataflow';
    }
    // Check if the spec is Vega-Lite
    if ('mark' in spec || 'encoding' in spec || 'layer' in spec || 'hconcat' in spec || 'vconcat' in spec ||
        'facet' in spec || 'repeat' in spec) {
      return 'vega-lite';
    }
    // Check if the spec is Vega
    if ('marks' in spec || 'signals' in spec || 'scales' in spec || 'axes' in spec) {
      return 'vega';
    }
    // Fallback to Vega-Lite
    return 'vega-lite';
// Prepare spec and config
function prepareSpecDict(dict) {
  var {spec, config, baseConfig} = dict;
  try {
    spec = spec || {};
    if (typeof spec === "string") {
      spec = JSON.parse(spec);
    }
    config = config || {};
    if (typeof config === "string") {
      config = JSON.parse(config);
    }
    baseConfig = baseConfig || {};
    if (typeof baseConfig === "string") {
      baseConfig = JSON.parse(baseConfig);
    }
  } catch (e) {
    return { error: e, mode: "error" }
  // Merge baseConfig into config
  config = vega.mergeConfig(baseConfig, config);
  return {spec, config, mode : getSpecMode(spec)};
// Compile any Vega-Lite, Vega spec, return the compiled dataflow.
function compileAnySpec(specDict, expressionFunctionNames) {
  var {spec, config, mode} = specDict;
  var originalSpecDict = {spec : spec, config : config, mode : mode};
  if (mode == "error") {
    return {error : specDict.error};
  try {
    // Register dummy expression functions if they are not already registered
    if (expressionFunctionNames != null) {
      for (var func of expressionFunctionNames) {
        if (vega.expressionFunction(func) == null) {
          vega.expressionFunction(func, () => {})
        }
      }
    }
    // mode: vega-lite | vega
    if (mode == "vega-lite") {
      if (console.benchmark !== undefined) {
        var t_start = console.benchmark.measureTime();
      }
      spec = window.vegaLite.compile(spec, {config : specDict.config}).spec;
      if (console.benchmark !== undefined) {
        var t_complete_vl = console.benchmark.measureTime();
      }
      // When using Vega-Lite spec, include the Vega spec in originalSpecDict.
      originalSpecDict.vgSpec = spec;
      spec = vega.parse(spec, {});
      if (console.benchmark !== undefined) {
        var t_end = console.benchmark.measureTime();
        console.benchmark.reportInterval(console.benchmark.kEntityVegaLiteCompile, t_start, t_complete_vl);
        console.benchmark.reportInterval(console.benchmark.kEntityVegaParse, t_complete_vl, t_end);
      }
    } else if (mode == "vega") {
      spec = vega.parse(spec, config);
    } else if (mode == "vega-dataflow") {
      // noop, spec is the dataflow.
    } else {
      return {error : "invalid spec mode"};
    }
  } catch (e) {
    return {error : e.message};
  return {runtime : spec, original : originalSpecDict};
function precompileSpec(specDict, expressionFunctionNames) {
  var compiledDataflow = compileAnySpec(specDict, expressionFunctionNames);
  if (compiledDataflow.error) {
    return {error : compiledDataflow.error};
  var result = {
    versions : {vega : VEGA_VERSION, vegaLite : VEGA_LITE_VERSION},
    original : compiledDataflow.original,
    dataflow : compiledDataflow.runtime
  };
  return {result : JSON.stringify(result)};
// Prepare spec and config
function prepareSpecDict(dict) {
  var {spec, config, baseConfig} = dict;
  try {
    spec = spec || {};
    if (typeof spec === "string") {
      spec = JSON.parse(spec);
    }
    config = config || {};
    if (typeof config === "string") {
      config = JSON.parse(config);
    }
    baseConfig = baseConfig || {};
    if (typeof baseConfig === "string") {
      baseConfig = JSON.parse(baseConfig);
    }
  } catch (e) {
    return { error: e, mode: "error" }
  // Merge baseConfig into config
  config = vega.mergeConfig(baseConfig, config);
  return {spec, config, mode : getSpecMode(spec)};
// Compile any Vega-Lite, Vega spec, return the compiled dataflow.
function compileAnySpec(specDict, expressionFunctionNames) {
  var {spec, config, mode} = specDict;
  var originalSpecDict = {spec : spec, config : config, mode : mode};
  if (mode == "error") {
    return {error : specDict.error};
  try {
    // Register dummy expression functions if they are not already registered
    if (expressionFunctionNames != null) {
      for (var func of expressionFunctionNames) {
        if (vega.expressionFunction(func) == null) {
          vega.expressionFunction(func, () => {})
        }
      }
    }
    // mode: vega-lite | vega
    if (mode == "vega-lite") {
      if (console.benchmark !== undefined) {
        var t_start = console.benchmark.measureTime();
      }
      spec = window.vegaLite.compile(spec, {config : specDict.config}).spec;
      if (console.benchmark !== undefined) {
        var t_complete_vl = console.benchmark.measureTime();
      }
      // When using Vega-Lite spec, include the Vega spec in originalSpecDict.
      originalSpecDict.vgSpec = spec;
      spec = vega.parse(spec, {});
      if (console.benchmark !== undefined) {
        var t_end = console.benchmark.measureTime();
        console.benchmark.reportInterval(console.benchmark.kEntityVegaLiteCompile, t_start, t_complete_vl);
        console.benchmark.reportInterval(console.benchmark.kEntityVegaParse, t_complete_vl, t_end);
      }
    } else if (mode == "vega") {
      spec = vega.parse(spec, config);
    } else if (mode == "vega-dataflow") {
      // noop, spec is the dataflow.
    } else {
      return {error : "invalid spec mode"};
    }
  } catch (e) {
    return {error : e.message};
  return {runtime : spec, original : originalSpecDict};
function precompileSpec(specDict, expressionFunctionNames) {
  var compiledDataflow = compileAnySpec(specDict, expressionFunctionNames);
  if (compiledDataflow.error) {
    return {error : compiledDataflow.error};
  var result = {
    versions : {vega : VEGA_VERSION, vegaLite : VEGA_LITE_VERSION},
    original : compiledDataflow.original,
    dataflow : compiledDataflow.runtime
  };
  return {result : JSON.stringify(result)};
function parseVersion(versionString) {
  return versionString.split(".").map(function(x) { return parseInt(x, 10); });
function isDataflowCompatible(originalVegaVersion) {
  var original = parseVersion(originalVegaVersion);
  var current = parseVersion(VEGA_VERSION);
  if (original[0] != current[0]) {
    // If major version is different we declare that it's not compatible.
    return false;
  // convert to format 5,012,000
  var original_num = original[0] * 1000000 + original[1] * 1000 + original[2];
  var current_num = current[0] * 1000000 + current[1] * 1000 + current[2];
  var breaking_versions = [
    5012000 // https://github.com/vega/vega/releases/tag/v5.12.0
  ];
  for (var ver of breaking_versions) {
    if (original_num < ver && current_num >= ver) {
      return false;
    }
  return true;
// Used in the native function `callInJSContext`
function callFunction(func) { func(); }
class Loader {
  constructor(viewRenderer) { this.viewRenderer = viewRenderer; }
  // (uri: string, options: any) => Promise<{ href: string }>;
  // options: { context: "href" | "image" }
  async sanitize(url, options) { return {href : url}; }
  // (uri: string, options?: any) => Promise<string>
  // options: {"context":"dataflow","response":"json"}
  async load(url, options) {
    return new Promise((resolve, reject) => {
      this.viewRenderer.delegate.loadURL(url, options, (result, error) => {
        if (result) {
          resolve(result);
        } else {
          reject(error);
        }
      });
    });
function prepareSpecDictForRuntime(specDict) {
  var {spec, config, mode} = prepareSpecDict(specDict);
  if (mode == "cc-precompiled") {
    var precompiled = spec;
    // If it's not from a compatible Vega, we return a new specDict so prepareRuntimeFromSpecDict will recompile it.
    if (!isDataflowCompatible(precompiled.versions.vega)) {
      console.warn("The pre-compiled spec was compiled with Vega version " + precompiled.versions.vega +
                   " which is not compatible with the current runtime, recompiling the spec...")
      return {spec : precompiled.original.vgSpec, mode : "vega"};
    }
  return {spec, config, mode};
// Prepare dataflow runtime from specDict.
function prepareRuntimeFromSpecDict(specDict) {
  if (specDict.mode == "cc-precompiled") {
    return {runtime : specDict.spec.dataflow};
  } else {
    return compileAnySpec(specDict, null);
var predefinedSignalNames = new Set([ "screen", "os", "textStyle", "color", "string", "locale", "calendar" ]);
// The primary view class for the JavaScript world
class ViewRenderer {
  // Construct a view from spec, config, container, and delegate
  constructor(specDict, container, delegate, options) {
    this.container = container;
    this.delegate = delegate;
    this.options = options;
    this.signalHandlers = {};
    var compileResult = prepareRuntimeFromSpecDict(specDict);
    if (compileResult.error) {
      throw compileResult.error;
    }
    var runtime = compileResult.runtime;
    window.addEventListener = container.addEventListener.bind(container);
    window.removeEventListener = container.removeEventListener.bind(container);
    this.container.viewRenderer = this;
    if (console.benchmark !== undefined) {
      var t_start = console.benchmark.measureTime();
    }
    this.vegaView = new vega.View(
        runtime, {logLevel : vega.Warn, renderer : options.renderer, loader : new Loader(this), hover : true});
    // set 'none' to bindContainer so Vega won't attempt to bind any signal
    this.vegaView.initialize(this.container);
    this.canvas = this.vegaView._renderer._canvas;
    this.vegaView._renderer.onViewUpdate = () => { this.delegate.updateNativeView(); };
    if (console.benchmark !== undefined) {
      var t_end = console.benchmark.measureTime();
      console.benchmark.reportInterval(console.benchmark.kEntityInitVegaView, t_start, t_end);
    }
  isEventConsumed(event) {
    // A hacky implementation for now. Ideally Vega should be able to tell us.
    // (note that event.defaultPrevented doesn't help here)
    return event && event.item && event.item.datum != null;
  getWidth() { return this.vegaView._renderer._width; }
  getHeight() { return this.vegaView._renderer._height; }
  saveState(named_datasets) {
    return this.vegaView.getState({
      signals : (name, op) => {
        // Skip native-handled signals.
        // They can't be saved correctly; they will work without saving.
        return !(name === 'parent' || this.signalHandlers[name] != null || op instanceof vega.transforms.proxy);
      },
      data : (name, data) => {
        if (named_datasets.indexOf(name) < 0) {
          return false;
        }
        return vega.isArray(data.input.value) && name.indexOf('_:vega:_');
      },
      recurse : true
    });
  loadState(state) { this.vegaView.setState(state); }
  redraw() {
    this.vegaView._renderer.redraw();
    this.vegaView._redraw = true;
  // Call touch on all dataflow operators. This will cause the dataflow to rerun on next runAsync
  touchDataflow() {
    var context = this.vegaView._runtime;
    for (var key of Object.keys(context.nodes)) {
      var node = context.nodes[key];
      context.dataflow.touch(node);
    }
  rerender() { this.vegaView._renderer.rerender(); }
  finalize() { this.vegaView.finalize(); }
  safeSetSignal(name, value) {
    if (this.signalHandlers[name] != null) {
      var handler = this.signalHandlers[name];
      var newValue = new Proxy({}, {
        get : (target, property) => {
          var val = handler.get(target, property);
          if (val != null) {
            return val;
          }
          return undefined;
        }
      });
      try {
        this.vegaView.signal(name, newValue);
      } catch (e) {
        // We don't emit an error message when a
        // natively-handled signal is not used in the spec.
      }
    } else {
      try {
        this.vegaView.signal(name, value);
      } catch (e) {
        if (!predefinedSignalNames.has(name)) {
          console.error(`Attempted to set an undefined signal "${name}"`);
        }
      }
    }
  safeGetSignal(name) {
    try {
      return this.vegaView.signal(name);
    } catch (e) {
      if (this.signalHandlers[name] == null) {
        if (!predefinedSignalNames.has(name)) {
          console.error(`Attempted to read an undefined signal "${name}"`);
        }
      }
      return undefined;
    }
  safeAddSignalListener(name, listener) {
    try {
      this.vegaView.addSignalListener(name, listener);
    } catch (e) {
    }
  safeRemoveSignalListener(name, listener) {
    try {
      this.vegaView.removeSignalListener(name, listener);
    } catch (e) {
    }
  setupSignalHandler(name, handler) {
    this.signalHandlers[name] = handler;
    this.safeSetSignal(name, this.safeGetSignal(name));
  setScaleZoomFactor(scaleFactor, zoomFactor) {
    if (this.vegaView._renderer) {
      if (this.vegaView._renderer.setScaleZoomFactor) {
        this.vegaView._renderer.setScaleZoomFactor(scaleFactor, zoomFactor);
        this.vegaView._redraw = true;
      }
    } else {
      console.warn("setScaleZoomFactor: renderer is not available so this call has no effect", scaleFactor, zoomFactor);
    }
function createViewRenderer(specDict, container, delegate, options) {
  return new ViewRenderer(specDict, container, delegate, options);
function resize(canvas, width, height, origin, scaleFactor, opt) {
  var context = canvas.getContext("2d"), ratio = scaleFactor != undefined ? scaleFactor : window.devicePixelRatio, key;
  console.log("resizing canvas with width: " + width + ", height: " + height + ", scale: " + ratio);
  canvas.width = width * ratio;
  canvas.height = height * ratio;
  for (key in opt) {
    context[key] = opt[key];
  if (ratio !== 1) {
    canvas.style.width = width + "px";
    canvas.style.height = height + "px";
  context.pixelRatio = ratio;
  context.setTransform(ratio, 0, 0, ratio, ratio * origin[0], ratio * origin[1]);
  return canvas;
class CCVegaCanvasRenderer extends vega.CanvasRenderer {
  constructor(loader) {
    super(loader);
    this._previousScene = null;
  resize(width, height, origin) {
    if (this._scaleFactor == undefined) {
      this._scaleFactor = window.devicePixelRatio;
    }
    vega.Renderer.prototype.resize.call(this, width, height, origin, this._scaleFactor);
    resize(this._canvas, this._width, this._height, this._origin, this._scaleFactor,
           this._options && this._options.context);
    this._redraw = true;
    return this;
  };
  redraw() { this._redraw = true; }
  rerender() {
    if (this._previousScene != null) {
      this.redraw();
      this._render(this._previousScene);
    }
  setScaleZoomFactor(scaleFactor) {
    this._scaleFactor = scaleFactor;
    this.resize(this._width, this._height, this._origin, this._scaleFactor);
    this._redraw = true;
  _render(scene) {
    this._previousScene = scene;
    super._render(scene);
    if (this.onViewUpdate) {
      this.onViewUpdate();
    }
vega.renderModule("CCVegaCanvasRenderer", {renderer : CCVegaCanvasRenderer, handler : vega.CanvasHandler})
class CCVegaCARenderer extends vega.Renderer {
  constructor(loader) {
    super(loader);
    this._previousScene = null;
  initialize(el, width, height, origin, scaleFactor) {
    // Create a cc-layer element to fake the canvas element
    this._canvas = document.createElement("div");
    el.appendChild(this._canvas);
    this._CARenderer = el.viewRenderer.options.CADelegate;
    return super.initialize(el, width, height, origin, scaleFactor);
  resize(width, height, origin, scaleFactor) {
    super.resize(width, height, origin, scaleFactor);
    this._CARenderer.resize(width, height, origin[0], origin[1]);
    return this;
  // Need to have a canvas element for event processing to go properly.
  canvas() { return this._canvas; }
  _render(scene) {
    this._previousScene = scene;
    this._CARenderer.backgroundColor = this._bgcolor;
    if (this._dirty) {
      this._CARenderer.dirty();
      this._dirty = false;
    }
    this._CARenderer.render(scene);
    if (this.onViewUpdate) {
      this.onViewUpdate();
    }
  redraw() { this._CARenderer.dirtyAll(); }
  rerender() {
    if (this._previousScene != null) {
      this.redraw();
      this._render(this._previousScene);
    }
  dirty(item) {
    item._caDirty = true;
    this._dirty = true;
// The handler for the Core Animation renderer
class CCVegaCAHandler extends vega.CanvasHandler {
  initialize(el, origin, obj) {
    // add event listeners
    this._pickCanvas = document.createElement("canvas");
    this._pickContext = this._pickCanvas.getContext("2d");
    this._pickContext.pixelRatio = 1;
    var prototype = vega.CanvasHandler.prototype;
    var canvas = (this._canvas = el.childNodes[0]);
    if (canvas) {
      var that = this;
      this.events.forEach(function(type) {
        canvas.addEventListener(type, function(evt) {
          if (prototype[type]) {
            prototype[type].call(that, evt);
          } else {
            that.fire(type, evt);
          }
        });
      });
    }
    return vega.Handler.prototype.initialize.call(this, el, origin, obj);
  origin(origin) {
    if (arguments.length) {
      this._pickContext.setTransform(1, 0, 0, 1, origin[0], origin[1]);
    }
    return super.origin(origin);
  context() { return this._pickContext; }
vega.renderModule("CCVegaCARenderer", {renderer : CCVegaCARenderer, handler : CCVegaCAHandler});
